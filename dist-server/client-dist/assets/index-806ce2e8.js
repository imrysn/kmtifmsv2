import{r as n,a as Pt,b as We}from"./react-vendor-a308f804.js";import{H as Rt,R as Bt,a as vs,N as ys}from"./router-vendor-90630356.js";import{a as Ps}from"./anime-vendor-37453147.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}})();var Gs={exports:{}},ns={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=n,Ot=Symbol.for("react.element"),Ut=Symbol.for("react.fragment"),Vt=Object.prototype.hasOwnProperty,Ht=zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Wt={key:!0,ref:!0,__self:!0,__source:!0};function Ys(a,s,t){var i,l={},o=null,r=null;t!==void 0&&(o=""+t),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(r=s.ref);for(i in s)Vt.call(s,i)&&!Wt.hasOwnProperty(i)&&(l[i]=s[i]);if(a&&a.defaultProps)for(i in s=a.defaultProps,s)l[i]===void 0&&(l[i]=s[i]);return{$$typeof:Ot,type:a,key:o,ref:r,props:l,_owner:Ht.current}}ns.Fragment=Ut;ns.jsx=Ys;ns.jsxs=Ys;Gs.exports=ns;var e=Gs.exports,Cs={},Rs=Pt;Cs.createRoot=Rs.createRoot,Cs.hydrateRoot=Rs.hydrateRoot;const qt=!1,Kt=["password","token","secret","apiKey","api_key","accessToken","refreshToken","privateKey","sessionId","sessionToken"],Jt=["email","username","phone","address","ssn","creditCard","bankAccount"];function as(a,s=!qt){if(!a||typeof a!="object")return a;if(Array.isArray(a))return a.map(i=>as(i,s));const t={};for(const[i,l]of Object.entries(a)){const o=i.toLowerCase();if(Kt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}if(s&&Jt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}l&&typeof l=="object"?t[i]=as(l,s):t[i]=l}return t}function Qt(a){return a?{id:a.id,role:a.role||a.panelType,team:a.team,username:`${a.username?.[0]}***`,email:"***@***.***",timestamp:new Date().toISOString()}:null}class Gt{constructor(s="App"){this.component=s}log(s,t=null){}info(s,t=null){const i=t?as(t):null;console.info(`â„¹ï¸ [${this.component}] ${s}`,i||"")}warn(s,t=null){const i=t?as(t):null;console.warn(`âš ï¸ [${this.component}] ${s}`,i||"")}error(s,t=null){const i=t?{message:t.message,name:t.name,stack:void 0}:null;console.error(`âŒ [${this.component}] ${s}`,i||"")}logLogin(s){const t=Qt(s);this.info("User logged in",t)}logLogout(){this.info("User logged out")}logStateUpdate(s){this.log(`State updated: ${s}`)}logNavigation(s,t){this.log(`Navigation: ${s} â†’ ${t}`)}debug(s,t=null){}logPerformance(s,t){console.log(`âš¡ [${this.component}] ${s} took ${t}ms`)}}function Zs(a){return new Gt(a)}const Yt=""+new URL("kmti_logo-e782f075.png",import.meta.url).href,Bs=Zs("Login"),be={EMAIL:"kmt_login_email",PASSWORD:"kmt_login_password",REMEMBER:"kmt_remember_me"},Zt=({onLogin:a})=>{const[s,t]=n.useState("user"),[i,l]=n.useState({email:"",password:""}),[o,r]=n.useState({}),[d,p]=n.useState(!1),[x,S]=n.useState(""),[k,c]=n.useState(!1),[C,M]=n.useState(!1),[I,f]=n.useState(""),[u,g]=n.useState(!1),[w,T]=n.useState(!1),[z,Y]=n.useState("");n.useEffect(()=>{if(localStorage.getItem(be.REMEMBER)==="true"){const K=localStorage.getItem(be.EMAIL)||"",ee=localStorage.getItem(be.PASSWORD)||"";l({email:K,password:ee}),M(!0)}},[]);const U=()=>{t(s==="user"?"admin":"user"),l({email:"",password:""}),r({}),S("")},B=L=>{const K=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,ee=/^[a-zA-Z0-9._-]+$/;return L.includes("@")?K.test(L):ee.test(L)&&L.length>=3&&L.length<=30},P=()=>{const L={};return i.email.trim()?B(i.email)||(i.email.includes("@")?L.email="Please enter a valid email address":L.email="Username must be 3-30 characters and contain only letters, numbers, dots, underscores, or hyphens"):L.email="Username or email is required",i.password.trim()||(L.password="Password is required"),r(L),Object.keys(L).length===0},E=()=>{T(!0),Y("")},W=async()=>{if(z.trim()){g(!0),f("");try{const K=await(await fetch("http://localhost:3001/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:z.trim()})})).json();K.success?(f("Password reset instructions have been sent to Admin (Contact him for your new password)."),T(!1)):f(K.message||"Failed to send reset email.")}catch(L){Bs.error("Forgot password failed",L),f("Unable to connect to server. Please try again.")}finally{g(!1)}}},Z=()=>{T(!1),Y("")},O=L=>{const{name:K,value:ee}=L.target;l(te=>({...te,[K]:ee})),o[K]&&r(te=>({...te,[K]:""})),x&&S("")},V=async L=>{if(L.preventDefault(),!!P()){p(!0),S("");try{const ee=await(await fetch("http://localhost:3001/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,loginType:s})})).json();ee.success?(C?(localStorage.setItem(be.EMAIL,i.email),localStorage.setItem(be.PASSWORD,i.password),localStorage.setItem(be.REMEMBER,"true")):(localStorage.removeItem(be.EMAIL),localStorage.removeItem(be.PASSWORD),localStorage.removeItem(be.REMEMBER)),setTimeout(()=>{a(ee.user)},200)):S(ee.message||"Login failed")}catch(K){Bs.error("Login failed",K),S("Unable to connect to server. Please try again.")}finally{p(!1)}}};return e.jsxs("div",{className:"unified-login-container",children:[e.jsxs("div",{className:"main-login-card",children:[e.jsx("div",{className:"welcome-section",children:e.jsxs("div",{className:"welcome-content",children:[e.jsx("div",{className:"logo-container",children:e.jsx("img",{src:Yt,alt:"KMTI Logo",className:"login-logo"})}),e.jsx("div",{className:"system-name",children:e.jsx("p",{children:"File Management System"})})]})}),e.jsx("div",{className:"login-section",children:e.jsxs("div",{className:"login-form-container",children:[e.jsx("div",{className:"login-header",children:e.jsx("h2",{children:"Sign in"})}),e.jsx("div",{className:"login-toggle",children:e.jsx("button",{type:"button",className:`toggle-switch ${s}`,onClick:U,"aria-label":`Switch to ${s==="user"?"Admin":"User"} login`,children:e.jsx("span",{className:"toggle-slider"})})}),e.jsxs("form",{onSubmit:V,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{type:"text",id:"email",name:"email",value:i.email,onChange:O,className:o.email?"error":"",disabled:d,placeholder:"User Name"}),o.email&&e.jsx("span",{className:"error-message",children:o.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:k?"text":"password",id:"password",name:"password",value:i.password,onChange:O,className:o.password?"error":"",disabled:d,placeholder:"Password"}),e.jsx("button",{type:"button",className:"show-password-btn",onClick:()=>c(!k),children:"SHOW"})]}),o.password&&e.jsx("span",{className:"error-message",children:o.password})]}),e.jsxs("div",{className:"form-options",children:[e.jsxs("label",{className:"remember-me",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:L=>M(L.target.checked)}),e.jsx("span",{className:"checkmark"}),"Remember me"]}),e.jsx("button",{type:"button",className:"forgot-password",onClick:E,disabled:u||d,children:u?"Sending...":"Forgot Password?"})]}),x&&e.jsx("div",{className:"api-error",children:x}),I&&e.jsx("div",{className:"api-error",style:{backgroundColor:"#DCFCE7",color:"#166534",borderColor:"#BBF7D0"},children:I}),e.jsx("button",{type:"submit",className:`login-button ${s} ${d?"loading":""}`,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),e.jsx("span",{children:"Signing In..."})]}):"Sign in"})]})]})})]}),w&&e.jsx("div",{className:"modal-overlay",onClick:Z,children:e.jsxs("div",{className:"modal-content",onClick:L=>L.stopPropagation(),children:[e.jsx("h3",{children:"Reset Password"}),e.jsx("p",{children:"Enter your email address or username to receive password reset instructions."}),e.jsx("input",{type:"text",value:z,onChange:L=>Y(L.target.value),placeholder:"Email or Username",disabled:u}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:Z,disabled:u,className:"cancel-button",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:!z.trim()||u,className:"submit-button",children:u?"Sending...":"Send Reset Password"})]})]})})]})},Xt="modulepreload",ea=function(a,s){return new URL(a,s).href},zs={},he=function(s,t,i){if(!t||t.length===0)return s();const l=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=ea(o,i),o in zs)return;zs[o]=!0;const r=o.endsWith(".css"),d=r?'[rel="stylesheet"]':"";if(!!i)for(let S=l.length-1;S>=0;S--){const k=l[S];if(k.href===o&&(!r||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${d}`))return;const x=document.createElement("link");if(x.rel=r?"stylesheet":Xt,r||(x.as="script",x.crossOrigin=""),x.href=o,document.head.appendChild(x),r)return new Promise((S,k)=>{x.addEventListener("load",S),x.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>s()).catch(o=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o})};const re=({type:a="dashboard"})=>{switch(a){case"dashboard":return e.jsx(Os,{});case"admin":return e.jsx(sa,{});case"teamleader":return e.jsx(ta,{});case"myfiles":return e.jsx(aa,{});case"table":return e.jsx(na,{});case"card":return e.jsx(ia,{});case"grid":return e.jsx(la,{});default:return e.jsx(Os,{})}},Os=()=>e.jsxs("div",{className:"skeleton-container",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"20px"}}),[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a))]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]},a))}),e.jsxs("div",{className:"skeleton-content-area",children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"200px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))})]})]})]}),sa=()=>e.jsxs("div",{className:"skeleton-container admin-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),[1,2,3,4,5,6].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-stats-grid",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70%"}})]},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"40px",width:"250px",marginBottom:"16px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5,6].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"15%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"10%"}})]},a))})]})]})]}),ta=()=>e.jsxs("div",{className:"skeleton-container tl-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",style:{width:"260px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"32px"}}),[1,2,3,4].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"12px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"70px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3].map(a=>e.jsx("div",{className:"skeleton-card",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",borderRadius:"12px"}})]})},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"180px",marginBottom:"20px"}}),e.jsxs("div",{className:"skeleton-table",children:[e.jsx("div",{className:"skeleton-table-header",children:[1,2,3,4,5,6,7,8].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}},a))}),[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"90%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"85%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"55%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"32px",borderRadius:"6px"}})]},a))]})]})]})]}),aa=()=>e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"140px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"200px"}})]}),e.jsx("div",{style:{display:"flex",gap:"0"},children:[1,2,3,4].map(a=>e.jsxs("div",{style:{borderRight:a!==4?"1px solid #d5d5d9":"none",padding:"0 24px",display:"flex",alignItems:"center",gap:"16px",minWidth:"200px",height:"80px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"56px",height:"56px",borderRadius:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"40px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"140px"}})]})]},a))})]}),e.jsxs("div",{style:{background:"white",border:"1px solid #d5d5d9",borderRadius:"12px",overflow:"hidden"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"14px 20px",background:"white",borderBottom:"1px solid #d5d5d9"},children:["FILENAME","DATE & TIME","TEAM","STATUS","ACTIONS"].map((a,s)=>e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80px"}},s))}),[1,2,3,4,5,6,7,8,9,10].map(a=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"16px 20px",borderBottom:a!==10?"1px solid #e5e5ea":"none",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"44px",height:"44px",borderRadius:"8px",flexShrink:0}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"70%",marginBottom:"6px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"40%"}})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"90%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"70%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"180px",borderRadius:"50px"}}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70px",borderRadius:"6px"}})})]},a))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",background:"white",borderTop:"1px solid #e5e5ea",marginTop:"-1px",borderRadius:"0 0 12px 12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"200px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"100px",borderRadius:"6px"}})]}),e.jsx("div",{style:{display:"flex",gap:"6px"},children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"36px",borderRadius:"6px"}},a))})]})]}),na=()=>e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))}),ia=()=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"80%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}})]}),la=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",padding:"1.5rem"},children:[1,2,3,4,5,6,7,8,9,10,11,12].map(a=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"1rem",borderRadius:"8px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",marginBottom:"0.75rem",borderRadius:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"100%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}})]},a))}),oa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z",fill:"#FDB022"})}),ra=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#E74C3C"}),e.jsx("path",{d:"M14 2v6h6",fill:"#C0392B"}),e.jsx("text",{x:"12",y:"17",fontSize:"6",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"PDF"})]}),Us=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#2980B9"}),e.jsx("path",{d:"M14 2v6h6",fill:"#3498DB"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"DOC"})]}),Vs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#27AE60"}),e.jsx("path",{d:"M14 2v6h6",fill:"#229954"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"XLS"})]}),Ue=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z",fill:"#9B59B6"})}),ws=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#95A5A6"}),e.jsx("path",{d:"M14 2v6h6M10 8h2v2h-2v-2zm0 2h2v2h-2v-2z",fill:"#7F8C8D"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"ZIP"})]}),Xe=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M18 4l2 3h-3l-2-3h-2l2 3h-3l-2-3H8l2 3H7L5 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z",fill:"#E67E22"}),e.jsx("path",{d:"M10 12l5 3-5 3v-6z",fill:"white"})]}),Ns=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z",fill:"#1ABC9C"})}),Ve=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#34495E"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2C3E50"}),e.jsx("rect",{x:"8",y:"12",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"14",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"16",width:"6",height:"1",fill:"white"})]}),$e=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#3498DB"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2980B9"}),e.jsx("circle",{cx:"12",cy:"14",r:"3",fill:"none",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14",stroke:"white",strokeWidth:"0.5"})]}),ca=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#BDC3C7"}),e.jsx("path",{d:"M14 2v6h6",fill:"#95A5A6"})]}),da=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})}),ha=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z",fill:"currentColor"})}),ma=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z",fill:"currentColor"})}),ua=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z",fill:"currentColor"})}),Hs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),pa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z",fill:"currentColor"})}),fa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z",fill:"currentColor"})}),xa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z",fill:"currentColor"})}),ga=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z",fill:"currentColor"})}),ja=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),va=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"}),e.jsx("path",{d:"M14 2v6h6"}),e.jsx("path",{d:"M16 13H8"}),e.jsx("path",{d:"M16 17H8"}),e.jsx("path",{d:"M10 9H8"})]}),ya=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"})}),wa=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),Na=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 9l-9 9z"}),e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),e.jsx("path",{d:"M13.59 7l-1.42 1.41L16.17 12l-4.59 4.59L13.59 18l6-6z"}),e.jsx("path",{d:"M7.41 7L6 8.41l4.59 4.59L6 17.59 7.41 19l6-6z"})]}),He={folder:oa,pdf:ra,doc:Us,docx:Us,xls:Vs,xlsx:Vs,jpg:Ue,jpeg:Ue,png:Ue,gif:Ue,bmp:Ue,zip:ws,rar:ws,"7z":ws,mp4:Xe,mov:Xe,avi:Xe,mkv:Xe,mp3:Ns,wav:Ns,flac:Ns,txt:Ve,json:Ve,html:Ve,css:Ve,js:Ve,default:ca,icd:$e,sldprt:$e,sldasm:$e,slddrw:$e,dwg:$e,dxf:$e,dashboard:da,files:ha,users:ma,activityLogs:ua,fileApproval:Hs,settings:pa,logout:fa,tasks:xa,notifications:ga,comment:ja,assignment:va,approval:Hs,rejection:ya,final_approval:wa,final_rejection:Na},ba=(a,s=!1)=>{if(s)return He.folder;const t=a?.toLowerCase()||"";return He[t]||He.default},me=a=>{const s=He[a]||He.default;return e.jsx(s,{})},ka=({fileType:a,isFolder:s=!1,altText:t="File Icon",className:i="",style:l={},size:o="default"})=>{const r=ba(a,s),d={small:{width:"24px",height:"24px"},default:{width:"40px",height:"40px"},medium:{width:"48px",height:"48px"},large:{width:"64px",height:"64px"}},p=typeof o=="string"&&d[o]?d[o]:d.default;return e.jsx("div",{className:`file-icon-wrapper ${i}`.trim(),style:{width:p.width,height:p.height,minWidth:p.width,minHeight:p.height,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,background:"transparent",...l},role:"img","aria-label":t,children:e.jsx(r,{})})},qe=We.memo(ka);const Ca=({activeTab:a,setActiveTab:s,filesCount:t,notificationCount:i,onLogout:l,user:o})=>e.jsxs("div",{className:"user-sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:o?.fullName||"User"}),e.jsx("div",{className:"user-role",children:o?.team||"No Team"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${a==="dashboard"?"active":""}`,onClick:()=>s("dashboard"),children:[e.jsx("span",{className:"nav-icon",children:me("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${a==="notification"?"active":""}`,onClick:()=>s("notification"),children:[e.jsxs("span",{className:"nav-icon notification-icon-wrapper",children:[me("notifications"),i>0&&e.jsx("span",{className:"notification-badge",children:i})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${a==="my-files"?"active":""}`,onClick:()=>s("my-files"),children:[e.jsx("span",{className:"nav-icon",children:me("files")}),e.jsx("span",{className:"nav-label",children:"My Files"}),t>0&&e.jsx("span",{className:"file-count-badge",children:t})]}),e.jsxs("button",{className:`nav-item ${a==="tasks"?"active":""}`,onClick:()=>s("tasks"),children:[e.jsx("span",{className:"nav-icon",children:me("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${a==="team-files"?"active":""}`,onClick:()=>s("team-files"),children:[e.jsx("span",{className:"nav-icon",children:me("users")}),e.jsx("span",{className:"nav-label",children:"Team Tasks"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{className:"logout-btn",onClick:l,children:[e.jsx("span",{className:"nav-icon",children:me("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]});const Ss=({type:a,message:s,onClose:t})=>(n.useEffect(()=>{if(s){const i=setTimeout(()=>{t()},2e3);return()=>clearTimeout(i)}},[s,t]),s?e.jsx("div",{className:"alert-message-component",children:e.jsxs("div",{className:`alert alert-${a}`,children:[e.jsx("span",{className:"alert-message",children:s}),e.jsx("button",{onClick:t,className:"alert-close",children:"Ã—"})]})}):null);let Ae=!0,_s=document.title,is=!1,ts=null;try{window.electron&&window.electron.flashFrame&&(is=!0,ts=window.electron,console.log("âœ… Electron environment detected - using native window flashing"))}catch{console.log("â„¹ï¸ Browser environment detected - using title flashing")}document.addEventListener("visibilitychange",()=>{Ae=!document.hidden,Ae&&De()});is&&(window.addEventListener("focus",()=>{Ae=!0,De()}),window.addEventListener("blur",()=>{Ae=!1}));window.addEventListener("load",()=>{_s=document.title});const Fs=(a="New Notification",s=1e4)=>{console.log(`ðŸ”” flashTaskbar called: "${a}" (isElectron: ${is}, isVisible: ${Ae})`),console.log("âš ï¸ Taskbar flash disabled to prevent page blinking")},De=()=>{console.log("â¹ï¸ Stopping taskbar flash"),is&&ts&&ts.flashFrame&&ts.flashFrame(!1),document.title=_s},Ts=a=>{_s=a,Ae&&(document.title=a)},Ms=a=>{if(a>0){const s=a===1?"New Notification":`${a} New Notifications`;Fs(s)}},Xs=()=>Ae,Sa={flashTaskbar:Fs,stopFlashing:De,updateOriginalTitle:Ts,flashForNotifications:Ms,isVisible:Xs},_a=Object.freeze(Object.defineProperty({__proto__:null,default:Sa,flashForNotifications:Ms,flashTaskbar:Fs,isVisible:Xs,stopFlashing:De,updateOriginalTitle:Ts},Symbol.toStringTag,{value:"Module"})),et=(a,s={})=>{const{enabled:t=!0,duration:i=1e4,pageTitle:l=null}=s,o=n.useRef(a);return n.useEffect(()=>{l&&Ts(l)},[l]),n.useEffect(()=>{if(!t)return;const r=a-o.current;r>0&&(console.log(`ðŸ“¢ ${r} new notification(s) - Flashing taskbar`),Ms(r)),o.current=a},[a,t]),n.useEffect(()=>()=>{De()},[]),{stopFlashing:De}},st=(a={})=>{const{duration:s=1e4}=a,t=(i="New Notification")=>{console.log(`ðŸ“¢ Manual flash: ${i}`),he(()=>Promise.resolve().then(()=>_a),void 0,import.meta.url).then(l=>{l.flashTaskbar(i,s)})};return n.useEffect(()=>()=>{De()},[]),t},Fa=({notifications:a,onClose:s,onNavigate:t})=>{const[i,l]=n.useState([]),[o,r]=n.useState(new Set),d=st({duration:5e3});n.useEffect(()=>{const c=a.filter(C=>!C.is_read&&!o.has(C.id)).slice(0,3);if(l(c),c.length>0){const C=c.length===1?c[0].title:`${c.length} New Notifications`;d(C)}if(c.length>0){const C=c.map(M=>setTimeout(()=>{p(M.id)},5e3));return()=>C.forEach(M=>clearTimeout(M))}},[a,o]);const p=n.useCallback(c=>{r(C=>new Set([...C,c])),l(C=>C.filter(M=>M.id!==c))},[]),x=n.useCallback(c=>{t&&(c.type==="comment"&&c.assignment_id?(c.action_by_username&&sessionStorage.setItem("highlightCommentBy",c.action_by_username),t("tasks",c.assignment_id)):c.type==="assignment"&&c.assignment_id?t("tasks",c.assignment_id):((c.type==="approval"||c.type==="rejection"||c.type==="final_approval"||c.type==="final_rejection")&&c.file_id||c.file_id)&&t("my-files",c.file_id)),p(c.id)},[t,p]),S=n.useCallback(c=>{switch(c){case"comment":return"ðŸ’¬";case"assignment":return"ðŸ“‹";case"approval":return"âœ…";case"rejection":return"âŒ";case"final_approval":return"ðŸŽ‰";case"final_rejection":return"ðŸš«";default:return"ðŸ””"}},[]),k=n.useCallback(c=>{switch(c){case"comment":return"blue";case"assignment":return"purple";case"approval":case"final_approval":return"green";case"rejection":case"final_rejection":return"red";default:return"gray"}},[]);return i.length===0?null:e.jsx("div",{className:"toast-container cursor-pointer",children:i.map((c,C)=>e.jsxs("div",{className:`toast-notification toast-${k(c.type)}`,style:{animationDelay:`${C*100}ms`},onClick:()=>x(c),children:[e.jsx("div",{className:"toast-icon",children:S(c.type)}),e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-title",children:c.title}),e.jsx("div",{className:"toast-message",children:c.message}),e.jsxs("div",{className:"toast-meta",children:[e.jsxs("span",{children:["ðŸ‘¤ ",c.action_by_username]}),c.assignment_title&&e.jsxs("span",{children:["ðŸ“‹ ",c.assignment_title]})]})]}),e.jsx("button",{className:"toast-close",onClick:M=>{M.stopPropagation(),p(c.id)},children:"âœ•"})]},c.id))})};const Ta=({columns:a=5})=>e.jsx("tr",{className:"skeleton-row",children:Array.from({length:a}).map((s,t)=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-box-inline",style:{width:t===0?"80%":"60%"}})},t))}),Ma=()=>e.jsxs("div",{className:"skeleton-stat-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"30%"}})]}),Jn=({rows:a=5,columns:s=5})=>e.jsx("div",{className:"loading-table-container",children:e.jsxs("table",{style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:s}).map((t,i)=>e.jsx("th",{children:e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"70%"}})},i))})}),e.jsx("tbody",{children:Array.from({length:a}).map((t,i)=>e.jsx(Ta,{columns:s},i))})]})}),Ws=({count:a=4})=>e.jsx("div",{className:"loading-cards-grid",children:Array.from({length:a}).map((s,t)=>e.jsx(Ma,{},t))}),qs=({user:a,files:s,setActiveTab:t,onOpenFile:i,onNavigateToTasks:l})=>{const[o,r]=n.useState([]),[d,p]=n.useState([]),[x,S]=n.useState([]),[k,c]=n.useState(!0),[C,M]=n.useState(new Date);n.useEffect(()=>{I();const E=setInterval(()=>{I(!0)},3e4);return()=>clearInterval(E)},[a.id,a.team]);const I=async(E=!1)=>{try{E||c(!0);const[W,Z,O]=await Promise.all([fetch(`http://localhost:3001/api/assignments/user/${a.id}`),fetch(`http://localhost:3001/api/assignments/team/${a.team}/all-tasks?limit=5`),fetch(`http://localhost:3001/api/notifications/user/${a.id}`)]),[V,L,K]=await Promise.all([W.json(),Z.json(),O.json()]);V.success&&r(V.assignments||[]),L.success&&p(L.assignments||[]),K.success&&S(K.notifications||[]),M(new Date)}catch(W){console.error("Error fetching dashboard data:",W)}finally{c(!1)}},f=async E=>{try{await fetch(`http://localhost:3001/api/notifications/${E.id}/read`,{method:"PUT"})}catch(W){console.error("Error marking notification as read:",W)}E.type==="comment"&&E.assignment_id?(sessionStorage.setItem("scrollToAssignment",E.assignment_id),sessionStorage.setItem("highlightCommentBy",E.action_by_username),l?l(E.assignment_id):t("tasks")):E.type==="assignment"?l?l():t("tasks"):E.file_id&&(i?i(E.file_id):t("my-files"))},u={total:o.length,pending:o.filter(E=>E.user_status!=="submitted").length,submitted:o.filter(E=>E.user_status==="submitted").length,overdue:o.filter(E=>E.due_date?new Date(E.due_date)<new Date&&E.user_status!=="submitted":!1).length},g={total:s.length,pending:s.filter(E=>E.current_stage?.includes("pending")).length,approved:s.filter(E=>E.status==="final_approved").length,rejected:s.filter(E=>E.status?.includes("rejected")||E.current_stage?.includes("rejected")).length},w={totalTasks:d.length,totalSubmissions:d.reduce((E,W)=>E+(W.recent_submissions?W.recent_submissions.length:0),0)},T={unread:x.filter(E=>!E.is_read).length,recent:x.slice(0,3)},z=u.total>0?Math.round(u.submitted/u.total*100):0,Y=g.total>0?Math.round(g.approved/g.total*100):0,U=g.total>0?Math.round(g.rejected/g.total*100):0,B=u.total>0?Math.round((u.total-u.overdue)/u.total*100):100,P=(()=>{const E=u.total>0?u.submitted/u.total*100:0,W=g.total>0?g.approved/g.total*100:0,Z=g.total>0?g.rejected/g.total*20:0,O=u.total>0?(u.total-u.overdue)/u.total*100:100,V=E*.4+W*.3+O*.3;return Math.max(0,Math.round(V-Z))})();return k?e.jsx("div",{className:"modern-dashboard",children:e.jsxs("div",{className:"dashboard-skeleton",children:[e.jsx("div",{className:"top-stats-grid",children:e.jsx(Ws,{count:3})}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"180px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"40px",width:"100%",marginBottom:"20px"}}),e.jsx("div",{className:"analytics-metrics-grid",children:e.jsx(Ws,{count:4})})]}),e.jsxs("div",{className:"notifications-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"140px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%"}})]})]})]})}):e.jsxs("div",{className:"modern-dashboard",children:[e.jsxs("div",{className:"top-stats-grid",children:[e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("tasks"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Tasks"}),e.jsx("div",{className:"stat-card-value",children:u.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[u.pending," pending"]})," Â· ",e.jsxs("span",{className:"submitted-count",children:[u.submitted," submitted"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("my-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Files"}),e.jsx("div",{className:"stat-card-value",children:g.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[g.pending," pending"]})," Â· ",e.jsxs("span",{className:"approved-count",children:[g.approved," approved"]})," Â· ",e.jsxs("span",{className:"rejected-count",children:[g.rejected," rejected"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("team-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"Team Activity"}),e.jsx("div",{className:"stat-card-value",children:w.totalTasks}),e.jsxs("div",{className:"stat-card-detail",children:[w.totalTasks," tasks Â· ",w.totalSubmissions," submissions"]})]})]})]}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern",children:[e.jsx("div",{className:"analytics-card-header",children:e.jsx("h2",{className:"analytics-card-title",children:"Performance Analytics"})}),e.jsxs("div",{className:"analytics-content",children:[e.jsx("div",{className:"overall-score-section",children:e.jsxs("div",{className:"score-content-wrapper",children:[e.jsx("div",{className:"circular-progress-container",children:e.jsxs("svg",{className:"circular-progress-svg",viewBox:"0 0 200 200",children:[e.jsx("circle",{className:"progress-ring-bg",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18"}),e.jsx("circle",{className:"progress-ring-fill",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18",strokeDasharray:`${P/100*534} 534`,strokeLinecap:"round",style:{stroke:P>=85?"#10b981":P>=70?"#22c55e":P>=50?"#f59e0b":"#ef4444"}}),e.jsxs("text",{className:"score-percentage-text",x:"100",y:"95",textAnchor:"middle",children:[P,"%"]}),e.jsx("text",{className:"score-label-text",x:"100",y:"118",textAnchor:"middle",children:"Performance"})]})}),e.jsxs("div",{className:"score-description",children:[e.jsx("div",{className:"score-status",children:e.jsx("div",{className:"status-badge",style:{background:P>=85||P>=70?"#d1fae5":P>=50?"#fef3c7":"#fee2e2",color:P>=85||P>=70?"#065f46":P>=50?"#92400e":"#991b1b"},children:P>=85?"ðŸŒŸ Excellent":P>=70?"âœ… Good":P>=50?"âš ï¸ Fair":"ðŸ“‰ Needs Improvement"})}),e.jsx("p",{className:"score-message",children:P>=85?"Outstanding work! You're exceeding expectations.":P>=70?"Great job! Keep up the good momentum.":P>=50?"You're on track. Focus on completing pending tasks.":"Let's work on improving your completion rate."}),e.jsxs("div",{className:"score-legend-grid",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot excellent"}),e.jsx("span",{children:"85-100% Excellent"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot good"}),e.jsx("span",{children:"70-84% Good"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot fair"}),e.jsx("span",{children:"50-69% Fair"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot poor"}),e.jsx("span",{children:"0-49% Poor"})]})]})]})]})}),e.jsxs("div",{className:"analytics-metrics-grid",children:[e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon task-completion-icon",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Task Completion"}),e.jsxs("div",{className:"metric-value",children:[z,"%"]}),e.jsxs("div",{className:"metric-detail",children:[u.submitted,"/",u.total," completed"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon ontime-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"On-Time Delivery"}),e.jsxs("div",{className:"metric-value",children:[B,"%"]}),e.jsxs("div",{className:"metric-detail",children:[u.total-u.overdue,"/",u.total," on time"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon approval-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Approval Rate"}),e.jsxs("div",{className:"metric-value",children:[Y,"%"]}),e.jsxs("div",{className:"metric-detail",children:[g.approved,"/",g.total," approved"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon rejection-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Rejection Rate"}),e.jsxs("div",{className:"metric-value",children:[U,"%"]}),e.jsxs("div",{className:"metric-detail",children:[g.rejected,"/",g.total," rejected"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon overdue-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Overdue Tasks"}),e.jsx("div",{className:"metric-value",children:u.overdue}),e.jsx("div",{className:"metric-detail",children:"Tasks awaiting attention"})]})]})]})]})]}),e.jsxs("div",{className:"notifications-card-modern",children:[e.jsxs("div",{className:"notifications-card-header",children:[e.jsxs("h2",{className:"notifications-card-title",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),"Notifications"]}),e.jsx("div",{className:"notifications-badge",children:T.unread})]}),e.jsx("div",{className:"notifications-content",children:T.recent.length>0?e.jsxs(e.Fragment,{children:[T.recent.map(E=>e.jsx("div",{className:`notification-item-modern ${E.is_read?"":"unread"}`,onClick:()=>f(E),style:{cursor:"pointer"},children:e.jsxs("div",{className:"notification-text",children:[e.jsx("div",{className:"notification-title-modern",children:E.title}),e.jsx("div",{className:"notification-time-modern",children:(()=>{const W=new Date,Z=new Date(E.created_at),O=W-Z,V=Math.floor(O/6e4),L=Math.floor(O/36e5);return V<60?`${V} minutes ago`:L<24?`${L} hour${L>1?"s":""} ago`:Z.toLocaleDateString()})()})]})},E.id)),e.jsx("button",{className:"view-all-notifications-btn",onClick:()=>t("notification"),children:"View all notifications"})]}):e.jsxs("div",{className:"empty-notifications",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{children:"No notifications"})]})})]})]})]})},Ea=n.lazy(()=>he(()=>import("./TeamTasksTab-699314bc.js"),["./TeamTasksTab-699314bc.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TeamTasksTab-e9d479ad.css"],import.meta.url)),Aa=n.lazy(()=>he(()=>import("./MyFilesTab-bf03290e.js"),["./MyFilesTab-bf03290e.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./MyFilesTab-2608cae7.css"],import.meta.url)),Da=n.lazy(()=>he(()=>import("./NotificationTab-RealTime-dbde2110.js"),["./NotificationTab-RealTime-dbde2110.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./NotificationTab-RealTime-c831b0ad.css"],import.meta.url)),La=n.lazy(()=>he(()=>import("./TasksTab-Enhanced-13b554f7.js"),["./TasksTab-Enhanced-13b554f7.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TasksTab-Enhanced-f73d19c6.css"],import.meta.url)),Ia=n.lazy(()=>he(()=>import("./FileModal-2aa260ec.js"),["./FileModal-2aa260ec.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./FileModal-6990c4b3.css"],import.meta.url)),Ks=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,d]=n.useState([]),[p,x]=n.useState(!1),[S,k]=n.useState(""),[c,C]=n.useState(""),[M,I]=n.useState(null),[f,u]=n.useState(!1),[g,w]=n.useState([]),[T,z]=n.useState("all"),[Y,U]=n.useState(0),[B,P]=n.useState([]),E=async()=>{x(!0);try{const h=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();h.success?o(h.files||[]):k("Failed to fetch your files")}catch(N){console.error("Error fetching user files:",N),k("Failed to connect to server")}finally{x(!1)}},W=N=>{i(N)};n.useEffect(()=>{(async()=>{try{const v=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();v.success&&(U(v.unreadCount||0),P(v.notifications||[]))}catch(h){console.error("Error fetching notifications:",h)}})()},[a.id]),n.useEffect(()=>{E()},[a.id]),n.useEffect(()=>{t==="my-files"&&E()},[t,a.id]),n.useEffect(()=>{Z()},[l,T]);const Z=()=>{let N=l;T!=="all"&&(N=N.filter(h=>{switch(T){case"pending":return h.current_stage.includes("pending");case"approved":return h.status==="final_approved";case"rejected":return h.status.includes("rejected");default:return!0}})),d(N)},O=async N=>{I(N),u(!0);try{const v=await(await fetch(`http://localhost:3001/api/files/${N.id}/comments`)).json();v.success&&w(v.comments||[])}catch(h){console.error("Error fetching comments:",h),w([])}},V=async N=>{try{const v=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();if(v.success&&v.files){const y=v.files.find(q=>q.id===parseInt(N));y?(i("my-files"),setTimeout(async()=>{await O(y)},100)):k("File not found in your files")}else k("Failed to fetch file details")}catch(h){console.error("Error fetching file:",h),k("Failed to connect to server")}},L=(N=null)=>{i("tasks"),N&&sessionStorage.setItem("scrollToAssignment",N)},K=async(N,h)=>{N==="my-files"&&h?await V(h):N==="tasks"&&h?(i("tasks"),sessionStorage.setItem("scrollToAssignment",h)):i(N)},ee=N=>{if(N===0)return"0 Bytes";const h=1024,v=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(N)/Math.log(h));return parseFloat((N/Math.pow(h,y)).toFixed(2))+" "+v[y]},te=()=>{k(""),C("")},m=()=>{s()},j=N=>{C(N)},F=()=>{switch(t){case"dashboard":return e.jsx(qs,{user:a,files:l,setActiveTab:i});case"team-files":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Ea,{user:a})});case"my-files":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"myfiles"}),children:e.jsx(Aa,{filteredFiles:r,isLoading:p,filterStatus:T,setFilterStatus:z,setActiveTab:i,fetchUserFiles:E,formatFileSize:ee,openFileModal:O,files:l,user:a,onUploadSuccess:j})});case"notification":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"list"}),children:e.jsx(Da,{user:a,onOpenFile:V,onNavigateToTasks:L,onUpdateUnreadCount:U})});case"tasks":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(La,{user:a})});default:return e.jsx(qs,{user:a,files:l,setActiveTab:W,onOpenFile:V,onNavigateToTasks:L})}};return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"dashboard"}),children:e.jsxs("div",{className:"minimal-dashboard user-dashboard",children:[e.jsx(Ca,{activeTab:t,setActiveTab:W,filesCount:l.filter(N=>N.status==="uploaded"||N.status==="team_leader_approved"||N.status==="final_approved").length,notificationCount:Y,onLogout:m,user:a}),e.jsx("div",{className:"main-content",children:e.jsxs("div",{className:"dashboard-content",children:[e.jsx(Ss,{type:"error",message:S,onClose:te}),e.jsx(Ss,{type:"success",message:c,onClose:te}),F()]})}),f&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ia,{showFileModal:f,setShowFileModal:u,selectedFile:M,fileComments:g,formatFileSize:ee})}),e.jsx(Fa,{notifications:B,onNavigate:K})]})})};const $a=({activeTab:a,setActiveTab:s,clearMessages:t,setSidebarOpen:i,sidebarOpen:l,onLogout:o})=>{const r=d=>{s(d),t(),i(!1)};return e.jsxs("aside",{className:`tl-sidebar ${l?"open":""}`,children:[e.jsxs("div",{className:"tl-brand",children:[e.jsx("div",{className:"tl-brand-logo",children:"TL"}),e.jsx("span",{className:"tl-brand-name",children:"Team Leader"})]}),e.jsxs("nav",{className:"tl-nav",children:[e.jsxs("button",{className:`tl-nav-item ${a==="dashboard"?"active":""}`,onClick:()=>r("dashboard"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="notifications"?"active":""}`,onClick:()=>r("notifications"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("span",{children:"Notifications"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="file-collection"?"active":""}`,onClick:()=>r("file-collection"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),e.jsx("span",{children:"File Collection"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="assignments"?"active":""}`,onClick:()=>r("assignments"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 11l3 3L22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),e.jsx("span",{children:"Tasks"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="team-management"?"active":""}`,onClick:()=>r("team-management"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Team Management"})]})]}),e.jsx("div",{className:"tl-sidebar-footer",children:e.jsxs("button",{className:"tl-logout-btn",onClick:o,children:[e.jsxs("svg",{className:"tl-logout-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),e.jsx("span",{children:"Logout"})]})})]})},Pa=({error:a,success:s,clearMessages:t})=>!a&&!s?null:e.jsxs(e.Fragment,{children:[a&&e.jsxs("div",{className:"tl-alert error",children:[a,e.jsx("button",{onClick:t,children:"Ã—"})]}),s&&e.jsxs("div",{className:"tl-alert success",children:[s,e.jsx("button",{onClick:t,children:"Ã—"})]})]});const Pe=({isOpen:a,onClose:s,onConfirm:t,title:i="Confirm Action",message:l="Are you sure you want to proceed?",confirmText:o="Confirm",cancelText:r="Cancel",variant:d="danger",isLoading:p=!1,itemInfo:x,children:S})=>{if(!a)return null;const k=I=>{I.target===I.currentTarget&&!p&&s()},c=I=>{I.preventDefault(),I.stopPropagation(),p||t()},C=I=>{I.preventDefault(),I.stopPropagation(),p||s()},M=()=>{switch(d){case"danger":return"btn-danger";case"warning":return"btn-warning";case"info":return"btn-primary";default:return"btn-danger"}};return e.jsx("div",{className:"modal-overlay",onClick:k,children:e.jsxs("div",{className:`modal confirmation-modal ${d}`,onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:C,className:"modal-close",disabled:p,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:l}),x&&e.jsxs("div",{className:"item-info",children:[x.name&&e.jsx("div",{className:"item-name",children:x.name}),x.details&&e.jsx("div",{className:"item-details",children:x.details})]}),S,!S&&e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"delete-actions",children:[e.jsx("button",{type:"button",onClick:C,className:"btn btn-secondary",disabled:p,children:r}),e.jsx("button",{type:"button",onClick:c,className:`btn ${M()}`,disabled:p,children:p?"Deleting...":o})]})})]})})};const tt=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`tl-notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"tl-notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"tl-notification-content",children:[e.jsxs("div",{className:"tl-notification-title",children:[a.title,!a.is_read&&e.jsx("span",{className:"tl-unread-badge",children:"New"})]}),e.jsx("div",{className:"tl-notification-message",children:a.message}),e.jsxs("div",{className:"tl-notification-meta",children:[e.jsxs("span",{className:"tl-notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"tl-notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"tl-notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"tl-notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"tl-notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"tl-notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));tt.displayName="NotificationItem";const Qn=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,d]=n.useState(!1),[p,x]=n.useState(""),[S,k]=n.useState(0),[c,C]=n.useState(!1),[M,I]=n.useState(!1);et(S);const[f,u]=n.useState(1),[g,w]=n.useState(!0),[T,z]=n.useState(0),Y=20,U=n.useRef(null),B=n.useRef(null);n.useEffect(()=>{P(1,!0);const m=setInterval(()=>{P(1,!0,!0)},3e4);return()=>clearInterval(m)},[a.id]),n.useEffect(()=>{if(l||r||!g)return;const m={root:null,rootMargin:"100px",threshold:.1};return U.current=new IntersectionObserver(j=>{j[0].isIntersecting&&g&&!r&&P(f+1,!1)},m),B.current&&U.current.observe(B.current),()=>{U.current&&U.current.disconnect()}},[l,r,g,f]);const P=async(m,j=!1,F=!1)=>{try{j&&!F?o(!0):F||d(!0);const h=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${m}&limit=${Y}`)).json();if(h.success){const v=h.notifications||[];if(j)i(v),u(1);else if(F){const y=new Set(t.map(X=>X.id)),q=v.filter(X=>!y.has(X.id));q.length>0&&i([...q,...t])}else i(y=>[...y,...v]),u(m);k(h.unreadCount||0),z(h.totalCount||0),w(h.hasMore||!1)}else x("Failed to fetch notifications")}catch(N){console.error("Error fetching notifications:",N),F||x("Failed to fetch notifications")}finally{j&&!F?o(!1):F||d(!1)}},E=async m=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${m}/read`,{method:"PUT"})).json()).success&&(i(N=>N.map(h=>h.id===m?{...h,is_read:!0}:h)),k(N=>Math.max(0,N-1)))}catch(j){console.error("Error marking notification as read:",j)}},W=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(F=>F.map(N=>({...N,is_read:!0}))),k(0))}catch(m){console.error("Error marking all as read:",m)}},Z=async m=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${m}`,{method:"DELETE"})).json()).success){const N=t.find(h=>h.id===m);i(h=>h.filter(v=>v.id!==m)),z(h=>h-1),N&&!N.is_read&&k(h=>Math.max(0,h-1))}}catch(j){console.error("Error deleting notification:",j)}},O=()=>{C(!0)},V=async()=>{I(!0);try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),k(0),z(0),w(!1),C(!1))}catch(m){console.error("Error deleting all notifications:",m),x("Failed to delete all notifications")}finally{I(!1)}},L=m=>{console.log("ðŸ”” Notification clicked:",m),console.log("   Type:",m.type),console.log("   Title:",m.title),console.log("   Assignment ID:",m.assignment_id),m.is_read||E(m.id);const j=m.title==="New Reply on Assignment";if(console.log("   Is Reply Notification:",j),m.type==="comment"||j)if(console.log("   â†’ Navigating to assignments with comment context"),m.assignment_id){const F={assignmentId:m.assignment_id,shouldOpenComments:!0,expandAllReplies:j};console.log("   ðŸ“¤ Sending navigation data:",F),s?s("assignments",F):console.error("   âŒ onNavigate function not provided!")}else console.error("   âŒ No assignment_id found in notification!");else m.type==="submission"||m.type==="file_uploaded"||m.type==="assignment"?(console.log("   â†’ Navigating to assignments (Go to Task behavior)"),m.assignment_id?s?s("assignments",{assignmentId:m.assignment_id,fileId:m.file_id||null,shouldOpenComments:!1,fromFileSubmission:!0}):console.error("   âŒ onNavigate function not provided!"):console.error("   âŒ No assignment_id found in notification!")):m.type==="approval"||m.type==="rejection"||m.type==="final_approval"||m.type==="final_rejection"?(console.log("   â†’ Navigating to file collection"),m.file_id?s&&s("file-collection",{fileId:m.file_id}):console.error("   âŒ No file_id found in notification!")):!m.type||m.type===""?(console.log("   âš ï¸ Empty notification type, checking IDs..."),m.file_id&&m.assignment_id?(console.log("   â†’ Has both file_id and assignment_id, treating as file submission"),console.log("   â†’ Navigating to assignments (Go to Task behavior)"),s&&s("assignments",{assignmentId:m.assignment_id,fileId:m.file_id,shouldOpenComments:!1,fromFileSubmission:!0})):m.assignment_id?(console.log("   â†’ Has assignment_id only, navigating to assignments"),s&&s("assignments",{assignmentId:m.assignment_id,shouldOpenComments:!1})):m.file_id?(console.log("   â†’ Has file_id only, navigating to file collection"),s&&s("file-collection",{fileId:m.file_id})):console.error("   âŒ Empty type and no valid IDs found!")):console.warn("   âš ï¸ Unknown notification type:",m.type)},K=({type:m})=>e.jsx(qe,{fileType:m,size:"medium",altText:`${m} notification icon`,className:"tl-notification-type-icon"}),ee=n.useCallback(m=>{const j=new Date,F=new Date(m),N=Math.floor((j-F)/1e3);return N<60?`${N}s ago`:N<3600?`${Math.floor(N/60)}m ago`:N<86400?`${Math.floor(N/3600)}h ago`:N<604800?`${Math.floor(N/86400)}d ago`:F.toLocaleDateString()},[]),te=()=>e.jsx("div",{className:"tl-notification-skeleton",children:[1,2,3,4,5].map(m=>e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-meta"})]})]},m))});return l?e.jsxs("div",{className:"tl-notifications-page",children:[e.jsx("div",{className:"tl-notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(te,{})]}):e.jsxs("div",{className:`tl-notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"tl-notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"tl-notifications-actions",children:[S>0&&e.jsx("button",{className:"tl-btn-mark-all-read",onClick:W,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"tl-btn-delete-all",onClick:O,children:"Delete All"})]})]}),p&&e.jsx("div",{className:"tl-error-message",children:p}),e.jsxs("div",{className:"tl-notifications-stats",children:[T," total â€¢ ",S," unread"]}),t.length===0?e.jsxs("div",{className:"tl-no-notifications",children:[e.jsx("div",{className:"tl-no-notifications-icon",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tl-notifications-list",children:t.map(m=>e.jsx(tt,{notification:m,onNotificationClick:L,onDeleteNotification:Z,NotificationIcon:K,formatTimeAgo:ee},m.id))}),r&&e.jsxs("div",{className:"tl-notifications-loading-more",children:[e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]}),e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]})]}),g&&!r&&e.jsx("div",{ref:B,className:"tl-load-more-trigger"}),!g&&t.length>=Y&&e.jsx("div",{className:"tl-end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]}),c&&e.jsx("div",{className:"custom-modal-overlay",onClick:()=>!M&&C(!1),children:e.jsxs("div",{className:"custom-modal",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"custom-modal-header",children:[e.jsx("h3",{children:"Delete All Notifications?"}),e.jsx("button",{onClick:()=>C(!1),className:"custom-modal-close",disabled:M,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"custom-modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:"Are you sure you want to delete all notifications?"}),e.jsxs("div",{className:"item-info",children:[e.jsxs("div",{className:"item-name",children:[T," notification",T!==1?"s":""]}),e.jsxs("div",{className:"item-details",children:["Including ",S," unread notification",S!==1?"s":""]})]}),e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})]})]})}),e.jsx("div",{className:"custom-modal-footer",children:e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"modal-cancel-btn",disabled:M,children:"Cancel"}),e.jsx("button",{type:"button",onClick:V,className:"modal-confirm-btn",disabled:M,children:M?"Deleting...":"Delete All"})]})})]})})]})};function at(a){if(!a)return"Unknown File Type";const s=a.replace(/^\./,"").toLowerCase().trim();return["pdf document","word document","excel spreadsheet","text file","jpeg image","png image","zip archive","documents","spreadsheets","presentations","images","videos","audio","cad/3d files","engineering files","archives","code","executables"].includes(s)?a.split(" ").map(M=>M.charAt(0).toUpperCase()+M.slice(1).toLowerCase()).join(" "):["pdf","doc","docx","txt","rtf","odt","pages"].includes(s)?"Documents":["xls","xlsx","csv","ods","numbers"].includes(s)?"Spreadsheets":["ppt","pptx","key","odp"].includes(s)?"Presentations":["jpg","jpeg","png","gif","bmp","svg","webp","tiff","tif","ico","heic","heif"].includes(s)?"Images":["mp4","avi","mov","wmv","flv","mkv","webm","mpeg","mpg","m4v"].includes(s)?"Videos":["mp3","wav","flac","aac","ogg","wma","m4a","opus"].includes(s)?"Audio":["dwg","dxf","dwf","dwt","sldprt","sldasm","slddrw","step","stp","iges","igs","stl","obj","fbx","3ds","sat","ipt","iam","idw","prt","asm","drw","catpart","catproduct","catdrawing","x_t","x_b"].includes(s)?"CAD/3D Files":["icd","bom","sch","pcb","gerber","gbr","cam","nc","gcode","plt","dxp","schdoc","pcbdoc","brd","lib","mod","kicad_pcb","kicad_sch","kicad_mod","pro"].includes(s)?"Engineering Files":["zip","rar","7z","tar","gz","bz2","xz","iso"].includes(s)?"Archives":["js","jsx","ts","tsx","py","java","cpp","c","h","cs","php","rb","go","rs","swift","kt","scala","r","m","sh","html","css","scss","sass","less","json","xml","yaml","yml","sql","md","markdown"].includes(s)?"Code":["exe","dll","so","dylib","app","dmg","pkg","deb","rpm","msi"].includes(s)?"Executables":/^[A-Z0-9]+\s+File$/i.test(a)?a:s.length<=10&&!/\s/.test(s)?`${s.toUpperCase()} File`:a}function Ra(a){if(!a)return"Unknown File Type";const s=a.split(".").pop();return at(s)}function Ba(a,s=""){return!a||a==="Unknown File Type"?s?Ra(s):"Unknown File Type":at(a)}const bs=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.OverviewTab}))),za=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileCollectionTab}))),Oa=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.TeamManagementTab}))),Ua=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.AssignmentsTab}))),Va=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.NotificationTab}))),Ha=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.BulkActionModal}))),Wa=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FilterModal}))),qa=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.PriorityModal}))),Ka=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.MemberFilesModal}))),Ja=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.CreateAssignmentModal}))),Qa=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.ReviewModal}))),Ga=n.lazy(()=>he(()=>import("./index-21c4a8a1.js"),["./index-21c4a8a1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileViewModal}))),Ya=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState(!1),[r,d]=n.useState([]),[p,x]=n.useState([]),[S,k]=n.useState([]),[c,C]=n.useState("all"),[M,I]=n.useState("date-desc"),[f,u]=n.useState(!1),[g,w]=n.useState(""),[T,z]=n.useState(""),[Y,U]=n.useState(null),[B,P]=n.useState(!1),[E,W]=n.useState(!1),[Z,O]=n.useState(""),[V,L]=n.useState(""),[K,ee]=n.useState(!1),[te,m]=n.useState(""),[j,F]=n.useState([]),[N,h]=n.useState(null),[v,y]=n.useState([]),[q,X]=n.useState(!1),[J,de]=n.useState(""),[ue,xe]=n.useState(""),[ye,ke]=n.useState(!1),[Ce,pe]=n.useState({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),[D,Q]=n.useState({field:"uploaded_at",direction:"DESC"}),[H,ce]=n.useState(!1),[_,G]=n.useState(null),[ae,ge]=n.useState("normal"),[je,os]=n.useState(""),[rs,cs]=n.useState([]),[ds,hs]=n.useState({overdue:0,urgent:0,pending:0});n.useState(!1);const[Te,Re]=n.useState([]),[b,$]=n.useState(null),[se,ne]=n.useState([]),[le,we]=n.useState(!1),[Ne,Se]=n.useState(!1),[ve,ms]=n.useState(null),[pt,ft]=n.useState("total"),[us,Ke]=n.useState([]),[xt,ps]=n.useState(!1),[Es,fs]=n.useState(!1),[Be,As]=n.useState({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),[gt,Ds]=n.useState(null),[jt,Je]=n.useState(null),[vt,Ls]=n.useState(null),[yt,Qe]=n.useState(null);n.useEffect(()=>{t==="overview"&&ze("total"),t==="file-collection"&&xs(),wt(),gs(),bt(),t==="assignments"&&Oe(),t==="dashboard"&&(console.log("ðŸ”„ DASHBOARD TAB: Loading data...",{activeTab:t,team:a.team}),xs(),Oe())},[a.team,t]),n.useEffect(()=>{const R=setInterval(gs,3e4);return()=>clearInterval(R)},[a.team]),n.useEffect(()=>{const R=()=>{N&&h(null)};return document.addEventListener("click",R),()=>document.removeEventListener("click",R)},[N]),n.useEffect(()=>{if(te.trim()==="")x(r);else{const R=r.filter(A=>A.original_name?.toLowerCase().includes(te.toLowerCase())||A.username?.toLowerCase().includes(te.toLowerCase())||A.description?.toLowerCase().includes(te.toLowerCase())||A.file_type?.toLowerCase().includes(te.toLowerCase()));x(R)}},[r,te,pt]);const xs=async()=>{u(!0);try{const A=await(await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}/all-submissions`)).json();A.success&&k(A.submissions||[])}catch(R){console.error("Error fetching all submissions:",R),k([])}finally{u(!1)}},ze=async(R=null)=>{u(!0);try{let A=`http://localhost:3001/api/files/team-leader/${a.team}?limit=1000`;if(R==="total")A=`http://localhost:3001/api/files/team/${a.team}?limit=1000`;else if(R&&R!=="pending"){let Ye=R;A=`http://localhost:3001/api/files/team/${a.team}/status/${Ye}?limit=1000`}const oe=await(await fetch(A)).json();oe.success&&(d(oe.files||[]),x(oe.files||[]),ft(R||null))}catch(A){console.error("Error fetching files:",A)}finally{u(!1)}},wt=async()=>{we(!0);try{const A=await(await fetch(`http://localhost:3001/api/team-members/${a.team}`)).json();if(A.success&&A.members&&A.members.length>0){const ie=A.members.map(oe=>({id:oe.id,name:oe.fullName||oe.username,email:oe.email,joined:new Date(oe.created_at||Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),files:oe.totalFiles||0,status:"Active",...oe}));Re(ie)}else Re([])}catch(R){console.error("Error fetching team members:",R),w("Failed to load team members"),Re([])}finally{we(!1)}},Nt=async(R,A)=>{$({id:R,name:A}),u(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/member/${R}`)).json();oe.success?(ne(oe.files||[]),Se(!0)):w("Failed to fetch member files")}catch(ie){console.error("Error fetching member files:",ie),w("Failed to connect to server")}finally{u(!1)}},bt=async()=>{try{const A=await(await fetch(`http://localhost:3001/api/dashboard/team/${a.team}`)).json();A.success&&ms(A.analytics||{})}catch(R){console.error("Error fetching analytics:",R)}},Oe=async()=>{ps(!0);try{const R=await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}`);if(R.status===404){Ke([]),ps(!1);return}const A=await R.json();A.success?Ke(A.assignments||[]):Ke([])}catch(R){console.error("Error fetching assignments:",R),Ke([])}finally{ps(!1)}},kt=async()=>{if(!Be.title.trim()){w("Please enter assignment title");return}if(Be.assignedMembers.length===0){w("Please select at least one team member");return}ee(!0);try{const A=await(await fetch("http://localhost:3001/api/assignments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...Be,assignedTo:Be.assignedMembers.length>0?"specific":"all",teamLeaderId:a.id,teamLeaderUsername:a.username,team:a.team})})).json();A.success?(z(`Assignment created! ${A.membersAssigned} members assigned.`),fs(!1),As({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),Oe()):w(A.message||"Failed to create assignment")}catch(R){console.error("Error creating assignment:",R),w("Failed to create assignment")}finally{ee(!1)}},Ct=async(R,A)=>{try{(await(await fetch(`http://localhost:3001/api/assignments/${R}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamLeaderUsername:a.username,team:a.team})})).json()).success?(z("Assignment deleted successfully"),Oe()):w("Failed to delete assignment")}catch(ie){console.error("Error deleting assignment:",ie),w("Failed to delete assignment")}},St=async(R,A)=>{U(R),L(A),O(""),P(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/${R.id}/comments`)).json();oe.success&&F(oe.comments||[])}catch(ie){console.error("Error fetching comments:",ie),F([])}},_t=async R=>{try{(await(await fetch("http://localhost:3001/api/files/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R.file_path})})).json()).success?z("File opened successfully"):w("Failed to open file")}catch(A){console.error("Error opening file:",A),w("Failed to open file")}},Ft=async R=>{if(R.preventDefault(),!(!Y||!V)){if(V==="reject"&&!Z.trim()){w("Please provide a reason for rejection");return}ee(!0),w("");try{const ie=await(await fetch(`http://localhost:3001/api/files/${Y.id}/team-leader-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:V,comments:Z.trim(),teamLeaderId:a.id,teamLeaderUsername:a.username,teamLeaderRole:a.role,team:a.team})})).json();ie.success?(z(`File ${V}d successfully!`),P(!1),U(null),O(""),L(null),F([]),ze()):w(ie.message||`Failed to ${V} file`)}catch(A){console.error(`Error ${V}ing file:`,A),w(`Failed to ${V} file. Please try again.`)}finally{ee(!1)}}},Ge=R=>{if(!R||R===0||isNaN(R))return"0 Bytes";const A=1024,ie=["Bytes","KB","MB","GB"],oe=Math.floor(Math.log(R)/Math.log(A));return parseFloat((R/Math.pow(A,oe)).toFixed(2))+" "+ie[oe]},Tt=R=>{if(!R)return"No date";const A=new Date(R);return isNaN(A.getTime())?"Invalid Date":A.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Mt=async()=>{if(J==="reject"&&!ue.trim()){w("Please provide a reason for rejection");return}ee(!0),w("");try{const A=await(await fetch("http://localhost:3001/api/files/bulk-action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:v,action:J,comments:ue.trim(),reviewerId:a.id,reviewerUsername:a.username,reviewerRole:a.role,team:a.team})})).json();A.success?(z(`Successfully ${J}d ${A.results.success.length} file(s)`),A.results.failed.length>0&&w(`Failed to process ${A.results.failed.length} file(s)`),X(!1),de(""),xe(""),y([]),ze()):w(A.message||`Failed to ${J} files`)}catch(R){console.error("Error performing bulk action:",R),w(`Failed to ${J} files. Please try again.`)}finally{ee(!1)}},Et=async()=>{u(!0);try{const A=await(await fetch(`http://localhost:3001/api/files/team-leader/${a.team}/filter`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:Ce,sort:D,page:1,limit:100})})).json();A.success?(d(A.files||[]),ke(!1)):w("Failed to apply filters")}catch(R){console.error("Error applying filters:",R),w("Failed to apply filters")}finally{u(!1)}},At=()=>{pe({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),ze()},Dt=async()=>{if(_){ee(!0),w("");try{const A=await(await fetch(`http://localhost:3001/api/files/${_}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:ae,dueDate:je,reviewerId:a.id,reviewerUsername:a.username})})).json();A.success?(z("Priority and deadline updated successfully"),ce(!1),G(null),ze(),gs()):w(A.message||"Failed to update priority")}catch(R){console.error("Error updating priority:",R),w("Failed to update priority. Please try again.")}finally{ee(!1)}}},gs=async()=>{try{const A=await(await fetch(`http://localhost:3001/api/files/notifications/${a.team}`)).json();A.success&&(cs(A.notifications||[]),hs(A.counts||{overdue:0,urgent:0,pending:0}))}catch(R){console.error("Error fetching notifications:",R)}},Is=()=>{w(""),z("")},Lt=(R,A)=>{A.stopPropagation(),h(N===R?null:R)},It=async(R,A)=>{A.stopPropagation();try{(await(await fetch("http://localhost:3001/api/files/open-in-explorer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R})})).json()).success?z("File opened in explorer"):w("Failed to open file in explorer")}catch(ie){console.error("Error opening file in explorer:",ie),w("Failed to open file in explorer")}h(null)},js=()=>94,$t=()=>{switch(t){case"overview":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Te,calculateApprovalRate:js})});case"dashboard":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Te,calculateApprovalRate:js,submittedFiles:S,assignments:us,notifications:rs,notificationCounts:ds,analyticsData:ve,activeTab:t,setActiveTab:i,onNavigateToTask:(R,A)=>{i("assignments"),Je(R),A&&Qe(A)}})});case"file-collection":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(za,{submittedFiles:S,isLoading:f,openFileViewModal:_t,formatFileSize:Ge,user:a,openMenuId:N,toggleMenu:Lt,handleOpenInExplorer:It,fileCollectionFilter:c,setFileCollectionFilter:C,fileCollectionSort:M,setFileCollectionSort:I,onNavigateToTask:(R,A)=>{i("assignments"),Je(R),A&&Qe(A)},highlightedFileId:vt,onClearFileHighlight:()=>Ls(null)})});case"team-management":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Oa,{isLoadingTeam:le,teamMembers:Te,fetchMemberFiles:Nt})});case"assignments":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Ua,{isLoadingAssignments:xt,assignments:us,formatDate:Tt,deleteAssignment:Ct,setShowCreateAssignmentModal:fs,openReviewModal:St,user:a,notificationCommentContext:gt,onClearNotificationContext:()=>Ds(null),highlightedAssignmentId:jt,onClearHighlight:()=>Je(null),highlightedFileId:yt,onClearFileHighlight:()=>Qe(null)})});case"notifications":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"list"}),children:e.jsx(Va,{user:a,onNavigate:async(R,A)=>{if(console.log("ðŸŽ¯ Dashboard onNavigate called"),console.log("   Tab:",R),console.log("   Data:",A),R==="assignments"){i("assignments"),us.length===0&&(console.log("   â³ Fetching assignments..."),await Oe());const ie=typeof A=="object"?A.assignmentId:A,oe=typeof A=="object"?A.shouldOpenComments:!1,Ye=typeof A=="object"?A.expandAllReplies:!1,Ze=typeof A=="object"?A.fileId:null;if(console.log("   ðŸ“‹ Extracted data:"),console.log("      assignmentId:",ie),console.log("      shouldOpenComments:",oe),console.log("      expandAllReplies:",Ye),console.log("      fileId:",Ze),ie)if(Je(ie),console.log("   âœ… Set highlightedAssignmentId:",ie),Ze&&(Qe(Ze),console.log("   âœ… Set highlightedSubmissionFileId:",Ze)),oe){const $s={assignmentId:ie,expandAllReplies:Ye};console.log("   âœ… Setting notificationCommentContext:",$s),Ds($s)}else console.log("   âš ï¸ Not opening comments - shouldOpenComments:",oe)}else if(R==="file-collection"&&(i("file-collection"),S.length===0&&await xs(),A)){const ie=typeof A=="object"?A.fileId:A;Ls(ie)}}})});default:return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Te,calculateApprovalRate:js})})}};return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"teamleader"}),children:e.jsxs("div",{className:"tl-dashboard",children:[e.jsx($a,{activeTab:t,setActiveTab:i,clearMessages:Is,setSidebarOpen:o,sidebarOpen:l,onLogout:s}),e.jsxs("main",{className:"tl-main",children:[e.jsx(Pa,{error:g,success:T,clearMessages:Is}),$t()]}),q&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ha,{showBulkActionModal:q,setShowBulkActionModal:X,bulkAction:J,selectedFileIds:v,bulkComments:ue,setBulkComments:xe,isProcessing:K,submitBulkAction:Mt})}),ye&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Wa,{showFilterModal:ye,setShowFilterModal:ke,filters:Ce,setFilters:pe,clearFilters:At,applyFilters:Et})}),H&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(qa,{showPriorityModal:H,setShowPriorityModal:ce,priorityValue:ae,setPriorityValue:ge,dueDateValue:je,setDueDateValue:os,isProcessing:K,submitPriority:Dt})}),Ne&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ka,{showMemberFilesModal:Ne,setShowMemberFilesModal:Se,selectedMember:b,setSelectedMember:$,memberFiles:se,setMemberFiles:ne,isLoading:f,formatFileSize:Ge})}),Es&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ja,{showCreateAssignmentModal:Es,setShowCreateAssignmentModal:fs,assignmentForm:Be,setAssignmentForm:As,teamMembers:Te,isProcessing:K,createAssignment:kt})}),B&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Qa,{showReviewModal:B,setShowReviewModal:P,selectedFile:Y,reviewAction:V,setReviewAction:L,fileComments:j,reviewComments:Z,setReviewComments:O,isProcessing:K,handleReviewSubmit:Ft,formatFileSize:Ge,user:a})}),E&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ga,{showModal:E,setShowModal:W,selectedFile:Y,formatFileSize:Ge,user:a})})]})})};const nt=n.createContext(null),Za=({children:a,initialUser:s})=>{const[t,i]=n.useState(s||null),[l,o]=n.useState(!!s);n.useEffect(()=>{s&&(i(s),o(!0))},[s]);const S={user:t,isAuthenticated:l,login:k=>{i(k),o(!0)},logout:()=>{i(null),o(!1)},updateUser:k=>{i(c=>({...c,...k}))},hasPermission:k=>{if(!t)return!1;const c={ADMIN:3,"TEAM LEADER":2,USER:1},C=c[t.role]||0,M=c[k]||0;return C>=M}};return e.jsx(nt.Provider,{value:S,children:a})},Le=()=>{const a=n.useContext(nt);if(!a)throw new Error("useAuth must be used within an AuthProvider");return a},it=n.createContext(null),Xa="http://localhost:3001",en=({children:a})=>{const[s,t]=n.useState(!0),[i,l]=n.useState(!0),[o,r]=n.useState(null),[d,p]=n.useState(3e4),x=n.useCallback(async()=>{try{const c=(await fetch(`${Xa}/api/health`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok;return l(c),t(!0),r(new Date),c}catch(k){return console.warn("Network check failed:",k.message),l(!1),t(navigator.onLine),r(new Date),!1}},[]);n.useEffect(()=>{x()},[x]),n.useEffect(()=>{const k=setInterval(x,d);return()=>clearInterval(k)},[x,d]),n.useEffect(()=>{const k=()=>{t(!0),x()},c=()=>{t(!1),l(!1)};return window.addEventListener("online",k),window.addEventListener("offline",c),()=>{window.removeEventListener("online",k),window.removeEventListener("offline",c)}},[x]);const S={isOnline:s,isServerAvailable:i,isConnected:s&&i,lastChecked:o,checkNetworkStatus:x,setCheckInterval:p};return e.jsx(it.Provider,{value:S,children:a})},Ie=()=>{const a=n.useContext(it);if(!a)throw new Error("useNetwork must be used within a NetworkProvider");return a},sn=n.createContext(null),tn=({children:a,userId:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(0),[r,d]=n.useState(!1),p=n.useRef(null),x=n.useCallback(async(f=!1)=>{if(s){f||d(!0);try{const g=await(await fetch(`http://localhost:3001/api/notifications/user/${s}?page=1&limit=20`)).json();g.success&&(i(g.notifications||[]),o(g.unreadCount||0))}catch(u){console.error("Error fetching notifications:",u)}finally{f||d(!1)}}},[s]),S=n.useCallback(async f=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${f}/read`,{method:"PUT"})).json()).success&&(i(w=>w.map(T=>T.id===f?{...T,is_read:!0}:T)),o(w=>Math.max(0,w-1)))}catch(u){console.error("Error marking notification as read:",u)}},[]),k=n.useCallback(async()=>{if(s)try{(await(await fetch(`http://localhost:3001/api/notifications/user/${s}/read-all`,{method:"PUT"})).json()).success&&(i(g=>g.map(w=>({...w,is_read:!0}))),o(0))}catch(f){console.error("Error marking all as read:",f)}},[s]),c=n.useCallback(async f=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${f}`,{method:"DELETE"})).json()).success){const w=t.find(T=>T.id===f);i(T=>T.filter(z=>z.id!==f)),w&&!w.is_read&&o(T=>Math.max(0,T-1))}}catch(u){console.error("Error deleting notification:",u)}},[t]),C=n.useCallback((f=3e4)=>{p.current&&clearInterval(p.current),p.current=setInterval(()=>{x(!0)},f)},[x]),M=n.useCallback(()=>{p.current&&(clearInterval(p.current),p.current=null)},[]);n.useEffect(()=>(s&&(x(),C()),()=>M()),[s,x,C,M]);const I={notifications:t,unreadCount:l,isLoading:r,fetchNotifications:x,markAsRead:S,markAllAsRead:k,deleteNotification:c,startPolling:C,stopPolling:M};return e.jsx(sn.Provider,{value:I,children:a})};class an extends n.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){const{onError:i,componentName:l}=this.props;console.error("ðŸš¨ Error Boundary Caught Error:",{component:l||"Unknown",error:s.toString(),stack:t.componentStack,timestamp:new Date().toISOString()}),this.setState(o=>({error:s,errorInfo:t,errorCount:o.errorCount+1})),i&&i(s,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};logErrorToService=(s,t)=>{};render(){const{hasError:s,error:t,errorInfo:i,errorCount:l}=this.state,{children:o,fallback:r,componentName:d="Component",showDetails:p=!1}=this.props;return s?r?typeof r=="function"?r(t,this.handleReset):r:e.jsx("div",{className:"error-boundary-container",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h2",{className:"error-title",children:"Something went wrong"}),e.jsxs("p",{className:"error-message",children:[d," encountered an unexpected error and couldn't render."]}),p&&t&&e.jsx("div",{className:"error-details",children:e.jsxs("details",{children:[e.jsx("summary",{className:"error-summary",children:"Technical Details (Click to expand)"}),e.jsxs("div",{className:"error-stack",children:[e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error:"}),e.jsx("pre",{children:t.toString()})]}),i&&e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Component Stack:"}),e.jsx("pre",{children:i.componentStack})]}),e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error Count:"})," ",l]})]})]})}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:this.handleReset,className:"error-btn error-btn-primary",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-btn error-btn-secondary",children:"Reload Page"})]}),l>2&&e.jsxs("div",{className:"error-persistent-notice",children:[e.jsxs("p",{children:["âš ï¸ This error has occurred ",l," times."]}),e.jsx("p",{children:"If the problem persists, please contact support."})]})]})}):o}}const Fe=(a,s={})=>{const t=i=>e.jsx(an,{...s,children:e.jsx(a,{...i})});return t.displayName=`withErrorBoundary(${a.displayName||a.name||"Component"})`,t},nn=({user:a,users:s})=>{Le();const{isConnected:t}=Ie(),[i,l]=n.useState(!0),[o,r]=n.useState(""),[d,p]=n.useState({totalFiles:0,approved:0,pending:0,rejected:0,fileTypes:[],recentActivity:[],approvalRate:0,approvalTrends:[],previousMonth:{totalFiles:0,approved:0,pending:0,rejected:0}});n.useEffect(()=>{let f=!0;const u=async()=>{if(t){l(!0),r("");try{const w=await(await fetch("http://localhost:3001/api/dashboard/summary")).json();if(!f)return;w.success?p(w.summary):r(w.message||"Failed to load dashboard data")}catch(g){if(console.error("Error fetching dashboard summary:",g),!f)return;r("Unable to connect to server")}finally{f&&l(!1)}}};if(t){u();const g=setInterval(u,60*1e3);return()=>{f=!1,clearInterval(g)}}},[t]);const x=d.pending,S=d.approved,k=d.rejected,c=d.totalFiles;n.useMemo(()=>d.recentActivity.filter(f=>f.activity&&f.activity.toLowerCase().includes("team leader")).length,[d.recentActivity]),n.useMemo(()=>d.recentActivity.filter(f=>f.activity&&f.activity.toLowerCase().includes("admin")).length,[d.recentActivity]);const C=n.useMemo(()=>{const f=(u,g)=>g===0?u>0?100:0:(u-g)/g*100;return d.previousMonth?{pending:f(x,d.previousMonth.pending),approved:f(S,d.previousMonth.approved),rejected:f(k,d.previousMonth.rejected),total:f(c,d.previousMonth.totalFiles)}:{pending:0,approved:0,rejected:0,total:0}},[x,S,k,c,d.previousMonth]),M=f=>{const u=Math.abs(f),g=f>0?"â†‘":f<0?"â†“":"â€”",w=f>0?"positive":f<0?"negative":"neutral",T=u.toFixed(1);return f===0?{text:"â€” No change from last month",className:"neutral"}:{text:`${g} ${f>=0?"+":"-"}${T}% from last month`,className:w}},I=n.useMemo(()=>d.recentActivity.map(f=>e.jsx("div",{className:"activity-item",children:e.jsxs("div",{className:"activity-content",children:[e.jsxs("div",{className:"activity-header",children:[e.jsx("span",{className:"activity-user",children:f.username||f.role||"System"}),e.jsx("span",{className:"activity-badge "+(f.activity&&f.activity.toLowerCase().includes("approved")?"approved":f.activity&&f.activity.toLowerCase().includes("rejected")?"rejected":"upload"),children:(f.activity||"").split(" ")[0]})]}),e.jsx("div",{className:"activity-description",children:f.activity}),e.jsx("div",{className:"activity-meta",children:new Date(f.timestamp).toLocaleString()})]})},f.id)),[d.recentActivity]);return t?e.jsxs("div",{className:`dashboard-overview ${i?"loading-cursor":""}`,children:[e.jsx("div",{className:"top-row",children:e.jsx("div",{className:"stats-section",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Pending Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":x}),!i&&e.jsx("div",{className:`stat-change ${M(C.pending).className}`,children:M(C.pending).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Approved Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":S.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${M(C.approved).className}`,children:M(C.approved).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Rejected Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":k}),!i&&e.jsx("div",{className:`stat-change ${C.rejected>0?"negative":C.rejected<0?"positive":"neutral"}`,children:M(C.rejected).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Total Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":c.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${M(C.total).className}`,children:M(C.total).text})]})]})})}),e.jsxs("div",{className:"bottom-row",children:[e.jsxs("div",{className:"charts-section",children:[e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"File Approval Trends"})}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading trends..."}),!i&&(!d.approvalTrends||d.approvalTrends.length===0)&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No trend data available"}),!i&&d.approvalTrends&&d.approvalTrends.length>0&&e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 700 300",preserveAspectRatio:"xMidYMid meet",style:{background:"transparent"},children:(()=>{const f=d.approvalTrends.slice(-30),u=Math.max(...f.map(B=>Math.max(B.approved||0,B.rejected||0)),1),g={left:50,right:50,top:30,bottom:50},w=700-g.left-g.right,T=300-g.top-g.bottom,z=w/Math.max(f.length-1,1),Y=f.map((B,P)=>({x:g.left+P*z,y:g.top+T-(B.approved||0)/u*T})),U=f.map((B,P)=>({x:g.left+P*z,y:g.top+T-(B.rejected||0)/u*T}));return e.jsxs(e.Fragment,{children:[[0,.25,.5,.75,1].map(B=>{const P=g.top+T-B*T;return e.jsx("line",{x1:g.left,y1:P,x2:g.left+w,y2:P,stroke:"#E5E7EB",strokeWidth:"1",strokeDasharray:"4 4"},B)}),Y.map((B,P)=>{if(P===0)return null;const E=Y[P-1];return e.jsx("line",{x1:E.x,y1:E.y,x2:B.x,y2:B.y,stroke:"#10B981",strokeWidth:"3"},`approved-${P}`)}),U.map((B,P)=>{if(P===0)return null;const E=U[P-1];return e.jsx("line",{x1:E.x,y1:E.y,x2:B.x,y2:B.y,stroke:"#EF4444",strokeWidth:"3"},`rejected-${P}`)}),Y.map((B,P)=>e.jsx("circle",{cx:B.x,cy:B.y,r:"4",fill:"#10B981"},`approved-point-${P}`)),U.map((B,P)=>e.jsx("circle",{cx:B.x,cy:B.y,r:"4",fill:"#EF4444"},`rejected-point-${P}`)),f.map((B,P)=>{if(P%5!==0&&P!==f.length-1)return null;const E=g.left+P*z,W=B.day||B.date||`D${P+1}`;return e.jsx("text",{x:E,y:g.top+T+30,fontSize:"11",fill:"#6B7280",textAnchor:"middle",children:W},`label-${P}`)}),e.jsxs("g",{transform:`translate(${g.left}, 10)`,children:[e.jsx("circle",{cx:"0",cy:"0",r:"4",fill:"#10B981"}),e.jsx("text",{x:"10",y:"4",fontSize:"12",fill:"#6B7280",children:"Approved"}),e.jsx("circle",{cx:"80",cy:"0",r:"4",fill:"#EF4444"}),e.jsx("text",{x:"90",y:"4",fontSize:"12",fill:"#6B7280",children:"Rejected"})]})]})})()})]})]}),e.jsxs("div",{className:"chart-card",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"File Types Distribution"}),e.jsx("span",{style:{fontSize:"12px",color:"var(--text-tertiary)"},children:"All file types tracked"})]}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading file types..."}),!i&&d.fileTypes.length===0&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No file type data available"}),!i&&d.fileTypes.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 200 200",children:(()=>{const f=d.fileTypes.reduce((w,T)=>w+T.count,0),u=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];let g=0;return d.fileTypes.map((w,T)=>{const z=w.count/f*100,Y=`${z/100*440} 440`,U=e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:u[T%u.length]||"#999",strokeWidth:"30",strokeDasharray:Y,strokeDashoffset:-g},w.file_type);return g+=z/100*440,U})})()}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"8px"},children:d.fileTypes.map((f,u)=>{const g=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];return e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[e.jsx("span",{style:{color:g[u%g.length]||"#999"},children:"â– "}),"Â ",f.file_type||"Unknown"," (",f.count,")"]},f.file_type)})})})]})]})]})]}),e.jsxs("div",{className:"section-card activity-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"Recent Activity"})}),e.jsxs("div",{className:"activity-list",children:[i&&e.jsx("div",{style:{padding:"1rem"},children:"Loading recent activityâ€¦"}),!i&&d.recentActivity.length===0&&e.jsx("div",{style:{padding:"1rem"},children:"No recent activity"}),!i&&I]})]})]})]}):e.jsx(re,{type:"admin"})},Js=Fe(n.memo(nn),{componentName:"Dashboard Overview"});const fe=({type:a="info",message:s,onClose:t,autoCloseDelay:i=3e3})=>{if(n.useEffect(()=>{if(i>0&&t){const r=setTimeout(()=>{t()},i);return()=>clearTimeout(r)}},[i,t]),!s)return null;const l=()=>{switch(a){case"success":return"alert-success";case"error":return"alert-error";case"warning":return"alert-warning";case"info":return"alert-info";default:return"alert-info"}},o=()=>{switch(a){case"success":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"error":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"warning":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 6V11M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"info":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 9V14M10 6H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});default:return null}};return e.jsx("div",{className:"alert-message-component",children:e.jsxs("div",{className:`alert ${l()} message-fade`,children:[e.jsxs("div",{className:"alert-content",children:[e.jsx("span",{className:"alert-icon",children:o()}),e.jsx("span",{className:"alert-message",children:s})]}),t&&e.jsx("button",{onClick:t,className:"alert-close",children:"Ã—"})]})})};const ks=({isOpen:a,onClose:s,onSubmit:t,title:i,submitText:l="Submit",cancelText:o="Cancel",isLoading:r=!1,size:d="medium",children:p})=>{if(!a)return null;const x=c=>{c.target===c.currentTarget&&!r&&s()},S=c=>{c.preventDefault(),t&&t(c)},k=()=>{switch(d){case"small":return"modal-small";case"large":return"modal-large";default:return"modal-medium"}};return e.jsx("div",{className:"modal-overlay",onClick:x,children:e.jsxs("div",{className:`modal form-modal ${k()}`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:s,className:"modal-close",type:"button",disabled:r,children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{className:"modal-body",children:p}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",onClick:s,className:"btn btn-secondary",disabled:r,children:o}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?"Processing...":l})]})]})]})})};const ln=({isOpen:a,onClose:s,file:t,onApprove:i,onReject:l,onOpenFile:o,isLoading:r,isOpeningFile:d,formatFileSize:p,mapFileStatus:x,getStatusDisplayName:S})=>{if(!a||!t)return null;const k=p(t.file_size),c=new Date(t.uploaded_at).toLocaleString();return e.jsx("div",{className:"file-details-modal-component",children:e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal file-modal",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"File Details"}),e.jsx("button",{onClick:s,className:"modal-close",children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"file-details-section",children:[e.jsx("h4",{className:"section-title",children:"File Details"}),e.jsxs("div",{className:"file-details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE NAME:"}),e.jsx("span",{className:"detail-value",children:t.original_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE TYPE:"}),e.jsx("span",{className:"detail-value",children:Ba(t.file_type,t.original_name)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE SIZE:"}),e.jsx("span",{className:"detail-value",children:k})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"SUBMITTED BY:"}),e.jsx("span",{className:"detail-value",children:t.username})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"TEAM:"}),e.jsx("span",{className:"detail-value team-badge-inline",children:t.user_team})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"UPLOAD DATE:"}),e.jsx("span",{className:"detail-value",children:c})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"STATUS:"}),e.jsx("span",{className:`detail-value status-badge status-${x(t.status)}`,children:S(t.status)})]})]})]}),e.jsx("div",{className:"actions-section",children:e.jsxs("div",{className:"action-buttons-large",children:[e.jsxs("button",{type:"button",onClick:i,className:"btn btn-success-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Approve"]}),e.jsxs("button",{type:"button",onClick:l,className:"btn btn-danger-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Reject"]}),e.jsxs("button",{onClick:o,className:"btn btn-secondary-large",disabled:r||d,children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 10.8333V15.8333C15 16.2754 14.8244 16.6993 14.5118 17.0118C14.1993 17.3244 13.7754 17.5 13.3333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V6.66667C2.5 6.22464 2.67559 5.80072 2.98816 5.48816C3.30072 5.17559 3.72464 5 4.16667 5H9.16667M12.5 2.5H17.5M17.5 2.5V7.5M17.5 2.5L8.33333 11.6667",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),d?"Opening...":"Open"]})]})})]})]})})})};const lt=n.memo(({comment:a,replyingTo:s,setReplyingTo:t,visibleReplies:i,toggleRepliesVisibility:l,getInitials:o,formatTimeAgo:r,replyText:d,setReplyText:p,onPostReply:x,user:S})=>{const[c,C]=n.useState(!1),M=a.comment.length>150,I=n.useCallback(()=>{t(a.id)},[a.id,t]),f=n.useCallback(()=>{l(a.id)},[a.id,l]);return e.jsxs("div",{className:"comment-thread","data-comment-id":a.id,children:[e.jsxs("div",{className:"comment-item",children:[e.jsx("div",{className:"comment-avatar",children:o(a.user_fullname||a.username)}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:a.user_fullname||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"comment-time",children:r(a.created_at)})]}),e.jsxs("div",{className:"comment-text",children:[M&&!c?a.comment.substring(0,150)+"...":a.comment,M&&e.jsx("button",{className:"see-more-btn",onClick:()=>C(!c),children:c?"See less":"See more"})]}),e.jsxs("div",{className:"comment-actions",children:[e.jsx("button",{className:"reply-button",onClick:I,children:"Reply"}),a.replies&&a.replies.length>0&&e.jsxs("button",{className:"view-replies-button",onClick:f,children:[i[a.id]?"Hide":"View"," ",a.replies.length," ",a.replies.length===1?"reply":"replies"]})]})]})]}),a.replies&&a.replies.length>0&&i[a.id]&&e.jsx("div",{className:"replies-thread",children:a.replies.map(u=>e.jsx(ot,{reply:u,getInitials:o,formatTimeAgo:r},u.id))}),s===a.id&&e.jsx(rt,{comment:a,replyText:d,setReplyText:p,onPostReply:x,getInitials:o,user:S})]})});lt.displayName="CommentItem";const ot=n.memo(({reply:a,getInitials:s,formatTimeAgo:t})=>{const[l,o]=n.useState(!1),r=a.reply.length>150;return e.jsxs("div",{className:"reply-item",children:[e.jsx("div",{className:"reply-avatar",children:s(a.user_fullname||a.username)}),e.jsxs("div",{className:"reply-content",children:[e.jsxs("div",{className:"reply-header",children:[e.jsx("span",{className:"reply-author",children:a.user_fullname||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"reply-time",children:t(a.created_at)})]}),e.jsxs("div",{className:"reply-text",children:[r&&!l?a.reply.substring(0,150)+"...":a.reply,r&&e.jsx("button",{className:"see-more-btn",onClick:()=>o(!l),children:l?"See less":"See more"})]})]})]})});ot.displayName="ReplyItem";const rt=n.memo(({comment:a,replyText:s,setReplyText:t,onPostReply:i,getInitials:l,user:o})=>{const r=n.useCallback(p=>{i(p,a.id)},[i,a.id]),d=n.useCallback(p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),r(p))},[r]);return e.jsxs("div",{className:"reply-input-box",children:[e.jsx("div",{className:"comment-avatar reply-avatar",children:l(o.username||o.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a reply...",value:s,onChange:p=>t(p.target.value),onKeyPress:d,disabled:!1,autoFocus:!0}),e.jsx("button",{className:"comment-submit-btn",onClick:r,disabled:!s.trim(),children:"âž¤"})]})]})});rt.displayName="ReplyInputBox";const ct=n.memo(({isOpen:a,onClose:s,assignment:t,comments:i,loadingComments:l,newComment:o,setNewComment:r,onPostComment:d,replyingTo:p,setReplyingTo:x,replyText:S,setReplyText:k,onPostReply:c,visibleReplies:C,toggleRepliesVisibility:M,getInitials:I,formatTimeAgo:f,user:u})=>{if(!a||!t)return null;const g=n.useCallback(w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),d(w))},[d]);return e.jsx("div",{className:"comments-modal-overlay",onClick:s,children:e.jsxs("div",{className:"comments-modal",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"comments-modal-header",children:[e.jsxs("h3",{children:["Comments - ",t.title]}),e.jsx("button",{className:"close-modal-btn",onClick:s,children:"âœ•"})]}),e.jsx("div",{className:"comments-modal-body",children:l?e.jsxs("div",{className:"loading-comments",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading comments..."})]}):i.length===0?e.jsx("div",{className:"no-comments",children:e.jsx("p",{children:"ðŸ’¬ No comments yet. Be the first to comment!"})}):e.jsx("div",{className:"comments-list",children:i.map(w=>e.jsx(lt,{comment:w,replyingTo:p,setReplyingTo:x,visibleReplies:C,toggleRepliesVisibility:M,getInitials:I,formatTimeAgo:f,replyText:S,setReplyText:k,onPostReply:c,user:u},w.id))})}),e.jsx("div",{className:"comments-modal-footer",children:e.jsxs("div",{className:"add-comment",children:[e.jsx("div",{className:"comment-avatar",children:I(u.username||u.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a comment...",value:o,onChange:w=>r(w.target.value),onKeyPress:g}),e.jsx("button",{className:"comment-submit-btn",onClick:d,disabled:!o.trim(),children:"âž¤"})]})]})})]})})});ct.displayName="CommentsModal";const on=(a=[],s=10)=>{const[t,i]=n.useState(1),l=n.useMemo(()=>Math.ceil(a.length/s),[a.length,s]),o=n.useMemo(()=>{const f=(t-1)*s,u=f+s;return a.slice(f,u)},[a,t,s]),r=n.useMemo(()=>(t-1)*s,[t,s]),d=n.useMemo(()=>Math.min(r+s,a.length),[r,s,a.length]),p=n.useCallback(f=>{const u=Math.max(1,Math.min(f,l));i(u)},[l]),x=n.useCallback(()=>{i(f=>Math.min(f+1,l))},[l]),S=n.useCallback(()=>{i(f=>Math.max(f-1,1))},[]),k=n.useCallback(()=>{i(1)},[]),c=n.useCallback(()=>{i(l)},[l]),C=n.useCallback(()=>{i(1)},[]),M=t<l,I=t>1;return{currentPage:t,totalPages:l,paginatedItems:o,startIndex:r,endIndex:d,itemsPerPage:s,goToPage:p,nextPage:x,prevPage:S,goToFirstPage:k,goToLastPage:c,resetPagination:C,canGoNext:M,canGoPrev:I}},rn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,user:o,contextData:r})=>{const{user:d}=Le(),{isConnected:p}=Ie(),[x,S]=n.useState([]),[k,c]=n.useState([]),[C,M]=n.useState(!1),[I,f]=n.useState(""),[u,g]=n.useState(!1),[w,T]=n.useState(null),[z,Y]=n.useState(!1),[U,B]=n.useState(!1),[P,E]=n.useState(!1),[W,Z]=n.useState(!1),[O,V]=n.useState(null),[L,K]=n.useState({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),ee=n.useMemo(()=>{let _=x;if(I.trim()!==""){const G=I.toLowerCase();_=x.filter(ae=>ae.fullName.toLowerCase().includes(G)||ae.username.toLowerCase().includes(G)||ae.email.toLowerCase().includes(G)||ae.role.toLowerCase().includes(G)||ae.team&&ae.team.toLowerCase().includes(G))}return _.sort((G,ae)=>{const ge=new Date(G.created_at||0),je=new Date(ae.created_at||0);return ge-je})},[I,x]),{currentPage:te,totalPages:m,paginatedItems:j,startIndex:F,endIndex:N,goToPage:h,nextPage:v,prevPage:y,resetPagination:q}=on(ee,9),X=n.useMemo(()=>k.filter(_=>_.is_active),[k]),J=n.useCallback(async()=>{g(!0);try{const G=await(await fetch("http://localhost:3001/api/users")).json();G.success?(S(G.users),q()):i("Failed to fetch users")}catch(_){console.error("Error fetching users:",_),i("Failed to connect to server")}finally{g(!1)}},[i,q]),de=n.useCallback(async()=>{M(!0);try{const G=await(await fetch("http://localhost:3001/api/teams")).json();G.success&&c(G.teams||[])}catch(_){console.error("Error fetching teams:",_)}finally{M(!1)}},[]);n.useEffect(()=>{J(),de()},[J,de]),n.useEffect(()=>{if(r&&r.action==="reset-password"&&r.userId){console.log("ðŸ”‘ Opening password reset modal for user:",r);const _=x.find(G=>G.id===r.userId);_?(pe(_),l(`Password reset request from ${r.username||_.username}`),setTimeout(()=>{const G=document.querySelector(`[data-user-id="${r.userId}"]`);G&&(G.scrollIntoView({behavior:"smooth",block:"center"}),G.classList.add("highlight-user"),setTimeout(()=>G.classList.remove("highlight-user"),2e3))},300)):i("User not found. They may have been deleted.")}},[r,x,l,i]);const ue=n.useCallback(async _=>{_.preventDefault(),g(!0),i("");try{const ae=await(await fetch("http://localhost:3001/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...L,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("User created successfully"),Y(!1),K({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),J()):i(ae.message)}catch{i("Failed to create user")}finally{g(!1)}},[L,d,i,l,J]),xe=n.useCallback(async _=>{_.preventDefault(),g(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${w.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:L.fullName,username:L.username,email:L.email,role:L.role,team:L.team,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("User updated successfully"),B(!1),T(null),J()):i(ae.message)}catch{i("Failed to update user")}finally{g(!1)}},[L,w,d,i,l,J]),ye=n.useCallback(async _=>{_.preventDefault(),g(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${w.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:L.password,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("Password reset successfully"),E(!1),T(null),K(ge=>({...ge,password:""}))):i(ae.message)}catch{i("Failed to reset password")}finally{g(!1)}},[L.password,w,d,i,l]),ke=n.useCallback(async()=>{if(O){g(!0);try{const G=await(await fetch(`http://localhost:3001/api/users/${O.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();G.success?(l(`User ${O.fullName} deleted successfully`),Z(!1),V(null),J()):i(G.message)}catch{i("Failed to delete user")}finally{g(!1)}}},[O,d,i,l,J]),Ce=n.useCallback(_=>{i(""),l(""),T(_),K({fullName:_.fullName||"",username:_.username||"",email:_.email||"",password:"",role:_.role||"USER",team:_.team||""}),B(!0)},[i,l]),pe=n.useCallback(_=>{i(""),l(""),T(_),K(G=>({...G,password:""})),E(!0)},[i,l]),D=n.useCallback(_=>{V(_),Z(!0)},[]),Q=n.useCallback(()=>{i(""),l(""),T(null),K({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),Y(!0)},[i,l]),H=n.useCallback((_,G)=>{K(ae=>({...ae,[_]:G}))},[]),ce=n.useCallback(_=>{f(_.target.value),q()},[q]);return p?e.jsxs("div",{className:`users-management ${u?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsx("div",{className:"search-section",children:e.jsx("div",{className:"search-container",children:e.jsx("input",{type:"text",placeholder:"Search users by name, email, role, or team...",value:I,onChange:ce,className:"search-input"})})}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn btn-primary",onClick:Q,children:"Add User"})})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[u?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Password"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:j.map(_=>{const G=_.role.toLowerCase().replace(" ","-");return e.jsxs("tr",{className:"user-row","data-user-id":_.id,children:[e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:_.fullName})})}),e.jsx("td",{children:_.username}),e.jsx("td",{className:"email-cell",children:_.email}),e.jsx("td",{children:e.jsxs("div",{className:"password-cell",children:[e.jsx("span",{className:"password-hidden",children:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),e.jsx("button",{className:"password-reset-btn",onClick:()=>pe(_),title:"Reset Password",children:"Reset"})]})}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${G}`,children:_.role})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:_.team||"â€”"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>Ce(_),title:"Edit User",children:"Edit"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>D(_),title:"Delete User",children:"Delete"})]})})]},_.id)})})]})}),!u&&ee.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No users found"}),e.jsx("p",{children:"No users match your current search criteria."})]}),!u&&m>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",F+1," to ",N," of ",ee.length," users"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:y,disabled:te===1,title:"Previous Page",children:"â€¹"}),e.jsx("div",{className:"pagination-numbers",children:Array.from({length:Math.min(5,m)},(_,G)=>{let ae;return m<=5||te<=3?ae=G+1:te>=m-2?ae=m-4+G:ae=te-2+G,e.jsx("button",{className:`pagination-number ${te===ae?"active":""}`,onClick:()=>h(ae),children:ae},ae)})}),e.jsx("button",{className:"pagination-btn",onClick:v,disabled:te===m,title:"Next Page",children:"â€º"})]})]})]}),z&&e.jsx(ks,{isOpen:z,onClose:()=>Y(!1),onSubmit:ue,title:"Add New User",submitText:"Create User",isLoading:u,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:L.fullName,onChange:_=>H("fullName",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:L.username,onChange:_=>H("username",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:L.email,onChange:_=>H("email",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password *"}),e.jsx("input",{type:"password",value:L.password,onChange:_=>H("password",_.target.value),required:!0,minLength:"6",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:L.role,onChange:_=>H("role",_.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:L.team,onChange:_=>H("team",_.target.value),className:"form-select",disabled:C,children:[e.jsx("option",{value:"",children:"Select Team"}),X.map(_=>e.jsxs("option",{value:_.name,children:[_.name,_.leader_username&&` (Led by ${_.leader_username})`]},_.id))]}),C&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),U&&w&&e.jsx(ks,{isOpen:U,onClose:()=>B(!1),onSubmit:xe,title:"Edit User",submitText:"Update User",isLoading:u,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:L.fullName,onChange:_=>H("fullName",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:L.username,onChange:_=>H("username",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:L.email,onChange:_=>H("email",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:L.role,onChange:_=>H("role",_.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:L.team,onChange:_=>H("team",_.target.value),className:"form-select",disabled:C,children:[e.jsx("option",{value:"",children:"Select Team"}),X.map(_=>e.jsxs("option",{value:_.name,children:[_.name,_.leader_username&&` (Led by ${_.leader_username})`]},_.id))]}),C&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),P&&w&&e.jsxs(ks,{isOpen:P,onClose:()=>E(!1),onSubmit:ye,title:"Reset Password",submitText:"Reset Password",isLoading:u,size:"small",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:["User: ",e.jsxs("strong",{children:[w.fullName," (",w.username,")"]})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password *"}),e.jsx("input",{type:"password",value:L.password,onChange:_=>H("password",_.target.value),required:!0,minLength:"6",placeholder:"Enter new password",className:"form-input"})]})]}),W&&O&&e.jsx(Pe,{isOpen:W,onClose:()=>Z(!1),onConfirm:ke,title:"Delete User",message:"Are you sure you want to delete this user?",confirmText:"Delete User",variant:"danger",isLoading:u,itemInfo:{name:O.fullName,details:`${O.email} â€¢ ${O.role}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The user account and all associated data will be permanently removed from the system."})})]}):e.jsx(re,{type:"table"})},cn=Fe(rn,{componentName:"User Management"});function dt(a){const s=new Map;return function(...i){const l=JSON.stringify(i);if(s.has(l))return s.get(l);const o=a(...i);return s.set(l,o),o}}const dn=dt(a=>new Date(a).toLocaleDateString()),hn=dt(a=>new Date(a).toLocaleTimeString()),mn=n.memo(({log:a})=>e.jsxs("tr",{children:[e.jsx("td",{children:a.username}),e.jsx("td",{children:a.role}),e.jsx("td",{children:a.team}),e.jsxs("td",{children:[dn(a.timestamp)," ",hn(a.timestamp)]}),e.jsx("td",{children:a.activity})]})),un=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Le();const{isConnected:o}=Ie(),[r,d]=n.useState([]),[p,x]=n.useState(""),[S,k]=n.useState(""),[c,C]=n.useState("all"),[M,I]=n.useState(1),[f,u]=n.useState(!1),[g,w]=n.useState(!1);n.useState(null),n.useState(!1);const T=12;n.useEffect(()=>{c==="all"&&o&&W()},[c,o]),n.useEffect(()=>{const m=setTimeout(()=>k(p),300);return()=>clearTimeout(m)},[p]);const z=n.useMemo(()=>{let m=[...r];if(S.trim()!==""){const j=S.toLowerCase();m=m.filter(F=>F.username.toLowerCase().includes(j)||F.role.toLowerCase().includes(j)||F.team.toLowerCase().includes(j)||F.activity.toLowerCase().includes(j))}if(c!=="all"){const j=new Date,F=new Date(j.getFullYear(),j.getMonth(),j.getDate());m=m.filter(N=>{const h=new Date(N.timestamp);switch(c){case"today":return h>=F;case"week":const v=new Date(F);return v.setDate(F.getDate()-7),h>=v;case"month":const y=new Date(F);return y.setMonth(F.getMonth()-1),h>=y;default:return!0}})}return m},[r,S,c]),Y=n.useMemo(()=>{const m=Math.ceil(z.length/T),j=(M-1)*T,F=j+T,N=z.slice(j,F);return{totalPages:m,startIndex:j,endIndex:F,currentLogs:N}},[z,M,T]),{totalPages:U,startIndex:B,endIndex:P,currentLogs:E}=Y;n.useEffect(()=>{I(1)},[z]);const W=async(m=1e4)=>{u(!0);try{const j=`http://localhost:3001/api/activity-logs?limit=${m}`,N=await(await fetch(j)).json();N.success?d(N.logs):i("Failed to fetch activity logs")}catch(j){console.error("Error fetching activity logs:",j),i("Failed to connect to server")}finally{u(!1)}},Z=()=>{const m=[["Username","Role","Team","Date & Time","Activity"],...z.map(h=>[h.username,h.role,h.team,new Date(h.timestamp).toLocaleString(),h.activity])].map(h=>h.join(",")).join(`
`),j=new Blob([m],{type:"text/csv"}),F=window.URL.createObjectURL(j),N=document.createElement("a");N.href=F,N.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(F),l("Activity logs exported successfully")},O=()=>{x(""),C("all"),I(1),l("All filters cleared")},V=n.useCallback(()=>{x("")},[]);n.useCallback(m=>{I(m)},[]),n.useCallback(()=>{I(m=>Math.max(m-1,1))},[]),n.useCallback(()=>{I(m=>Math.min(m+1,U))},[U]);const L=n.useMemo(()=>{const m=[];if(U<=5)for(let F=1;F<=U;F++)m.push(e.jsx("button",{className:`pagination-btn ${F===M?"active":""}`,onClick:()=>I(F),children:F},F));else{m.push(e.jsx("button",{className:`pagination-btn ${M===1?"active":""}`,onClick:()=>I(1),children:"1"},1)),M>3&&m.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const F=Math.max(2,M-1),N=Math.min(U-1,M+1);for(let h=F;h<=N;h++)h!==1&&h!==U&&m.push(e.jsx("button",{className:`pagination-btn ${h===M?"active":""}`,onClick:()=>I(h),children:h},h));M<U-2&&m.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),U>1&&m.push(e.jsx("button",{className:`pagination-btn ${U===M?"active":""}`,onClick:()=>I(U),children:U},U))}return m},[U,M]),K=()=>{const m=p.trim()!=="",j=c!=="all";if(m&&j){const F={today:"today",week:"this week",month:"this month"}[c];return`search "${p}" and ${F}`}else{if(m)return`search "${p}"`;if(j)return`date filter "${{today:"today",week:"this week",month:"this month"}[c]}"`}return"current filters"},ee=async()=>{if(!(p.trim()!=="")&&!(c!=="all")){i("Please apply a search term or date filter to specify logs for deletion");return}if(z.length===0){i("No logs found matching your current filter criteria");return}w(!0)},te=async()=>{const m=z.length,j=z.map(F=>F.id);console.log("Attempting to delete logs:",{logsToDelete:m,logIdsToDelete:j});try{const F=await fetch("http://localhost:3001/api/health");console.log("API health check:",F.status,F.ok)}catch(F){console.error("API health check failed:",F),i("Cannot connect to server. Please ensure the server is running."),u(!1);return}u(!0);try{console.log("Making delete request to:","http://localhost:3001/api/activity-logs/bulk-delete");const F=await fetch("http://localhost:3001/api/activity-logs/bulk-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({logIds:j})});if(console.log("Response status:",F.status,"OK:",F.ok),!F.ok){const v=await F.text();throw console.error("Response error text:",v),new Error(`HTTP error! status: ${F.status} - ${v}`)}const N=await F.json();if(console.log("Delete response:",N),!N.success)throw new Error(N.message||"Failed to delete logs");const h=r.filter(v=>!j.includes(v.id));console.log("Updating state:",{originalCount:r.length,newCount:h.length,deletedCount:N.deletedCount}),d(h),I(1),w(!1),s&&i(""),l(`Successfully deleted ${N.deletedCount||m} log(s) matching your filter criteria`)}catch(F){console.error("Error deleting logs:",F),i(`Failed to delete logs: ${F.message}`)}finally{u(!1)}};return o?e.jsxs("div",{className:`activity-logs-section ${f?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-container",children:[e.jsx("input",{type:"text",placeholder:"Search activity logs...",value:p,onChange:m=>x(m.target.value),className:"search-input"}),p&&e.jsx("button",{className:"search-clear-btn",onClick:V,title:"Clear search",children:"Ã—"})]}),e.jsx("div",{className:"date-filter-container",children:e.jsxs("select",{value:c,onChange:m=>C(m.target.value),className:"date-filter-select",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})}),(p||c!=="all")&&e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:O,children:"Clear Filters"})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-danger",onClick:ee,disabled:p.trim()===""&&c==="all"||z.length===0||f,title:p.trim()===""&&c==="all"?"Apply a search term or date filter to specify logs for deletion":`Delete ${z.length} filtered log(s)`,children:f?"Deleting...":`Delete Logs (${z.length})`}),e.jsx("button",{className:"btn btn-primary",onClick:Z,disabled:z.length===0,children:"Export Logs"})]})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[f?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading activity logs..."})]}):e.jsx("div",{className:"logs-table-container",children:e.jsxs("table",{className:"activity-logs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Activity"})]})}),e.jsx("tbody",{children:E.map(m=>e.jsx(mn,{log:m},m.id))})]})}),!f&&z.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No activity logs found"}),e.jsx("p",{children:"No activity logs match your current search criteria."})]}),!f&&z.length>0&&U>1&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(M-1)*T+1," to ",Math.min(M*T,z.length)," of ",z.length," logs"]}),U>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>I(m=>Math.max(m-1,1)),disabled:M===1,children:"â€¹"}),L,e.jsx("button",{className:"pagination-btn",onClick:()=>I(m=>Math.min(m+1,U)),disabled:M===U,children:"â€º"})]})]})]}),e.jsxs(Pe,{isOpen:g,onClose:()=>w(!1),onConfirm:te,title:"Delete Activity Logs",message:"Are you sure you want to delete these activity logs?",confirmText:`Delete ${z.length} Log(s)`,variant:"danger",isLoading:f,children:[e.jsxs("p",{className:"confirmation-description",children:["You are about to delete ",e.jsxs("strong",{children:[z.length," log(s)"]})," that match your ",K(),"."]}),e.jsx("p",{className:"confirmation-description",style:{marginTop:"0.5rem"},children:"This action cannot be undone. The selected activity logs will be permanently removed from the system and cannot be recovered."})]})]}):e.jsx(re,{type:"table"})},pn=Fe(n.memo(un),{componentName:"Activity Logs"});const _e="http://localhost:3001/api",es=n.memo(({icon:a,label:s,count:t,className:i})=>e.jsxs("div",{className:`file-status-card ${i}`,children:[e.jsx("div",{className:`status-icon ${i}-icon`,children:a}),e.jsxs("div",{className:"status-info",children:[e.jsx("div",{className:"status-number",children:t}),e.jsx("div",{className:"status-label",children:s})]})]})),fn=n.memo(()=>e.jsxs("tr",{className:"file-row-skeleton",children:[e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text-lg"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-btn"})})]})),xn=n.memo(({file:a,formatFileSize:s,mapFileStatus:t,getStatusDisplayName:i,onOpenModal:l,onDelete:o})=>{const r=n.useCallback(()=>{l(a)},[a,l]),d=n.useCallback(C=>{C.stopPropagation(),o(a)},[a,o]),x=n.useCallback((C,M)=>{if(C){const I=C.split(".");if(I.length>1)return I[I.length-1].toLowerCase()}return M?M.replace(/^\./,"").toLowerCase():""},[])(a.original_name,a.file_type),S=n.useMemo(()=>new Date(a.uploaded_at).toLocaleDateString(),[a.uploaded_at]),k=n.useMemo(()=>new Date(a.uploaded_at).toLocaleTimeString(),[a.uploaded_at]),c=n.useMemo(()=>s(a.file_size),[a.file_size,s]);return e.jsxs("tr",{className:"file-row",onClick:r,children:[e.jsx("td",{children:e.jsxs("div",{className:"file-cell",children:[e.jsx("div",{className:"file-icon",children:e.jsx(qe,{fileType:x,isFolder:!1,altText:`Icon for ${a.original_name}`,size:"medium"})}),e.jsxs("div",{className:"file-details",children:[e.jsx("span",{className:"file-name",children:a.original_name}),e.jsx("span",{className:"file-size",children:c})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:a.username})})}),e.jsx("td",{children:e.jsxs("div",{className:"datetime-cell",children:[e.jsx("div",{className:"date",children:S}),e.jsx("div",{className:"time",children:k})]})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:a.user_team})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${t(a.status)}`,children:i(a.status)})}),e.jsx("td",{children:e.jsx("button",{className:"action-btn delete-btn",onClick:d,title:"Delete File",children:"Delete"})})]})}),gn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{const{user:o}=Le(),{isConnected:r}=Ie(),[d,p]=n.useState([]),[x,S]=n.useState(""),[k,c]=n.useState(""),[C,M]=n.useState("all"),[I,f]=n.useState("date-desc"),[u,g]=n.useState(1),[w]=n.useState(7),[T,z]=n.useState(null),[Y,U]=n.useState(!1),[B,P]=n.useState(!1),[E,W]=n.useState(null),[Z,O]=n.useState(!0),[V,L]=n.useState(!1),K=n.useRef(null),ee=n.useRef(null),te=n.useRef(null),m=n.useRef(null);n.useEffect(()=>{if(s||t){const D=setTimeout(()=>{a()},3e3);return()=>clearTimeout(D)}},[s,t,a]);const j=n.useCallback(async()=>{m.current&&m.current.abort(),m.current=new AbortController,O(!0);try{const Q=await(await fetch(`${_e}/files/all`,{signal:m.current.signal})).json();Q.success?p(Q.files):i("Failed to fetch files")}catch(D){D.name!=="AbortError"&&(console.error("Error fetching files:",D),i("Failed to connect to server"))}finally{O(!1)}},[i]);n.useEffect(()=>(r&&j(),()=>{m.current&&m.current.abort()}),[r,j]),n.useEffect(()=>{const D=setTimeout(()=>S(k),300);return()=>clearTimeout(D)},[k]),n.useEffect(()=>{g(1)},[x,C,I]);const F=n.useMemo(()=>({pendingTeamLeader:d.filter(D=>D.status==="uploaded").length,pendingAdmin:d.filter(D=>D.status==="team_leader_approved").length,approved:d.filter(D=>D.status==="final_approved").length,rejected:d.filter(D=>D.status==="rejected_by_team_leader"||D.status==="rejected_by_admin").length}),[d]),N=n.useMemo(()=>{let D=d;if(C!=="all"&&(D=D.filter(Q=>{switch(C){case"pending-team-leader":return Q.status==="uploaded";case"pending-admin":return Q.status==="team_leader_approved";case"approved":return Q.status==="final_approved";case"rejected":return Q.status==="rejected_by_team_leader"||Q.status==="rejected_by_admin";default:return!1}})),x&&x.trim()!==""){const Q=x.toLowerCase();D=D.filter(H=>H.original_name.toLowerCase().includes(Q)||H.username.toLowerCase().includes(Q)||H.user_team.toLowerCase().includes(Q))}return[...D].sort((Q,H)=>{switch(I){case"date-desc":return new Date(H.uploaded_at)-new Date(Q.uploaded_at);case"date-asc":return new Date(Q.uploaded_at)-new Date(H.uploaded_at);case"filename-asc":return Q.original_name.localeCompare(H.original_name);case"filename-desc":return H.original_name.localeCompare(Q.original_name);case"user-asc":return Q.username.localeCompare(H.username);case"user-desc":return H.username.localeCompare(Q.username);default:return 0}})},[d,x,C,I]),h=n.useMemo(()=>{const D=(u-1)*w,Q=D+w;return N.slice(D,Q)},[N,u,w]),v=n.useMemo(()=>Math.ceil(N.length/w),[N.length,w]),y=n.useCallback(D=>{if(D===0)return"0 Bytes";const Q=1024,H=["Bytes","KB","MB","GB"],ce=Math.floor(Math.log(D)/Math.log(Q));return parseFloat((D/Math.pow(Q,ce)).toFixed(2))+" "+H[ce]},[]);n.useMemo(()=>T?y(T.file_size):"",[T,y]),n.useMemo(()=>T?new Date(T.uploaded_at).toLocaleString():"",[T]);const q=n.useCallback(D=>{switch(D){case"uploaded":case"team_leader_approved":return"pending";case"final_approved":return"approved";case"rejected_by_team_leader":case"rejected_by_admin":return"rejected";default:return"pending"}},[]),X=n.useCallback(D=>{switch(D){case"uploaded":return"Pending Team Leader";case"team_leader_approved":return"Pending Admin";case"final_approved":return"Approved";case"rejected_by_team_leader":return"Rejected by Team Leader";case"rejected_by_admin":return"Rejected by Admin";default:return D.charAt(0).toUpperCase()+D.slice(1)}},[]),J=n.useCallback(D=>{W(D),P(!0)},[]),de=n.useCallback(D=>{z(D),U(!0)},[]),ue=n.useCallback(()=>{U(!1),z(null),L(!1)},[]),xe=n.useCallback(async()=>{if(E){O(!0);try{try{await fetch(`${_e}/files/${E.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})})}catch(H){console.warn("Physical file deletion failed (file may not exist):",H)}const Q=await(await fetch(`${_e}/files/${E.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();Q.success?(p(H=>H.filter(ce=>ce.id!==E.id)),P(!1),W(null),l("File metadata deleted successfully")):i(Q.message||"Failed to delete file metadata")}catch(D){console.error("Error deleting file:",D),i(D.message||"Failed to delete file metadata")}finally{O(!1)}}},[E,o,i,l]),ye=n.useCallback(async D=>{if(D){L(!0);try{const H=await(await fetch(`${_e}/files/${D.id}/path`)).json();if(!H.success)throw new Error("Failed to get file path");const ce=H.filePath;if(window.electron&&typeof window.electron.openFileInApp=="function"){const _=await window.electron.openFileInApp(ce);if(!_.success)throw new Error(_.error||"Failed to open file")}else i("File opening not available")}catch(Q){console.error("Error opening file:",Q),i(Q.message||"Failed to open file")}finally{L(!1)}}},[i]),ke=n.useCallback(async()=>{if(T){O(!0);try{let D=!1;if(window.electron&&typeof window.electron.openDirectoryDialog=="function"){const Q={};try{if(typeof window.electron.getNetworkProjectsPath=="function"){const je=await window.electron.getNetworkProjectsPath();je&&(Q.defaultPath=je)}}catch(je){console.warn("Could not get default path",je)}const H=await window.electron.openDirectoryDialog(Q);if(!H||H.canceled||!H.filePaths||H.filePaths.length===0){O(!1);return}const ce=H.filePaths[0],G=await(await fetch(`${_e}/files/${T.id}/move-to-projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinationPath:ce,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team,deleteFromUploads:!0})})).json();if(!G.success)throw new Error(G.message||"Failed to move file");const ge=await(await fetch(`${_e}/files/${T.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();if(!ge.success)throw new Error(ge.message||"Failed to approve file");D=!0}else throw new Error("File system access not available");D&&(p(Q=>Q.map(H=>H.id===T.id?{...H,status:"final_approved"}:H)),ue(),l("File approved and moved successfully"),j())}catch(D){console.error("Approval error:",D),i(D.message||"Failed to approve file")}finally{O(!1)}}},[T,o,i,l,ue,j]),Ce=n.useCallback(async()=>{if(T){O(!0);try{const Q=await(await fetch(`${_e}/files/${T.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();Q.success?(await fetch(`${_e}/files/${T.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})}).catch(()=>{}),p(H=>H.map(ce=>ce.id===T.id?{...ce,status:"rejected_by_admin"}:ce)),ue(),l("File rejected successfully"),j()):i(Q.message||"Failed to reject file")}catch(D){console.error("Error rejecting file:",D),i("Failed to reject file")}finally{O(!1)}}},[T,o,i,l,ue,j]),pe=n.useMemo(()=>{const D=[];if(v<=5)for(let H=1;H<=v;H++)D.push(e.jsx("button",{className:`pagination-btn ${H===u?"active":""}`,onClick:()=>g(H),children:H},H));else{D.push(e.jsx("button",{className:`pagination-btn ${u===1?"active":""}`,onClick:()=>g(1),children:"1"},1)),u>3&&D.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const H=Math.max(2,u-1),ce=Math.min(v-1,u+1);for(let _=H;_<=ce;_++)_!==1&&_!==v&&D.push(e.jsx("button",{className:`pagination-btn ${_===u?"active":""}`,onClick:()=>g(_),children:_},_));u<v-2&&D.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),v>1&&D.push(e.jsx("button",{className:`pagination-btn ${v===u?"active":""}`,onClick:()=>g(v),children:v},v))}return D},[v,u]);return r?e.jsxs("div",{className:`file-approval-section ${V?"file-opening-cursor":""}`,children:[s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"file-status-cards",ref:K,children:[e.jsx(es,{icon:"TL",label:"Pending Team Leader",count:F.pendingTeamLeader,className:"pending"}),e.jsx(es,{icon:"AD",label:"Pending Admin",count:F.pendingAdmin,className:"pending-admin"}),e.jsx(es,{icon:"AP",label:"Approved Files",count:F.approved,className:"approved"}),e.jsx(es,{icon:"RE",label:"Rejected Files",count:F.rejected,className:"rejected"})]}),e.jsxs("div",{className:"file-controls",children:[e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search files by name, user, or team...",value:k,onChange:D=>c(D.target.value),className:"search-input",ref:ee}),x&&e.jsx("button",{className:"search-clear-btn",onClick:()=>{c(""),S("")},title:"Clear search",children:"Ã—"})]}),e.jsxs("div",{className:"file-filters",children:[e.jsxs("select",{value:C,onChange:D=>M(D.target.value),className:"form-select",ref:te,children:[e.jsx("option",{value:"all",children:"All Files"}),e.jsx("option",{value:"pending-team-leader",children:"Pending Team Leader"}),e.jsx("option",{value:"pending-admin",children:"Pending Admin"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsxs("select",{value:I,onChange:D=>f(D.target.value),className:"form-select",children:[e.jsx("option",{value:"date-desc",children:"Latest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"filename-asc",children:"Filename A-Z"}),e.jsx("option",{value:"filename-desc",children:"Filename Z-A"}),e.jsx("option",{value:"user-asc",children:"User A-Z"}),e.jsx("option",{value:"user-desc",children:"User Z-A"})]})]})]}),e.jsxs("div",{className:"table-section",children:[e.jsx("div",{className:"files-table-container",children:e.jsxs("table",{className:"files-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Submitted By"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Z?Array(w).fill(0).map((D,Q)=>e.jsx(fn,{},Q)):h.length>0?h.map(D=>e.jsx(xn,{file:D,formatFileSize:y,mapFileStatus:q,getStatusDisplayName:X,onOpenModal:de,onDelete:J},D.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No files found"}),e.jsx("p",{children:"No files match your current search and filter criteria."})]})})})})]})}),!Z&&N.length>0&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(u-1)*w+1," to ",Math.min(u*w,N.length)," of ",N.length," files"]}),v>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>g(D=>Math.max(D-1,1)),disabled:u===1,children:"â€¹"}),pe,e.jsx("button",{className:"pagination-btn",onClick:()=>g(D=>Math.min(D+1,v)),disabled:u===v,children:"â€º"})]})]})]}),e.jsx(ln,{isOpen:Y,onClose:ue,file:T,onApprove:ke,onReject:Ce,onOpenFile:()=>ye(T),isLoading:Z,isOpeningFile:V,formatFileSize:y,mapFileStatus:q,getStatusDisplayName:X}),e.jsx(Pe,{isOpen:B&&E,onClose:()=>P(!1),onConfirm:xe,title:"Deleting File",message:"Are you sure you want to delete this file?",confirmText:"Delete File",variant:"danger",isLoading:Z,itemInfo:E?{name:E.original_name||E.filename,details:`Submitted by ${E.username} from ${E.user_team} team`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})})]}):e.jsx(re,{type:"table"})},jn=Fe(gn,{componentName:"File Approval"});class vn{constructor(){this.invertedIndex=new Map,this.fileMetadata=new Map,this.keywordBitmasks=new Map,this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}addFile(s,t={}){const i=this.nextFileId++,l={id:i,path:s,name:t.name||this._getFileName(s),size:t.size||0,modified:t.modified||Date.now(),type:t.type||this._getFileType(s),content:t.content||null};return this.fileMetadata.set(i,l),this._extractKeywords(l).forEach(r=>{this.invertedIndex.has(r)||this.invertedIndex.set(r,new Set),this.invertedIndex.get(r).add(i)}),this.stats.totalFiles++,this.stats.lastIndexTime=Date.now(),i}search(s,t={}){const i=this._normalizeQuery(s);if(i.length===0)return[];let l=null;for(const r of i){const d=this._findMatchingIds(r);if(l===null?l=d:l=new Set([...l].filter(p=>d.has(p))),l.size===0)break}const o=l?Array.from(l).map(r=>this.fileMetadata.get(r)):[];return this._applyFilters(o,t)}_findMatchingIds(s){const t=new Set;this.invertedIndex.has(s)&&this.invertedIndex.get(s).forEach(i=>t.add(i));for(const[i,l]of this.invertedIndex.entries())(i.startsWith(s)||i.includes(s))&&l.forEach(o=>t.add(o));return t}_extractKeywords(s){const t=new Set;s.name.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(r=>r.length>1).forEach(r=>t.add(r));const l=s.name.split(".").pop();return l&&l!==s.name&&t.add(l.toLowerCase()),t.add(s.type),s.content&&s.content.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(d=>d.length>2).slice(0,100).forEach(d=>t.add(d)),s.path.toLowerCase().split(/[\/\\]/).filter(r=>r.length>1).forEach(r=>t.add(r)),t}_normalizeQuery(s){return s.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(t=>t.length>0)}_applyFilters(s,t){let i=[...s];if(t.fileTypes&&t.fileTypes.length>0){const l=t.fileTypes.map(o=>o.startsWith(".")?o.slice(1).toLowerCase():o.toLowerCase());i=i.filter(o=>{const r=o.name.split(".").pop().toLowerCase();return l.includes(r)})}return t.minSize!==void 0&&(i=i.filter(l=>l.size>=t.minSize)),t.maxSize!==void 0&&(i=i.filter(l=>l.size<=t.maxSize)),t.modifiedAfter&&(i=i.filter(l=>l.modified>=t.modifiedAfter)),t.modifiedBefore&&(i=i.filter(l=>l.modified<=t.modifiedBefore)),i.sort((l,o)=>o.modified-l.modified),t.limit&&(i=i.slice(0,t.limit)),i}removeFile(s){const t=this.fileMetadata.get(s);return t?(this._extractKeywords(t).forEach(l=>{const o=this.invertedIndex.get(l);o&&(o.delete(s),o.size===0&&this.invertedIndex.delete(l))}),this.fileMetadata.delete(s),this.stats.totalFiles--,!0):!1}clear(){this.invertedIndex.clear(),this.fileMetadata.clear(),this.keywordBitmasks.clear(),this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}getStats(){return{...this.stats,totalKeywords:this.invertedIndex.size,indexSize:this._calculateIndexSize()}}_calculateIndexSize(){let s=0;for(const[t,i]of this.invertedIndex.entries())s+=t.length*2,s+=i.size*8;for(const[,t]of this.fileMetadata.entries())s+=JSON.stringify(t).length*2;return s}_getFileName(s){return s.split(/[\/\\]/).pop()||s}_getFileType(s){const t=s.split(".").pop()?.toLowerCase();return!t||t===s?"file":["pdf","doc","docx","txt","rtf","odt"].includes(t)?"document":["jpg","jpeg","png","gif","bmp","svg","webp"].includes(t)?"image":["mp4","avi","mov","mkv","flv","wmv"].includes(t)?"video":["mp3","wav","flac","aac","ogg","wma"].includes(t)?"audio":["js","jsx","ts","tsx","py","java","cpp","c","cs","php","rb"].includes(t)?"code":["zip","rar","7z","tar","gz"].includes(t)?"archive":"file"}export(){return{fileMetadata:Array.from(this.fileMetadata.entries()),invertedIndex:Array.from(this.invertedIndex.entries()).map(([s,t])=>[s,Array.from(t)]),nextFileId:this.nextFileId,stats:this.stats}}import(s){this.clear(),this.fileMetadata=new Map(s.fileMetadata),this.invertedIndex=new Map(s.invertedIndex.map(([t,i])=>[t,new Set(i)])),this.nextFileId=s.nextFileId,this.stats=s.stats}}class yn{constructor(s=5*60*1e3){this.cache=new Map,this.ttl=s,this.stats={hits:0,misses:0,totalQueries:0},this.maxCacheSize=500,this.accessOrder=new Map}async listDirectory(s,t){this.stats.totalQueries++;const i=this._normalizePath(s),l=this.cache.get(i);if(l&&Date.now()-l.timestamp<this.ttl)return this.stats.hits++,this._updateAccessOrder(i),l.data;this.stats.misses++;try{const o=await t(s);return this._setCache(i,o),o}catch(o){if(l)return console.warn(`Using stale cache for ${s}: ${o.message}`),l.data;throw o}}async prefetchDirectories(s,t){const i=s.map(async l=>{try{const o=this._normalizePath(l);if(!this.cache.has(o)){const r=await t(l);this._setCache(o,r)}}catch(o){console.warn(`Failed to prefetch ${l}:`,o.message)}});await Promise.allSettled(i)}_setCache(s,t){if(this.cache.size>=this.maxCacheSize){const i=this._getOldestKey();i&&(this.cache.delete(i),this.accessOrder.delete(i))}this.cache.set(s,{data:t,timestamp:Date.now()}),this._updateAccessOrder(s)}_updateAccessOrder(s){this.accessOrder.set(s,Date.now())}_getOldestKey(){let s=null,t=1/0;for(const[i,l]of this.accessOrder.entries())l<t&&(t=l,s=i);return s}invalidate(s){const t=this._normalizePath(s);this.cache.delete(t),this.accessOrder.delete(t)}invalidatePrefix(s){const t=this._normalizePath(s),i=[];for(const l of this.cache.keys())l.startsWith(t)&&i.push(l);return i.forEach(l=>{this.cache.delete(l),this.accessOrder.delete(l)}),i.length}clear(){this.cache.clear(),this.accessOrder.clear(),this.stats={hits:0,misses:0,totalQueries:0}}getStats(){const s=this.stats.totalQueries>0?(this.stats.hits/this.stats.totalQueries*100).toFixed(2):0;return{...this.stats,hitRate:`${s}%`,cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,ttlMs:this.ttl}}_normalizePath(s){return s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase()}async warmup(s,t){console.log("Warming up cache with common directories..."),await this.prefetchDirectories(s,t),console.log(`Cache warmed up. Cached ${this.cache.size} directories.`)}getCachedPaths(){return Array.from(this.cache.keys())}isCached(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?!(Date.now()-i.timestamp>=this.ttl):!1}getCacheAge(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?Date.now()-i.timestamp:null}setTTL(s){this.ttl=s}setMaxCacheSize(s){for(this.maxCacheSize=s;this.cache.size>s;){const t=this._getOldestKey();t&&(this.cache.delete(t),this.accessOrder.delete(t))}}export(){return{cache:Array.from(this.cache.entries()),accessOrder:Array.from(this.accessOrder.entries()),stats:this.stats,ttl:this.ttl,maxCacheSize:this.maxCacheSize}}import(s){this.cache=new Map(s.cache),this.accessOrder=new Map(s.accessOrder),this.stats=s.stats,this.ttl=s.ttl,this.maxCacheSize=s.maxCacheSize}}class ht{constructor(){this.allowedDirectories=this.loadAllowedDirectories(),this.blacklistedPaths=this.loadBlacklistedPaths(),this.permissionCache=new Map,this.cacheTimeout=5*60*1e3}async checkDirectoryAccess(s){if(!s)throw new Error("Directory path is required");const t=this._normalizePath(s),i=this.permissionCache.get(t);if(i&&Date.now()-i.timestamp<this.cacheTimeout){if(!i.allowed)throw new Error(`Directory access denied: ${s}`);return!0}if(!this.isDirectoryAllowed(t))throw this._cachePermission(t,!1),new Error(`Directory access denied: ${s}`);if(this.isBlacklisted(t))throw this._cachePermission(t,!1),new Error(`Directory is blacklisted: ${s}`);return this._cachePermission(t,!0),!0}async checkFileEditAccess(s){if(!s)throw new Error("File path is required");const t=this._getDirectoryPath(s);if(await this.checkDirectoryAccess(t),!this.isSafeFileExtension(s))throw new Error(`File type not allowed for editing: ${s}`);return!0}isDirectoryAllowed(s){const t=this._normalizePath(s);return this.allowedDirectories.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isBlacklisted(s){const t=this._normalizePath(s);return this.blacklistedPaths.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isSafeFileExtension(s){const t=[".exe",".bat",".cmd",".sh",".bin",".dll",".sys",".com",".scr",".vbs",".ps1",".app",".deb",".rpm"],i=this._getFileExtension(s).toLowerCase();return!t.includes(i)}loadAllowedDirectories(){return[`${this._getHomeDirectory()}`,"/"].filter(t=>t)}loadBlacklistedPaths(){const s=this._getHomeDirectory();return["C:\\Windows","C:\\Program Files","C:\\Program Files (x86)","C:\\ProgramData","/System","/etc","/root","/boot","/proc","/sys","/dev","/var/log",`${s}/.ssh`,`${s}/.aws`,`${s}/.gnupg`,`${s}/AppData/Local`,`${s}/AppData/Roaming`,`${s}/Library/Keychains`,".git",".svn",".hg","node_modules"].filter(t=>t)}addAllowedDirectory(s){const t=this._normalizePath(s);return this.allowedDirectories.includes(t)?!1:(this.allowedDirectories.push(t),this.permissionCache.clear(),!0)}removeAllowedDirectory(s){const t=this._normalizePath(s),i=this.allowedDirectories.indexOf(t);return i!==-1?(this.allowedDirectories.splice(i,1),this.permissionCache.clear(),!0):!1}addBlacklistedPath(s){const t=this._normalizePath(s);return this.blacklistedPaths.includes(t)?!1:(this.blacklistedPaths.push(t),this.permissionCache.clear(),!0)}getAllowedDirectories(){return[...this.allowedDirectories]}getBlacklistedPaths(){return[...this.blacklistedPaths]}clearCache(){this.permissionCache.clear()}_cachePermission(s,t){this.permissionCache.set(s,{allowed:t,timestamp:Date.now()})}_normalizePath(s){return s?s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase():""}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_getFileExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.substring(t):""}_getHomeDirectory(){return typeof process>"u"||!{}?"":{}.HOME||{}.USERPROFILE||{}.HOMEPATH||""}getCacheStats(){return{cacheSize:this.permissionCache.size,cacheTimeout:this.cacheTimeout}}export(){return{allowedDirectories:this.allowedDirectories,blacklistedPaths:this.blacklistedPaths}}import(s){s.allowedDirectories&&(this.allowedDirectories=s.allowedDirectories),s.blacklistedPaths&&(this.blacklistedPaths=s.blacklistedPaths),this.permissionCache.clear()}}class wn{constructor(s,t=null){this.apiBase=s||"http://localhost:3001",this.directoryManager=t||new ht,this.maxFileSize=50*1024*1024}async readFile(s,t={}){try{const i=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(i);const l=t.maxSize||this.maxFileSize,o=await fetch(`${this.apiBase}/api/file-system/read-file?path=${encodeURIComponent(s)}&maxSize=${l}`);if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.message||`Failed to read file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to read file");return{success:!0,content:r.content,size:r.size,encoding:r.encoding||t.encoding||"utf-8",path:s}}catch(i){throw console.error("Error reading file:",i),new Error(`Failed to read file: ${i.message}`)}}async editFile(s,t,i={}){try{if(await this.directoryManager.checkFileEditAccess(s),i.validate&&typeof i.validate=="function")try{i.validate(t)}catch(d){throw new Error(`Content validation failed: ${d.message}`)}let l=null;if(i.backup)try{l=await this.createBackup(s)}catch(d){if(console.warn("Failed to create backup:",d),i.requireBackup)throw new Error(`Backup required but failed: ${d.message}`)}const o=await fetch(`${this.apiBase}/api/file-system/write-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s,content:t,encoding:i.encoding||"utf-8",backup:i.backup||!1})});if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.message||`Failed to write file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to write file");return{success:!0,path:s,backupPath:l||r.backupPath,bytesWritten:t.length}}catch(l){throw console.error("Error editing file:",l),new Error(`Failed to edit file: ${l.message}`)}}async createBackup(s){try{const t=new Date().toISOString().replace(/[:.]/g,"-"),i=`${s}.backup.${t}`,l=await fetch(`${this.apiBase}/api/file-system/backup-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:s,backupPath:i})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Backup failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Backup failed");return o.backupPath||i}catch(t){throw new Error(`Failed to create backup: ${t.message}`)}}async deleteFile(s,t={}){try{await this.directoryManager.checkFileEditAccess(s);let i=null;t.backup&&(i=await this.createBackup(s));const l=await fetch(`${this.apiBase}/api/file-system/delete-file`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Delete failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Delete failed");return{success:!0,path:s,backupPath:i}}catch(i){throw new Error(`Failed to delete file: ${i.message}`)}}async renameFile(s,t){try{await this.directoryManager.checkFileEditAccess(s);const i=this._getDirectoryPath(t);await this.directoryManager.checkDirectoryAccess(i);const l=await fetch(`${this.apiBase}/api/file-system/rename-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPath:s,newPath:t})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Rename failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Rename failed");return{success:!0,oldPath:s,newPath:t}}catch(i){throw new Error(`Failed to rename file: ${i.message}`)}}async getFileInfo(s){try{const t=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(t);const i=await fetch(`${this.apiBase}/api/file-system/file-info?path=${encodeURIComponent(s)}`);if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||"Failed to get file info")}const l=await i.json();if(!l.success)throw new Error(l.message||"Failed to get file info");return{success:!0,...l.info}}catch(t){throw new Error(`Failed to get file info: ${t.message}`)}}async fileExists(s){try{return(await this.getFileInfo(s)).success}catch{return!1}}async validateFileSize(s,t=null){const i=await this.getFileInfo(s),l=t||this.maxFileSize;if(i.size>l)throw new Error(`File too large: ${this._formatBytes(i.size)} (max: ${this._formatBytes(l)})`);return!0}setMaxFileSize(s){this.maxFileSize=s}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_formatBytes(s,t=2){if(s===0)return"0 Bytes";const i=1024,l=t<0?0:t,o=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(s)/Math.log(i));return parseFloat((s/Math.pow(i,r)).toFixed(l))+" "+o[r]}export(){return{apiBase:this.apiBase,maxFileSize:this.maxFileSize,directoryConfig:this.directoryManager.export()}}}class Nn{constructor(s){this.apiBase=s||"http://localhost:3001",this.bitmaskIndex=new vn,this.fsCache=new yn(5*60*1e3),this.directoryManager=new ht,this.fileEditor=new wn(this.apiBase,this.directoryManager),this.isIndexing=!1,this.indexProgress=0,this.lastIndexTime=null,this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0},this.queryCache=new Map,this.queryCacheSize=100,this.queryCacheTTL=2*60*1e3}async initialize(){console.log("ðŸš€ Initializing FastSearchEngine...");try{this._startBackgroundIndexing(),console.log("âœ… FastSearchEngine initialized")}catch(s){console.error("âŒ Failed to initialize FastSearchEngine:",s)}}async searchFiles(s,t={}){const i=performance.now();this.searchStats.totalSearches++;try{const l=this._getQueryCacheKey(s,t),o=this._getFromQueryCache(l);if(o)return console.log("âš¡ Cache hit for query:",s),o;t.directory&&await this.directoryManager.checkDirectoryAccess(t.directory);let r;const d=this.bitmaskIndex.getStats().totalFiles>100;d&&!t.forceAPISearch?(r=await this._indexedSearch(s,t),this.searchStats.indexedSearches++):(r=await this._apiSearch(s,t),this.searchStats.fallbackSearches++),t.checkPermissions!==!1&&(r.files=r.files.filter(S=>{const k=this._getDirectoryPath(S.path);return this.directoryManager.isDirectoryAllowed(k)}));const p=performance.now()-i;this._updateSearchStats(p);const x={...r,searchTime:p,indexed:d,cached:!1};return this._addToQueryCache(l,x),x}catch(l){throw console.error("Search error:",l),new Error(`Search failed: ${l.message}`)}}async _indexedSearch(s,t){console.log("ðŸ” Using indexed search for:",s);const i=this.bitmaskIndex.search(s,{fileTypes:t.fileTypes,minSize:t.minSize,maxSize:t.maxSize,modifiedAfter:t.modifiedAfter,modifiedBefore:t.modifiedBefore,limit:t.limit||1e3});return{success:!0,files:i.map(l=>({id:`file-${l.id}`,name:l.name,displayName:l.name,path:l.path,type:l.type==="folder"?"folder":"file",fileType:l.type,size:l.size,modified:l.modified,parentPath:this._getDirectoryPath(l.path)})),total:i.length,query:s}}async _apiSearch(s,t){console.log("ðŸŒ Using API search for:",s);const i=t.directory||"/",l=`${this.apiBase}/api/file-system/search?query=${encodeURIComponent(s)}&path=${encodeURIComponent(i)}`,o=await fetch(l);if(!o.ok)throw new Error(`API search failed: ${o.statusText}`);const r=await o.json();if(!r.success)throw new Error(r.message||"API search failed");return r.results&&r.results.length>0&&this._indexSearchResults(r.results),{success:!0,files:r.results||[],total:r.results?.length||0,query:s}}async listDirectory(s,t={}){try{return await this.directoryManager.checkDirectoryAccess(s),{success:!0,items:(await this.fsCache.listDirectory(s,async o=>{const d=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(o)}`)).json();if(!d.success)throw new Error(d.message||"Failed to list directory");return d.items&&d.items.length>0&&this._indexSearchResults(d.items),d.items||[]})).filter(o=>{const r=o.type==="folder"?o.path:this._getDirectoryPath(o.path);return this.directoryManager.isDirectoryAllowed(r)}),path:s}}catch(i){throw new Error(`Failed to list directory: ${i.message}`)}}async readFileContent(s,t={}){return await this.fileEditor.readFile(s,t)}async updateFileContent(s,t,i={}){const l=await this.fileEditor.editFile(s,t,i);return this._invalidateCachesForPath(s),l}async deleteFile(s,t={}){const i=await this.fileEditor.deleteFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),i}async renameFile(s,t){const i=await this.fileEditor.renameFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),this._invalidateCachesForPath(t),i}async _startBackgroundIndexing(){if(!this.isIndexing){this.isIndexing=!0,console.log("ðŸ“‡ Starting background indexing...");try{const t=this.directoryManager.getAllowedDirectories().slice(0,5);await this.fsCache.warmup(t,async i=>{try{const o=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(i)}`)).json();return o.success?o.items||[]:[]}catch(l){return console.warn(`Failed to prefetch ${i}:`,l.message),[]}}),this.lastIndexTime=Date.now(),console.log("âœ… Background indexing complete")}catch(s){console.error("âŒ Background indexing failed:",s)}finally{this.isIndexing=!1}}}_indexSearchResults(s){s.forEach(t=>{this.bitmaskIndex.addFile(t.path,{name:t.name||t.displayName,size:t.size||0,modified:t.modified||Date.now(),type:t.fileType||t.type||"file"})})}_removeFromIndex(s){const t=Array.from(this.bitmaskIndex.fileMetadata.values()).find(i=>i.path===s);t&&this.bitmaskIndex.removeFile(t.id)}_invalidateCachesForPath(s){const t=this._getDirectoryPath(s);this.fsCache.invalidate(t),this.queryCache.clear()}_getQueryCacheKey(s,t){return JSON.stringify({query:s.toLowerCase(),options:t})}_getFromQueryCache(s){const t=this.queryCache.get(s);return t?Date.now()-t.timestamp>this.queryCacheTTL?(this.queryCache.delete(s),null):{...t.data,cached:!0}:null}_addToQueryCache(s,t){if(this.queryCache.size>=this.queryCacheSize){const i=this.queryCache.keys().next().value;this.queryCache.delete(i)}this.queryCache.set(s,{data:t,timestamp:Date.now()})}_updateSearchStats(s){const t=this.searchStats.totalSearches,i=this.searchStats.avgSearchTime;this.searchStats.avgSearchTime=(i*(t-1)+s)/t}getStats(){return{search:this.searchStats,index:this.bitmaskIndex.getStats(),cache:this.fsCache.getStats(),security:{allowedDirectories:this.directoryManager.getAllowedDirectories().length,blacklistedPaths:this.directoryManager.getBlacklistedPaths().length},queryCache:{size:this.queryCache.size,maxSize:this.queryCacheSize}}}clearAll(){this.bitmaskIndex.clear(),this.fsCache.clear(),this.queryCache.clear(),this.directoryManager.clearCache(),this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0}}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):"/"}export(){return{index:this.bitmaskIndex.export(),cache:this.fsCache.export(),directoryConfig:this.directoryManager.export(),stats:this.searchStats,lastIndexTime:this.lastIndexTime}}import(s){s.index&&this.bitmaskIndex.import(s.index),s.cache&&this.fsCache.import(s.cache),s.directoryConfig&&this.directoryManager.import(s.directoryConfig),s.stats&&(this.searchStats=s.stats),s.lastIndexTime&&(this.lastIndexTime=s.lastIndexTime)}}const ss="http://localhost:3001",bn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Le();const{isConnected:o}=Ie(),[r,d]=n.useState("/"),[p,x]=n.useState([]),[S,k]=n.useState([]),[c,C]=n.useState(""),[M,I]=n.useState(!1),[f,u]=n.useState(null),[g,w]=n.useState(!1),[T,z]=n.useState(!1),[Y,U]=n.useState(null),[B]=n.useState(()=>new Nn(ss)),[P,E]=n.useState(null),[W,Z]=n.useState(null),O=n.useRef(null),V=n.useRef(null),L=300,K=n.useRef(null);n.useEffect(()=>{B.initialize();const y=setInterval(()=>{Z(B.getStats())},5e3);return()=>clearInterval(y)},[B]),n.useEffect(()=>{if(s||t){const y=setTimeout(()=>{a()},3e3);return()=>clearTimeout(y)}},[s,t,a]),n.useEffect(()=>{o&&ee()},[o]),n.useEffect(()=>{o&&te()},[r,o]),n.useEffect(()=>(K.current&&clearTimeout(K.current),c.trim()===""?(k(p),I(!1),E(null)):(I(!0),K.current=setTimeout(()=>{m(c)},300)),()=>{K.current&&clearTimeout(K.current)}),[c]),n.useEffect(()=>{c.trim()===""&&k(p)},[p]),n.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]);const ee=async()=>{try{const q=await(await fetch(`${ss}/api/file-system/info`)).json();U(q),q.accessible||i("Network projects directory is not accessible.")}catch(y){console.error("Error checking network access:",y),i("Failed to check network directory access: "+y.message),U({accessible:!1,message:"Connection failed"})}},te=async()=>{w(!0),a();try{const y=await B.listDirectory(r);if(y.success)x(y.items),k(y.items);else throw new Error("Failed to load directory")}catch(y){console.error("Error fetching file system items:",y),i(y.message||"Failed to load directory contents"),x([]),k([])}finally{w(!1)}},m=async y=>{if(!y||y.trim()===""){k(p),I(!1);return}I(!0),a();try{const q=performance.now(),X=await B.searchFiles(y,{directory:r,recursive:!0,checkPermissions:!0,limit:500}),J=performance.now()-q;E({time:J,indexed:X.indexed,cached:X.cached,resultCount:X.files.length,query:y}),k(X.files),J<100&&X.files.length>0&&l(`âš¡ Found ${X.files.length} results in ${J.toFixed(0)}ms ${X.cached?"(cached)":X.indexed?"(indexed)":""}`)}catch(q){if(console.error("Search error:",q),q.message.includes("permission denied")||q.message.includes("access denied"))i(`Access denied: ${q.message}`);else{console.log("Falling back to local search");const X=p.filter(J=>J.displayName.toLowerCase().includes(y.toLowerCase()));k(X)}}finally{I(!1)}},j=y=>{d(y),C(""),u(null),E(null)},F=y=>{O.current&&clearTimeout(O.current),V.current===y.id?(V.current=null,h(y)):(V.current=y.id,N(y),O.current=setTimeout(()=>{V.current=null},L))},N=y=>{f===y.id?u(null):u(y.id)},h=async y=>{if(y.type==="folder")j(y.path);else{z(!0),l(`Opening ${y.displayName}...`);try{if(await new Promise(X=>setTimeout(X,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const J=await(await fetch(`${ss}/api/file-system/filepath?path=${encodeURIComponent(y.path)}`)).json();if(!J.success)throw new Error(J.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",J.fullPath),console.log("ðŸ“„ File type:",J.fileType);const de=await window.electron.openFileInApp(J.fullPath);if(de.success)console.log("âœ… Opened with Windows default application"),l(`Opened ${y.displayName}`);else throw new Error(de.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const X=`${ss}/api/file-system/file?path=${encodeURIComponent(y.path)}`,J=window.open(X,"_blank");if(!J)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");J.focus(),console.log("âœ… Opened in browser tab"),l(`Opened ${y.displayName} in browser`)}}catch(q){console.error("âŒ Error opening file:",q),i(`Error opening file: ${q.message||"Failed to open file"}`)}finally{z(!1)}}},v=()=>{if(r==="/")return[{name:"PROJECTS",path:"/"}];const y=r.split("/").filter(J=>J),q=[{name:"PROJECTS",path:"/"}];let X="";return y.forEach(J=>{X+=`/${J}`,q.push({name:J.length>20?J.substring(0,20)+"...":J,path:X,fullName:J})}),q};return o?e.jsxs("div",{className:`file-management-section ${T?"file-opening-cursor":""}`,children:[Y&&e.jsxs("div",{className:`network-status ${Y.accessible?"accessible":"not-accessible"}`,children:[e.jsx("span",{className:"status-text",children:Y.accessible?"Network directory accessible":"Network directory not accessible"}),e.jsx("span",{className:"network-path",children:Y.path||"\\\\KMTI-NAS\\Shared\\Public\\PROJECTS"})]}),e.jsxs("div",{className:"file-nav-controls",children:[e.jsx("div",{className:"breadcrumb-container",children:e.jsx("nav",{className:"breadcrumb",children:v().map((y,q)=>e.jsxs("span",{className:"breadcrumb-item",children:[q>0&&e.jsx("span",{className:"breadcrumb-separator",children:"/"}),e.jsx("button",{className:`breadcrumb-link ${q===v().length-1?"active":""}`,onClick:()=>j(y.path),disabled:q===v().length-1,title:y.fullName||y.name,children:y.name})]},y.path))})}),e.jsx("div",{className:"file-controls-right",children:e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:c,onChange:y=>C(y.target.value),className:"search-input"}),c&&e.jsx("button",{className:"search-clear-btn",onClick:()=>C(""),title:"Clear search",children:"Ã—"})]})})]}),P&&e.jsxs("div",{className:"search-performance-bar",children:[e.jsxs("span",{className:"perf-badge",children:["âš¡ ",P.time.toFixed(0),"ms"]}),e.jsx("span",{className:"perf-badge",children:P.cached?"ðŸ’¾ Cached":P.indexed?"ðŸ“‡ Indexed":"ðŸŒ API"}),e.jsxs("span",{className:"perf-badge",children:["ðŸ“Š ",P.resultCount," results"]}),W&&e.jsxs("span",{className:"perf-badge",title:"Cache statistics",children:["ðŸ’¿ ",W.cache.cacheSize," dirs cached (",W.cache.hitRate," hit rate)"]})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsx("div",{className:"file-system-container",children:g||M?e.jsx(re,{type:"grid"}):e.jsxs(e.Fragment,{children:[T&&e.jsx("div",{className:"component-loading-overlay",children:e.jsx(re,{type:"grid"})}),e.jsx("div",{className:`files-content ${T?"loading":""}`,children:e.jsx("div",{className:"files-grid",children:S.length===0&&c?e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['No files found for "',c,'"']}),e.jsx("p",{className:"no-results-hint",children:"Try a different search term or check your spelling"})]}):S.map(y=>e.jsxs("div",{className:`file-item ${y.type} ${f===y.id?"selected":""}`,onClick:()=>F(y),title:`${y.name}
1st click: Select
2nd click: Open`,children:[e.jsx("div",{className:"file-icon",children:e.jsx(qe,{fileType:y.fileType,isFolder:y.type==="folder",altText:y.type,className:"file-icon-img"})}),e.jsxs("div",{className:"file-info",children:[e.jsx("div",{className:"file-name",title:y.name,children:y.displayName}),y.parentPath&&c&&e.jsxs("div",{className:"file-location",title:y.parentPath,children:["ðŸ“ ",y.parentPath]})]})]},y.id))})})]})})]}):e.jsx(re,{type:"table"})},kn=Fe(bn,{componentName:"File Management"});const Cn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,users:o,user:r})=>{Le();const{isConnected:d}=Ie(),[p,x]=n.useState(!1),[S,k]=n.useState([]),[c,C]=n.useState(!1),[M,I]=n.useState("Loading..."),[f,u]=n.useState({name:"",leaderId:"",leaderUsername:""}),[g,w]=n.useState(null),[T,z]=n.useState({isOpen:!1,teamId:null,teamName:""}),[Y,U]=n.useState({fileManagement:{rootDirectory:""},general:{timezone:"UTC",dateFormat:"ISO",language:"en-US"}}),[B,P]=n.useState(!0);n.useEffect(()=>{(async()=>{try{if(window.updater&&window.updater.getVersion){const v=await window.updater.getVersion();I(`v${v}`)}else{const y=await(await fetch("http://localhost:3001/api/version")).json();y.success&&y.version?I(`v${y.version}`):I("Unknown")}}catch(v){console.error("Failed to fetch app version:",v),I("Unknown")}})()},[]);const E=(h,v,y)=>{U(q=>({...q,[h]:{...q[h],[v]:y}}))},W=async()=>{P(!0);try{const v=await(await fetch("http://localhost:3001/api/settings/root_directory")).json();v.success&&v.setting&&U(y=>({...y,fileManagement:{...y.fileManagement,rootDirectory:v.setting.value||"/home/admin/files"}}))}catch(h){console.error("Failed to fetch settings:",h),i("Failed to load settings")}finally{P(!1)}},Z=async()=>{a();try{if(console.log("Browse button clicked"),console.log("window.electron available:",!!window.electron),console.log("window.electron.openDirectoryDialog available:",!!(window.electron&&window.electron.openDirectoryDialog)),window.electron&&window.electron.openDirectoryDialog){console.log("Opening Electron directory dialog...");const h=await window.electron.openDirectoryDialog();if(console.log("Dialog result:",h),!h.canceled&&h.filePaths&&h.filePaths.length>0){const v=h.filePaths[0];console.log("Selected path:",v),U(y=>({...y,fileManagement:{...y.fileManagement,rootDirectory:v}})),l(`Selected directory: ${v}`)}else console.log("Dialog was canceled")}else console.warn("Electron API not available"),i("Folder browser is only available in the desktop application. Please enter the path manually or run the Electron app.")}catch(h){console.error("Error browsing directory:",h),i("Failed to open directory browser: "+h.message)}},O=async()=>{if(!Y.fileManagement.rootDirectory.trim()){i("Root directory path is required");return}x(!0);try{const v=await(await fetch("http://localhost:3001/api/settings/root_directory",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:Y.fileManagement.rootDirectory,updated_by:r?.username||"admin"})})).json();v.success?l("New directory settings saved successfully"):i(v.message||"Failed to save file directory settings")}catch(h){console.error("Error saving settings:",h),i("Failed to save file directory settings")}finally{x(!1)}};n.useEffect(()=>{d&&(V(),W())},[d]);const V=async()=>{C(!0);try{const v=await(await fetch("http://localhost:3001/api/teams")).json();v.success?k(v.teams||[]):i("Failed to fetch teams")}catch{i("Failed to fetch teams")}finally{C(!1)}},L=async()=>{if(!f.name.trim()){i("Team name is required");return}x(!0);try{const v=await(await fetch("http://localhost:3001/api/teams",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f.name,leaderId:f.leaderId,leaderUsername:f.leaderUsername})})).json();v.success?(l("Team created successfully"),u({name:"",leaderId:"",leaderUsername:""}),V()):i(v.message||"Failed to create team")}catch{i("Failed to create team")}finally{x(!1)}},K=async()=>{if(!g||!g.name.trim()){i("Team name is required");return}x(!0);try{const v=await(await fetch(`http://localhost:3001/api/teams/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g.name,leaderId:g.leader_id,leaderUsername:g.leader_username,isActive:g.is_active})})).json();v.success?(l("Team updated successfully"),w(null),V()):i(v.message||"Failed to update team")}catch{i("Failed to update team")}finally{x(!1)}},ee=(h,v)=>{z({isOpen:!0,teamId:h,teamName:v})},te=async()=>{const{teamId:h,teamName:v}=T;x(!0);try{const q=await(await fetch(`http://localhost:3001/api/teams/${h}`,{method:"DELETE"})).json();q.success?(l(`Team '${v}' deleted successfully`),V()):i(q.message||"Failed to delete team")}catch{i("Failed to delete team")}finally{x(!1),z({isOpen:!1,teamId:null,teamName:""})}},m=()=>{z({isOpen:!1,teamId:null,teamName:""})},j=h=>w({...h}),F=()=>w(null),N=()=>o?.filter(h=>h.role==="TEAM LEADER"||h.role==="ADMIN")||[];return d?e.jsxs("div",{className:`settings-section ${p?"loading-cursor":""}`,children:[s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"settings-grid",children:[e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"File Management"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Root Directory Path"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{type:"text",value:Y.fileManagement.rootDirectory,onChange:h=>E("fileManagement","rootDirectory",h.target.value),placeholder:"/home/admin/files",className:"form-input",disabled:B}),e.jsx("button",{className:"btn btn-secondary",onClick:Z,disabled:p||B,title:"Browse for folder (Desktop app only)",children:"Browse"}),e.jsx("button",{className:"btn btn-primary",onClick:O,disabled:p||B,children:p?"Saving...":"Save"})]}),e.jsx("p",{className:"help-text",children:"Base directory for files"})]})})]}),e.jsxs("div",{className:"settings-card team-management-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"Team Management"})}),e.jsxs("div",{className:"settings-card-body",children:[e.jsxs("div",{className:"team-section",children:[e.jsx("h4",{children:"Create New Team"}),e.jsxs("div",{className:"team-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Name"}),e.jsx("input",{type:"text",value:f.name,onChange:h=>u(v=>({...v,name:h.target.value})),placeholder:"Enter team name",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Leader"}),e.jsxs("select",{value:f.leaderId,onChange:h=>{const v=N().find(y=>y.id==h.target.value);u(y=>({...y,leaderId:h.target.value,leaderUsername:v?v.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),N().map(h=>e.jsxs("option",{value:h.id,children:[h.fullName," (",h.username,") - ",h.role]},h.id))]})]}),e.jsx("button",{className:"btn btn-primary",id:"create-team-btn",onClick:L,disabled:p||!f.name.trim(),children:p?"Creating...":"Create Team"})]})]}),e.jsxs("div",{className:"team-section",children:[e.jsxs("h4",{children:["Existing Teams (",S.length,")"]}),c?e.jsx("div",{className:"loading-state",children:"Loading teams..."}):S.length===0?e.jsx("div",{className:"empty-state",children:"No teams found"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"teams-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Team Name"}),e.jsx("th",{children:"Leader"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:S.map(h=>e.jsx("tr",{children:g&&g.id===h.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:g.name,onChange:v=>w(y=>({...y,name:v.target.value})),className:"form-input"})}),e.jsx("td",{children:e.jsxs("select",{value:g.leader_id||"",onChange:v=>{const y=N().find(q=>q.id==v.target.value);w(q=>({...q,leader_id:v.target.value,leader_username:y?y.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),N().map(v=>e.jsxs("option",{value:v.id,children:[v.fullName," (",v.username,")"]},v.id))]})}),e.jsx("td",{children:e.jsxs("select",{value:g.is_active,onChange:v=>w(y=>({...y,is_active:v.target.value==="true"})),className:"form-select",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:K,disabled:p,children:p?"Saving...":"Save"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:F,children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:h.name}),e.jsx("td",{children:h.leader_username||"No leader assigned"}),e.jsx("td",{children:e.jsx("span",{className:`status ${h.is_active?"active":"inactive"}`,children:h.is_active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>j(h),children:"Edit"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>ee(h.id,h.name),children:"Delete"})]})})]})},h.id))})]})})]})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"System Information"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"system-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Application Version:"}),e.jsx("span",{className:"info-value",children:M})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Database Version:"}),e.jsx("span",{className:"info-value",children:"MySQL"})]})]})})]})]}),e.jsx(Pe,{isOpen:T.isOpen,onClose:m,onConfirm:te,title:"Delete Team",message:"Are you sure you want to delete this team?",confirmText:"Delete Team",variant:"danger",isLoading:p,itemInfo:T.teamName?{name:T.teamName,details:"All team members will be unassigned"}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The team will be permanently removed from the system."})})]}):e.jsx(re,{type:"admin"})},Sn=Fe(Cn,{componentName:"Settings"});const _n=({error:a,success:s,setError:t,setSuccess:i,clearMessages:l,user:o,contextAssignmentId:r})=>{Le(),Ie();const[d,p]=n.useState([]),[x,S]=n.useState(!0),[k,c]=n.useState(!1),[C,M]=n.useState({}),[I,f]=n.useState(!1),[u,g]=n.useState(null),[w,T]=n.useState([]),[z,Y]=n.useState(!1),[U,B]=n.useState(""),[P,E]=n.useState(null),[W,Z]=n.useState(""),[O,V]=n.useState({}),[L,K]=n.useState(!1),[ee,te]=n.useState(!1),[m,j]=n.useState(null),[F,N]=n.useState(!1),[h,v]=n.useState(null),[y,q]=n.useState({}),[X,J]=n.useState(null),[de,ue]=n.useState(!0),xe=n.useRef(null),ye=n.useRef(null);n.useEffect(()=>{ke()},[]),n.useEffect(()=>{if(r&&typeof r=="object"){const{assignmentId:b,commentId:$,shouldOpenComments:se}=r;if(b&&se){const ne=d.find(le=>le.id===b);ne&&(D(ne),$&&setTimeout(()=>{const le=document.querySelector(`[data-comment-id="${$}"]`);le&&(le.scrollIntoView({behavior:"smooth",block:"center"}),le.classList.add("highlight-comment"),setTimeout(()=>{le.classList.remove("highlight-comment")},2e3))},500))}}},[r,d]),n.useEffect(()=>{if(x||k||!de)return;const b={root:null,rootMargin:"100px",threshold:.1};return xe.current=new IntersectionObserver($=>{$[0].isIntersecting&&de&&!k&&(console.log("Intersection detected, loading more..."),Ce())},b),ye.current&&xe.current.observe(ye.current),()=>{xe.current&&xe.current.disconnect()}},[x,k,de,X]),n.useEffect(()=>{const b=$=>{h&&!$.target.closest(".admin-card-menu")&&v(null)};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[h]);const ke=async()=>{try{S(!0),l(),console.log("Fetching initial assignments...");const $=await(await fetch("http://localhost:3001/api/assignments/admin/all?limit=20")).json();if(console.log("Initial assignments response:",$),!$.success){t($.message||"Failed to fetch assignments"),S(!1);return}const se=$.assignments||[];console.log(`Fetched ${se.length} initial assignments`),p(se),J($.nextCursor),ue($.hasMore)}catch(b){console.error("Error fetching assignments:",b),t("Failed to load assignments")}finally{S(!1)}},Ce=n.useCallback(async()=>{if(k||!de||!X){console.log("Skipping fetch:",{loadingMore:k,hasMore:de,nextCursor:X});return}try{c(!0),console.log("Fetching more assignments with cursor:",X);const $=await(await fetch(`http://localhost:3001/api/assignments/admin/all?cursor=${X}&limit=20`)).json();if(console.log("More assignments response:",$),!$.success){t($.message||"Failed to fetch more assignments");return}const se=$.assignments||[];console.log(`Fetched ${se.length} more assignments`),p(ne=>[...ne,...se]),J($.nextCursor),ue($.hasMore)}catch(b){console.error("Error fetching more assignments:",b),t("Failed to load more assignments")}finally{c(!1)}},[X,de,k]),pe=n.useCallback(async b=>{try{Y(!0);const se=await(await fetch(`http://localhost:3001/api/assignments/${b}/comments`)).json();se.success?T(se.comments||[]):t(se.message||"Failed to load comments. Please try again.")}catch($){console.error("Error fetching comments:",$),t("Failed to load comments")}finally{Y(!1)}},[t]),D=n.useCallback(b=>{g(b),f(!0),pe(b.id)},[pe]),Q=n.useCallback(()=>{f(!1),g(null),T([]),B(""),E(null),Z("")},[]),H=n.useCallback(async b=>{if(b.preventDefault(),!!U.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const $=o,se=U,ne={id:`temp-${Date.now()}`,comment:se,user_id:$.id,username:$.username,user_fullname:$.fullName,user_role:$.role,created_at:new Date().toISOString(),replies:[]};T(Ne=>[...Ne,ne]),B("");const we=await(await fetch(`http://localhost:3001/api/assignments/${u.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:$.id,username:$.username,comment:se})})).json();we.success?(await pe(u.id),i("Comment posted successfully"),setTimeout(()=>i(""),3e3)):(T(Ne=>Ne.filter(Se=>Se.id!==ne.id)),B(se),t(we.message||"Failed to post comment"))}catch($){console.error("Error posting comment:",$),t("Failed to post comment")}},[U,o,u,pe,t,i]),ce=n.useCallback(async(b,$)=>{if(b.preventDefault(),!!W.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const se=o,ne=W,le={id:`temp-${Date.now()}`,reply:ne,user_id:se.id,username:se.username,user_fullname:se.fullName,user_role:se.role,created_at:new Date().toISOString()};T(Se=>Se.map(ve=>ve.id===$?{...ve,replies:[...ve.replies||[],le]}:ve)),Z(""),E(null);const Ne=await(await fetch(`http://localhost:3001/api/assignments/${u.id}/comments/${$}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:se.id,username:se.username,reply:ne})})).json();Ne.success?(await pe(u.id),i("Reply posted successfully"),setTimeout(()=>i(""),3e3)):(T(Se=>Se.map(ve=>ve.id===$?{...ve,replies:(ve.replies||[]).filter(ms=>ms.id!==le.id)}:ve)),Z(ne),E($),t(Ne.message||"Failed to post reply"))}catch(se){console.error("Error posting reply:",se),t("Failed to post reply")}},[W,o,u,pe,t,i]),_=b=>{M($=>({...$,[b]:!$[b]}))},G=b=>{q($=>({...$,[b]:!$[b]}))},ae=n.useCallback(b=>b?b.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2):"?",[]),ge=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No due date",je=b=>{if(!b)return"";const ne=new Date(b)-new Date,le=Math.ceil(ne/(1e3*60*60*24));return le<0?`${Math.abs(le)} days overdue`:le===0?"Due today":le===1?"1 day left":`${le} days left`},os=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown",rs=n.useCallback(b=>{if(!b)return"Unknown";const $=new Date(b),ne=Math.floor((new Date-$)/1e3);return ne<60?"Just now":ne<3600?`${Math.floor(ne/60)}m ago`:ne<86400?`${Math.floor(ne/3600)}h ago`:ne<604800?`${Math.floor(ne/86400)}d ago`:$.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[]),cs=b=>{if(!b)return"#95a5a6";const $=new Date(b),ne=Math.ceil(($-new Date)/(1e3*60*60*24));return ne<0?"#e74c3c":ne<=2?"#f39c12":"#27ae60"},ds=n.useCallback(b=>{V($=>({...$,[b]:!$[b]}))},[]),hs=async(b,$)=>{if(!b){t("File path not available");return}try{if(K(!0),l(),i("Opening file..."),await new Promise(ne=>setTimeout(ne,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const le=await(await fetch(`http://localhost:3001/api/files/${$}/path`)).json();if(!le.success)throw new Error(le.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",le.filePath),console.log("ðŸ“„ File name:",le.fileName);const we=await window.electron.openFileInApp(le.filePath);if(we.success)console.log("âœ… Opened with Windows default application"),i("File opened successfully");else throw new Error(we.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const ne=`http://localhost:3001${b}`,le=window.open(ne,"_blank");if(!le)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");le.focus(),console.log("âœ… Opened in browser tab"),i("File opened in browser")}}catch(se){console.error("âŒ Error opening file:",se),i(""),t(`Error opening file: File deleted/rejected or ${se.message||"Failed to open file"}`)}finally{K(!1)}},Te=async()=>{if(m)try{N(!0),l(),i("Deleting assignment and associated files...");const $=await(await fetch(`http://localhost:3001/api/assignments/${m.id}`,{method:"DELETE"})).json();$.success?(p(se=>se.filter(ne=>ne.id!==m.id)),i("Assignment and associated files deleted successfully"),setTimeout(()=>i(""),3e3),te(!1),j(null)):t($.message||"Failed to delete assignment")}catch(b){console.error("Error deleting assignment:",b),t("Failed to delete assignment")}finally{N(!1)}},Re=()=>{te(!1),j(null)};return x?e.jsx("div",{className:"task-management-container",children:e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsx("div",{className:"task-count",children:"Loading..."}),e.jsx("div",{className:"feed-container",children:e.jsx("div",{className:"loading-skeleton",children:[1,2,3].map(b=>e.jsxs("div",{className:"skeleton-assignment-card",children:[e.jsxs("div",{className:"skeleton-card-header",children:[e.jsxs("div",{className:"skeleton-header-left",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-header-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]}),e.jsx("div",{className:"skeleton-header-right",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]}),e.jsx("div",{className:"skeleton-title-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-title"})}),e.jsxs("div",{className:"skeleton-description-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-medium"})]}),e.jsxs("div",{className:"skeleton-attachment-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-small"}),e.jsxs("div",{className:"skeleton-file-item",children:[e.jsx("div",{className:"skeleton-file-icon"}),e.jsxs("div",{className:"skeleton-file-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]})]}),e.jsx("div",{className:"skeleton-comments-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]},b))})})]})}):e.jsxs("div",{className:`task-management-container ${L?"file-opening-cursor":""}`,children:[a&&e.jsx(fe,{type:"error",message:a,onClose:l}),s&&e.jsx(fe,{type:"success",message:s,onClose:l}),e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsxs("div",{className:"task-count",children:[d.length," task",d.length!==1?"s":"",de&&" â€¢ Scroll for more"]}),e.jsx("div",{className:"feed-container",children:d.length===0?e.jsxs("div",{className:"empty-feed",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“­"}),e.jsx("h3",{children:"No Tasks Yet"}),e.jsx("p",{children:"Team leaders haven't created any assignments yet."})]}):e.jsxs(e.Fragment,{children:[d.map(b=>e.jsxs("div",{className:"admin-assignment-card",children:[e.jsxs("div",{className:"admin-card-header",children:[e.jsxs("div",{className:"admin-header-left",children:[e.jsx("div",{className:"admin-avatar",children:ae(b.team_leader_fullname||b.team_leader_username)}),e.jsxs("div",{className:"admin-header-info",children:[e.jsxs("div",{className:"admin-assignment-assigned",children:[e.jsx("span",{className:"admin-team-leader-name",children:b.team_leader_fullname||b.team_leader_username}),e.jsx("span",{className:"role-badge team-leader",children:"TEAM LEADER"}),"assigned to"," ",e.jsx("span",{className:"admin-assigned-user",children:b.assigned_member_details&&b.assigned_member_details.length>0?b.assigned_member_details.length===1?b.assigned_member_details[0].fullName||b.assigned_member_details[0].username:`${b.assigned_member_details.length} members (${b.assigned_member_details.map($=>$.fullName||$.username).join(", ")})`:b.assigned_to==="all"?"All team members":"Unknown User"})]}),e.jsx("div",{className:"admin-assignment-created",children:b.created_at?os(b.created_at):"Unknown creation date"})]})]}),e.jsxs("div",{className:"admin-header-right",children:[e.jsxs("div",{className:"admin-card-menu",children:[e.jsx("button",{className:"admin-menu-btn",onClick:()=>v(h===b.id?null:b.id),title:"More options",children:"â‹®"}),h===b.id&&e.jsx("div",{className:"admin-menu-dropdown",children:e.jsx("button",{className:"admin-menu-item admin-delete-menu-item",onClick:()=>{j(b),te(!0),v(null)},children:"Delete"})})]}),b.due_date&&e.jsxs("div",{className:"admin-due-date",children:["Due: ",ge(b.due_date),e.jsxs("span",{className:"admin-days-left",style:{color:cs(b.due_date)},children:[" ","(",je(b.due_date),")"]})]})]})]}),e.jsx("div",{className:"admin-task-title-section",children:e.jsx("h3",{className:"admin-assignment-title",children:b.title})}),b.description&&e.jsx("div",{className:"admin-task-description-section",children:e.jsxs("p",{className:"admin-assignment-description",children:[C[b.id]?b.description:b.description.length>200?`${b.description.substring(0,200)}...`:b.description,b.description.length>200&&e.jsx("button",{className:"admin-expand-btn",onClick:()=>_(b.id),children:C[b.id]?"Show less":"Show more"})]})}),e.jsx("div",{className:"admin-attachment-section",children:b.recent_submissions&&b.recent_submissions.length>0?e.jsxs("div",{className:"admin-attached-file",children:[e.jsxs("div",{className:"admin-file-label",children:["ðŸ“Ž Attachment",b.recent_submissions.length>1?"s":""," (",b.recent_submissions.length,"):"]}),(y[b.id]?b.recent_submissions:b.recent_submissions.slice(0,5)).map(($,se)=>e.jsxs("div",{className:"admin-file-item",onClick:()=>hs($.file_path,$.id),style:{cursor:"pointer",marginBottom:se<(y[b.id]?b.recent_submissions.length:Math.min(5,b.recent_submissions.length))-1?"8px":"0"},children:[e.jsx(qe,{fileType:$.original_name.split(".").pop(),size:"small",className:"admin-file-icon"}),e.jsxs("div",{className:"admin-file-details",children:[e.jsx("div",{className:"admin-file-name",children:$.original_name}),e.jsxs("div",{className:"admin-file-meta",children:["Submitted by ",e.jsx("span",{className:"admin-file-submitter",children:$.fullName||$.username})," on ",ge($.submitted_at),$.tag&&e.jsxs("span",{style:{backgroundColor:"#dbeafe",color:"#1e40af",padding:"4px 10px",borderRadius:"12px",fontSize:"11px",fontWeight:"600",border:"1px solid #93c5fd",display:"inline-flex",alignItems:"center",gap:"4px",marginLeft:"8px"},children:["ðŸ·ï¸ ",$.tag]})]})]})]},$.id)),b.recent_submissions.length>5&&e.jsx("button",{className:"admin-attachment-toggle-btn",onClick:()=>G(b.id),children:y[b.id]?"See less":`See more (${b.recent_submissions.length-5} more)`})]}):e.jsxs("div",{className:"admin-no-attachment",children:[e.jsx("span",{className:"admin-no-attachment-icon",children:"ðŸ“„"}),e.jsx("span",{className:"admin-no-attachment-text",children:"No attachments yet"})]})}),e.jsx("div",{className:"admin-comments-section",children:e.jsxs("div",{className:"admin-comments-text",onClick:()=>D(b),children:["Comments (",b.comment_count||0,")"]})})]},b.id)),k&&e.jsx("div",{className:"inline-skeleton-container",children:[1,2].map(b=>e.jsxs("div",{className:"skeleton-card",children:[e.jsxs("div",{className:"skeleton-header",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-text",children:[e.jsx("div",{className:"skeleton-line skeleton-line-short"}),e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})]})]}),e.jsxs("div",{className:"skeleton-body",children:[e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line skeleton-line-short"})]})]},b))}),de&&!k&&e.jsx("div",{ref:ye,style:{height:"20px",margin:"20px 0"}})]})}),e.jsx(ct,{isOpen:I,onClose:Q,assignment:u,comments:w,loadingComments:z,newComment:U,setNewComment:B,onPostComment:H,replyingTo:P,setReplyingTo:E,replyText:W,setReplyText:Z,onPostReply:ce,visibleReplies:O,toggleRepliesVisibility:ds,getInitials:ae,formatTimeAgo:rs,user:o}),e.jsx(Pe,{isOpen:ee,onClose:Re,onConfirm:Te,title:"Delete Task",message:"Are you sure you want to delete this task?",confirmText:"Delete Task",cancelText:"Cancel",variant:"danger",isLoading:F,itemInfo:m?{name:m.title,details:`${m.comment_count||0} comment${(m.comment_count||0)!==1?"s":""} â€¢ ${m.recent_submissions?.length||0} submission${(m.recent_submissions?.length||0)!==1?"s":""}`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The task and all associated comments will be permanently removed from the system."})})]})]})},Fn=Fe(_n,{componentName:"Task Management"});const mt=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-title",children:a.title}),e.jsx("div",{className:"notification-message",children:a.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsxs("span",{className:"notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));mt.displayName="NotificationItem";const Tn=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,d]=n.useState(!1),[p,x]=n.useState(""),[S,k]=n.useState(0),[c,C]=n.useState(!1),[M,I]=n.useState(!1);et(S);const[f,u]=n.useState(1),[g,w]=n.useState(!0),[T,z]=n.useState(0),Y=20,U=n.useRef(null),B=n.useRef(null),[P,E]=n.useState(null);n.useEffect(()=>{W(1,!0);const j=setInterval(()=>{W(1,!0,!0)},3e4);return()=>clearInterval(j)},[a.id]),n.useEffect(()=>{if(l||r||!g)return;const j={root:null,rootMargin:"100px",threshold:.1};return U.current=new IntersectionObserver(F=>{F[0].isIntersecting&&g&&!r&&W(f+1,!1)},j),B.current&&U.current.observe(B.current),()=>{U.current&&U.current.disconnect()}},[l,r,g,f]);const W=async(j,F=!1,N=!1)=>{try{F&&!N?o(!0):N||d(!0);const v=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${j}&limit=${Y}`)).json();if(v.success){const y=v.notifications||[];if(F)i(y),u(1);else if(N){const q=new Set(t.map(J=>J.id)),X=y.filter(J=>!q.has(J.id));X.length>0&&i([...X,...t])}else i(q=>[...q,...y]),u(j);k(v.unreadCount||0),z(v.totalCount||0),w(v.hasMore||!1)}else x("Failed to fetch notifications")}catch(h){console.error("Error fetching notifications:",h),N||x("Failed to fetch notifications")}finally{F&&!N?o(!1):N||d(!1)}},Z=async j=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${j}/read`,{method:"PUT"})).json()).success&&(i(h=>h.map(v=>v.id===j?{...v,is_read:!0}:v)),k(h=>Math.max(0,h-1)))}catch(F){console.error("Error marking notification as read:",F)}},O=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(N=>N.map(h=>({...h,is_read:!0}))),k(0))}catch(j){console.error("Error marking all as read:",j)}},V=async j=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${j}`,{method:"DELETE"})).json()).success){const h=t.find(v=>v.id===j);i(v=>v.filter(y=>y.id!==j)),z(v=>v-1),h&&!h.is_read&&k(v=>Math.max(0,v-1))}}catch(F){console.error("Error deleting notification:",F)}},L=async()=>{I(!0);try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),k(0),z(0),w(!1),C(!1))}catch(j){console.error("Error deleting all notifications:",j),x("Failed to delete all notifications")}finally{I(!1)}},K=j=>{if(j.is_read||Z(j.id),console.log("ðŸ“‹ Notification clicked:",j),j.type==="password_reset_request"){s&&j.file_id&&(console.log("ðŸ”‘ Password reset request - Navigating to User Management"),s("users",{userId:j.file_id,action:"reset-password",username:j.action_by_username}));return}j.type==="comment"?j.assignment_id&&(j.comment_id&&E(j.comment_id),s&&s("tasks",{assignmentId:j.assignment_id,commentId:j.comment_id,shouldOpenComments:!0})):j.assignment_id?s&&s("tasks",j.assignment_id):j.file_id&&(j.type==="approval"||j.type==="rejection"?s&&s("file-approval",j.file_id):s&&s("file-management",j.file_id))},ee=({type:j})=>e.jsx(qe,{fileType:j,size:"medium",altText:`${j} notification icon`,className:"notification-type-icon"}),te=n.useCallback(j=>{const F=new Date,N=new Date(j),h=Math.floor((F-N)/1e3);return h<60?`${h}s ago`:h<3600?`${Math.floor(h/60)}m ago`:h<86400?`${Math.floor(h/3600)}h ago`:h<604800?`${Math.floor(h/86400)}d ago`:N.toLocaleDateString()},[]),m=()=>e.jsx("div",{className:"notification-skeleton",children:[1,2,3,4,5].map(j=>e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"}),e.jsx("div",{className:"skeleton-line skeleton-line-meta"})]})]},j))});return l?e.jsxs("div",{className:"notifications-page",children:[e.jsx("div",{className:"notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(m,{})]}):e.jsxs("div",{className:`notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"notifications-actions",children:[S>0&&e.jsx("button",{className:"btn-mark-all-read",onClick:O,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"btn-delete-all",onClick:()=>C(!0),children:"Delete All"})]})]}),p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"notifications-stats",children:[T," total â€¢ ",S," unread"]}),t.length===0?e.jsxs("div",{className:"no-notifications",children:[e.jsx("div",{className:"no-notifications-icon",children:"ðŸ””"}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notifications-list",children:t.map(j=>e.jsx(mt,{notification:j,onNotificationClick:K,onDeleteNotification:V,NotificationIcon:ee,formatTimeAgo:te},j.id))}),r&&e.jsxs("div",{className:"notifications-loading-more",children:[e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]}),e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]})]}),g&&!r&&e.jsx("div",{ref:B,className:"load-more-trigger"}),!g&&t.length>=Y&&e.jsx("div",{className:"end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]}),c&&e.jsx(Pe,{isOpen:c,onClose:()=>C(!1),onConfirm:L,title:"Delete All Notifications",message:"Are you sure you want to delete all notifications?",confirmText:"Delete All",cancelText:"Cancel",variant:"danger",isLoading:M,itemInfo:{name:`${T} notification${T!==1?"s":""}`,details:`Including ${S} unread notification${S!==1?"s":""}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})})]})},Mn=Fe(Tn,{componentName:"Notifications"});const En=({notifications:a,onClose:s,onNavigate:t})=>{const[i,l]=n.useState([]),[o,r]=n.useState(new Set),d=st({duration:8e3});n.useEffect(()=>{const c=a.filter(C=>!C.is_read&&!o.has(C.id)).slice(0,3);if(l(c),c.length>0){const C=c.length===1?c[0].title:`${c.length} New Notifications`;d(C)}if(c.length>0){const C=c.map(M=>setTimeout(()=>{p(M.id)},8e3));return()=>C.forEach(M=>clearTimeout(M))}},[a,o]);const p=c=>{r(C=>new Set([...C,c])),l(C=>C.filter(M=>M.id!==c))},x=c=>{console.log("ðŸ‘‰ Admin Toast clicked:",c),t&&(c.type==="password_reset_request"&&c.file_id?(console.log("ðŸ”‘ Password reset request - Navigating to User Management"),t("users",{userId:c.file_id,action:"reset-password",username:c.action_by_username})):c.assignment_id?(console.log("ðŸ“‹ Navigating to tasks:",c.assignment_id),t("tasks",c.assignment_id)):c.file_id?c.type==="approval"||c.type==="rejection"||c.type==="final_approval"||c.type==="final_rejection"?(console.log("âœ… Navigating to file-approval:",c.file_id),t("file-approval",c.file_id)):(console.log("ðŸ“ Navigating to file-management:",c.file_id),t("file-management",c.file_id)):console.log("âš ï¸ No specific target for notification")),p(c.id)},S=c=>{switch(c){case"password_reset_request":return"ðŸ”‘";case"comment":return"ðŸ’¬";case"assignment":return"ðŸ“‹";case"approval":return"âœ…";case"rejection":return"âŒ";case"final_approval":return"ðŸŽ‰";case"final_rejection":return"ðŸš«";default:return"ðŸ””"}},k=c=>{switch(c){case"password_reset_request":return"gray";case"comment":return"blue";case"assignment":return"purple";case"approval":case"final_approval":return"green";case"rejection":case"final_rejection":return"red";default:return"gray"}};return i.length===0?null:e.jsx("div",{className:"toast-container cursor-pointer",children:i.map((c,C)=>e.jsxs("div",{className:`toast-notification toast-${k(c.type)}`,style:{animationDelay:`${C*100}ms`},onClick:()=>x(c),children:[e.jsx("div",{className:"toast-icon",children:S(c.type)}),e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-title",children:c.title}),e.jsx("div",{className:"toast-message",children:c.message}),e.jsxs("div",{className:"toast-meta",children:[e.jsxs("span",{children:["ðŸ‘¤ ",c.action_by_username]}),c.assignment_title&&e.jsxs("span",{children:["ðŸ“‹ ",c.assignment_title]})]})]}),e.jsx("button",{className:"toast-close",onClick:M=>{M.stopPropagation(),p(c.id)},children:"âœ•"})]},c.id))})},An=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,d]=n.useState(""),[p,x]=n.useState(""),[S,k]=n.useState([]),[c,C]=n.useState(0),[M,I]=n.useState(null),[f,u]=n.useState(!1),g=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{Ps({targets:g.current,opacity:[0,1],duration:300,easing:"easeOutCubic"}),Ps({targets:w.current,opacity:[0,1],duration:300,delay:100,easing:"easeOutCubic"})},[]),n.useEffect(()=>{T(),z();const O=setInterval(z,1e4);return()=>clearInterval(O)},[]);const T=async()=>{try{const V=await(await fetch("http://localhost:3001/api/users")).json();V.success&&o(V.users)}catch(O){console.error("Error fetching users:",O)}},z=async()=>{try{const V=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();V.success&&(k(V.notifications||[]),C(V.unreadCount||0))}catch(O){console.error("Error fetching notifications:",O)}},Y=()=>{s()},U=()=>{d(""),x("")},B=(O,V=null)=>{i(O),I(V),U()},P=(O,V)=>{if(console.log("ðŸ”” Admin Navigation triggered:",{tabName:O,contextData:V}),f&&u(!1),i(O),I(V),U(),V){const L=document.querySelector(".content-area");L&&(L.scrollTop=0),V.action==="reset-password"&&console.log("ðŸ”‘ Password reset context:",V)}},E=()=>{u(!f)},W=()=>{u(!1)},Z=()=>{const O={clearMessages:U,error:r,success:p,setError:d,setSuccess:x};switch(t){case"dashboard":return e.jsx(Js,{user:a,users:l});case"users":return e.jsx(cn,{...O,user:a,contextData:M});case"activity-logs":return e.jsx(pn,{...O});case"file-approval":return e.jsx(jn,{...O,contextFileId:M});case"file-management":return e.jsx(kn,{...O,contextFileId:M});case"tasks":return e.jsx(Fn,{...O,user:a,contextAssignmentId:M});case"notifications":return e.jsx(Mn,{user:a,onNavigate:P});case"settings":return e.jsx(Sn,{...O,users:l,user:a});default:return e.jsx(Js,{user:a,users:l})}};return e.jsx(Za,{initialUser:a,children:e.jsx(en,{children:e.jsx(tn,{userId:a?.id,children:e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"admin"}),children:e.jsxs("div",{className:"minimal-admin-dashboard",children:[e.jsx("button",{className:`burger-menu-btn ${f?"active":""}`,onClick:E,"aria-label":"Toggle sidebar menu",children:e.jsxs("div",{className:"burger-menu-icon",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{className:`sidebar-overlay ${f?"active":""}`,onClick:W}),e.jsxs("div",{className:`admin-sidebar ${f?"open":""}`,ref:g,children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"admin-info",children:[e.jsx("div",{className:"admin-name",children:a.fullName||"Admin User"}),e.jsx("div",{className:"admin-role",children:a.role||"Administrator"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${t==="dashboard"?"active":""}`,onClick:()=>{B("dashboard"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${t==="notifications"?"active":""}`,onClick:()=>{B("notifications"),W()},children:[e.jsxs("span",{className:"nav-icon nav-icon-with-badge",children:[me("notifications"),c>0&&e.jsx("span",{className:"sidebar-notification-badge",children:c>99?"99+":c})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${t==="file-management"?"active":""}`,onClick:()=>{B("file-management"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("files")}),e.jsx("span",{className:"nav-label",children:"Files"})]}),e.jsxs("button",{className:`nav-item ${t==="users"?"active":""}`,onClick:()=>{B("users"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("users")}),e.jsx("span",{className:"nav-label",children:"Users"})]}),e.jsxs("button",{className:`nav-item ${t==="activity-logs"?"active":""}`,onClick:()=>{B("activity-logs"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("activityLogs")}),e.jsx("span",{className:"nav-label",children:"Activity Logs"})]}),e.jsxs("button",{className:`nav-item ${t==="file-approval"?"active":""}`,onClick:()=>{B("file-approval"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("fileApproval")}),e.jsx("span",{className:"nav-label",children:"File Approval"})]}),e.jsxs("button",{className:`nav-item ${t==="tasks"?"active":""}`,onClick:()=>{B("tasks"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${t==="settings"?"active":""}`,onClick:()=>{B("settings"),W()},children:[e.jsx("span",{className:"nav-icon",children:me("settings")}),e.jsx("span",{className:"nav-label",children:"Settings"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{onClick:Y,className:"logout-btn",children:[e.jsx("span",{className:"nav-icon",children:me("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]}),e.jsx("div",{className:"admin-main-content",ref:w,children:e.jsx("div",{className:"content-area",children:Z()})}),e.jsx(En,{notifications:S,onNavigate:P})]})})})})})};var Dn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ln=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),In=(a,s)=>{const t=n.forwardRef(({color:i="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:r,children:d,...p},x)=>n.createElement("svg",{ref:x,...Dn,width:l,height:l,stroke:i,strokeWidth:r?Number(o)*24/Number(l):o,className:`lucide lucide-${Ln(a)}`,...p},[...s.map(([S,k])=>n.createElement(S,k)),...(Array.isArray(d)?d:[d])||[]]));return t.displayName=`${a}`,t};var ls=In;const Qs=ls("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),$n=ls("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Pn=ls("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Rn=ls("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Bn=({id:a,type:s,title:t,message:i,duration:l=5e3,onClose:o,action:r})=>{const[d,p]=n.useState(!0),[x,S]=n.useState(!1);n.useEffect(()=>{if(l>0){const M=setTimeout(()=>{k()},l);return()=>clearTimeout(M)}},[l]);const k=()=>{S(!0),setTimeout(()=>{p(!1),o(a)},300)},c=()=>{switch(s){case"success":return e.jsx($n,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(Qs,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(Qs,{className:"w-5 h-5 text-yellow-500"});case"info":default:return e.jsx(Pn,{className:"w-5 h-5 text-blue-500"})}},C=()=>{switch(s){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":default:return"bg-blue-50 border-blue-200"}};return d?e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-sm w-full animate-slide-in ${x?"animate-slide-out":""}`,style:{animation:x?"slideOut 0.3s ease-in forwards":"slideIn 0.3s ease-out"},children:e.jsx("div",{className:`${C()} border rounded-lg shadow-lg p-4`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:c()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:t}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:i}),r&&e.jsx("button",{onClick:r.onClick,className:"mt-2 px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors",children:r.label})]}),e.jsx("button",{onClick:k,className:"flex-shrink-0 p-1 hover:bg-gray-200 rounded transition-colors",children:e.jsx(Rn,{className:"w-4 h-4 text-gray-500"})})]})})}):null};const zn=({version:a,onInstall:s,onClose:t})=>e.jsx("div",{className:"update-alert-overlay",children:e.jsxs("div",{className:"update-alert-modal",children:[e.jsx(Ss,{type:"success",message:`Update ${a} has been downloaded and is ready to install. The application will restart to apply the update.`,onClose:t}),e.jsxs("div",{className:"update-alert-buttons",children:[e.jsx("button",{onClick:s,className:"update-install-btn",children:"Install & Restart"}),e.jsx("button",{onClick:t,className:"update-cancel-btn",children:"Cancel"})]})]})}),On=()=>{const[a,s]=n.useState([]),[t,i]=n.useState(null),l=n.useCallback(x=>{const S=Date.now()+Math.random(),k={id:S,...x};return s(c=>[...c,k]),S},[]),o=n.useCallback(x=>{s(S=>S.filter(k=>k.id!==x))},[]),r=n.useCallback(()=>{window.updater&&window.updater.restartAndInstall(),i(null)},[]),d=n.useCallback(()=>{i(null)},[]),p=n.useCallback((x,S)=>{switch(x){case"available":l({type:"info",title:"Update Available",message:`Version ${S.version} is available for download.`,duration:1e4});break;case"downloading":break;case"downloaded":i({version:S.version});break;case"error":l({type:"error",title:"Update Failed",message:S.message||"Failed to check for updates.",duration:8e3,action:{label:"Retry",onClick:()=>{window.updater&&window.updater.checkForUpdates()}}});break}},[l]);return We.useEffect(()=>{if(window.updater)return window.updater.onStatus(S=>{p(S.status,S)})},[p]),We.useEffect(()=>(window.toastContainer={addToast:l,showUpdateToast:p},()=>{delete window.toastContainer}),[l,p]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 z-50 pointer-events-none",children:a.map((x,S)=>e.jsx("div",{className:"pointer-events-auto mb-2",style:{transform:`translateY(${S*10}px)`,zIndex:50+S},children:e.jsx(Bn,{...x,onClose:o})},x.id))}),t&&e.jsx(zn,{version:t.version,onInstall:r,onClose:d})]})},Me=Zs("App");function Un(){const[a,s]=n.useState(()=>{const o=localStorage.getItem("user");if(o)try{const r=JSON.parse(o);return Me.info("User session restored from localStorage"),r}catch(r){return Me.error("Error parsing saved user",r),localStorage.removeItem("user"),null}return null}),t=o=>{Me.logLogin(o),s(o),localStorage.setItem("user",JSON.stringify(o)),Me.logStateUpdate("User authenticated and saved")},i=()=>{Me.logLogout(),s(null),localStorage.removeItem("user")},l=()=>{if(!a)return null;switch(Me.logNavigation("login",`${a.panelType}-dashboard`),a.panelType){case"user":return e.jsx(Ks,{user:a,onLogout:i});case"teamleader":return e.jsx(Ya,{user:a,onLogout:i});case"admin":return e.jsx(An,{user:a,onLogout:i});default:return Me.warn("Unknown panel type, defaulting to user dashboard",{panelType:a.panelType}),e.jsx(Ks,{user:a,onLogout:i})}};return e.jsx(Rt,{children:e.jsxs("div",{className:"app",children:[e.jsx(On,{}),e.jsxs(Bt,{children:[e.jsx(vs,{path:"/login",element:a?e.jsx(ys,{to:"/dashboard",replace:!0}):e.jsx(Zt,{onLogin:t})}),e.jsx(vs,{path:"/dashboard",element:a?l():e.jsx(ys,{to:"/login",replace:!0})}),e.jsx(vs,{path:"/",element:e.jsx(ys,{to:a?"/dashboard":"/login",replace:!0})})]})]})})}class Vn extends We.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){console.error("ErrorBoundary caught an error:",s,t),this.setState({error:s,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{style:Ee.container,children:e.jsxs("div",{style:Ee.card,children:[e.jsx("h1",{style:Ee.title,children:"âš ï¸ Oops! Something went wrong"}),e.jsx("p",{style:Ee.message,children:"The application encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{style:Ee.buttonGroup,children:[e.jsx("button",{onClick:this.handleReset,style:Ee.primaryButton,children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),style:Ee.secondaryButton,children:"Reload Page"})]}),!1]})}):this.props.children}}const Ee={container:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#f5f5f5",padding:"20px"},card:{backgroundColor:"white",borderRadius:"8px",padding:"40px",maxWidth:"600px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center"},title:{fontSize:"24px",marginBottom:"16px",color:"#333"},message:{fontSize:"16px",color:"#666",marginBottom:"24px",lineHeight:"1.5"},buttonGroup:{display:"flex",gap:"12px",justifyContent:"center",marginBottom:"24px"},primaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s"},secondaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#fff",color:"#333",border:"2px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},details:{marginTop:"24px",textAlign:"left"},summary:{cursor:"pointer",padding:"12px",backgroundColor:"#f9f9f9",borderRadius:"4px",fontWeight:"600"},errorDetails:{marginTop:"12px",padding:"16px",backgroundColor:"#fff5f5",borderRadius:"4px",border:"1px solid #ffcccb"},errorMessage:{marginBottom:"12px",color:"#d32f2f"},errorStack:{fontSize:"12px",color:"#666",overflow:"auto",maxHeight:"200px",whiteSpace:"pre-wrap",wordWrap:"break-word"}};typeof window<"u"&&(window.React=We);const ut=document.getElementById("root");if(!ut)throw new Error("Failed to find the root element");const Hn=Cs.createRoot(ut);Hn.render(e.jsx(Vn,{children:e.jsx(Un,{})}));console.log("âœ… React application initialized successfully");export{Pa as A,Pe as C,qe as F,Ws as L,Qn as N,$a as S,Jn as a,Ba as g,e as j,et as u};
