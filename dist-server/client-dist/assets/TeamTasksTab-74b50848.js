import{j as s,F as me}from"./index-c6791fe0.js";import{r as o}from"./react-vendor-a308f804.js";import"./router-vendor-90630356.js";import"./anime-vendor-37453147.js";const fe=({user:r})=>{const[g,E]=o.useState([]),[y,v]=o.useState(!0),[h,F]=o.useState(!1),[$,Q]=o.useState({}),[R,i]=o.useState(""),[D,d]=o.useState(""),[X,M]=o.useState(!1),[u,P]=o.useState({}),[k,A]=o.useState({}),[w,O]=o.useState({}),[c,f]=o.useState(null),[Z,L]=o.useState({}),[W,I]=o.useState({}),[b,U]=o.useState({}),[_,z]=o.useState({}),[K,ee]=o.useState({}),[x,B]=o.useState(null),[p,J]=o.useState(!0),N=o.useRef(null),C=o.useRef(null);o.useEffect(()=>{r&&r.team&&se()},[r]),o.useEffect(()=>{const e=t=>{t.key==="Escape"&&c&&f(null)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[c]),o.useEffect(()=>{if(y||h||!p)return;const e={root:null,rootMargin:"100px",threshold:.1};return N.current=new IntersectionObserver(t=>{t[0].isIntersecting&&p&&!h&&(console.log("Intersection detected, loading more..."),te())},e),C.current&&N.current.observe(C.current),()=>{N.current&&N.current.disconnect()}},[y,h,p,x]);const se=async()=>{try{v(!0),i(""),console.log("Fetching team assignments for team:",r.team);const t=await(await fetch(`http://localhost:3001/api/assignments/team/${r.team}/all-tasks?limit=20`)).json();if(console.log("Team assignments response:",t),!t.success){i(t.message||"Failed to fetch team assignments"),v(!1);return}const n=t.assignments||[];console.log(`Fetched ${n.length} team assignments`),E(n),B(t.nextCursor),J(t.hasMore),await V(n)}catch(e){console.error("Error fetching team assignments:",e),i("Failed to load team assignments")}finally{v(!1)}},te=o.useCallback(async()=>{if(h||!p||!x){console.log("Skipping fetch:",{loadingMore:h,hasMore:p,nextCursor:x});return}try{F(!0),console.log("Fetching more team assignments with cursor:",x);const t=await(await fetch(`http://localhost:3001/api/assignments/team/${r.team}/all-tasks?cursor=${x}&limit=20`)).json();if(console.log("More team assignments response:",t),!t.success){i(t.message||"Failed to fetch more assignments");return}const n=t.assignments||[];console.log(`Fetched ${n.length} more assignments`),E(a=>[...a,...n]),B(t.nextCursor),J(t.hasMore),await V(n)}catch(e){console.error("Error fetching more assignments:",e),i("Failed to load more assignments")}finally{F(!1)}},[x,p,h,r.team]),V=async e=>{try{const t={};await Promise.all(e.map(async n=>{try{const l=await(await fetch(`http://localhost:3001/api/assignments/${n.id}/comments`)).json();l.success&&(t[n.id]=l.comments||[])}catch(a){console.error(`Error fetching comments for assignment ${n.id}:`,a)}})),P(n=>({...n,...t}))}catch(t){console.error("Error fetching comment counts:",t)}},ae=e=>{Q(t=>({...t,[e]:!t[e]}))},j=e=>e?e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"?",S=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No due date",ne=e=>{if(!e)return"";const a=new Date(e)-new Date,l=Math.ceil(a/(1e3*60*60*24));return l<0?`${Math.abs(l)} days overdue`:l===0?"Due today":l===1?"1 day left":`${l} days left`},le=e=>e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown",oe=e=>{if(!e)return"#95a5a6";const t=new Date(e),a=Math.ceil((t-new Date)/(1e3*60*60*24));return a<0?"#e74c3c":a<=2?"#f39c12":"#27ae60"},ie=async(e,t)=>{if(!e){i("File path not available");return}try{if(M(!0),i(""),d("Opening file..."),await new Promise(a=>setTimeout(a,300)),window.electron&&window.electron.openFileInApp){console.log("ğŸ’» Running in Electron - using Windows default application");const l=await(await fetch(`http://localhost:3001/api/files/${t}/path`)).json();if(!l.success)throw new Error(l.message||"Failed to get file path");console.log("ğŸ“‚ Full path:",l.filePath),console.log("ğŸ“„ File name:",l.fileName);const m=await window.electron.openFileInApp(l.filePath);if(m.success)console.log("âœ… Opened with Windows default application"),d("File opened successfully");else throw new Error(m.error||"Failed to open file")}else{console.log("ğŸŒ Running in browser - opening in new tab");const a=`http://localhost:3001${e}`,l=window.open(a,"_blank");if(!l)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");l.focus(),console.log("âœ… Opened in browser tab"),d("File opened in browser")}}catch(n){console.error("âŒ Error opening file:",n),d(""),i(`Error opening file: ${n.message||"Failed to open file"}`)}finally{M(!1),setTimeout(()=>{d(""),i("")},3e3)}},H=()=>{i(""),d("")},T=async e=>{try{const n=await(await fetch(`http://localhost:3001/api/assignments/${e}/comments`)).json();n.success&&P(a=>({...a,[e]:n.comments||[]}))}catch(t){console.error("Error fetching comments:",t)}},re=async e=>{c===e?f(null):(f(e),u[e]||await T(e))},Y=async e=>{const t=k[e]?.trim();if(t)try{U(l=>({...l,[e]:!0}));const a=await(await fetch(`http://localhost:3001/api/assignments/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.id,username:r.username||r.fullName,comment:t})})).json();a.success?(A(l=>({...l,[e]:""})),await T(e),d("Comment posted successfully"),setTimeout(()=>d(""),3e3)):(i(a.message||"Failed to post comment"),setTimeout(()=>i(""),3e3))}catch(n){console.error("Error posting comment:",n),i("Failed to post comment"),setTimeout(()=>i(""),3e3)}finally{U(n=>({...n,[e]:!1}))}},q=async(e,t)=>{const n=w[t]?.trim();if(n)try{z(m=>({...m,[t]:!0}));const l=await(await fetch(`http://localhost:3001/api/assignments/${e}/comments/${t}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.id,username:r.username||r.fullName,reply:n})})).json();l.success?(O(m=>({...m,[t]:""})),L(m=>({...m,[t]:!1})),await T(e),d("Reply posted successfully"),setTimeout(()=>d(""),3e3)):(i(l.message||"Failed to post reply"),setTimeout(()=>i(""),3e3))}catch(a){console.error("Error posting reply:",a),i("Failed to post reply"),setTimeout(()=>i(""),3e3)}finally{z(a=>({...a,[t]:!1}))}},G=e=>{const t=new Date(e),a=Math.floor((new Date-t)/1e3);return a<60?"Just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:a<604800?`${Math.floor(a/86400)}d ago`:S(e)},ce=e=>{I(t=>({...t,[e]:!t[e]}))},de=e=>{L(t=>({...t,[e]:!t[e]}))};return y?s.jsxs("div",{className:"team-tasks-tab",children:[s.jsxs("div",{className:"team-tasks-header",children:[s.jsx("h2",{children:"Team Tasks"}),s.jsx("p",{className:"team-tasks-subtitle",children:"Tasks assigned to your team members"})]}),s.jsx("div",{className:"team-tasks-count",children:"Loading..."}),s.jsx("div",{className:"loading-skeleton",children:[1,2,3].map(e=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-header",children:[s.jsx("div",{className:"skeleton-avatar"}),s.jsxs("div",{className:"skeleton-text",children:[s.jsx("div",{className:"skeleton-line skeleton-line-short"}),s.jsx("div",{className:"skeleton-line skeleton-line-tiny"})]})]}),s.jsxs("div",{className:"skeleton-body",children:[s.jsx("div",{className:"skeleton-line"}),s.jsx("div",{className:"skeleton-line"}),s.jsx("div",{className:"skeleton-line skeleton-line-short"})]})]},e))})]}):s.jsxs("div",{className:`team-tasks-tab ${X?"file-opening-cursor":""}`,children:[R&&s.jsxs("div",{className:"team-tasks-message error-message",children:[R,s.jsx("button",{className:"close-message-btn",onClick:H,children:"Ã—"})]}),D&&s.jsxs("div",{className:"team-tasks-message success-message",children:[D,s.jsx("button",{className:"close-message-btn",onClick:H,children:"Ã—"})]}),s.jsxs("div",{className:"team-tasks-header",children:[s.jsx("h2",{children:"Team Tasks"}),s.jsx("p",{className:"team-tasks-subtitle",children:"Tasks assigned to your team members"})]}),s.jsxs("div",{className:"team-tasks-count",children:[g.length," task",g.length!==1?"s":"",p&&" â€¢ Scroll for more"]}),s.jsx("div",{className:"team-tasks-container",children:g.length===0?s.jsxs("div",{className:"empty-team-tasks",children:[s.jsx("div",{className:"empty-icon",children:"ğŸ“‹"}),s.jsx("h3",{children:"No Team Tasks Yet"}),s.jsx("p",{children:"Your team leader hasn't created any assignments yet."})]}):s.jsxs(s.Fragment,{children:[g.map(e=>s.jsxs("div",{className:"team-task-card",children:[s.jsxs("div",{className:"team-task-header",children:[s.jsxs("div",{className:"team-task-header-left",children:[s.jsx("div",{className:"team-task-avatar",children:j(e.team_leader_fullname||e.team_leader_username)}),s.jsxs("div",{className:"team-task-header-info",children:[s.jsxs("div",{className:"team-task-assigned",children:[s.jsx("span",{className:"team-leader-name",children:e.team_leader_fullname||e.team_leader_username}),s.jsx("span",{className:"role-badge team-leader",children:"TEAM LEADER"}),"assigned to"," ",s.jsx("span",{className:"assigned-user",children:e.assigned_member_details&&e.assigned_member_details.length>0?e.assigned_member_details.length===1?e.assigned_member_details[0].fullName:`${e.assigned_member_details.length} members (${e.assigned_member_details.map(t=>t.fullName).join(", ")})`:e.assigned_to==="all"?"All team members":"Unknown User"})]}),s.jsx("div",{className:"team-task-created",children:e.created_at?le(e.created_at):"Unknown creation date"})]})]}),s.jsx("div",{className:"team-task-header-right",children:e.due_date&&s.jsxs("div",{className:"team-task-due-date",children:["Due: ",S(e.due_date),s.jsxs("span",{className:"days-left",style:{color:oe(e.due_date)},children:[" ","(",ne(e.due_date),")"]})]})})]}),s.jsx("div",{className:"team-task-title-section",children:s.jsx("h3",{className:"team-task-title",children:e.title})}),e.description&&s.jsx("div",{className:"team-task-description-section",children:s.jsxs("p",{className:"team-task-description",children:[$[e.id]?e.description:e.description.length>200?`${e.description.substring(0,200)}...`:e.description,e.description.length>200&&s.jsx("button",{className:"expand-btn",onClick:t=>{t.stopPropagation(),ae(e.id)},children:$[e.id]?"Show less":"Show more"})]})}),s.jsx("div",{className:"team-task-attachment-section",children:e.recent_submissions&&e.recent_submissions.length>0?s.jsxs("div",{className:"team-task-attached-file",children:[s.jsxs("div",{className:"file-label",children:[s.jsx("span",{style:{fontSize:"16px"},children:"ğŸ“"}),"Attachment",e.recent_submissions.length>1?"s":""," (",e.recent_submissions.length,"):"]}),(()=>{const t=[...e.recent_submissions].sort((a,l)=>new Date(l.submitted_at)-new Date(a.submitted_at)),n=K[e.id]?t:t.slice(0,5);return s.jsxs(s.Fragment,{children:[n.map((a,l)=>s.jsx("div",{className:"file-item",onClick:m=>{m.stopPropagation(),ie(a.file_path,a.id)},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(me,{fileType:a.original_name.split(".").pop(),size:"small",style:{width:"48px",height:"48px",flexShrink:0}}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"15px",color:"#111827",marginBottom:"6px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.original_name}),s.jsxs("div",{style:{fontSize:"13px",color:"#6b7280",display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[s.jsxs("span",{children:["Submitted by ",s.jsx("span",{style:{fontWeight:"500",color:"#374151"},children:a.fullName||a.username})]}),s.jsx("span",{style:{color:"#d1d5db"},children:"â€¢"}),s.jsxs("span",{children:["on ",S(a.submitted_at)]}),a.tag&&s.jsxs(s.Fragment,{children:[s.jsx("span",{style:{color:"#d1d5db"},children:"â€¢"}),s.jsxs("span",{style:{backgroundColor:"#eff6ff",color:"#1e40af",padding:"2px 10px",borderRadius:"12px",fontSize:"11px",fontWeight:"600",border:"1px solid #bfdbfe",display:"inline-flex",alignItems:"center",gap:"4px"},children:[s.jsx("span",{children:"ğŸ·ï¸"})," ",a.tag]})]})]})]})]})},a.id)),t.length>5&&s.jsx("button",{className:"see-more-files-btn",onClick:a=>{a.stopPropagation(),ee(l=>({...l,[e.id]:!l[e.id]}))},children:K[e.id]?s.jsx("span",{children:"See less"}):s.jsxs("span",{children:["See more (",t.length-5," more)"]})})]})})()]}):s.jsxs("div",{className:"no-attachment",children:[s.jsx("span",{className:"no-attachment-icon",children:"ğŸ“„"}),s.jsx("span",{className:"no-attachment-text",children:"No attachments yet"})]})}),s.jsx("div",{className:"team-task-comments-section",style:{display:"flex",justifyContent:"flex-start",paddingTop:"12px",borderTop:"1px solid #f3f4f6"},children:s.jsxs("button",{className:"toggle-comments-btn",onClick:t=>{t.stopPropagation(),re(e.id)},style:{padding:"0",backgroundColor:"transparent",border:"none",color:"#1c1e21",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"4px"},children:[s.jsx("span",{children:"Comment"}),u[e.id]&&u[e.id].length>0&&s.jsxs("span",{children:["(",u[e.id].length,")"]})]})})]},e.id)),h&&s.jsx("div",{className:"inline-skeleton-container",children:[1,2].map(e=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-header",children:[s.jsx("div",{className:"skeleton-avatar"}),s.jsxs("div",{className:"skeleton-text",children:[s.jsx("div",{className:"skeleton-line skeleton-line-short"}),s.jsx("div",{className:"skeleton-line skeleton-line-tiny"})]})]}),s.jsxs("div",{className:"skeleton-body",children:[s.jsx("div",{className:"skeleton-line"}),s.jsx("div",{className:"skeleton-line"}),s.jsx("div",{className:"skeleton-line skeleton-line-short"})]})]},e))}),p&&!h&&s.jsx("div",{ref:C,style:{height:"20px",margin:"20px 0"}})]})}),c&&s.jsx("div",{className:"comments-modal-overlay",onClick:()=>f(null),children:s.jsxs("div",{className:"comments-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"comments-modal-header",children:[s.jsx("h3",{children:"Comments"}),s.jsx("button",{className:"close-modal-btn",onClick:()=>f(null),children:"âœ•"})]}),s.jsx("div",{className:"comments-modal-body",children:u[c]?.length>0?s.jsx("div",{className:"comments-list",children:u[c].map(e=>s.jsxs("div",{className:"comment-thread",children:[s.jsxs("div",{className:"comment-item",children:[s.jsx("div",{className:"comment-avatar",children:j(e.fullName||e.username)}),s.jsxs("div",{className:"comment-content",children:[s.jsxs("div",{className:"comment-header",children:[s.jsx("span",{className:"comment-author",children:e.fullName||e.username}),s.jsx("span",{className:`role-badge ${e.user_role?e.user_role.toLowerCase().replace(" ","-").replace("_","-"):"user"}`,children:e.user_role||"USER"}),s.jsx("span",{className:"comment-time",children:G(e.created_at)})]}),s.jsx("div",{className:"comment-text",children:e.comment}),s.jsxs("div",{className:"comment-actions",children:[s.jsx("button",{className:"reply-button",onClick:()=>de(e.id),children:"Reply"}),e.replies&&e.replies.length>0&&s.jsxs("button",{className:"view-replies-button",onClick:()=>ce(e.id),children:[W[e.id]?"Hide":"View"," ",e.replies.length," ",e.replies.length===1?"reply":"replies"]})]})]})]}),e.replies&&e.replies.length>0&&W[e.id]&&s.jsx("div",{className:"replies-thread",children:e.replies.map(t=>s.jsxs("div",{className:"reply-item",children:[s.jsx("div",{className:"reply-avatar",children:j(t.fullName||t.username)}),s.jsxs("div",{className:"reply-content",children:[s.jsxs("div",{className:"reply-header",children:[s.jsx("span",{className:"reply-author",children:t.fullName||t.username}),s.jsx("span",{className:`role-badge ${t.user_role?t.user_role.toLowerCase().replace(" ","-").replace("_","-"):"user"}`,children:t.user_role||"USER"}),s.jsx("span",{className:"reply-time",children:G(t.created_at)})]}),s.jsx("div",{className:"reply-text",children:t.reply})]})]},t.id))}),Z[e.id]&&s.jsxs("div",{className:"reply-input-box",children:[s.jsx("div",{className:"comment-avatar reply-avatar",children:j(r.username||r.fullName)}),s.jsxs("div",{className:"comment-input-wrapper",children:[s.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a reply...",value:w[e.id]||"",onChange:t=>O(n=>({...n,[e.id]:t.target.value})),onKeyPress:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),q(c,e.id))},disabled:_[e.id],autoFocus:!0}),s.jsx("button",{className:"comment-submit-btn",onClick:()=>q(c,e.id),disabled:!w[e.id]?.trim()||_[e.id],children:_[e.id]?"...":"â¤"})]})]})]},e.id))}):s.jsx("div",{className:"no-comments",children:s.jsx("p",{children:"ğŸ’¬ No comments yet. Be the first to comment!"})})}),s.jsx("div",{className:"comments-modal-footer",children:s.jsxs("div",{className:"add-comment",children:[s.jsx("div",{className:"comment-avatar",children:j(r.username||r.fullName)}),s.jsxs("div",{className:"comment-input-wrapper",children:[s.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a comment...",value:k[c]||"",onChange:e=>A(t=>({...t,[c]:e.target.value})),onKeyPress:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Y(c))},disabled:b[c]}),s.jsx("button",{className:"comment-submit-btn",onClick:()=>Y(c),disabled:!k[c]?.trim()||b[c],children:b[c]?"...":"â¤"})]})]})})]})})]})};export{fe as default};
