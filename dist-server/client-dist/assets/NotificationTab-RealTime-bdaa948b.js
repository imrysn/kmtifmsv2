import{a as B,j as e}from"./index-f88750f1.js";import{r as t}from"./react-vendor-a308f804.js";import"./router-vendor-90630356.js";import"./anime-vendor-37453147.js";const z=({user:c,onOpenFile:x,onNavigateToTasks:h,onUpdateUnreadCount:l})=>{const[n,m]=t.useState([]);t.useState(!1);const[r,u]=t.useState(0),[w,f]=t.useState(!1),[d,j]=t.useState(10),[g,k]=t.useState(!0),[p,v]=t.useState(!1);B(r),t.useEffect(()=>{let s=!0;(async()=>{s&&await N()})();const o=setInterval(()=>{s&&N()},5e3);return()=>{s=!1,clearInterval(o)}},[c.id]);const N=async()=>{try{const a=await(await fetch(`http://localhost:3001/api/notifications/user/${c.id}`)).json();if(a.success){m(a.notifications||[]);const o=a.unreadCount||0;u(o),l&&l(o)}}catch(s){console.error("âŒ Error fetching notifications:",s)}finally{g&&k(!1)}},y=t.useCallback(async s=>{if(!s.is_read)try{await fetch(`http://localhost:3001/api/notifications/${s.id}/read`,{method:"PUT"}),m(o=>o.map(i=>i.id===s.id?{...i,is_read:1}:i));const a=Math.max(0,r-1);u(a),l&&l(a)}catch(a){console.error("âŒ Error marking notification as read:",a)}s.type==="comment"&&s.assignment_id?h&&(sessionStorage.setItem("scrollToAssignment",s.assignment_id),sessionStorage.setItem("highlightCommentBy",s.action_by_username),console.log("ðŸ“ Stored comment navigation:",{assignmentId:s.assignment_id,highlightUser:s.action_by_username}),h(s.assignment_id)):s.type==="assignment"?h&&h():s.file_id&&x&&x(s.file_id)},[h,x]);t.useCallback(async(s,a)=>{s.stopPropagation();try{(await(await fetch(`http://localhost:3001/api/notifications/${a}`,{method:"DELETE"})).json()).success&&m(R=>R.filter($=>$.id!==a))}catch(o){console.error("âŒ Error deleting notification:",o)}},[]);const b=t.useCallback(async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${c.id}/read-all`,{method:"PUT"})).json()).success&&(m(o=>o.map(i=>({...i,is_read:1}))),u(0),l&&l(0))}catch(s){console.error("Error marking all as read:",s)}},[c.id,l]),C=t.useCallback(()=>{f(!0)},[]),_=t.useCallback(async()=>{try{console.log("Deleting all notifications for user:",c.id);const a=await(await fetch(`http://localhost:3001/api/notifications/user/${c.id}/delete-all`,{method:"DELETE"})).json();console.log("Delete response:",a),a.success?(m([]),u(0),f(!1),l&&l(0),console.log("âœ… All notifications deleted successfully")):(console.error("âŒ Delete failed:",a.message),alert("Failed to delete notifications. Please try again."))}catch(s){console.error("âŒ Error deleting all notifications:",s),alert("An error occurred while deleting notifications.")}},[c.id,l]),E=t.useCallback(s=>{switch(console.log("ðŸ”„ UPDATED VERSION - Using specific user dashboard icons"),s){case"approval":case"final_approval":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8.5"}),e.jsx("path",{d:"M6 10l2.5 2.5 5.5-5.5"})]});case"rejection":case"final_rejection":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8.5"}),e.jsx("line",{x1:"4",y1:"4",x2:"16",y2:"16"})]});case"comment":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:e.jsx("path",{d:"M3 3h14a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H6l-3 3V4a1 1 0 0 1 1-1z"})});case"assignment":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M12 2H4a1.5 1.5 0 0 0-1.5 1.5v13A1.5 1.5 0 0 0 4 18h10a1.5 1.5 0 0 0 1.5-1.5V6l-3.5-4z"}),e.jsx("path",{d:"M12 2v4h3.5"}),e.jsx("path",{d:"M6 10h6M6 13h6"})]});default:return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M12 2H4a1.5 1.5 0 0 0-1.5 1.5v13A1.5 1.5 0 0 0 4 18h10a1.5 1.5 0 0 0 1.5-1.5V6l-3.5-4z"}),e.jsx("path",{d:"M12 2v4h3.5"})]})}},[]);t.useCallback(s=>{switch(s){case"uploaded":return"PENDING TEAM LEADER";case"team_leader_approved":return"PENDING ADMIN";case"final_approved":return"FINAL APPROVED";case"rejected_by_team_leader":return"REJECTED BY TEAM LEADER";case"rejected_by_admin":return"REJECTED BY ADMIN";default:return s?s.replace(/_/g," ").toUpperCase():"UNKNOWN"}},[]);const M=t.useCallback(s=>{switch(s){case"approval":case"final_approval":return"notification-success";case"rejection":case"final_rejection":return"notification-error";case"comment":return"notification-info";case"assignment":return"notification-assignment";default:return"notification-default"}},[]),A=t.useCallback(s=>{const a=new Date(s),i=Math.floor((new Date-a)/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<604800?`${Math.floor(i/86400)}d ago`:a.toLocaleDateString()},[]),D=t.useCallback(s=>s?s.toUpperCase():"",[]),L=t.useMemo(()=>n.slice(0,d),[n,d]),I=t.useMemo(()=>n.length-d,[n.length,d]),S=t.useCallback(()=>{p?(j(10),v(!1)):(j(s=>s+10),d+10>=n.length&&v(!0))},[p,d,n.length]);return g&&n.length===0?e.jsxs("div",{className:"user-notification-component notification-section",children:[e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"page-header-content",children:e.jsxs("div",{className:"page-header-left",children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{children:"Click on any notification to view details"})]})})}),e.jsx("div",{className:"notifications-container",children:e.jsx("div",{className:"notifications-list",children:[1,2,3].map(s=>e.jsxs("div",{className:"notification-card skeleton-card",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-title"}),e.jsx("div",{className:"skeleton-message"}),e.jsxs("div",{className:"skeleton-footer",children:[e.jsx("div",{className:"skeleton-footer-item"}),e.jsx("div",{className:"skeleton-footer-item"})]})]})]},s))})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"user-notification-component notification-section",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"page-header-content",children:[e.jsxs("div",{className:"page-header-left",children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{children:"Stay updated with your file approvals and system messages"}),e.jsxs("div",{className:"notification-stats",children:[n.length," total â€¢ ",r," unread"]})]}),e.jsxs("div",{className:"notification-actions",children:[r>0&&e.jsx("button",{className:"mark-all-read-btn",onClick:b,title:"Mark all as read",children:"Mark All as Read"}),n.length>0&&e.jsx("button",{className:"delete-all-btn",onClick:C,title:"Delete all notifications",children:"Delete All"})]})]})}),e.jsx("div",{className:"notifications-container",children:n.length>0?e.jsxs("div",{className:"notifications-list",children:[L.map(s=>e.jsxs("div",{className:`notification-card clickable ${M(s.type)} ${s.is_read?"":"unread"}`,onClick:()=>y(s),children:[e.jsx("div",{className:"notification-icon",children:E(s.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title-row",children:[e.jsx("h4",{className:"notification-title",children:s.title}),e.jsx("svg",{className:"arrow-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]}),e.jsx("p",{className:"notification-message",children:s.message}),e.jsxs("div",{className:"notification-footer",children:[e.jsxs("span",{className:"notification-action-by",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 1 .41-1.108A9.965 9.965 0 0 1 10 11c2.456 0 4.71.886 6.425 2.385.276.24.456.6.41 1.108a9.98 9.98 0 0 1-13.37 0Z"})}),s.action_by_username," (",D(s.action_by_role),")"]}),e.jsx("span",{className:"notification-time",children:A(s.created_at)})]})]})]},s.id)),n.length>10&&e.jsx("div",{className:"see-more-container",children:e.jsx("button",{className:"see-more-btn",onClick:S,children:p?"See less":`See more (${I} more notifications)`})})]}):e.jsxs("div",{className:"empty-notifications",children:[e.jsx("div",{className:"empty-icon",children:"â—‹"}),e.jsx("h3",{children:"No notifications yet"}),e.jsx("p",{children:"We'll notify you when there are updates on your files or important system messages."})]})})]}),w&&e.jsx("div",{className:"custom-modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"custom-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"custom-modal-header",children:[e.jsx("h3",{children:"Delete All Notifications?"}),e.jsx("button",{onClick:()=>f(!1),className:"custom-modal-close",type:"button",children:"Ã—"})]}),e.jsx("div",{className:"custom-modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:"Are you sure you want to delete all notifications?"}),e.jsxs("div",{className:"item-info",children:[e.jsxs("div",{className:"item-name",children:[n.length," notification",n.length!==1?"s":""]}),e.jsxs("div",{className:"item-details",children:["Including ",r," unread notification",r!==1?"s":""]})]}),e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})]})]})}),e.jsx("div",{className:"custom-modal-footer",children:e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"modal-cancel-btn",children:"Cancel"}),e.jsx("button",{type:"button",onClick:_,className:"modal-confirm-btn",children:"Delete All"})]})})]})})]})};export{z as default};
