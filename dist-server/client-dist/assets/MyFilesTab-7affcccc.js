import{j as e,F as z,C as V}from"./index-ea7f734c.js";import{r as t}from"./react-vendor-a308f804.js";import"./router-vendor-90630356.js";import"./anime-vendor-37453147.js";const J=({isOpen:o,onClose:x,title:j,message:g,type:m="success"})=>{if(t.useEffect(()=>{if(o){const b=setTimeout(()=>{x()},3e3);return()=>clearTimeout(b)}},[o,x]),!o)return null;const h=()=>{switch(m){case"success":return"âœ“";case"error":return"âœ•";case"warning":return"âš ";case"info":return"â„¹";default:return"âœ“"}};return e.jsx("div",{className:"success-modal-overlay",children:e.jsxs("div",{className:`success-modal success-modal-${m}`,children:[e.jsxs("div",{className:"success-modal-content",children:[e.jsx("div",{className:`success-icon success-icon-${m}`,children:h()}),e.jsxs("div",{className:"success-text",children:[j&&e.jsx("h3",{className:"success-title",children:j}),e.jsx("p",{className:"success-message",children:g})]}),e.jsx("button",{className:"success-close",onClick:x,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"success-progress-bar",children:e.jsx("div",{className:`success-progress-fill success-progress-${m}`})})]})})},H=({filteredFiles:o,isLoading:x,fetchUserFiles:j,formatFileSize:g,files:m,user:h})=>{t.useState(!1);const[b,y]=t.useState(!1),[u,w]=t.useState(null),[v,p]=t.useState({isOpen:!1,title:"",message:"",type:"success"}),[n,k]=t.useState(1),[c,T]=t.useState(7),N=t.useRef(null),f=t.useRef(null),F=300,C=t.useCallback(async s=>{try{if(window.electron&&window.electron.openFileInApp){const l=await(await fetch(`http://localhost:3001/api/files/${s.id}/path`)).json();if(l.success&&l.filePath){const d=await window.electron.openFileInApp(l.filePath);d.success||p({isOpen:!0,title:"Error",message:d.error||"Failed to open file with system application",type:"error"})}else throw new Error("Could not get file path")}else{const a=`http://localhost:3001${s.file_path}`;window.open(a,"_blank","noopener,noreferrer")}}catch(a){console.error("Error opening file:",a),p({isOpen:!0,title:"Error",message:"Failed to open file. Please try again.",type:"error"})}},[]),D=t.useCallback((s,a)=>{a.stopPropagation(),N.current&&clearTimeout(N.current),f.current===s.id?(f.current=null,C(s)):(f.current=s.id,N.current=setTimeout(()=>{f.current=null},F))},[C]);t.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]);const E=t.useCallback((s,a)=>{a&&(a.preventDefault(),a.stopPropagation()),w(s),y(!0)},[]),M=t.useCallback(async()=>{if(u)try{const a=await(await fetch(`http://localhost:3001/api/files/${u.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h.id,username:h.username,userRole:"USER",team:h.team})})).json();a.success?(j(),p({isOpen:!0,title:"File Deleted",message:"File deleted successfully",type:"info"}),y(!1),w(null)):p({isOpen:!0,title:"Delete Failed",message:a.message||"Failed to delete file",type:"error"})}catch(s){console.error("Error deleting file:",s),p({isOpen:!0,title:"Delete Error",message:"Failed to delete file. Please try again.",type:"error"})}},[u,h,j]),S=t.useCallback(s=>{if(!s)return"Pending";switch(s){case"uploaded":return"Pending Team Leader";case"team_leader_approved":return"Pending Admin";case"final_approved":return"Approved";case"rejected_by_team_leader":return"Rejected by Team Leader";case"rejected_by_admin":return"Rejected by Admin";default:return"Pending"}},[]),R=t.useCallback(s=>{switch(s){case"uploaded":case"team_leader_approved":return"status-pending";case"final_approved":return"status-approved";case"rejected_by_team_leader":case"rejected_by_admin":return"status-rejected";default:return"status-default"}},[]),A=t.useCallback(s=>{const a=new Date(s),l=a.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),d=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0});return{date:l,time:d}},[]),i=t.useMemo(()=>o.filter(s=>s.status==="final_approved"||s.status==="uploaded"||s.status==="team_leader_approved"||s.status==="rejected_by_team_leader"||s.status==="rejected_by_admin"),[o]),P=t.useMemo(()=>i.filter(s=>s.status==="uploaded"||s.status==="team_leader_approved"),[i]),I=t.useMemo(()=>i.filter(s=>s.status==="final_approved"),[i]),L=t.useMemo(()=>i.filter(s=>s.status==="rejected_by_team_leader"||s.status==="rejected_by_admin"),[i]),$=t.useMemo(()=>i.reduce((s,a)=>s+a.file_size,0),[i]),r=t.useMemo(()=>Math.ceil(i.length/c),[i.length,c]),O=t.useMemo(()=>{const s=(n-1)*c,a=s+c;return i.slice(s,a)},[i,n,c]);t.useEffect(()=>{k(1)},[o,c]);const _=t.useCallback(s=>{k(s),window.scrollTo({top:0,behavior:"smooth"})},[]),B=t.useCallback(s=>{T(Number(s.target.value))},[]),U=t.useCallback(()=>{const s=[];if(r<=5)for(let l=1;l<=r;l++)s.push(l);else if(n<=3){for(let l=1;l<=4;l++)s.push(l);s.push("..."),s.push(r)}else if(n>=r-2){s.push(1),s.push("...");for(let l=r-3;l<=r;l++)s.push(l)}else{s.push(1),s.push("...");for(let l=n-1;l<=n+1;l++)s.push(l);s.push("..."),s.push(r)}return s},[n,r]);return e.jsxs("div",{className:"user-my-files-component my-files-wrapper",children:[e.jsx("div",{className:"my-files-header-top",children:x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-left",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"32px",width:"140px",marginBottom:"12px",borderRadius:"8px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"18px",width:"200px",borderRadius:"6px"}})]}),e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat-box-skeleton",children:[e.jsx("div",{className:"skeleton-circle",style:{width:"56px",height:"56px"}}),e.jsxs("div",{className:"stat-text-skeleton",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"40px",marginBottom:"8px",borderRadius:"6px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"14px",width:"140px",borderRadius:"6px"}})]})]}),e.jsxs("div",{className:"stat-box-skeleton",children:[e.jsx("div",{className:"skeleton-circle",style:{width:"56px",height:"56px"}}),e.jsxs("div",{className:"stat-text-skeleton",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"40px",marginBottom:"8px",borderRadius:"6px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"14px",width:"140px",borderRadius:"6px"}})]})]}),e.jsxs("div",{className:"stat-box-skeleton",children:[e.jsx("div",{className:"skeleton-circle",style:{width:"56px",height:"56px"}}),e.jsxs("div",{className:"stat-text-skeleton",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"40px",marginBottom:"8px",borderRadius:"6px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"14px",width:"140px",borderRadius:"6px"}})]})]}),e.jsxs("div",{className:"stat-box-skeleton",children:[e.jsx("div",{className:"skeleton-circle",style:{width:"56px",height:"56px"}}),e.jsxs("div",{className:"stat-text-skeleton",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"40px",marginBottom:"8px",borderRadius:"6px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"14px",width:"140px",borderRadius:"6px"}})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"My Files"}),e.jsxs("p",{className:"header-subtitle",children:[i.length," files â€¢ ",g($)," total"]})]}),e.jsxs("div",{className:"stats-row",children:[e.jsxs("div",{className:"stat-box",children:[e.jsx("div",{className:"stat-icon",children:"TL"}),e.jsxs("div",{className:"stat-text",children:[e.jsx("div",{className:"stat-number",children:P.filter(s=>s.status==="uploaded").length}),e.jsx("div",{className:"stat-name",children:"Pending Team Leader"})]})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("div",{className:"stat-icon",children:"AD"}),e.jsxs("div",{className:"stat-text",children:[e.jsx("div",{className:"stat-number",children:P.filter(s=>s.status==="team_leader_approved").length}),e.jsx("div",{className:"stat-name",children:"Pending Admin"})]})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("div",{className:"stat-icon",children:"AP"}),e.jsxs("div",{className:"stat-text",children:[e.jsx("div",{className:"stat-number",children:I.length}),e.jsx("div",{className:"stat-name",children:"Approved Files"})]})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("div",{className:"stat-icon",children:"RE"}),e.jsxs("div",{className:"stat-text",children:[e.jsx("div",{className:"stat-number",children:L.length}),e.jsx("div",{className:"stat-name",children:"Rejected Files"})]})]})]})]})}),e.jsx("div",{className:"files-table-wrapper",children:i.length>0?e.jsxs("div",{className:"files-list",children:[e.jsxs("div",{className:"table-header",children:[e.jsx("div",{className:"col-filename",children:"FILENAME"}),e.jsx("div",{className:"col-datetime",children:"DATE & TIME"}),e.jsx("div",{className:"col-team",children:"TEAM"}),e.jsx("div",{className:"col-status",children:"STATUS"}),e.jsx("div",{className:"col-actions",children:"ACTIONS"})]}),O.map(s=>{const{date:a,time:l}=A(s.uploaded_at);return e.jsxs("div",{className:"file-row-new",onClick:d=>D(s,d),title:"Double click to open file",children:[e.jsxs("div",{className:"col-filename",children:[e.jsx(z,{fileType:s.original_name.split(".").pop().toLowerCase(),isFolder:!1,size:"default",altText:`${s.file_type} file`,style:{width:"44px",height:"44px"}}),e.jsxs("div",{className:"file-text",children:[e.jsx("div",{className:"filename",children:s.original_name}),e.jsx("div",{className:"filesize",children:g(s.file_size)}),e.jsxs("div",{className:"datetime-mobile",children:[e.jsx("div",{className:"date-label",children:a}),e.jsx("div",{className:"time-label",children:l})]})]})]}),e.jsxs("div",{className:"col-datetime",children:[e.jsx("div",{className:"date-label",children:a}),e.jsx("div",{className:"time-label",children:l})]}),e.jsx("div",{className:"col-team",children:e.jsx("span",{className:"team-text",children:s.user_team})}),e.jsx("div",{className:"col-status",children:e.jsx("span",{className:`status-tag ${R(s.status)}`,children:S(s.status)})}),e.jsx("div",{className:"col-actions",children:e.jsx("button",{className:"delete-btn",onClick:d=>E(s,d),title:"Delete file",children:"Delete"})})]},s.id)})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“‹"}),e.jsx("h3",{children:"No files found"}),e.jsx("p",{children:m.length===0?"Ready to upload your first file? Click the button above to get started.":"No files match your current search criteria."})]})}),i.length>0&&e.jsxs("div",{className:"pagination-wrapper",children:[e.jsxs("div",{className:"pagination-info",children:[e.jsxs("span",{className:"pagination-text",children:["Showing ",(n-1)*c+1," to ",Math.min(n*c,i.length)," of ",i.length," files"]}),e.jsxs("div",{className:"items-per-page",children:[e.jsx("label",{htmlFor:"itemsPerPage",children:"Show:"}),e.jsxs("select",{id:"itemsPerPage",value:c,onChange:B,className:"items-select",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn pagination-prev",onClick:()=>_(n-1),disabled:n===1,title:"Previous page",children:e.jsx("span",{children:"â€¹"})}),U().map((s,a)=>s==="..."?e.jsx("span",{className:"pagination-ellipsis",children:"..."},`ellipsis-${a}`):e.jsx("button",{className:`pagination-btn pagination-number ${n===s?"active":""}`,onClick:()=>_(s),children:s},s)),e.jsx("button",{className:"pagination-btn pagination-next",onClick:()=>_(n+1),disabled:n===r,title:"Next page",children:e.jsx("span",{children:"â€º"})})]})]}),e.jsx(V,{isOpen:b,onClose:()=>{y(!1),w(null)},onConfirm:M,title:"Delete File",message:"Are you sure you want to delete this file?",itemInfo:{name:u?.original_name||"",details:u?g(u.file_size):""},confirmText:"Delete File",cancelText:"Cancel",variant:"danger",children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})}),e.jsx(J,{isOpen:v.isOpen,onClose:()=>p({...v,isOpen:!1}),title:v.title,message:v.message,type:v.type})]})};export{H as default};
