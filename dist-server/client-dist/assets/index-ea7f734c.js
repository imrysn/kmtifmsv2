import{r as n,a as Rt,b as Ke}from"./react-vendor-a308f804.js";import{H as Bt,R as zt,a as ws,N as Ns}from"./router-vendor-90630356.js";import{a as Rs}from"./anime-vendor-37453147.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}})();var Ys={exports:{}},os={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ot=n,Ut=Symbol.for("react.element"),Vt=Symbol.for("react.fragment"),Ht=Object.prototype.hasOwnProperty,Wt=Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qt={key:!0,ref:!0,__self:!0,__source:!0};function Zs(a,s,t){var i,l={},o=null,r=null;t!==void 0&&(o=""+t),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(r=s.ref);for(i in s)Ht.call(s,i)&&!qt.hasOwnProperty(i)&&(l[i]=s[i]);if(a&&a.defaultProps)for(i in s=a.defaultProps,s)l[i]===void 0&&(l[i]=s[i]);return{$$typeof:Ut,type:a,key:o,ref:r,props:l,_owner:Wt.current}}os.Fragment=Vt;os.jsx=Zs;os.jsxs=Zs;Ys.exports=os;var e=Ys.exports,_s={},Bs=Rt;_s.createRoot=Bs.createRoot,_s.hydrateRoot=Bs.hydrateRoot;const Kt=!1,Jt=["password","token","secret","apiKey","api_key","accessToken","refreshToken","privateKey","sessionId","sessionToken"],Qt=["email","username","phone","address","ssn","creditCard","bankAccount"];function ls(a,s=!Kt){if(!a||typeof a!="object")return a;if(Array.isArray(a))return a.map(i=>ls(i,s));const t={};for(const[i,l]of Object.entries(a)){const o=i.toLowerCase();if(Jt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}if(s&&Qt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}l&&typeof l=="object"?t[i]=ls(l,s):t[i]=l}return t}function Gt(a){return a?{id:a.id,role:a.role||a.panelType,team:a.team,username:`${a.username?.[0]}***`,email:"***@***.***",timestamp:new Date().toISOString()}:null}class Yt{constructor(s="App"){this.component=s}log(s,t=null){}info(s,t=null){const i=t?ls(t):null;console.info(`â„¹ï¸ [${this.component}] ${s}`,i||"")}warn(s,t=null){const i=t?ls(t):null;console.warn(`âš ï¸ [${this.component}] ${s}`,i||"")}error(s,t=null){const i=t?{message:t.message,name:t.name,stack:void 0}:null;console.error(`âŒ [${this.component}] ${s}`,i||"")}logLogin(s){const t=Gt(s);this.info("User logged in",t)}logLogout(){this.info("User logged out")}logStateUpdate(s){this.log(`State updated: ${s}`)}logNavigation(s,t){this.log(`Navigation: ${s} â†’ ${t}`)}debug(s,t=null){}logPerformance(s,t){console.log(`âš¡ [${this.component}] ${s} took ${t}ms`)}}function Xs(a){return new Yt(a)}const Zt=""+new URL("kmti_logo-e782f075.png",import.meta.url).href,zs=Xs("Login"),ke={EMAIL:"kmt_login_email",PASSWORD:"kmt_login_password",REMEMBER:"kmt_remember_me"},Xt=({onLogin:a})=>{const[s,t]=n.useState("user"),[i,l]=n.useState({email:"",password:""}),[o,r]=n.useState({}),[d,f]=n.useState(!1),[x,C]=n.useState(""),[w,c]=n.useState(!1),[S,_]=n.useState(!1),[L,p]=n.useState(""),[h,v]=n.useState(!1),[j,T]=n.useState(!1),[z,Z]=n.useState("");n.useEffect(()=>{if(localStorage.getItem(ke.REMEMBER)==="true"){const V=localStorage.getItem(ke.EMAIL)||"",W=localStorage.getItem(ke.PASSWORD)||"";l({email:V,password:W}),_(!0)}},[]);const H=()=>{t(s==="user"?"admin":"user"),l({email:"",password:""}),r({}),C("")},U=F=>{const V=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,W=/^[a-zA-Z0-9._-]+$/;return F.includes("@")?V.test(F):W.test(F)&&F.length>=3&&F.length<=30},B=()=>{const F={};return i.email.trim()?U(i.email)||(i.email.includes("@")?F.email="Please enter a valid email address":F.email="Username must be 3-30 characters and contain only letters, numbers, dots, underscores, or hyphens"):F.email="Username or email is required",i.password.trim()||(F.password="Password is required"),r(F),Object.keys(F).length===0},M=()=>{T(!0),Z("")},K=async()=>{if(z.trim()){v(!0),p("");try{const V=await(await fetch("http://localhost:3001/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:z.trim()})})).json();V.success?(p("Password reset instructions have been sent to Admin (Contact him for your new password)."),T(!1)):p(V.message||"Failed to send reset email.")}catch(F){zs.error("Forgot password failed",F),p("Unable to connect to server. Please try again.")}finally{v(!1)}}},X=()=>{T(!1),Z("")},O=F=>{const{name:V,value:W}=F.target;l(J=>({...J,[V]:W})),o[V]&&r(J=>({...J,[V]:""})),x&&C("")},g=async F=>{if(F.preventDefault(),!!B()){f(!0),C("");try{const W=await(await fetch("http://localhost:3001/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,loginType:s})})).json();W.success?(S?(localStorage.setItem(ke.EMAIL,i.email),localStorage.setItem(ke.PASSWORD,i.password),localStorage.setItem(ke.REMEMBER,"true")):(localStorage.removeItem(ke.EMAIL),localStorage.removeItem(ke.PASSWORD),localStorage.removeItem(ke.REMEMBER)),setTimeout(()=>{a(W.user)},200)):C(W.message||"Login failed")}catch(V){zs.error("Login failed",V),C("Unable to connect to server. Please try again.")}finally{f(!1)}}};return e.jsxs("div",{className:"unified-login-container",children:[e.jsxs("div",{className:"main-login-card",children:[e.jsx("div",{className:"welcome-section",children:e.jsxs("div",{className:"welcome-content",children:[e.jsx("div",{className:"logo-container",children:e.jsx("img",{src:Zt,alt:"KMTI Logo",className:"login-logo"})}),e.jsx("div",{className:"system-name",children:e.jsx("p",{children:"File Management System"})})]})}),e.jsx("div",{className:"login-section",children:e.jsxs("div",{className:"login-form-container",children:[e.jsx("div",{className:"login-header",children:e.jsx("h2",{children:"Sign in"})}),e.jsx("div",{className:"login-toggle",children:e.jsx("button",{type:"button",className:`toggle-switch ${s}`,onClick:H,"aria-label":`Switch to ${s==="user"?"Admin":"User"} login`,children:e.jsx("span",{className:"toggle-slider"})})}),e.jsxs("form",{onSubmit:g,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{type:"text",id:"email",name:"email",value:i.email,onChange:O,className:o.email?"error":"",disabled:d,placeholder:"User Name"}),o.email&&e.jsx("span",{className:"error-message",children:o.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:w?"text":"password",id:"password",name:"password",value:i.password,onChange:O,className:o.password?"error":"",disabled:d,placeholder:"Password"}),e.jsx("button",{type:"button",className:"show-password-btn",onClick:()=>c(!w),children:"SHOW"})]}),o.password&&e.jsx("span",{className:"error-message",children:o.password})]}),e.jsxs("div",{className:"form-options",children:[e.jsxs("label",{className:"remember-me",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:F=>_(F.target.checked)}),e.jsx("span",{className:"checkmark"}),"Remember me"]}),e.jsx("button",{type:"button",className:"forgot-password",onClick:M,disabled:h||d,children:h?"Sending...":"Forgot Password?"})]}),x&&e.jsx("div",{className:"api-error",children:x}),L&&e.jsx("div",{className:"api-error",style:{backgroundColor:"#DCFCE7",color:"#166534",borderColor:"#BBF7D0"},children:L}),e.jsx("button",{type:"submit",className:`login-button ${s} ${d?"loading":""}`,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),e.jsx("span",{children:"Signing In..."})]}):"Sign in"})]})]})})]}),j&&e.jsx("div",{className:"modal-overlay",onClick:X,children:e.jsxs("div",{className:"modal-content",onClick:F=>F.stopPropagation(),children:[e.jsx("h3",{children:"Reset Password"}),e.jsx("p",{children:"Enter your email address or username to receive password reset instructions."}),e.jsx("input",{type:"text",value:z,onChange:F=>Z(F.target.value),placeholder:"Email or Username",disabled:h}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:X,disabled:h,className:"cancel-button",children:"Cancel"}),e.jsx("button",{onClick:K,disabled:!z.trim()||h,className:"submit-button",children:h?"Sending...":"Send Reset Password"})]})]})})]})},ea="modulepreload",sa=function(a,s){return new URL(a,s).href},Os={},he=function(s,t,i){if(!t||t.length===0)return s();const l=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=sa(o,i),o in Os)return;Os[o]=!0;const r=o.endsWith(".css"),d=r?'[rel="stylesheet"]':"";if(!!i)for(let C=l.length-1;C>=0;C--){const w=l[C];if(w.href===o&&(!r||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${d}`))return;const x=document.createElement("link");if(x.rel=r?"stylesheet":ea,r||(x.as="script",x.crossOrigin=""),x.href=o,document.head.appendChild(x),r)return new Promise((C,w)=>{x.addEventListener("load",C),x.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>s()).catch(o=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o})};const re=({type:a="dashboard"})=>{switch(a){case"dashboard":return e.jsx(Us,{});case"admin":return e.jsx(ta,{});case"teamleader":return e.jsx(aa,{});case"myfiles":return e.jsx(na,{});case"table":return e.jsx(ia,{});case"card":return e.jsx(la,{});case"grid":return e.jsx(oa,{});default:return e.jsx(Us,{})}},Us=()=>e.jsxs("div",{className:"skeleton-container",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"20px"}}),[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a))]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]},a))}),e.jsxs("div",{className:"skeleton-content-area",children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"200px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))})]})]})]}),ta=()=>e.jsxs("div",{className:"skeleton-container admin-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),[1,2,3,4,5,6].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-stats-grid",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70%"}})]},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"40px",width:"250px",marginBottom:"16px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5,6].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"15%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"10%"}})]},a))})]})]})]}),aa=()=>e.jsxs("div",{className:"skeleton-container tl-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",style:{width:"260px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"32px"}}),[1,2,3,4].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"12px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"70px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3].map(a=>e.jsx("div",{className:"skeleton-card",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",borderRadius:"12px"}})]})},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"180px",marginBottom:"20px"}}),e.jsxs("div",{className:"skeleton-table",children:[e.jsx("div",{className:"skeleton-table-header",children:[1,2,3,4,5,6,7,8].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}},a))}),[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"90%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"85%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"55%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"32px",borderRadius:"6px"}})]},a))]})]})]})]}),na=()=>e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"140px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"200px"}})]}),e.jsx("div",{style:{display:"flex",gap:"0"},children:[1,2,3,4].map(a=>e.jsxs("div",{style:{borderRight:a!==4?"1px solid #d5d5d9":"none",padding:"0 24px",display:"flex",alignItems:"center",gap:"16px",minWidth:"200px",height:"80px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"56px",height:"56px",borderRadius:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"40px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"140px"}})]})]},a))})]}),e.jsxs("div",{style:{background:"white",border:"1px solid #d5d5d9",borderRadius:"12px",overflow:"hidden"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"14px 20px",background:"white",borderBottom:"1px solid #d5d5d9"},children:["FILENAME","DATE & TIME","TEAM","STATUS","ACTIONS"].map((a,s)=>e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80px"}},s))}),[1,2,3,4,5,6,7,8,9,10].map(a=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"16px 20px",borderBottom:a!==10?"1px solid #e5e5ea":"none",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"44px",height:"44px",borderRadius:"8px",flexShrink:0}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"70%",marginBottom:"6px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"40%"}})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"90%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"70%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"180px",borderRadius:"50px"}}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70px",borderRadius:"6px"}})})]},a))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",background:"white",borderTop:"1px solid #e5e5ea",marginTop:"-1px",borderRadius:"0 0 12px 12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"200px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"100px",borderRadius:"6px"}})]}),e.jsx("div",{style:{display:"flex",gap:"6px"},children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"36px",borderRadius:"6px"}},a))})]})]}),ia=()=>e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))}),la=()=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"80%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}})]}),oa=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",padding:"1.5rem"},children:[1,2,3,4,5,6,7,8,9,10,11,12].map(a=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"1rem",borderRadius:"8px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",marginBottom:"0.75rem",borderRadius:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"100%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}})]},a))}),ra=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z",fill:"#FDB022"})}),ca=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#E74C3C"}),e.jsx("path",{d:"M14 2v6h6",fill:"#C0392B"}),e.jsx("text",{x:"12",y:"17",fontSize:"6",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"PDF"})]}),Vs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#2980B9"}),e.jsx("path",{d:"M14 2v6h6",fill:"#3498DB"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"DOC"})]}),Hs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#27AE60"}),e.jsx("path",{d:"M14 2v6h6",fill:"#229954"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"XLS"})]}),Ve=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z",fill:"#9B59B6"})}),bs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#95A5A6"}),e.jsx("path",{d:"M14 2v6h6M10 8h2v2h-2v-2zm0 2h2v2h-2v-2z",fill:"#7F8C8D"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"ZIP"})]}),as=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M18 4l2 3h-3l-2-3h-2l2 3h-3l-2-3H8l2 3H7L5 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z",fill:"#E67E22"}),e.jsx("path",{d:"M10 12l5 3-5 3v-6z",fill:"white"})]}),ks=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z",fill:"#1ABC9C"})}),He=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#34495E"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2C3E50"}),e.jsx("rect",{x:"8",y:"12",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"14",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"16",width:"6",height:"1",fill:"white"})]}),Pe=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#3498DB"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2980B9"}),e.jsx("circle",{cx:"12",cy:"14",r:"3",fill:"none",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14",stroke:"white",strokeWidth:"0.5"})]}),da=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#BDC3C7"}),e.jsx("path",{d:"M14 2v6h6",fill:"#95A5A6"})]}),ha=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})}),ma=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z",fill:"currentColor"})}),ua=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z",fill:"currentColor"})}),pa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z",fill:"currentColor"})}),Ws=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),fa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z",fill:"currentColor"})}),xa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z",fill:"currentColor"})}),ga=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z",fill:"currentColor"})}),ja=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z",fill:"currentColor"})}),va=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),ya=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"}),e.jsx("path",{d:"M14 2v6h6"}),e.jsx("path",{d:"M16 13H8"}),e.jsx("path",{d:"M16 17H8"}),e.jsx("path",{d:"M10 9H8"})]}),wa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"})}),Na=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),ba=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 9l-9 9z"}),e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),e.jsx("path",{d:"M13.59 7l-1.42 1.41L16.17 12l-4.59 4.59L13.59 18l6-6z"}),e.jsx("path",{d:"M7.41 7L6 8.41l4.59 4.59L6 17.59 7.41 19l6-6z"})]}),We={folder:ra,pdf:ca,doc:Vs,docx:Vs,xls:Hs,xlsx:Hs,jpg:Ve,jpeg:Ve,png:Ve,gif:Ve,bmp:Ve,zip:bs,rar:bs,"7z":bs,mp4:as,mov:as,avi:as,mkv:as,mp3:ks,wav:ks,flac:ks,txt:He,json:He,html:He,css:He,js:He,default:da,icd:Pe,sldprt:Pe,sldasm:Pe,slddrw:Pe,dwg:Pe,dxf:Pe,dashboard:ha,files:ma,users:ua,activityLogs:pa,fileApproval:Ws,settings:fa,logout:xa,tasks:ga,notifications:ja,comment:va,assignment:ya,approval:Ws,rejection:wa,final_approval:Na,final_rejection:ba},ka=(a,s=!1)=>{if(s)return We.folder;const t=a?.toLowerCase()||"";return We[t]||We.default},me=a=>{const s=We[a]||We.default;return e.jsx(s,{})},Ca=({fileType:a,isFolder:s=!1,altText:t="File Icon",className:i="",style:l={},size:o="default"})=>{const r=ka(a,s),d={small:{width:"24px",height:"24px"},default:{width:"40px",height:"40px"},medium:{width:"48px",height:"48px"},large:{width:"64px",height:"64px"}},f=typeof o=="string"&&d[o]?d[o]:d.default;return e.jsx("div",{className:`file-icon-wrapper ${i}`.trim(),style:{width:f.width,height:f.height,minWidth:f.width,minHeight:f.height,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,background:"transparent",...l},role:"img","aria-label":t,children:e.jsx(r,{})})},Ge=Ke.memo(Ca);const Sa=({activeTab:a,setActiveTab:s,filesCount:t,notificationCount:i,onLogout:l,user:o})=>e.jsxs("div",{className:"user-sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:o?.fullName||"User"}),e.jsx("div",{className:"user-role",children:o?.team||"No Team"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${a==="dashboard"?"active":""}`,onClick:()=>s("dashboard"),children:[e.jsx("span",{className:"nav-icon",children:me("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${a==="notification"?"active":""}`,onClick:()=>s("notification"),children:[e.jsxs("span",{className:"nav-icon notification-icon-wrapper",children:[me("notifications"),i>0&&e.jsx("span",{className:"notification-badge",children:i})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${a==="my-files"?"active":""}`,onClick:()=>s("my-files"),children:[e.jsx("span",{className:"nav-icon",children:me("files")}),e.jsx("span",{className:"nav-label",children:"My Files"}),t>0&&e.jsx("span",{className:"file-count-badge",children:t})]}),e.jsxs("button",{className:`nav-item ${a==="tasks"?"active":""}`,onClick:()=>s("tasks"),children:[e.jsx("span",{className:"nav-icon",children:me("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${a==="team-files"?"active":""}`,onClick:()=>s("team-files"),children:[e.jsx("span",{className:"nav-icon",children:me("users")}),e.jsx("span",{className:"nav-label",children:"Team Tasks"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{className:"logout-btn",onClick:l,children:[e.jsx("span",{className:"nav-icon",children:me("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]});const Fs=({type:a,message:s,onClose:t})=>(n.useEffect(()=>{if(s){const i=setTimeout(()=>{t()},2e3);return()=>clearTimeout(i)}},[s,t]),s?e.jsx("div",{className:"alert-message-component",children:e.jsxs("div",{className:`alert alert-${a}`,children:[e.jsx("span",{className:"alert-message",children:s}),e.jsx("button",{onClick:t,className:"alert-close",children:"Ã—"})]})}):null);let Te=!0,qe=null,Je=document.title,Qe=!1,Ie=null;try{window.electron&&window.electron.flashFrame&&(Qe=!0,Ie=window.electron,console.log("âœ… Electron environment detected - using native window flashing"))}catch{console.log("â„¹ï¸ Browser environment detected - using title flashing")}document.addEventListener("visibilitychange",()=>{Te=!document.hidden,Te&&we()});Qe&&(window.addEventListener("focus",()=>{Te=!0,we()}),window.addEventListener("blur",()=>{Te=!1}));window.addEventListener("load",()=>{Je=document.title});const Ts=(a="New Notification",s=1e4)=>{if(console.log(`ðŸ”” flashTaskbar called: "${a}" (isElectron: ${Qe}, isVisible: ${Te})`),Te){console.log("âš ï¸ Page is visible, skipping flash");return}if(we(),Qe&&Ie&&Ie.flashFrame){console.log("âš¡ Using Electron native window flashing"),Ie.flashFrame(!0);let t=!1;qe=setInterval(()=>{document.title=t?Je:`ðŸ”” ${a}`,t=!t},1e3),s>0&&setTimeout(()=>{we()},s)}else{console.log("ðŸŒ Using browser title flashing");let t=!1;qe=setInterval(()=>{document.title=t?Je:`ðŸ”” ${a}`,t=!t},1e3),s>0&&setTimeout(()=>{we()},s)}},we=()=>{console.log("â¹ï¸ Stopping taskbar flash"),qe&&(clearInterval(qe),qe=null),Qe&&Ie&&Ie.flashFrame&&Ie.flashFrame(!1),document.title=Je},Ms=a=>{Je=a,Te&&(document.title=a)},Es=a=>{if(a>0){const s=a===1?"New Notification":`${a} New Notifications`;Ts(s)}},et=()=>Te,_a={flashTaskbar:Ts,stopFlashing:we,updateOriginalTitle:Ms,flashForNotifications:Es,isVisible:et},Fa=Object.freeze(Object.defineProperty({__proto__:null,default:_a,flashForNotifications:Es,flashTaskbar:Ts,isVisible:et,stopFlashing:we,updateOriginalTitle:Ms},Symbol.toStringTag,{value:"Module"})),st=(a,s={})=>{const{enabled:t=!0,duration:i=1e4,pageTitle:l=null}=s,o=n.useRef(a);return n.useEffect(()=>{l&&Ms(l)},[l]),n.useEffect(()=>{if(!t)return;const r=a-o.current;r>0&&(console.log(`ðŸ“¢ ${r} new notification(s) - Flashing taskbar`),Es(r)),o.current=a},[a,t]),n.useEffect(()=>()=>{we()},[]),{stopFlashing:we}},tt=(a={})=>{const{duration:s=1e4}=a,t=(i="New Notification")=>{console.log(`ðŸ“¢ Manual flash: ${i}`),he(()=>Promise.resolve().then(()=>Fa),void 0,import.meta.url).then(l=>{l.flashTaskbar(i,s)})};return n.useEffect(()=>()=>{we()},[]),t},Ta=({notifications:a,onClose:s,onNavigate:t})=>{const[i,l]=n.useState([]),[o,r]=n.useState(new Set),d=tt({duration:5e3});n.useEffect(()=>{const c=a.filter(S=>!S.is_read&&!o.has(S.id)).slice(0,3);if(l(c),c.length>0){const S=c.length===1?c[0].title:`${c.length} New Notifications`;d(S)}if(c.length>0){const S=c.map(_=>setTimeout(()=>{f(_.id)},5e3));return()=>S.forEach(_=>clearTimeout(_))}},[a,o]);const f=n.useCallback(c=>{r(S=>new Set([...S,c])),l(S=>S.filter(_=>_.id!==c))},[]),x=n.useCallback(c=>{t&&(c.type==="comment"&&c.assignment_id?(c.action_by_username&&sessionStorage.setItem("highlightCommentBy",c.action_by_username),t("tasks",c.assignment_id)):c.type==="assignment"&&c.assignment_id?t("tasks",c.assignment_id):((c.type==="approval"||c.type==="rejection"||c.type==="final_approval"||c.type==="final_rejection")&&c.file_id||c.file_id)&&t("my-files",c.file_id)),f(c.id)},[t,f]),C=n.useCallback(c=>{switch(c){case"comment":return"ðŸ’¬";case"assignment":return"ðŸ“‹";case"approval":return"âœ…";case"rejection":return"âŒ";case"final_approval":return"ðŸŽ‰";case"final_rejection":return"ðŸš«";default:return"ðŸ””"}},[]),w=n.useCallback(c=>{switch(c){case"comment":return"blue";case"assignment":return"purple";case"approval":case"final_approval":return"green";case"rejection":case"final_rejection":return"red";default:return"gray"}},[]);return i.length===0?null:e.jsx("div",{className:"toast-container cursor-pointer",children:i.map((c,S)=>e.jsxs("div",{className:`toast-notification toast-${w(c.type)}`,style:{animationDelay:`${S*100}ms`},onClick:()=>x(c),children:[e.jsx("div",{className:"toast-icon",children:C(c.type)}),e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-title",children:c.title}),e.jsx("div",{className:"toast-message",children:c.message}),e.jsxs("div",{className:"toast-meta",children:[e.jsxs("span",{children:["ðŸ‘¤ ",c.action_by_username]}),c.assignment_title&&e.jsxs("span",{children:["ðŸ“‹ ",c.assignment_title]})]})]}),e.jsx("button",{className:"toast-close",onClick:_=>{_.stopPropagation(),f(c.id)},children:"âœ•"})]},c.id))})};const Ma=({columns:a=5})=>e.jsx("tr",{className:"skeleton-row",children:Array.from({length:a}).map((s,t)=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-box-inline",style:{width:t===0?"80%":"60%"}})},t))}),Ea=()=>e.jsxs("div",{className:"skeleton-stat-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"30%"}})]}),Qn=({rows:a=5,columns:s=5})=>e.jsx("div",{className:"loading-table-container",children:e.jsxs("table",{style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:s}).map((t,i)=>e.jsx("th",{children:e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"70%"}})},i))})}),e.jsx("tbody",{children:Array.from({length:a}).map((t,i)=>e.jsx(Ma,{columns:s},i))})]})}),qs=({count:a=4})=>e.jsx("div",{className:"loading-cards-grid",children:Array.from({length:a}).map((s,t)=>e.jsx(Ea,{},t))}),Ks=({user:a,files:s,setActiveTab:t,onOpenFile:i,onNavigateToTasks:l})=>{const[o,r]=n.useState([]),[d,f]=n.useState([]),[x,C]=n.useState([]),[w,c]=n.useState(!0),[S,_]=n.useState(new Date);n.useEffect(()=>{L();const M=setInterval(()=>{L(!0)},3e4);return()=>clearInterval(M)},[a.id,a.team]);const L=async(M=!1)=>{try{M||c(!0);const[K,X,O]=await Promise.all([fetch(`http://localhost:3001/api/assignments/user/${a.id}`),fetch(`http://localhost:3001/api/assignments/team/${a.team}/all-tasks?limit=5`),fetch(`http://localhost:3001/api/notifications/user/${a.id}`)]),[g,F,V]=await Promise.all([K.json(),X.json(),O.json()]);g.success&&r(g.assignments||[]),F.success&&f(F.assignments||[]),V.success&&C(V.notifications||[]),_(new Date)}catch(K){console.error("Error fetching dashboard data:",K)}finally{c(!1)}},p=async M=>{try{await fetch(`http://localhost:3001/api/notifications/${M.id}/read`,{method:"PUT"})}catch(K){console.error("Error marking notification as read:",K)}M.type==="comment"&&M.assignment_id?(sessionStorage.setItem("scrollToAssignment",M.assignment_id),sessionStorage.setItem("highlightCommentBy",M.action_by_username),l?l(M.assignment_id):t("tasks")):M.type==="assignment"?l?l():t("tasks"):M.file_id&&(i?i(M.file_id):t("my-files"))},h={total:o.length,pending:o.filter(M=>M.user_status!=="submitted").length,submitted:o.filter(M=>M.user_status==="submitted").length,overdue:o.filter(M=>M.due_date?new Date(M.due_date)<new Date&&M.user_status!=="submitted":!1).length},v={total:s.length,pending:s.filter(M=>M.current_stage?.includes("pending")).length,approved:s.filter(M=>M.status==="final_approved").length,rejected:s.filter(M=>M.status?.includes("rejected")||M.current_stage?.includes("rejected")).length},j={totalTasks:d.length,totalSubmissions:d.reduce((M,K)=>M+(K.recent_submissions?K.recent_submissions.length:0),0)},T={unread:x.filter(M=>!M.is_read).length,recent:x.slice(0,3)},z=h.total>0?Math.round(h.submitted/h.total*100):0,Z=v.total>0?Math.round(v.approved/v.total*100):0,H=v.total>0?Math.round(v.rejected/v.total*100):0,U=h.total>0?Math.round((h.total-h.overdue)/h.total*100):100,B=(()=>{const M=h.total>0?h.submitted/h.total*100:0,K=v.total>0?v.approved/v.total*100:0,X=v.total>0?v.rejected/v.total*20:0,O=h.total>0?(h.total-h.overdue)/h.total*100:100,g=M*.4+K*.3+O*.3;return Math.max(0,Math.round(g-X))})();return w?e.jsx("div",{className:"modern-dashboard",children:e.jsxs("div",{className:"dashboard-skeleton",children:[e.jsx("div",{className:"top-stats-grid",children:e.jsx(qs,{count:3})}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"180px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"40px",width:"100%",marginBottom:"20px"}}),e.jsx("div",{className:"analytics-metrics-grid",children:e.jsx(qs,{count:4})})]}),e.jsxs("div",{className:"notifications-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"140px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%"}})]})]})]})}):e.jsxs("div",{className:"modern-dashboard",children:[e.jsxs("div",{className:"top-stats-grid",children:[e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("tasks"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Tasks"}),e.jsx("div",{className:"stat-card-value",children:h.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[h.pending," pending"]})," Â· ",e.jsxs("span",{className:"submitted-count",children:[h.submitted," submitted"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("my-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Files"}),e.jsx("div",{className:"stat-card-value",children:v.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[v.pending," pending"]})," Â· ",e.jsxs("span",{className:"approved-count",children:[v.approved," approved"]})," Â· ",e.jsxs("span",{className:"rejected-count",children:[v.rejected," rejected"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("team-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"Team Activity"}),e.jsx("div",{className:"stat-card-value",children:j.totalTasks}),e.jsxs("div",{className:"stat-card-detail",children:[j.totalTasks," tasks Â· ",j.totalSubmissions," submissions"]})]})]})]}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern",children:[e.jsx("div",{className:"analytics-card-header",children:e.jsx("h2",{className:"analytics-card-title",children:"Performance Analytics"})}),e.jsxs("div",{className:"analytics-content",children:[e.jsx("div",{className:"overall-score-section",children:e.jsxs("div",{className:"score-content-wrapper",children:[e.jsx("div",{className:"circular-progress-container",children:e.jsxs("svg",{className:"circular-progress-svg",viewBox:"0 0 200 200",children:[e.jsx("circle",{className:"progress-ring-bg",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18"}),e.jsx("circle",{className:"progress-ring-fill",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18",strokeDasharray:`${B/100*534} 534`,strokeLinecap:"round",style:{stroke:B>=85?"#10b981":B>=70?"#22c55e":B>=50?"#f59e0b":"#ef4444"}}),e.jsxs("text",{className:"score-percentage-text",x:"100",y:"95",textAnchor:"middle",children:[B,"%"]}),e.jsx("text",{className:"score-label-text",x:"100",y:"118",textAnchor:"middle",children:"Performance"})]})}),e.jsxs("div",{className:"score-description",children:[e.jsx("div",{className:"score-status",children:e.jsx("div",{className:"status-badge",style:{background:B>=85||B>=70?"#d1fae5":B>=50?"#fef3c7":"#fee2e2",color:B>=85||B>=70?"#065f46":B>=50?"#92400e":"#991b1b"},children:B>=85?"ðŸŒŸ Excellent":B>=70?"âœ… Good":B>=50?"âš ï¸ Fair":"ðŸ“‰ Needs Improvement"})}),e.jsx("p",{className:"score-message",children:B>=85?"Outstanding work! You're exceeding expectations.":B>=70?"Great job! Keep up the good momentum.":B>=50?"You're on track. Focus on completing pending tasks.":"Let's work on improving your completion rate."}),e.jsxs("div",{className:"score-legend-grid",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot excellent"}),e.jsx("span",{children:"85-100% Excellent"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot good"}),e.jsx("span",{children:"70-84% Good"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot fair"}),e.jsx("span",{children:"50-69% Fair"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot poor"}),e.jsx("span",{children:"0-49% Poor"})]})]})]})]})}),e.jsxs("div",{className:"analytics-metrics-grid",children:[e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon task-completion-icon",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Task Completion"}),e.jsxs("div",{className:"metric-value",children:[z,"%"]}),e.jsxs("div",{className:"metric-detail",children:[h.submitted,"/",h.total," completed"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon ontime-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"On-Time Delivery"}),e.jsxs("div",{className:"metric-value",children:[U,"%"]}),e.jsxs("div",{className:"metric-detail",children:[h.total-h.overdue,"/",h.total," on time"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon approval-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Approval Rate"}),e.jsxs("div",{className:"metric-value",children:[Z,"%"]}),e.jsxs("div",{className:"metric-detail",children:[v.approved,"/",v.total," approved"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon rejection-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Rejection Rate"}),e.jsxs("div",{className:"metric-value",children:[H,"%"]}),e.jsxs("div",{className:"metric-detail",children:[v.rejected,"/",v.total," rejected"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon overdue-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Overdue Tasks"}),e.jsx("div",{className:"metric-value",children:h.overdue}),e.jsx("div",{className:"metric-detail",children:"Tasks awaiting attention"})]})]})]})]})]}),e.jsxs("div",{className:"notifications-card-modern",children:[e.jsxs("div",{className:"notifications-card-header",children:[e.jsxs("h2",{className:"notifications-card-title",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),"Notifications"]}),e.jsx("div",{className:"notifications-badge",children:T.unread})]}),e.jsx("div",{className:"notifications-content",children:T.recent.length>0?e.jsxs(e.Fragment,{children:[T.recent.map(M=>e.jsx("div",{className:`notification-item-modern ${M.is_read?"":"unread"}`,onClick:()=>p(M),style:{cursor:"pointer"},children:e.jsxs("div",{className:"notification-text",children:[e.jsx("div",{className:"notification-title-modern",children:M.title}),e.jsx("div",{className:"notification-time-modern",children:(()=>{const K=new Date,X=new Date(M.created_at),O=K-X,g=Math.floor(O/6e4),F=Math.floor(O/36e5);return g<60?`${g} minutes ago`:F<24?`${F} hour${F>1?"s":""} ago`:X.toLocaleDateString()})()})]})},M.id)),e.jsx("button",{className:"view-all-notifications-btn",onClick:()=>t("notification"),children:"View all notifications"})]}):e.jsxs("div",{className:"empty-notifications",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{children:"No notifications"})]})})]})]})]})},Aa=n.lazy(()=>he(()=>import("./TeamTasksTab-f239d5a4.js"),["./TeamTasksTab-f239d5a4.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TeamTasksTab-e9d479ad.css"],import.meta.url)),Da=n.lazy(()=>he(()=>import("./MyFilesTab-7affcccc.js"),["./MyFilesTab-7affcccc.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./MyFilesTab-5e070958.css"],import.meta.url)),Ia=n.lazy(()=>he(()=>import("./NotificationTab-RealTime-1007e3ff.js"),["./NotificationTab-RealTime-1007e3ff.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./NotificationTab-RealTime-f2f41e81.css"],import.meta.url)),La=n.lazy(()=>he(()=>import("./TasksTab-Enhanced-cfb4807b.js"),["./TasksTab-Enhanced-cfb4807b.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TasksTab-Enhanced-f73d19c6.css"],import.meta.url)),$a=n.lazy(()=>he(()=>import("./FileModal-a06bb696.js"),["./FileModal-a06bb696.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./FileModal-6990c4b3.css"],import.meta.url)),Js=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,d]=n.useState([]),[f,x]=n.useState(!1),[C,w]=n.useState(""),[c,S]=n.useState(""),[_,L]=n.useState(null),[p,h]=n.useState(!1),[v,j]=n.useState([]),[T,z]=n.useState("all"),[Z,H]=n.useState(0),[U,B]=n.useState([]),M=async()=>{x(!0);try{const b=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();b.success?o(b.files||[]):w("Failed to fetch your files")}catch(u){console.error("Error fetching user files:",u),w("Failed to connect to server")}finally{x(!1)}},K=u=>{i(u)};n.useEffect(()=>{(async()=>{try{const P=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();P.success&&(H(P.unreadCount||0),B(P.notifications||[]))}catch(b){console.error("Error fetching notifications:",b)}})()},[a.id]),n.useEffect(()=>{M()},[a.id]),n.useEffect(()=>{t==="my-files"&&M()},[t,a.id]),n.useEffect(()=>{X()},[l,T]);const X=()=>{let u=l;T!=="all"&&(u=u.filter(b=>{switch(T){case"pending":return b.current_stage.includes("pending");case"approved":return b.status==="final_approved";case"rejected":return b.status.includes("rejected");default:return!0}})),d(u)},O=async u=>{L(u),h(!0);try{const P=await(await fetch(`http://localhost:3001/api/files/${u.id}/comments`)).json();P.success&&j(P.comments||[])}catch(b){console.error("Error fetching comments:",b),j([])}},g=async u=>{try{const P=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();if(P.success&&P.files){const E=P.files.find(ee=>ee.id===parseInt(u));E?(i("my-files"),setTimeout(async()=>{await O(E)},100)):w("File not found in your files")}else w("Failed to fetch file details")}catch(b){console.error("Error fetching file:",b),w("Failed to connect to server")}},F=(u=null)=>{i("tasks"),u&&sessionStorage.setItem("scrollToAssignment",u)},V=async(u,b)=>{u==="my-files"&&b?await g(b):u==="tasks"&&b?(i("tasks"),sessionStorage.setItem("scrollToAssignment",b)):i(u)},W=u=>{if(u===0)return"0 Bytes";const b=1024,P=["Bytes","KB","MB","GB"],E=Math.floor(Math.log(u)/Math.log(b));return parseFloat((u/Math.pow(b,E)).toFixed(2))+" "+P[E]},J=()=>{w(""),S("")},D=()=>{s()},N=u=>{S(u)},m=()=>{switch(t){case"dashboard":return e.jsx(Ks,{user:a,files:l,setActiveTab:i});case"team-files":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Aa,{user:a})});case"my-files":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"myfiles"}),children:e.jsx(Da,{filteredFiles:r,isLoading:f,filterStatus:T,setFilterStatus:z,setActiveTab:i,fetchUserFiles:M,formatFileSize:W,openFileModal:O,files:l,user:a,onUploadSuccess:N})});case"notification":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"list"}),children:e.jsx(Ia,{user:a,onOpenFile:g,onNavigateToTasks:F,onUpdateUnreadCount:H})});case"tasks":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(La,{user:a})});default:return e.jsx(Ks,{user:a,files:l,setActiveTab:K,onOpenFile:g,onNavigateToTasks:F})}};return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"dashboard"}),children:e.jsxs("div",{className:"minimal-dashboard user-dashboard",children:[e.jsx(Sa,{activeTab:t,setActiveTab:K,filesCount:l.filter(u=>u.status==="uploaded"||u.status==="team_leader_approved"||u.status==="final_approved").length,notificationCount:Z,onLogout:D,user:a}),e.jsx("div",{className:"main-content",children:e.jsxs("div",{className:"dashboard-content",children:[e.jsx(Fs,{type:"error",message:C,onClose:J}),e.jsx(Fs,{type:"success",message:c,onClose:J}),m()]})}),p&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx($a,{showFileModal:p,setShowFileModal:h,selectedFile:_,fileComments:v,formatFileSize:W})}),e.jsx(Ta,{notifications:U,onNavigate:V})]})})};const Pa=({activeTab:a,setActiveTab:s,clearMessages:t,setSidebarOpen:i,sidebarOpen:l,onLogout:o})=>{const r=d=>{s(d),t(),i(!1)};return e.jsxs("aside",{className:`tl-sidebar ${l?"open":""}`,children:[e.jsxs("div",{className:"tl-brand",children:[e.jsx("div",{className:"tl-brand-logo",children:"TL"}),e.jsx("span",{className:"tl-brand-name",children:"Team Leader"})]}),e.jsxs("nav",{className:"tl-nav",children:[e.jsxs("button",{className:`tl-nav-item ${a==="dashboard"?"active":""}`,onClick:()=>r("dashboard"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="notifications"?"active":""}`,onClick:()=>r("notifications"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("span",{children:"Notifications"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="file-collection"?"active":""}`,onClick:()=>r("file-collection"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),e.jsx("span",{children:"File Collection"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="assignments"?"active":""}`,onClick:()=>r("assignments"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 11l3 3L22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),e.jsx("span",{children:"Tasks"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="team-management"?"active":""}`,onClick:()=>r("team-management"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Team Management"})]})]}),e.jsx("div",{className:"tl-sidebar-footer",children:e.jsxs("button",{className:"tl-logout-btn",onClick:o,children:[e.jsxs("svg",{className:"tl-logout-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),e.jsx("span",{children:"Logout"})]})})]})},Ra=({error:a,success:s,clearMessages:t})=>!a&&!s?null:e.jsxs(e.Fragment,{children:[a&&e.jsxs("div",{className:"tl-alert error",children:[a,e.jsx("button",{onClick:t,children:"Ã—"})]}),s&&e.jsxs("div",{className:"tl-alert success",children:[s,e.jsx("button",{onClick:t,children:"Ã—"})]})]});const Re=({isOpen:a,onClose:s,onConfirm:t,title:i="Confirm Action",message:l="Are you sure you want to proceed?",confirmText:o="Confirm",cancelText:r="Cancel",variant:d="danger",isLoading:f=!1,itemInfo:x,children:C})=>{if(!a)return null;const w=L=>{L.target===L.currentTarget&&!f&&s()},c=L=>{L.preventDefault(),L.stopPropagation(),f||t()},S=L=>{L.preventDefault(),L.stopPropagation(),f||s()},_=()=>{switch(d){case"danger":return"btn-danger";case"warning":return"btn-warning";case"info":return"btn-primary";default:return"btn-danger"}};return e.jsx("div",{className:"modal-overlay",onClick:w,children:e.jsxs("div",{className:`modal confirmation-modal ${d}`,onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:S,className:"modal-close",disabled:f,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:l}),x&&e.jsxs("div",{className:"item-info",children:[x.name&&e.jsx("div",{className:"item-name",children:x.name}),x.details&&e.jsx("div",{className:"item-details",children:x.details})]}),C,!C&&e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"delete-actions",children:[e.jsx("button",{type:"button",onClick:S,className:"btn btn-secondary",disabled:f,children:r}),e.jsx("button",{type:"button",onClick:c,className:`btn ${_()}`,disabled:f,children:f?"Deleting...":o})]})})]})})};const at=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`tl-notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"tl-notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"tl-notification-content",children:[e.jsxs("div",{className:"tl-notification-title",children:[a.title,!a.is_read&&e.jsx("span",{className:"tl-unread-badge",children:"New"})]}),e.jsx("div",{className:"tl-notification-message",children:a.message}),e.jsxs("div",{className:"tl-notification-meta",children:[e.jsxs("span",{className:"tl-notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"tl-notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"tl-notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"tl-notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"tl-notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"tl-notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));at.displayName="NotificationItem";const Gn=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,d]=n.useState(!1),[f,x]=n.useState(""),[C,w]=n.useState(0);st(C);const[c,S]=n.useState(1),[_,L]=n.useState(!0),[p,h]=n.useState(0),v=20,j=n.useRef(null),T=n.useRef(null);n.useEffect(()=>{z(1,!0);const g=setInterval(()=>{z(1,!0,!0)},3e4);return()=>clearInterval(g)},[a.id]),n.useEffect(()=>{if(l||r||!_)return;const g={root:null,rootMargin:"100px",threshold:.1};return j.current=new IntersectionObserver(F=>{F[0].isIntersecting&&_&&!r&&z(c+1,!1)},g),T.current&&j.current.observe(T.current),()=>{j.current&&j.current.disconnect()}},[l,r,_,c]);const z=async(g,F=!1,V=!1)=>{try{F&&!V?o(!0):V||d(!0);const J=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${g}&limit=${v}`)).json();if(J.success){const D=J.notifications||[];if(F)i(D),S(1);else if(V){const N=new Set(t.map(u=>u.id)),m=D.filter(u=>!N.has(u.id));m.length>0&&i([...m,...t])}else i(N=>[...N,...D]),S(g);w(J.unreadCount||0),h(J.totalCount||0),L(J.hasMore||!1)}else x("Failed to fetch notifications")}catch(W){console.error("Error fetching notifications:",W),V||x("Failed to fetch notifications")}finally{F&&!V?o(!1):V||d(!1)}},Z=async g=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${g}/read`,{method:"PUT"})).json()).success&&(i(W=>W.map(J=>J.id===g?{...J,is_read:!0}:J)),w(W=>Math.max(0,W-1)))}catch(F){console.error("Error marking notification as read:",F)}},H=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(V=>V.map(W=>({...W,is_read:!0}))),w(0))}catch(g){console.error("Error marking all as read:",g)}},U=async g=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${g}`,{method:"DELETE"})).json()).success){const W=t.find(J=>J.id===g);i(J=>J.filter(D=>D.id!==g)),h(J=>J-1),W&&!W.is_read&&w(J=>Math.max(0,J-1))}}catch(F){console.error("Error deleting notification:",F)}},B=async()=>{if(window.confirm("Are you sure you want to delete all notifications?"))try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),w(0),h(0),L(!1))}catch(g){console.error("Error deleting all notifications:",g)}},M=g=>{console.log("ðŸ”” Notification clicked:",g),console.log("   Type:",g.type),console.log("   Title:",g.title),console.log("   Assignment ID:",g.assignment_id),g.is_read||Z(g.id);const F=g.title==="New Reply on Assignment";if(console.log("   Is Reply Notification:",F),g.type==="comment"||F)if(console.log("   â†’ Navigating to assignments with comment context"),g.assignment_id){const V={assignmentId:g.assignment_id,shouldOpenComments:!0,expandAllReplies:F};console.log("   ðŸ“¤ Sending navigation data:",V),s?s("assignments",V):console.error("   âŒ onNavigate function not provided!")}else console.error("   âŒ No assignment_id found in notification!");else g.type==="submission"||g.type==="file_uploaded"||g.type==="assignment"?(console.log("   â†’ Navigating to assignments (Go to Task behavior)"),g.assignment_id?s?s("assignments",{assignmentId:g.assignment_id,fileId:g.file_id||null,shouldOpenComments:!1,fromFileSubmission:!0}):console.error("   âŒ onNavigate function not provided!"):console.error("   âŒ No assignment_id found in notification!")):g.type==="approval"||g.type==="rejection"||g.type==="final_approval"||g.type==="final_rejection"?(console.log("   â†’ Navigating to file collection"),g.file_id?s&&s("file-collection",{fileId:g.file_id}):console.error("   âŒ No file_id found in notification!")):!g.type||g.type===""?(console.log("   âš ï¸ Empty notification type, checking IDs..."),g.file_id&&g.assignment_id?(console.log("   â†’ Has both file_id and assignment_id, treating as file submission"),console.log("   â†’ Navigating to assignments (Go to Task behavior)"),s&&s("assignments",{assignmentId:g.assignment_id,fileId:g.file_id,shouldOpenComments:!1,fromFileSubmission:!0})):g.assignment_id?(console.log("   â†’ Has assignment_id only, navigating to assignments"),s&&s("assignments",{assignmentId:g.assignment_id,shouldOpenComments:!1})):g.file_id?(console.log("   â†’ Has file_id only, navigating to file collection"),s&&s("file-collection",{fileId:g.file_id})):console.error("   âŒ Empty type and no valid IDs found!")):console.warn("   âš ï¸ Unknown notification type:",g.type)},K=({type:g})=>e.jsx(Ge,{fileType:g,size:"medium",altText:`${g} notification icon`,className:"tl-notification-type-icon"}),X=n.useCallback(g=>{const F=new Date,V=new Date(g),W=Math.floor((F-V)/1e3);return W<60?`${W}s ago`:W<3600?`${Math.floor(W/60)}m ago`:W<86400?`${Math.floor(W/3600)}h ago`:W<604800?`${Math.floor(W/86400)}d ago`:V.toLocaleDateString()},[]),O=()=>e.jsx("div",{className:"tl-notification-skeleton",children:[1,2,3,4,5].map(g=>e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-meta"})]})]},g))});return l?e.jsxs("div",{className:"tl-notifications-page",children:[e.jsx("div",{className:"tl-notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(O,{})]}):e.jsxs("div",{className:`tl-notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"tl-notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"tl-notifications-actions",children:[C>0&&e.jsx("button",{className:"tl-btn-mark-all-read",onClick:H,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"tl-btn-delete-all",onClick:B,children:"Delete All"})]})]}),f&&e.jsx("div",{className:"tl-error-message",children:f}),e.jsxs("div",{className:"tl-notifications-stats",children:[p," total â€¢ ",C," unread"]}),t.length===0?e.jsxs("div",{className:"tl-no-notifications",children:[e.jsx("div",{className:"tl-no-notifications-icon",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tl-notifications-list",children:t.map(g=>e.jsx(at,{notification:g,onNotificationClick:M,onDeleteNotification:U,NotificationIcon:K,formatTimeAgo:X},g.id))}),r&&e.jsxs("div",{className:"tl-notifications-loading-more",children:[e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]}),e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]})]}),_&&!r&&e.jsx("div",{ref:T,className:"tl-load-more-trigger"}),!_&&t.length>=v&&e.jsx("div",{className:"tl-end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]})]})};function nt(a){if(!a)return"Unknown File Type";const s=a.replace(/^\./,"").toLowerCase().trim();return["pdf document","word document","excel spreadsheet","text file","jpeg image","png image","zip archive","documents","spreadsheets","presentations","images","videos","audio","cad/3d files","engineering files","archives","code","executables"].includes(s)?a.split(" ").map(_=>_.charAt(0).toUpperCase()+_.slice(1).toLowerCase()).join(" "):["pdf","doc","docx","txt","rtf","odt","pages"].includes(s)?"Documents":["xls","xlsx","csv","ods","numbers"].includes(s)?"Spreadsheets":["ppt","pptx","key","odp"].includes(s)?"Presentations":["jpg","jpeg","png","gif","bmp","svg","webp","tiff","tif","ico","heic","heif"].includes(s)?"Images":["mp4","avi","mov","wmv","flv","mkv","webm","mpeg","mpg","m4v"].includes(s)?"Videos":["mp3","wav","flac","aac","ogg","wma","m4a","opus"].includes(s)?"Audio":["dwg","dxf","dwf","dwt","sldprt","sldasm","slddrw","step","stp","iges","igs","stl","obj","fbx","3ds","sat","ipt","iam","idw","prt","asm","drw","catpart","catproduct","catdrawing","x_t","x_b"].includes(s)?"CAD/3D Files":["icd","bom","sch","pcb","gerber","gbr","cam","nc","gcode","plt","dxp","schdoc","pcbdoc","brd","lib","mod","kicad_pcb","kicad_sch","kicad_mod","pro"].includes(s)?"Engineering Files":["zip","rar","7z","tar","gz","bz2","xz","iso"].includes(s)?"Archives":["js","jsx","ts","tsx","py","java","cpp","c","h","cs","php","rb","go","rs","swift","kt","scala","r","m","sh","html","css","scss","sass","less","json","xml","yaml","yml","sql","md","markdown"].includes(s)?"Code":["exe","dll","so","dylib","app","dmg","pkg","deb","rpm","msi"].includes(s)?"Executables":/^[A-Z0-9]+\s+File$/i.test(a)?a:s.length<=10&&!/\s/.test(s)?`${s.toUpperCase()} File`:a}function Ba(a){if(!a)return"Unknown File Type";const s=a.split(".").pop();return nt(s)}function za(a,s=""){return!a||a==="Unknown File Type"?s?Ba(s):"Unknown File Type":nt(a)}const Cs=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.OverviewTab}))),Oa=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileCollectionTab}))),Ua=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.TeamManagementTab}))),Va=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.AssignmentsTab}))),Ha=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.NotificationTab}))),Wa=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.BulkActionModal}))),qa=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FilterModal}))),Ka=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.PriorityModal}))),Ja=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.MemberFilesModal}))),Qa=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.CreateAssignmentModal}))),Ga=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.ReviewModal}))),Ya=n.lazy(()=>he(()=>import("./index-d9c883bf.js"),["./index-d9c883bf.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileViewModal}))),Za=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState(!1),[r,d]=n.useState([]),[f,x]=n.useState([]),[C,w]=n.useState([]),[c,S]=n.useState("all"),[_,L]=n.useState("date-desc"),[p,h]=n.useState(!1),[v,j]=n.useState(""),[T,z]=n.useState(""),[Z,H]=n.useState(null),[U,B]=n.useState(!1),[M,K]=n.useState(!1),[X,O]=n.useState(""),[g,F]=n.useState(""),[V,W]=n.useState(!1),[J,D]=n.useState(""),[N,m]=n.useState([]),[u,b]=n.useState(null),[P,E]=n.useState([]),[ee,se]=n.useState(!1),[Q,de]=n.useState(""),[ue,xe]=n.useState(""),[ye,Ce]=n.useState(!1),[Se,pe]=n.useState({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),[I,G]=n.useState({field:"uploaded_at",direction:"DESC"}),[q,ce]=n.useState(!1),[k,Y]=n.useState(null),[ae,ge]=n.useState("normal"),[je,cs]=n.useState(""),[ds,hs]=n.useState([]),[ms,us]=n.useState({overdue:0,urgent:0,pending:0});n.useState(!1);const[Ee,Be]=n.useState([]),[y,$]=n.useState(null),[te,ne]=n.useState([]),[le,Ne]=n.useState(!1),[be,_e]=n.useState(!1),[ve,ps]=n.useState(null),[ft,xt]=n.useState("total"),[fs,Ye]=n.useState([]),[gt,xs]=n.useState(!1),[As,gs]=n.useState(!1),[ze,Ds]=n.useState({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),[jt,Is]=n.useState(null),[vt,Ze]=n.useState(null),[yt,Ls]=n.useState(null),[wt,Xe]=n.useState(null);n.useEffect(()=>{t==="overview"&&Oe("total"),t==="file-collection"&&js(),Nt(),vs(),kt(),t==="assignments"&&Ue(),t==="dashboard"&&(console.log("ðŸ”„ DASHBOARD TAB: Loading data...",{activeTab:t,team:a.team}),js(),Ue())},[a.team,t]),n.useEffect(()=>{const R=setInterval(vs,3e4);return()=>clearInterval(R)},[a.team]),n.useEffect(()=>{const R=()=>{u&&b(null)};return document.addEventListener("click",R),()=>document.removeEventListener("click",R)},[u]),n.useEffect(()=>{if(J.trim()==="")x(r);else{const R=r.filter(A=>A.original_name?.toLowerCase().includes(J.toLowerCase())||A.username?.toLowerCase().includes(J.toLowerCase())||A.description?.toLowerCase().includes(J.toLowerCase())||A.file_type?.toLowerCase().includes(J.toLowerCase()));x(R)}},[r,J,ft]);const js=async()=>{h(!0);try{const A=await(await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}/all-submissions`)).json();A.success&&w(A.submissions||[])}catch(R){console.error("Error fetching all submissions:",R),w([])}finally{h(!1)}},Oe=async(R=null)=>{h(!0);try{let A=`http://localhost:3001/api/files/team-leader/${a.team}?limit=1000`;if(R==="total")A=`http://localhost:3001/api/files/team/${a.team}?limit=1000`;else if(R&&R!=="pending"){let ss=R;A=`http://localhost:3001/api/files/team/${a.team}/status/${ss}?limit=1000`}const oe=await(await fetch(A)).json();oe.success&&(d(oe.files||[]),x(oe.files||[]),xt(R||null))}catch(A){console.error("Error fetching files:",A)}finally{h(!1)}},Nt=async()=>{Ne(!0);try{const A=await(await fetch(`http://localhost:3001/api/team-members/${a.team}`)).json();if(A.success&&A.members&&A.members.length>0){const ie=A.members.map(oe=>({id:oe.id,name:oe.fullName||oe.username,email:oe.email,joined:new Date(oe.created_at||Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),files:oe.totalFiles||0,status:"Active",...oe}));Be(ie)}else Be([])}catch(R){console.error("Error fetching team members:",R),j("Failed to load team members"),Be([])}finally{Ne(!1)}},bt=async(R,A)=>{$({id:R,name:A}),h(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/member/${R}`)).json();oe.success?(ne(oe.files||[]),_e(!0)):j("Failed to fetch member files")}catch(ie){console.error("Error fetching member files:",ie),j("Failed to connect to server")}finally{h(!1)}},kt=async()=>{try{const A=await(await fetch(`http://localhost:3001/api/dashboard/team/${a.team}`)).json();A.success&&ps(A.analytics||{})}catch(R){console.error("Error fetching analytics:",R)}},Ue=async()=>{xs(!0);try{const R=await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}`);if(R.status===404){Ye([]),xs(!1);return}const A=await R.json();A.success?Ye(A.assignments||[]):Ye([])}catch(R){console.error("Error fetching assignments:",R),Ye([])}finally{xs(!1)}},Ct=async()=>{if(!ze.title.trim()){j("Please enter assignment title");return}if(ze.assignedMembers.length===0){j("Please select at least one team member");return}W(!0);try{const A=await(await fetch("http://localhost:3001/api/assignments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...ze,assignedTo:ze.assignedMembers.length>0?"specific":"all",teamLeaderId:a.id,teamLeaderUsername:a.username,team:a.team})})).json();A.success?(z(`Assignment created! ${A.membersAssigned} members assigned.`),gs(!1),Ds({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),Ue()):j(A.message||"Failed to create assignment")}catch(R){console.error("Error creating assignment:",R),j("Failed to create assignment")}finally{W(!1)}},St=async(R,A)=>{try{(await(await fetch(`http://localhost:3001/api/assignments/${R}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamLeaderUsername:a.username,team:a.team})})).json()).success?(z("Assignment deleted successfully"),Ue()):j("Failed to delete assignment")}catch(ie){console.error("Error deleting assignment:",ie),j("Failed to delete assignment")}},_t=async(R,A)=>{H(R),F(A),O(""),B(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/${R.id}/comments`)).json();oe.success&&m(oe.comments||[])}catch(ie){console.error("Error fetching comments:",ie),m([])}},Ft=async R=>{try{(await(await fetch("http://localhost:3001/api/files/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R.file_path})})).json()).success?z("File opened successfully"):j("Failed to open file")}catch(A){console.error("Error opening file:",A),j("Failed to open file")}},Tt=async R=>{if(R.preventDefault(),!(!Z||!g)){if(g==="reject"&&!X.trim()){j("Please provide a reason for rejection");return}W(!0),j("");try{const ie=await(await fetch(`http://localhost:3001/api/files/${Z.id}/team-leader-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:g,comments:X.trim(),teamLeaderId:a.id,teamLeaderUsername:a.username,teamLeaderRole:a.role,team:a.team})})).json();ie.success?(z(`File ${g}d successfully!`),B(!1),H(null),O(""),F(null),m([]),Oe()):j(ie.message||`Failed to ${g} file`)}catch(A){console.error(`Error ${g}ing file:`,A),j(`Failed to ${g} file. Please try again.`)}finally{W(!1)}}},es=R=>{if(!R||R===0||isNaN(R))return"0 Bytes";const A=1024,ie=["Bytes","KB","MB","GB"],oe=Math.floor(Math.log(R)/Math.log(A));return parseFloat((R/Math.pow(A,oe)).toFixed(2))+" "+ie[oe]},Mt=R=>{if(!R)return"No date";const A=new Date(R);return isNaN(A.getTime())?"Invalid Date":A.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Et=async()=>{if(Q==="reject"&&!ue.trim()){j("Please provide a reason for rejection");return}W(!0),j("");try{const A=await(await fetch("http://localhost:3001/api/files/bulk-action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:P,action:Q,comments:ue.trim(),reviewerId:a.id,reviewerUsername:a.username,reviewerRole:a.role,team:a.team})})).json();A.success?(z(`Successfully ${Q}d ${A.results.success.length} file(s)`),A.results.failed.length>0&&j(`Failed to process ${A.results.failed.length} file(s)`),se(!1),de(""),xe(""),E([]),Oe()):j(A.message||`Failed to ${Q} files`)}catch(R){console.error("Error performing bulk action:",R),j(`Failed to ${Q} files. Please try again.`)}finally{W(!1)}},At=async()=>{h(!0);try{const A=await(await fetch(`http://localhost:3001/api/files/team-leader/${a.team}/filter`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:Se,sort:I,page:1,limit:100})})).json();A.success?(d(A.files||[]),Ce(!1)):j("Failed to apply filters")}catch(R){console.error("Error applying filters:",R),j("Failed to apply filters")}finally{h(!1)}},Dt=()=>{pe({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),Oe()},It=async()=>{if(k){W(!0),j("");try{const A=await(await fetch(`http://localhost:3001/api/files/${k}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:ae,dueDate:je,reviewerId:a.id,reviewerUsername:a.username})})).json();A.success?(z("Priority and deadline updated successfully"),ce(!1),Y(null),Oe(),vs()):j(A.message||"Failed to update priority")}catch(R){console.error("Error updating priority:",R),j("Failed to update priority. Please try again.")}finally{W(!1)}}},vs=async()=>{try{const A=await(await fetch(`http://localhost:3001/api/files/notifications/${a.team}`)).json();A.success&&(hs(A.notifications||[]),us(A.counts||{overdue:0,urgent:0,pending:0}))}catch(R){console.error("Error fetching notifications:",R)}},$s=()=>{j(""),z("")},Lt=(R,A)=>{A.stopPropagation(),b(u===R?null:R)},$t=async(R,A)=>{A.stopPropagation();try{(await(await fetch("http://localhost:3001/api/files/open-in-explorer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R})})).json()).success?z("File opened in explorer"):j("Failed to open file in explorer")}catch(ie){console.error("Error opening file in explorer:",ie),j("Failed to open file in explorer")}b(null)},ys=()=>94,Pt=()=>{switch(t){case"overview":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(Cs,{pendingFiles:r,teamMembers:Ee,calculateApprovalRate:ys})});case"dashboard":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(Cs,{pendingFiles:r,teamMembers:Ee,calculateApprovalRate:ys,submittedFiles:C,assignments:fs,notifications:ds,notificationCounts:ms,analyticsData:ve,activeTab:t,setActiveTab:i,onNavigateToTask:(R,A)=>{i("assignments"),Ze(R),A&&Xe(A)}})});case"file-collection":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Oa,{submittedFiles:C,isLoading:p,openFileViewModal:Ft,formatFileSize:es,user:a,openMenuId:u,toggleMenu:Lt,handleOpenInExplorer:$t,fileCollectionFilter:c,setFileCollectionFilter:S,fileCollectionSort:_,setFileCollectionSort:L,onNavigateToTask:(R,A)=>{i("assignments"),Ze(R),A&&Xe(A)},highlightedFileId:yt,onClearFileHighlight:()=>Ls(null)})});case"team-management":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Ua,{isLoadingTeam:le,teamMembers:Ee,fetchMemberFiles:bt})});case"assignments":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"table"}),children:e.jsx(Va,{isLoadingAssignments:gt,assignments:fs,formatDate:Mt,deleteAssignment:St,setShowCreateAssignmentModal:gs,openReviewModal:_t,user:a,notificationCommentContext:jt,onClearNotificationContext:()=>Is(null),highlightedAssignmentId:vt,onClearHighlight:()=>Ze(null),highlightedFileId:wt,onClearFileHighlight:()=>Xe(null)})});case"notifications":return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"list"}),children:e.jsx(Ha,{user:a,onNavigate:async(R,A)=>{if(console.log("ðŸŽ¯ Dashboard onNavigate called"),console.log("   Tab:",R),console.log("   Data:",A),R==="assignments"){i("assignments"),fs.length===0&&(console.log("   â³ Fetching assignments..."),await Ue());const ie=typeof A=="object"?A.assignmentId:A,oe=typeof A=="object"?A.shouldOpenComments:!1,ss=typeof A=="object"?A.expandAllReplies:!1,ts=typeof A=="object"?A.fileId:null;if(console.log("   ðŸ“‹ Extracted data:"),console.log("      assignmentId:",ie),console.log("      shouldOpenComments:",oe),console.log("      expandAllReplies:",ss),console.log("      fileId:",ts),ie)if(Ze(ie),console.log("   âœ… Set highlightedAssignmentId:",ie),ts&&(Xe(ts),console.log("   âœ… Set highlightedSubmissionFileId:",ts)),oe){const Ps={assignmentId:ie,expandAllReplies:ss};console.log("   âœ… Setting notificationCommentContext:",Ps),Is(Ps)}else console.log("   âš ï¸ Not opening comments - shouldOpenComments:",oe)}else if(R==="file-collection"&&(i("file-collection"),C.length===0&&await js(),A)){const ie=typeof A=="object"?A.fileId:A;Ls(ie)}}})});default:return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"cards"}),children:e.jsx(Cs,{pendingFiles:r,teamMembers:Ee,calculateApprovalRate:ys})})}};return e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"teamleader"}),children:e.jsxs("div",{className:"tl-dashboard",children:[e.jsx(Pa,{activeTab:t,setActiveTab:i,clearMessages:$s,setSidebarOpen:o,sidebarOpen:l,onLogout:s}),e.jsxs("main",{className:"tl-main",children:[e.jsx(Ra,{error:v,success:T,clearMessages:$s}),Pt()]}),ee&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Wa,{showBulkActionModal:ee,setShowBulkActionModal:se,bulkAction:Q,selectedFileIds:P,bulkComments:ue,setBulkComments:xe,isProcessing:V,submitBulkAction:Et})}),ye&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(qa,{showFilterModal:ye,setShowFilterModal:Ce,filters:Se,setFilters:pe,clearFilters:Dt,applyFilters:At})}),q&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ka,{showPriorityModal:q,setShowPriorityModal:ce,priorityValue:ae,setPriorityValue:ge,dueDateValue:je,setDueDateValue:cs,isProcessing:V,submitPriority:It})}),be&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ja,{showMemberFilesModal:be,setShowMemberFilesModal:_e,selectedMember:y,setSelectedMember:$,memberFiles:te,setMemberFiles:ne,isLoading:p,formatFileSize:es})}),As&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Qa,{showCreateAssignmentModal:As,setShowCreateAssignmentModal:gs,assignmentForm:ze,setAssignmentForm:Ds,teamMembers:Ee,isProcessing:V,createAssignment:Ct})}),U&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ga,{showReviewModal:U,setShowReviewModal:B,selectedFile:Z,reviewAction:g,setReviewAction:F,fileComments:N,reviewComments:X,setReviewComments:O,isProcessing:V,handleReviewSubmit:Tt,formatFileSize:es,user:a})}),M&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ya,{showModal:M,setShowModal:K,selectedFile:Z,formatFileSize:es,user:a})})]})})};const it=n.createContext(null),Xa=({children:a,initialUser:s})=>{const[t,i]=n.useState(s||null),[l,o]=n.useState(!!s);n.useEffect(()=>{s&&(i(s),o(!0))},[s]);const C={user:t,isAuthenticated:l,login:w=>{i(w),o(!0)},logout:()=>{i(null),o(!1)},updateUser:w=>{i(c=>({...c,...w}))},hasPermission:w=>{if(!t)return!1;const c={ADMIN:3,"TEAM LEADER":2,USER:1},S=c[t.role]||0,_=c[w]||0;return S>=_}};return e.jsx(it.Provider,{value:C,children:a})},Le=()=>{const a=n.useContext(it);if(!a)throw new Error("useAuth must be used within an AuthProvider");return a},lt=n.createContext(null),en="http://localhost:3001",sn=({children:a})=>{const[s,t]=n.useState(!0),[i,l]=n.useState(!0),[o,r]=n.useState(null),[d,f]=n.useState(3e4),x=n.useCallback(async()=>{try{const c=(await fetch(`${en}/api/health`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok;return l(c),t(!0),r(new Date),c}catch(w){return console.warn("Network check failed:",w.message),l(!1),t(navigator.onLine),r(new Date),!1}},[]);n.useEffect(()=>{x()},[x]),n.useEffect(()=>{const w=setInterval(x,d);return()=>clearInterval(w)},[x,d]),n.useEffect(()=>{const w=()=>{t(!0),x()},c=()=>{t(!1),l(!1)};return window.addEventListener("online",w),window.addEventListener("offline",c),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",c)}},[x]);const C={isOnline:s,isServerAvailable:i,isConnected:s&&i,lastChecked:o,checkNetworkStatus:x,setCheckInterval:f};return e.jsx(lt.Provider,{value:C,children:a})},$e=()=>{const a=n.useContext(lt);if(!a)throw new Error("useNetwork must be used within a NetworkProvider");return a},tn=n.createContext(null),an=({children:a,userId:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(0),[r,d]=n.useState(!1),f=n.useRef(null),x=n.useCallback(async(p=!1)=>{if(s){p||d(!0);try{const v=await(await fetch(`http://localhost:3001/api/notifications/user/${s}?page=1&limit=20`)).json();v.success&&(i(v.notifications||[]),o(v.unreadCount||0))}catch(h){console.error("Error fetching notifications:",h)}finally{p||d(!1)}}},[s]),C=n.useCallback(async p=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${p}/read`,{method:"PUT"})).json()).success&&(i(j=>j.map(T=>T.id===p?{...T,is_read:!0}:T)),o(j=>Math.max(0,j-1)))}catch(h){console.error("Error marking notification as read:",h)}},[]),w=n.useCallback(async()=>{if(s)try{(await(await fetch(`http://localhost:3001/api/notifications/user/${s}/read-all`,{method:"PUT"})).json()).success&&(i(v=>v.map(j=>({...j,is_read:!0}))),o(0))}catch(p){console.error("Error marking all as read:",p)}},[s]),c=n.useCallback(async p=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${p}`,{method:"DELETE"})).json()).success){const j=t.find(T=>T.id===p);i(T=>T.filter(z=>z.id!==p)),j&&!j.is_read&&o(T=>Math.max(0,T-1))}}catch(h){console.error("Error deleting notification:",h)}},[t]),S=n.useCallback((p=3e4)=>{f.current&&clearInterval(f.current),f.current=setInterval(()=>{x(!0)},p)},[x]),_=n.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null)},[]);n.useEffect(()=>(s&&(x(),S()),()=>_()),[s,x,S,_]);const L={notifications:t,unreadCount:l,isLoading:r,fetchNotifications:x,markAsRead:C,markAllAsRead:w,deleteNotification:c,startPolling:S,stopPolling:_};return e.jsx(tn.Provider,{value:L,children:a})};class nn extends n.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){const{onError:i,componentName:l}=this.props;console.error("ðŸš¨ Error Boundary Caught Error:",{component:l||"Unknown",error:s.toString(),stack:t.componentStack,timestamp:new Date().toISOString()}),this.setState(o=>({error:s,errorInfo:t,errorCount:o.errorCount+1})),i&&i(s,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};logErrorToService=(s,t)=>{};render(){const{hasError:s,error:t,errorInfo:i,errorCount:l}=this.state,{children:o,fallback:r,componentName:d="Component",showDetails:f=!1}=this.props;return s?r?typeof r=="function"?r(t,this.handleReset):r:e.jsx("div",{className:"error-boundary-container",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h2",{className:"error-title",children:"Something went wrong"}),e.jsxs("p",{className:"error-message",children:[d," encountered an unexpected error and couldn't render."]}),f&&t&&e.jsx("div",{className:"error-details",children:e.jsxs("details",{children:[e.jsx("summary",{className:"error-summary",children:"Technical Details (Click to expand)"}),e.jsxs("div",{className:"error-stack",children:[e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error:"}),e.jsx("pre",{children:t.toString()})]}),i&&e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Component Stack:"}),e.jsx("pre",{children:i.componentStack})]}),e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error Count:"})," ",l]})]})]})}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:this.handleReset,className:"error-btn error-btn-primary",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-btn error-btn-secondary",children:"Reload Page"})]}),l>2&&e.jsxs("div",{className:"error-persistent-notice",children:[e.jsxs("p",{children:["âš ï¸ This error has occurred ",l," times."]}),e.jsx("p",{children:"If the problem persists, please contact support."})]})]})}):o}}const Me=(a,s={})=>{const t=i=>e.jsx(nn,{...s,children:e.jsx(a,{...i})});return t.displayName=`withErrorBoundary(${a.displayName||a.name||"Component"})`,t},ln=({user:a,users:s})=>{Le();const{isConnected:t}=$e(),[i,l]=n.useState(!0),[o,r]=n.useState(""),[d,f]=n.useState({totalFiles:0,approved:0,pending:0,rejected:0,fileTypes:[],recentActivity:[],approvalRate:0,approvalTrends:[],previousMonth:{totalFiles:0,approved:0,pending:0,rejected:0}});n.useEffect(()=>{let p=!0;const h=async()=>{if(t){l(!0),r("");try{const j=await(await fetch("http://localhost:3001/api/dashboard/summary")).json();if(!p)return;j.success?f(j.summary):r(j.message||"Failed to load dashboard data")}catch(v){if(console.error("Error fetching dashboard summary:",v),!p)return;r("Unable to connect to server")}finally{p&&l(!1)}}};if(t){h();const v=setInterval(h,60*1e3);return()=>{p=!1,clearInterval(v)}}},[t]);const x=d.pending,C=d.approved,w=d.rejected,c=d.totalFiles;n.useMemo(()=>d.recentActivity.filter(p=>p.activity&&p.activity.toLowerCase().includes("team leader")).length,[d.recentActivity]),n.useMemo(()=>d.recentActivity.filter(p=>p.activity&&p.activity.toLowerCase().includes("admin")).length,[d.recentActivity]);const S=n.useMemo(()=>{const p=(h,v)=>v===0?h>0?100:0:(h-v)/v*100;return d.previousMonth?{pending:p(x,d.previousMonth.pending),approved:p(C,d.previousMonth.approved),rejected:p(w,d.previousMonth.rejected),total:p(c,d.previousMonth.totalFiles)}:{pending:0,approved:0,rejected:0,total:0}},[x,C,w,c,d.previousMonth]),_=p=>{const h=Math.abs(p),v=p>0?"â†‘":p<0?"â†“":"â€”",j=p>0?"positive":p<0?"negative":"neutral",T=h.toFixed(1);return p===0?{text:"â€” No change from last month",className:"neutral"}:{text:`${v} ${p>=0?"+":"-"}${T}% from last month`,className:j}},L=n.useMemo(()=>d.recentActivity.map(p=>e.jsx("div",{className:"activity-item",children:e.jsxs("div",{className:"activity-content",children:[e.jsxs("div",{className:"activity-header",children:[e.jsx("span",{className:"activity-user",children:p.username||p.role||"System"}),e.jsx("span",{className:"activity-badge "+(p.activity&&p.activity.toLowerCase().includes("approved")?"approved":p.activity&&p.activity.toLowerCase().includes("rejected")?"rejected":"upload"),children:(p.activity||"").split(" ")[0]})]}),e.jsx("div",{className:"activity-description",children:p.activity}),e.jsx("div",{className:"activity-meta",children:new Date(p.timestamp).toLocaleString()})]})},p.id)),[d.recentActivity]);return t?e.jsxs("div",{className:`dashboard-overview ${i?"loading-cursor":""}`,children:[e.jsx("div",{className:"top-row",children:e.jsx("div",{className:"stats-section",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Pending Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":x}),!i&&e.jsx("div",{className:`stat-change ${_(S.pending).className}`,children:_(S.pending).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Approved Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":C.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${_(S.approved).className}`,children:_(S.approved).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Rejected Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":w}),!i&&e.jsx("div",{className:`stat-change ${S.rejected>0?"negative":S.rejected<0?"positive":"neutral"}`,children:_(S.rejected).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Total Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":c.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${_(S.total).className}`,children:_(S.total).text})]})]})})}),e.jsxs("div",{className:"bottom-row",children:[e.jsxs("div",{className:"charts-section",children:[e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"File Approval Trends"})}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading trends..."}),!i&&(!d.approvalTrends||d.approvalTrends.length===0)&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No trend data available"}),!i&&d.approvalTrends&&d.approvalTrends.length>0&&e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 700 300",preserveAspectRatio:"xMidYMid meet",style:{background:"transparent"},children:(()=>{const p=d.approvalTrends.slice(-30),h=Math.max(...p.map(U=>Math.max(U.approved||0,U.rejected||0)),1),v={left:50,right:50,top:30,bottom:50},j=700-v.left-v.right,T=300-v.top-v.bottom,z=j/Math.max(p.length-1,1),Z=p.map((U,B)=>({x:v.left+B*z,y:v.top+T-(U.approved||0)/h*T})),H=p.map((U,B)=>({x:v.left+B*z,y:v.top+T-(U.rejected||0)/h*T}));return e.jsxs(e.Fragment,{children:[[0,.25,.5,.75,1].map(U=>{const B=v.top+T-U*T;return e.jsx("line",{x1:v.left,y1:B,x2:v.left+j,y2:B,stroke:"#E5E7EB",strokeWidth:"1",strokeDasharray:"4 4"},U)}),Z.map((U,B)=>{if(B===0)return null;const M=Z[B-1];return e.jsx("line",{x1:M.x,y1:M.y,x2:U.x,y2:U.y,stroke:"#10B981",strokeWidth:"3"},`approved-${B}`)}),H.map((U,B)=>{if(B===0)return null;const M=H[B-1];return e.jsx("line",{x1:M.x,y1:M.y,x2:U.x,y2:U.y,stroke:"#EF4444",strokeWidth:"3"},`rejected-${B}`)}),Z.map((U,B)=>e.jsx("circle",{cx:U.x,cy:U.y,r:"4",fill:"#10B981"},`approved-point-${B}`)),H.map((U,B)=>e.jsx("circle",{cx:U.x,cy:U.y,r:"4",fill:"#EF4444"},`rejected-point-${B}`)),p.map((U,B)=>{if(B%5!==0&&B!==p.length-1)return null;const M=v.left+B*z,K=U.day||U.date||`D${B+1}`;return e.jsx("text",{x:M,y:v.top+T+30,fontSize:"11",fill:"#6B7280",textAnchor:"middle",children:K},`label-${B}`)}),e.jsxs("g",{transform:`translate(${v.left}, 10)`,children:[e.jsx("circle",{cx:"0",cy:"0",r:"4",fill:"#10B981"}),e.jsx("text",{x:"10",y:"4",fontSize:"12",fill:"#6B7280",children:"Approved"}),e.jsx("circle",{cx:"80",cy:"0",r:"4",fill:"#EF4444"}),e.jsx("text",{x:"90",y:"4",fontSize:"12",fill:"#6B7280",children:"Rejected"})]})]})})()})]})]}),e.jsxs("div",{className:"chart-card",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"File Types Distribution"}),e.jsx("span",{style:{fontSize:"12px",color:"var(--text-tertiary)"},children:"All file types tracked"})]}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading file types..."}),!i&&d.fileTypes.length===0&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No file type data available"}),!i&&d.fileTypes.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 200 200",children:(()=>{const p=d.fileTypes.reduce((j,T)=>j+T.count,0),h=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];let v=0;return d.fileTypes.map((j,T)=>{const z=j.count/p*100,Z=`${z/100*440} 440`,H=e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:h[T%h.length]||"#999",strokeWidth:"30",strokeDasharray:Z,strokeDashoffset:-v},j.file_type);return v+=z/100*440,H})})()}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"8px"},children:d.fileTypes.map((p,h)=>{const v=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];return e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[e.jsx("span",{style:{color:v[h%v.length]||"#999"},children:"â– "}),"Â ",p.file_type||"Unknown"," (",p.count,")"]},p.file_type)})})})]})]})]})]}),e.jsxs("div",{className:"section-card activity-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"Recent Activity"})}),e.jsxs("div",{className:"activity-list",children:[i&&e.jsx("div",{style:{padding:"1rem"},children:"Loading recent activityâ€¦"}),!i&&d.recentActivity.length===0&&e.jsx("div",{style:{padding:"1rem"},children:"No recent activity"}),!i&&L]})]})]})]}):e.jsx(re,{type:"admin"})},Qs=Me(n.memo(ln),{componentName:"Dashboard Overview"});const fe=({type:a="info",message:s,onClose:t,autoCloseDelay:i=3e3})=>{if(n.useEffect(()=>{if(i>0&&t){const r=setTimeout(()=>{t()},i);return()=>clearTimeout(r)}},[i,t]),!s)return null;const l=()=>{switch(a){case"success":return"alert-success";case"error":return"alert-error";case"warning":return"alert-warning";case"info":return"alert-info";default:return"alert-info"}},o=()=>{switch(a){case"success":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"error":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"warning":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 6V11M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"info":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 9V14M10 6H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});default:return null}};return e.jsx("div",{className:"alert-message-component",children:e.jsxs("div",{className:`alert ${l()} message-fade`,children:[e.jsxs("div",{className:"alert-content",children:[e.jsx("span",{className:"alert-icon",children:o()}),e.jsx("span",{className:"alert-message",children:s})]}),t&&e.jsx("button",{onClick:t,className:"alert-close",children:"Ã—"})]})})};const Ss=({isOpen:a,onClose:s,onSubmit:t,title:i,submitText:l="Submit",cancelText:o="Cancel",isLoading:r=!1,size:d="medium",children:f})=>{if(!a)return null;const x=c=>{c.target===c.currentTarget&&!r&&s()},C=c=>{c.preventDefault(),t&&t(c)},w=()=>{switch(d){case"small":return"modal-small";case"large":return"modal-large";default:return"modal-medium"}};return e.jsx("div",{className:"modal-overlay",onClick:x,children:e.jsxs("div",{className:`modal form-modal ${w()}`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:s,className:"modal-close",type:"button",disabled:r,children:"Ã—"})]}),e.jsxs("form",{onSubmit:C,children:[e.jsx("div",{className:"modal-body",children:f}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",onClick:s,className:"btn btn-secondary",disabled:r,children:o}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?"Processing...":l})]})]})]})})};const on=({isOpen:a,onClose:s,file:t,onApprove:i,onReject:l,onOpenFile:o,isLoading:r,isOpeningFile:d,formatFileSize:f,mapFileStatus:x,getStatusDisplayName:C})=>{if(!a||!t)return null;const w=f(t.file_size),c=new Date(t.uploaded_at).toLocaleString();return e.jsx("div",{className:"file-details-modal-component",children:e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal file-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"File Details"}),e.jsx("button",{onClick:s,className:"modal-close",children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"file-details-section",children:[e.jsx("h4",{className:"section-title",children:"File Details"}),e.jsxs("div",{className:"file-details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE NAME:"}),e.jsx("span",{className:"detail-value",children:t.original_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE TYPE:"}),e.jsx("span",{className:"detail-value",children:za(t.file_type,t.original_name)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE SIZE:"}),e.jsx("span",{className:"detail-value",children:w})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"SUBMITTED BY:"}),e.jsx("span",{className:"detail-value",children:t.username})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"TEAM:"}),e.jsx("span",{className:"detail-value team-badge-inline",children:t.user_team})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"UPLOAD DATE:"}),e.jsx("span",{className:"detail-value",children:c})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"STATUS:"}),e.jsx("span",{className:`detail-value status-badge status-${x(t.status)}`,children:C(t.status)})]})]})]}),e.jsx("div",{className:"actions-section",children:e.jsxs("div",{className:"action-buttons-large",children:[e.jsxs("button",{type:"button",onClick:i,className:"btn btn-success-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Approve"]}),e.jsxs("button",{type:"button",onClick:l,className:"btn btn-danger-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Reject"]}),e.jsxs("button",{onClick:o,className:"btn btn-secondary-large",disabled:r||d,children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 10.8333V15.8333C15 16.2754 14.8244 16.6993 14.5118 17.0118C14.1993 17.3244 13.7754 17.5 13.3333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V6.66667C2.5 6.22464 2.67559 5.80072 2.98816 5.48816C3.30072 5.17559 3.72464 5 4.16667 5H9.16667M12.5 2.5H17.5M17.5 2.5V7.5M17.5 2.5L8.33333 11.6667",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),d?"Opening...":"Open"]})]})})]})]})})})};const ot=n.memo(({comment:a,replyingTo:s,setReplyingTo:t,visibleReplies:i,toggleRepliesVisibility:l,getInitials:o,formatTimeAgo:r,replyText:d,setReplyText:f,onPostReply:x,user:C})=>{const[c,S]=n.useState(!1),_=a.comment.length>150,L=n.useCallback(()=>{t(a.id)},[a.id,t]),p=n.useCallback(()=>{l(a.id)},[a.id,l]);return e.jsxs("div",{className:"comment-thread","data-comment-id":a.id,children:[e.jsxs("div",{className:"comment-item",children:[e.jsx("div",{className:"comment-avatar",children:o(a.user_fullname||a.username)}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:a.user_fullname||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"comment-time",children:r(a.created_at)})]}),e.jsxs("div",{className:"comment-text",children:[_&&!c?a.comment.substring(0,150)+"...":a.comment,_&&e.jsx("button",{className:"see-more-btn",onClick:()=>S(!c),children:c?"See less":"See more"})]}),e.jsxs("div",{className:"comment-actions",children:[e.jsx("button",{className:"reply-button",onClick:L,children:"Reply"}),a.replies&&a.replies.length>0&&e.jsxs("button",{className:"view-replies-button",onClick:p,children:[i[a.id]?"Hide":"View"," ",a.replies.length," ",a.replies.length===1?"reply":"replies"]})]})]})]}),a.replies&&a.replies.length>0&&i[a.id]&&e.jsx("div",{className:"replies-thread",children:a.replies.map(h=>e.jsx(rt,{reply:h,getInitials:o,formatTimeAgo:r},h.id))}),s===a.id&&e.jsx(ct,{comment:a,replyText:d,setReplyText:f,onPostReply:x,getInitials:o,user:C})]})});ot.displayName="CommentItem";const rt=n.memo(({reply:a,getInitials:s,formatTimeAgo:t})=>{const[l,o]=n.useState(!1),r=a.reply.length>150;return e.jsxs("div",{className:"reply-item",children:[e.jsx("div",{className:"reply-avatar",children:s(a.user_fullname||a.username)}),e.jsxs("div",{className:"reply-content",children:[e.jsxs("div",{className:"reply-header",children:[e.jsx("span",{className:"reply-author",children:a.user_fullname||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"reply-time",children:t(a.created_at)})]}),e.jsxs("div",{className:"reply-text",children:[r&&!l?a.reply.substring(0,150)+"...":a.reply,r&&e.jsx("button",{className:"see-more-btn",onClick:()=>o(!l),children:l?"See less":"See more"})]})]})]})});rt.displayName="ReplyItem";const ct=n.memo(({comment:a,replyText:s,setReplyText:t,onPostReply:i,getInitials:l,user:o})=>{const r=n.useCallback(f=>{i(f,a.id)},[i,a.id]),d=n.useCallback(f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),r(f))},[r]);return e.jsxs("div",{className:"reply-input-box",children:[e.jsx("div",{className:"comment-avatar reply-avatar",children:l(o.username||o.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a reply...",value:s,onChange:f=>t(f.target.value),onKeyPress:d,disabled:!1,autoFocus:!0}),e.jsx("button",{className:"comment-submit-btn",onClick:r,disabled:!s.trim(),children:"âž¤"})]})]})});ct.displayName="ReplyInputBox";const dt=n.memo(({isOpen:a,onClose:s,assignment:t,comments:i,loadingComments:l,newComment:o,setNewComment:r,onPostComment:d,replyingTo:f,setReplyingTo:x,replyText:C,setReplyText:w,onPostReply:c,visibleReplies:S,toggleRepliesVisibility:_,getInitials:L,formatTimeAgo:p,user:h})=>{if(!a||!t)return null;const v=n.useCallback(j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),d(j))},[d]);return e.jsx("div",{className:"comments-modal-overlay",onClick:s,children:e.jsxs("div",{className:"comments-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"comments-modal-header",children:[e.jsxs("h3",{children:["Comments - ",t.title]}),e.jsx("button",{className:"close-modal-btn",onClick:s,children:"âœ•"})]}),e.jsx("div",{className:"comments-modal-body",children:l?e.jsxs("div",{className:"loading-comments",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading comments..."})]}):i.length===0?e.jsx("div",{className:"no-comments",children:e.jsx("p",{children:"ðŸ’¬ No comments yet. Be the first to comment!"})}):e.jsx("div",{className:"comments-list",children:i.map(j=>e.jsx(ot,{comment:j,replyingTo:f,setReplyingTo:x,visibleReplies:S,toggleRepliesVisibility:_,getInitials:L,formatTimeAgo:p,replyText:C,setReplyText:w,onPostReply:c,user:h},j.id))})}),e.jsx("div",{className:"comments-modal-footer",children:e.jsxs("div",{className:"add-comment",children:[e.jsx("div",{className:"comment-avatar",children:L(h.username||h.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a comment...",value:o,onChange:j=>r(j.target.value),onKeyPress:v}),e.jsx("button",{className:"comment-submit-btn",onClick:d,disabled:!o.trim(),children:"âž¤"})]})]})})]})})});dt.displayName="CommentsModal";const rn=(a=[],s=10)=>{const[t,i]=n.useState(1),l=n.useMemo(()=>Math.ceil(a.length/s),[a.length,s]),o=n.useMemo(()=>{const p=(t-1)*s,h=p+s;return a.slice(p,h)},[a,t,s]),r=n.useMemo(()=>(t-1)*s,[t,s]),d=n.useMemo(()=>Math.min(r+s,a.length),[r,s,a.length]),f=n.useCallback(p=>{const h=Math.max(1,Math.min(p,l));i(h)},[l]),x=n.useCallback(()=>{i(p=>Math.min(p+1,l))},[l]),C=n.useCallback(()=>{i(p=>Math.max(p-1,1))},[]),w=n.useCallback(()=>{i(1)},[]),c=n.useCallback(()=>{i(l)},[l]),S=n.useCallback(()=>{i(1)},[]),_=t<l,L=t>1;return{currentPage:t,totalPages:l,paginatedItems:o,startIndex:r,endIndex:d,itemsPerPage:s,goToPage:f,nextPage:x,prevPage:C,goToFirstPage:w,goToLastPage:c,resetPagination:S,canGoNext:_,canGoPrev:L}},cn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,user:o,contextData:r})=>{const{user:d}=Le(),{isConnected:f}=$e(),[x,C]=n.useState([]),[w,c]=n.useState([]),[S,_]=n.useState(!1),[L,p]=n.useState(""),[h,v]=n.useState(!1),[j,T]=n.useState(null),[z,Z]=n.useState(!1),[H,U]=n.useState(!1),[B,M]=n.useState(!1),[K,X]=n.useState(!1),[O,g]=n.useState(null),[F,V]=n.useState({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),W=n.useMemo(()=>{let k=x;if(L.trim()!==""){const Y=L.toLowerCase();k=x.filter(ae=>ae.fullName.toLowerCase().includes(Y)||ae.username.toLowerCase().includes(Y)||ae.email.toLowerCase().includes(Y)||ae.role.toLowerCase().includes(Y)||ae.team&&ae.team.toLowerCase().includes(Y))}return k.sort((Y,ae)=>{const ge=new Date(Y.created_at||0),je=new Date(ae.created_at||0);return ge-je})},[L,x]),{currentPage:J,totalPages:D,paginatedItems:N,startIndex:m,endIndex:u,goToPage:b,nextPage:P,prevPage:E,resetPagination:ee}=rn(W,9),se=n.useMemo(()=>w.filter(k=>k.is_active),[w]),Q=n.useCallback(async()=>{v(!0);try{const Y=await(await fetch("http://localhost:3001/api/users")).json();Y.success?(C(Y.users),ee()):i("Failed to fetch users")}catch(k){console.error("Error fetching users:",k),i("Failed to connect to server")}finally{v(!1)}},[i,ee]),de=n.useCallback(async()=>{_(!0);try{const Y=await(await fetch("http://localhost:3001/api/teams")).json();Y.success&&c(Y.teams||[])}catch(k){console.error("Error fetching teams:",k)}finally{_(!1)}},[]);n.useEffect(()=>{Q(),de()},[Q,de]),n.useEffect(()=>{if(r&&r.action==="reset-password"&&r.userId){console.log("ðŸ”‘ Opening password reset modal for user:",r);const k=x.find(Y=>Y.id===r.userId);k?(pe(k),l(`Password reset request from ${r.username||k.username}`),setTimeout(()=>{const Y=document.querySelector(`[data-user-id="${r.userId}"]`);Y&&(Y.scrollIntoView({behavior:"smooth",block:"center"}),Y.classList.add("highlight-user"),setTimeout(()=>Y.classList.remove("highlight-user"),2e3))},300)):i("User not found. They may have been deleted.")}},[r,x,l,i]);const ue=n.useCallback(async k=>{k.preventDefault(),v(!0),i("");try{const ae=await(await fetch("http://localhost:3001/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...F,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("User created successfully"),Z(!1),V({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),Q()):i(ae.message)}catch{i("Failed to create user")}finally{v(!1)}},[F,d,i,l,Q]),xe=n.useCallback(async k=>{k.preventDefault(),v(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:F.fullName,username:F.username,email:F.email,role:F.role,team:F.team,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("User updated successfully"),U(!1),T(null),Q()):i(ae.message)}catch{i("Failed to update user")}finally{v(!1)}},[F,j,d,i,l,Q]),ye=n.useCallback(async k=>{k.preventDefault(),v(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${j.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:F.password,adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();ae.success?(l("Password reset successfully"),M(!1),T(null),V(ge=>({...ge,password:""}))):i(ae.message)}catch{i("Failed to reset password")}finally{v(!1)}},[F.password,j,d,i,l]),Ce=n.useCallback(async()=>{if(O){v(!0);try{const Y=await(await fetch(`http://localhost:3001/api/users/${O.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:d.id,adminUsername:d.username,adminRole:d.role,adminTeam:d.team})})).json();Y.success?(l(`User ${O.fullName} deleted successfully`),X(!1),g(null),Q()):i(Y.message)}catch{i("Failed to delete user")}finally{v(!1)}}},[O,d,i,l,Q]),Se=n.useCallback(k=>{i(""),l(""),T(k),V({fullName:k.fullName||"",username:k.username||"",email:k.email||"",password:"",role:k.role||"USER",team:k.team||""}),U(!0)},[i,l]),pe=n.useCallback(k=>{i(""),l(""),T(k),V(Y=>({...Y,password:""})),M(!0)},[i,l]),I=n.useCallback(k=>{g(k),X(!0)},[]),G=n.useCallback(()=>{i(""),l(""),T(null),V({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),Z(!0)},[i,l]),q=n.useCallback((k,Y)=>{V(ae=>({...ae,[k]:Y}))},[]),ce=n.useCallback(k=>{p(k.target.value),ee()},[ee]);return f?e.jsxs("div",{className:`users-management ${h?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsx("div",{className:"search-section",children:e.jsx("div",{className:"search-container",children:e.jsx("input",{type:"text",placeholder:"Search users by name, email, role, or team...",value:L,onChange:ce,className:"search-input"})})}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn btn-primary",onClick:G,children:"Add User"})})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[h?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Password"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.map(k=>{const Y=k.role.toLowerCase().replace(" ","-");return e.jsxs("tr",{className:"user-row","data-user-id":k.id,children:[e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:k.fullName})})}),e.jsx("td",{children:k.username}),e.jsx("td",{className:"email-cell",children:k.email}),e.jsx("td",{children:e.jsxs("div",{className:"password-cell",children:[e.jsx("span",{className:"password-hidden",children:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),e.jsx("button",{className:"password-reset-btn",onClick:()=>pe(k),title:"Reset Password",children:"Reset"})]})}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${Y}`,children:k.role})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:k.team||"â€”"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>Se(k),title:"Edit User",children:"Edit"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>I(k),title:"Delete User",children:"Delete"})]})})]},k.id)})})]})}),!h&&W.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No users found"}),e.jsx("p",{children:"No users match your current search criteria."})]}),!h&&D>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",m+1," to ",u," of ",W.length," users"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:E,disabled:J===1,title:"Previous Page",children:"â€¹"}),e.jsx("div",{className:"pagination-numbers",children:Array.from({length:Math.min(5,D)},(k,Y)=>{let ae;return D<=5||J<=3?ae=Y+1:J>=D-2?ae=D-4+Y:ae=J-2+Y,e.jsx("button",{className:`pagination-number ${J===ae?"active":""}`,onClick:()=>b(ae),children:ae},ae)})}),e.jsx("button",{className:"pagination-btn",onClick:P,disabled:J===D,title:"Next Page",children:"â€º"})]})]})]}),z&&e.jsx(Ss,{isOpen:z,onClose:()=>Z(!1),onSubmit:ue,title:"Add New User",submitText:"Create User",isLoading:h,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:F.fullName,onChange:k=>q("fullName",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:F.username,onChange:k=>q("username",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:F.email,onChange:k=>q("email",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password *"}),e.jsx("input",{type:"password",value:F.password,onChange:k=>q("password",k.target.value),required:!0,minLength:"6",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:F.role,onChange:k=>q("role",k.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:F.team,onChange:k=>q("team",k.target.value),className:"form-select",disabled:S,children:[e.jsx("option",{value:"",children:"Select Team"}),se.map(k=>e.jsxs("option",{value:k.name,children:[k.name,k.leader_username&&` (Led by ${k.leader_username})`]},k.id))]}),S&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),H&&j&&e.jsx(Ss,{isOpen:H,onClose:()=>U(!1),onSubmit:xe,title:"Edit User",submitText:"Update User",isLoading:h,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:F.fullName,onChange:k=>q("fullName",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:F.username,onChange:k=>q("username",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:F.email,onChange:k=>q("email",k.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:F.role,onChange:k=>q("role",k.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:F.team,onChange:k=>q("team",k.target.value),className:"form-select",disabled:S,children:[e.jsx("option",{value:"",children:"Select Team"}),se.map(k=>e.jsxs("option",{value:k.name,children:[k.name,k.leader_username&&` (Led by ${k.leader_username})`]},k.id))]}),S&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),B&&j&&e.jsxs(Ss,{isOpen:B,onClose:()=>M(!1),onSubmit:ye,title:"Reset Password",submitText:"Reset Password",isLoading:h,size:"small",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:["User: ",e.jsxs("strong",{children:[j.fullName," (",j.username,")"]})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password *"}),e.jsx("input",{type:"password",value:F.password,onChange:k=>q("password",k.target.value),required:!0,minLength:"6",placeholder:"Enter new password",className:"form-input"})]})]}),K&&O&&e.jsx(Re,{isOpen:K,onClose:()=>X(!1),onConfirm:Ce,title:"Delete User",message:"Are you sure you want to delete this user?",confirmText:"Delete User",variant:"danger",isLoading:h,itemInfo:{name:O.fullName,details:`${O.email} â€¢ ${O.role}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The user account and all associated data will be permanently removed from the system."})})]}):e.jsx(re,{type:"table"})},dn=Me(cn,{componentName:"User Management"});function ht(a){const s=new Map;return function(...i){const l=JSON.stringify(i);if(s.has(l))return s.get(l);const o=a(...i);return s.set(l,o),o}}const hn=ht(a=>new Date(a).toLocaleDateString()),mn=ht(a=>new Date(a).toLocaleTimeString()),un=n.memo(({log:a})=>e.jsxs("tr",{children:[e.jsx("td",{children:a.username}),e.jsx("td",{children:a.role}),e.jsx("td",{children:a.team}),e.jsxs("td",{children:[hn(a.timestamp)," ",mn(a.timestamp)]}),e.jsx("td",{children:a.activity})]})),pn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Le();const{isConnected:o}=$e(),[r,d]=n.useState([]),[f,x]=n.useState(""),[C,w]=n.useState(""),[c,S]=n.useState("all"),[_,L]=n.useState(1),[p,h]=n.useState(!1),[v,j]=n.useState(!1);n.useState(null),n.useState(!1);const T=12;n.useEffect(()=>{c==="all"&&o&&K()},[c,o]),n.useEffect(()=>{const D=setTimeout(()=>w(f),300);return()=>clearTimeout(D)},[f]);const z=n.useMemo(()=>{let D=[...r];if(C.trim()!==""){const N=C.toLowerCase();D=D.filter(m=>m.username.toLowerCase().includes(N)||m.role.toLowerCase().includes(N)||m.team.toLowerCase().includes(N)||m.activity.toLowerCase().includes(N))}if(c!=="all"){const N=new Date,m=new Date(N.getFullYear(),N.getMonth(),N.getDate());D=D.filter(u=>{const b=new Date(u.timestamp);switch(c){case"today":return b>=m;case"week":const P=new Date(m);return P.setDate(m.getDate()-7),b>=P;case"month":const E=new Date(m);return E.setMonth(m.getMonth()-1),b>=E;default:return!0}})}return D},[r,C,c]),Z=n.useMemo(()=>{const D=Math.ceil(z.length/T),N=(_-1)*T,m=N+T,u=z.slice(N,m);return{totalPages:D,startIndex:N,endIndex:m,currentLogs:u}},[z,_,T]),{totalPages:H,startIndex:U,endIndex:B,currentLogs:M}=Z;n.useEffect(()=>{L(1)},[z]);const K=async(D=1e4)=>{h(!0);try{const N=`http://localhost:3001/api/activity-logs?limit=${D}`,u=await(await fetch(N)).json();u.success?d(u.logs):i("Failed to fetch activity logs")}catch(N){console.error("Error fetching activity logs:",N),i("Failed to connect to server")}finally{h(!1)}},X=()=>{const D=[["Username","Role","Team","Date & Time","Activity"],...z.map(b=>[b.username,b.role,b.team,new Date(b.timestamp).toLocaleString(),b.activity])].map(b=>b.join(",")).join(`
`),N=new Blob([D],{type:"text/csv"}),m=window.URL.createObjectURL(N),u=document.createElement("a");u.href=m,u.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(m),l("Activity logs exported successfully")},O=()=>{x(""),S("all"),L(1),l("All filters cleared")},g=n.useCallback(()=>{x("")},[]);n.useCallback(D=>{L(D)},[]),n.useCallback(()=>{L(D=>Math.max(D-1,1))},[]),n.useCallback(()=>{L(D=>Math.min(D+1,H))},[H]);const F=n.useMemo(()=>{const D=[];if(H<=5)for(let m=1;m<=H;m++)D.push(e.jsx("button",{className:`pagination-btn ${m===_?"active":""}`,onClick:()=>L(m),children:m},m));else{D.push(e.jsx("button",{className:`pagination-btn ${_===1?"active":""}`,onClick:()=>L(1),children:"1"},1)),_>3&&D.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const m=Math.max(2,_-1),u=Math.min(H-1,_+1);for(let b=m;b<=u;b++)b!==1&&b!==H&&D.push(e.jsx("button",{className:`pagination-btn ${b===_?"active":""}`,onClick:()=>L(b),children:b},b));_<H-2&&D.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),H>1&&D.push(e.jsx("button",{className:`pagination-btn ${H===_?"active":""}`,onClick:()=>L(H),children:H},H))}return D},[H,_]),V=()=>{const D=f.trim()!=="",N=c!=="all";if(D&&N){const m={today:"today",week:"this week",month:"this month"}[c];return`search "${f}" and ${m}`}else{if(D)return`search "${f}"`;if(N)return`date filter "${{today:"today",week:"this week",month:"this month"}[c]}"`}return"current filters"},W=async()=>{if(!(f.trim()!=="")&&!(c!=="all")){i("Please apply a search term or date filter to specify logs for deletion");return}if(z.length===0){i("No logs found matching your current filter criteria");return}j(!0)},J=async()=>{const D=z.length,N=z.map(m=>m.id);console.log("Attempting to delete logs:",{logsToDelete:D,logIdsToDelete:N});try{const m=await fetch("http://localhost:3001/api/health");console.log("API health check:",m.status,m.ok)}catch(m){console.error("API health check failed:",m),i("Cannot connect to server. Please ensure the server is running."),h(!1);return}h(!0);try{console.log("Making delete request to:","http://localhost:3001/api/activity-logs/bulk-delete");const m=await fetch("http://localhost:3001/api/activity-logs/bulk-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({logIds:N})});if(console.log("Response status:",m.status,"OK:",m.ok),!m.ok){const P=await m.text();throw console.error("Response error text:",P),new Error(`HTTP error! status: ${m.status} - ${P}`)}const u=await m.json();if(console.log("Delete response:",u),!u.success)throw new Error(u.message||"Failed to delete logs");const b=r.filter(P=>!N.includes(P.id));console.log("Updating state:",{originalCount:r.length,newCount:b.length,deletedCount:u.deletedCount}),d(b),L(1),j(!1),s&&i(""),l(`Successfully deleted ${u.deletedCount||D} log(s) matching your filter criteria`)}catch(m){console.error("Error deleting logs:",m),i(`Failed to delete logs: ${m.message}`)}finally{h(!1)}};return o?e.jsxs("div",{className:`activity-logs-section ${p?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-container",children:[e.jsx("input",{type:"text",placeholder:"Search activity logs...",value:f,onChange:D=>x(D.target.value),className:"search-input"}),f&&e.jsx("button",{className:"search-clear-btn",onClick:g,title:"Clear search",children:"Ã—"})]}),e.jsx("div",{className:"date-filter-container",children:e.jsxs("select",{value:c,onChange:D=>S(D.target.value),className:"date-filter-select",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})}),(f||c!=="all")&&e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:O,children:"Clear Filters"})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-danger",onClick:W,disabled:f.trim()===""&&c==="all"||z.length===0||p,title:f.trim()===""&&c==="all"?"Apply a search term or date filter to specify logs for deletion":`Delete ${z.length} filtered log(s)`,children:p?"Deleting...":`Delete Logs (${z.length})`}),e.jsx("button",{className:"btn btn-primary",onClick:X,disabled:z.length===0,children:"Export Logs"})]})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading activity logs..."})]}):e.jsx("div",{className:"logs-table-container",children:e.jsxs("table",{className:"activity-logs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Activity"})]})}),e.jsx("tbody",{children:M.map(D=>e.jsx(un,{log:D},D.id))})]})}),!p&&z.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No activity logs found"}),e.jsx("p",{children:"No activity logs match your current search criteria."})]}),!p&&z.length>0&&H>1&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(_-1)*T+1," to ",Math.min(_*T,z.length)," of ",z.length," logs"]}),H>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>L(D=>Math.max(D-1,1)),disabled:_===1,children:"â€¹"}),F,e.jsx("button",{className:"pagination-btn",onClick:()=>L(D=>Math.min(D+1,H)),disabled:_===H,children:"â€º"})]})]})]}),e.jsxs(Re,{isOpen:v,onClose:()=>j(!1),onConfirm:J,title:"Delete Activity Logs",message:"Are you sure you want to delete these activity logs?",confirmText:`Delete ${z.length} Log(s)`,variant:"danger",isLoading:p,children:[e.jsxs("p",{className:"confirmation-description",children:["You are about to delete ",e.jsxs("strong",{children:[z.length," log(s)"]})," that match your ",V(),"."]}),e.jsx("p",{className:"confirmation-description",style:{marginTop:"0.5rem"},children:"This action cannot be undone. The selected activity logs will be permanently removed from the system and cannot be recovered."})]})]}):e.jsx(re,{type:"table"})},fn=Me(n.memo(pn),{componentName:"Activity Logs"});const Fe="http://localhost:3001/api",ns=n.memo(({icon:a,label:s,count:t,className:i})=>e.jsxs("div",{className:`file-status-card ${i}`,children:[e.jsx("div",{className:`status-icon ${i}-icon`,children:a}),e.jsxs("div",{className:"status-info",children:[e.jsx("div",{className:"status-number",children:t}),e.jsx("div",{className:"status-label",children:s})]})]})),xn=n.memo(()=>e.jsxs("tr",{className:"file-row-skeleton",children:[e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text-lg"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-btn"})})]})),gn=n.memo(({file:a,formatFileSize:s,mapFileStatus:t,getStatusDisplayName:i,onOpenModal:l,onDelete:o})=>{const r=n.useCallback(()=>{l(a)},[a,l]),d=n.useCallback(S=>{S.stopPropagation(),o(a)},[a,o]),x=n.useCallback((S,_)=>{if(S){const L=S.split(".");if(L.length>1)return L[L.length-1].toLowerCase()}return _?_.replace(/^\./,"").toLowerCase():""},[])(a.original_name,a.file_type),C=n.useMemo(()=>new Date(a.uploaded_at).toLocaleDateString(),[a.uploaded_at]),w=n.useMemo(()=>new Date(a.uploaded_at).toLocaleTimeString(),[a.uploaded_at]),c=n.useMemo(()=>s(a.file_size),[a.file_size,s]);return e.jsxs("tr",{className:"file-row",onClick:r,children:[e.jsx("td",{children:e.jsxs("div",{className:"file-cell",children:[e.jsx("div",{className:"file-icon",children:e.jsx(Ge,{fileType:x,isFolder:!1,altText:`Icon for ${a.original_name}`,size:"medium"})}),e.jsxs("div",{className:"file-details",children:[e.jsx("span",{className:"file-name",children:a.original_name}),e.jsx("span",{className:"file-size",children:c})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:a.username})})}),e.jsx("td",{children:e.jsxs("div",{className:"datetime-cell",children:[e.jsx("div",{className:"date",children:C}),e.jsx("div",{className:"time",children:w})]})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:a.user_team})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${t(a.status)}`,children:i(a.status)})}),e.jsx("td",{children:e.jsx("button",{className:"action-btn delete-btn",onClick:d,title:"Delete File",children:"Delete"})})]})}),jn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{const{user:o}=Le(),{isConnected:r}=$e(),[d,f]=n.useState([]),[x,C]=n.useState(""),[w,c]=n.useState(""),[S,_]=n.useState("all"),[L,p]=n.useState("date-desc"),[h,v]=n.useState(1),[j]=n.useState(7),[T,z]=n.useState(null),[Z,H]=n.useState(!1),[U,B]=n.useState(!1),[M,K]=n.useState(null),[X,O]=n.useState(!0),[g,F]=n.useState(!1),V=n.useRef(null),W=n.useRef(null),J=n.useRef(null),D=n.useRef(null);n.useEffect(()=>{if(s||t){const I=setTimeout(()=>{a()},3e3);return()=>clearTimeout(I)}},[s,t,a]);const N=n.useCallback(async()=>{D.current&&D.current.abort(),D.current=new AbortController,O(!0);try{const G=await(await fetch(`${Fe}/files/all`,{signal:D.current.signal})).json();G.success?f(G.files):i("Failed to fetch files")}catch(I){I.name!=="AbortError"&&(console.error("Error fetching files:",I),i("Failed to connect to server"))}finally{O(!1)}},[i]);n.useEffect(()=>(r&&N(),()=>{D.current&&D.current.abort()}),[r,N]),n.useEffect(()=>{const I=setTimeout(()=>C(w),300);return()=>clearTimeout(I)},[w]),n.useEffect(()=>{v(1)},[x,S,L]);const m=n.useMemo(()=>({pendingTeamLeader:d.filter(I=>I.status==="uploaded").length,pendingAdmin:d.filter(I=>I.status==="team_leader_approved").length,approved:d.filter(I=>I.status==="final_approved").length,rejected:d.filter(I=>I.status==="rejected_by_team_leader"||I.status==="rejected_by_admin").length}),[d]),u=n.useMemo(()=>{let I=d;if(S!=="all"&&(I=I.filter(G=>{switch(S){case"pending-team-leader":return G.status==="uploaded";case"pending-admin":return G.status==="team_leader_approved";case"approved":return G.status==="final_approved";case"rejected":return G.status==="rejected_by_team_leader"||G.status==="rejected_by_admin";default:return!1}})),x&&x.trim()!==""){const G=x.toLowerCase();I=I.filter(q=>q.original_name.toLowerCase().includes(G)||q.username.toLowerCase().includes(G)||q.user_team.toLowerCase().includes(G))}return[...I].sort((G,q)=>{switch(L){case"date-desc":return new Date(q.uploaded_at)-new Date(G.uploaded_at);case"date-asc":return new Date(G.uploaded_at)-new Date(q.uploaded_at);case"filename-asc":return G.original_name.localeCompare(q.original_name);case"filename-desc":return q.original_name.localeCompare(G.original_name);case"user-asc":return G.username.localeCompare(q.username);case"user-desc":return q.username.localeCompare(G.username);default:return 0}})},[d,x,S,L]),b=n.useMemo(()=>{const I=(h-1)*j,G=I+j;return u.slice(I,G)},[u,h,j]),P=n.useMemo(()=>Math.ceil(u.length/j),[u.length,j]),E=n.useCallback(I=>{if(I===0)return"0 Bytes";const G=1024,q=["Bytes","KB","MB","GB"],ce=Math.floor(Math.log(I)/Math.log(G));return parseFloat((I/Math.pow(G,ce)).toFixed(2))+" "+q[ce]},[]);n.useMemo(()=>T?E(T.file_size):"",[T,E]),n.useMemo(()=>T?new Date(T.uploaded_at).toLocaleString():"",[T]);const ee=n.useCallback(I=>{switch(I){case"uploaded":case"team_leader_approved":return"pending";case"final_approved":return"approved";case"rejected_by_team_leader":case"rejected_by_admin":return"rejected";default:return"pending"}},[]),se=n.useCallback(I=>{switch(I){case"uploaded":return"Pending Team Leader";case"team_leader_approved":return"Pending Admin";case"final_approved":return"Approved";case"rejected_by_team_leader":return"Rejected by Team Leader";case"rejected_by_admin":return"Rejected by Admin";default:return I.charAt(0).toUpperCase()+I.slice(1)}},[]),Q=n.useCallback(I=>{K(I),B(!0)},[]),de=n.useCallback(I=>{z(I),H(!0)},[]),ue=n.useCallback(()=>{H(!1),z(null),F(!1)},[]),xe=n.useCallback(async()=>{if(M){O(!0);try{try{await fetch(`${Fe}/files/${M.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})})}catch(q){console.warn("Physical file deletion failed (file may not exist):",q)}const G=await(await fetch(`${Fe}/files/${M.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();G.success?(f(q=>q.filter(ce=>ce.id!==M.id)),B(!1),K(null),l("File metadata deleted successfully")):i(G.message||"Failed to delete file metadata")}catch(I){console.error("Error deleting file:",I),i(I.message||"Failed to delete file metadata")}finally{O(!1)}}},[M,o,i,l]),ye=n.useCallback(async I=>{if(I){F(!0);try{const q=await(await fetch(`${Fe}/files/${I.id}/path`)).json();if(!q.success)throw new Error("Failed to get file path");const ce=q.filePath;if(window.electron&&typeof window.electron.openFileInApp=="function"){const k=await window.electron.openFileInApp(ce);if(!k.success)throw new Error(k.error||"Failed to open file")}else i("File opening not available")}catch(G){console.error("Error opening file:",G),i(G.message||"Failed to open file")}finally{F(!1)}}},[i]),Ce=n.useCallback(async()=>{if(T){O(!0);try{let I=!1;if(window.electron&&typeof window.electron.openDirectoryDialog=="function"){const G={};try{if(typeof window.electron.getNetworkProjectsPath=="function"){const je=await window.electron.getNetworkProjectsPath();je&&(G.defaultPath=je)}}catch(je){console.warn("Could not get default path",je)}const q=await window.electron.openDirectoryDialog(G);if(!q||q.canceled||!q.filePaths||q.filePaths.length===0){O(!1);return}const ce=q.filePaths[0],Y=await(await fetch(`${Fe}/files/${T.id}/move-to-projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinationPath:ce,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team,deleteFromUploads:!0})})).json();if(!Y.success)throw new Error(Y.message||"Failed to move file");const ge=await(await fetch(`${Fe}/files/${T.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();if(!ge.success)throw new Error(ge.message||"Failed to approve file");I=!0}else throw new Error("File system access not available");I&&(f(G=>G.map(q=>q.id===T.id?{...q,status:"final_approved"}:q)),ue(),l("File approved and moved successfully"),N())}catch(I){console.error("Approval error:",I),i(I.message||"Failed to approve file")}finally{O(!1)}}},[T,o,i,l,ue,N]),Se=n.useCallback(async()=>{if(T){O(!0);try{const G=await(await fetch(`${Fe}/files/${T.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();G.success?(await fetch(`${Fe}/files/${T.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})}).catch(()=>{}),f(q=>q.map(ce=>ce.id===T.id?{...ce,status:"rejected_by_admin"}:ce)),ue(),l("File rejected successfully"),N()):i(G.message||"Failed to reject file")}catch(I){console.error("Error rejecting file:",I),i("Failed to reject file")}finally{O(!1)}}},[T,o,i,l,ue,N]),pe=n.useMemo(()=>{const I=[];if(P<=5)for(let q=1;q<=P;q++)I.push(e.jsx("button",{className:`pagination-btn ${q===h?"active":""}`,onClick:()=>v(q),children:q},q));else{I.push(e.jsx("button",{className:`pagination-btn ${h===1?"active":""}`,onClick:()=>v(1),children:"1"},1)),h>3&&I.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const q=Math.max(2,h-1),ce=Math.min(P-1,h+1);for(let k=q;k<=ce;k++)k!==1&&k!==P&&I.push(e.jsx("button",{className:`pagination-btn ${k===h?"active":""}`,onClick:()=>v(k),children:k},k));h<P-2&&I.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),P>1&&I.push(e.jsx("button",{className:`pagination-btn ${P===h?"active":""}`,onClick:()=>v(P),children:P},P))}return I},[P,h]);return r?e.jsxs("div",{className:`file-approval-section ${g?"file-opening-cursor":""}`,children:[s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"file-status-cards",ref:V,children:[e.jsx(ns,{icon:"TL",label:"Pending Team Leader",count:m.pendingTeamLeader,className:"pending"}),e.jsx(ns,{icon:"AD",label:"Pending Admin",count:m.pendingAdmin,className:"pending-admin"}),e.jsx(ns,{icon:"AP",label:"Approved Files",count:m.approved,className:"approved"}),e.jsx(ns,{icon:"RE",label:"Rejected Files",count:m.rejected,className:"rejected"})]}),e.jsxs("div",{className:"file-controls",children:[e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search files by name, user, or team...",value:w,onChange:I=>c(I.target.value),className:"search-input",ref:W}),x&&e.jsx("button",{className:"search-clear-btn",onClick:()=>{c(""),C("")},title:"Clear search",children:"Ã—"})]}),e.jsxs("div",{className:"file-filters",children:[e.jsxs("select",{value:S,onChange:I=>_(I.target.value),className:"form-select",ref:J,children:[e.jsx("option",{value:"all",children:"All Files"}),e.jsx("option",{value:"pending-team-leader",children:"Pending Team Leader"}),e.jsx("option",{value:"pending-admin",children:"Pending Admin"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsxs("select",{value:L,onChange:I=>p(I.target.value),className:"form-select",children:[e.jsx("option",{value:"date-desc",children:"Latest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"filename-asc",children:"Filename A-Z"}),e.jsx("option",{value:"filename-desc",children:"Filename Z-A"}),e.jsx("option",{value:"user-asc",children:"User A-Z"}),e.jsx("option",{value:"user-desc",children:"User Z-A"})]})]})]}),e.jsxs("div",{className:"table-section",children:[e.jsx("div",{className:"files-table-container",children:e.jsxs("table",{className:"files-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Submitted By"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:X?Array(j).fill(0).map((I,G)=>e.jsx(xn,{},G)):b.length>0?b.map(I=>e.jsx(gn,{file:I,formatFileSize:E,mapFileStatus:ee,getStatusDisplayName:se,onOpenModal:de,onDelete:Q},I.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No files found"}),e.jsx("p",{children:"No files match your current search and filter criteria."})]})})})})]})}),!X&&u.length>0&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(h-1)*j+1," to ",Math.min(h*j,u.length)," of ",u.length," files"]}),P>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>v(I=>Math.max(I-1,1)),disabled:h===1,children:"â€¹"}),pe,e.jsx("button",{className:"pagination-btn",onClick:()=>v(I=>Math.min(I+1,P)),disabled:h===P,children:"â€º"})]})]})]}),e.jsx(on,{isOpen:Z,onClose:ue,file:T,onApprove:Ce,onReject:Se,onOpenFile:()=>ye(T),isLoading:X,isOpeningFile:g,formatFileSize:E,mapFileStatus:ee,getStatusDisplayName:se}),e.jsx(Re,{isOpen:U&&M,onClose:()=>B(!1),onConfirm:xe,title:"Deleting File",message:"Are you sure you want to delete this file?",confirmText:"Delete File",variant:"danger",isLoading:X,itemInfo:M?{name:M.original_name||M.filename,details:`Submitted by ${M.username} from ${M.user_team} team`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})})]}):e.jsx(re,{type:"table"})},vn=Me(jn,{componentName:"File Approval"});class yn{constructor(){this.invertedIndex=new Map,this.fileMetadata=new Map,this.keywordBitmasks=new Map,this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}addFile(s,t={}){const i=this.nextFileId++,l={id:i,path:s,name:t.name||this._getFileName(s),size:t.size||0,modified:t.modified||Date.now(),type:t.type||this._getFileType(s),content:t.content||null};return this.fileMetadata.set(i,l),this._extractKeywords(l).forEach(r=>{this.invertedIndex.has(r)||this.invertedIndex.set(r,new Set),this.invertedIndex.get(r).add(i)}),this.stats.totalFiles++,this.stats.lastIndexTime=Date.now(),i}search(s,t={}){const i=this._normalizeQuery(s);if(i.length===0)return[];let l=null;for(const r of i){const d=this._findMatchingIds(r);if(l===null?l=d:l=new Set([...l].filter(f=>d.has(f))),l.size===0)break}const o=l?Array.from(l).map(r=>this.fileMetadata.get(r)):[];return this._applyFilters(o,t)}_findMatchingIds(s){const t=new Set;this.invertedIndex.has(s)&&this.invertedIndex.get(s).forEach(i=>t.add(i));for(const[i,l]of this.invertedIndex.entries())(i.startsWith(s)||i.includes(s))&&l.forEach(o=>t.add(o));return t}_extractKeywords(s){const t=new Set;s.name.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(r=>r.length>1).forEach(r=>t.add(r));const l=s.name.split(".").pop();return l&&l!==s.name&&t.add(l.toLowerCase()),t.add(s.type),s.content&&s.content.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(d=>d.length>2).slice(0,100).forEach(d=>t.add(d)),s.path.toLowerCase().split(/[\/\\]/).filter(r=>r.length>1).forEach(r=>t.add(r)),t}_normalizeQuery(s){return s.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(t=>t.length>0)}_applyFilters(s,t){let i=[...s];if(t.fileTypes&&t.fileTypes.length>0){const l=t.fileTypes.map(o=>o.startsWith(".")?o.slice(1).toLowerCase():o.toLowerCase());i=i.filter(o=>{const r=o.name.split(".").pop().toLowerCase();return l.includes(r)})}return t.minSize!==void 0&&(i=i.filter(l=>l.size>=t.minSize)),t.maxSize!==void 0&&(i=i.filter(l=>l.size<=t.maxSize)),t.modifiedAfter&&(i=i.filter(l=>l.modified>=t.modifiedAfter)),t.modifiedBefore&&(i=i.filter(l=>l.modified<=t.modifiedBefore)),i.sort((l,o)=>o.modified-l.modified),t.limit&&(i=i.slice(0,t.limit)),i}removeFile(s){const t=this.fileMetadata.get(s);return t?(this._extractKeywords(t).forEach(l=>{const o=this.invertedIndex.get(l);o&&(o.delete(s),o.size===0&&this.invertedIndex.delete(l))}),this.fileMetadata.delete(s),this.stats.totalFiles--,!0):!1}clear(){this.invertedIndex.clear(),this.fileMetadata.clear(),this.keywordBitmasks.clear(),this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}getStats(){return{...this.stats,totalKeywords:this.invertedIndex.size,indexSize:this._calculateIndexSize()}}_calculateIndexSize(){let s=0;for(const[t,i]of this.invertedIndex.entries())s+=t.length*2,s+=i.size*8;for(const[,t]of this.fileMetadata.entries())s+=JSON.stringify(t).length*2;return s}_getFileName(s){return s.split(/[\/\\]/).pop()||s}_getFileType(s){const t=s.split(".").pop()?.toLowerCase();return!t||t===s?"file":["pdf","doc","docx","txt","rtf","odt"].includes(t)?"document":["jpg","jpeg","png","gif","bmp","svg","webp"].includes(t)?"image":["mp4","avi","mov","mkv","flv","wmv"].includes(t)?"video":["mp3","wav","flac","aac","ogg","wma"].includes(t)?"audio":["js","jsx","ts","tsx","py","java","cpp","c","cs","php","rb"].includes(t)?"code":["zip","rar","7z","tar","gz"].includes(t)?"archive":"file"}export(){return{fileMetadata:Array.from(this.fileMetadata.entries()),invertedIndex:Array.from(this.invertedIndex.entries()).map(([s,t])=>[s,Array.from(t)]),nextFileId:this.nextFileId,stats:this.stats}}import(s){this.clear(),this.fileMetadata=new Map(s.fileMetadata),this.invertedIndex=new Map(s.invertedIndex.map(([t,i])=>[t,new Set(i)])),this.nextFileId=s.nextFileId,this.stats=s.stats}}class wn{constructor(s=5*60*1e3){this.cache=new Map,this.ttl=s,this.stats={hits:0,misses:0,totalQueries:0},this.maxCacheSize=500,this.accessOrder=new Map}async listDirectory(s,t){this.stats.totalQueries++;const i=this._normalizePath(s),l=this.cache.get(i);if(l&&Date.now()-l.timestamp<this.ttl)return this.stats.hits++,this._updateAccessOrder(i),l.data;this.stats.misses++;try{const o=await t(s);return this._setCache(i,o),o}catch(o){if(l)return console.warn(`Using stale cache for ${s}: ${o.message}`),l.data;throw o}}async prefetchDirectories(s,t){const i=s.map(async l=>{try{const o=this._normalizePath(l);if(!this.cache.has(o)){const r=await t(l);this._setCache(o,r)}}catch(o){console.warn(`Failed to prefetch ${l}:`,o.message)}});await Promise.allSettled(i)}_setCache(s,t){if(this.cache.size>=this.maxCacheSize){const i=this._getOldestKey();i&&(this.cache.delete(i),this.accessOrder.delete(i))}this.cache.set(s,{data:t,timestamp:Date.now()}),this._updateAccessOrder(s)}_updateAccessOrder(s){this.accessOrder.set(s,Date.now())}_getOldestKey(){let s=null,t=1/0;for(const[i,l]of this.accessOrder.entries())l<t&&(t=l,s=i);return s}invalidate(s){const t=this._normalizePath(s);this.cache.delete(t),this.accessOrder.delete(t)}invalidatePrefix(s){const t=this._normalizePath(s),i=[];for(const l of this.cache.keys())l.startsWith(t)&&i.push(l);return i.forEach(l=>{this.cache.delete(l),this.accessOrder.delete(l)}),i.length}clear(){this.cache.clear(),this.accessOrder.clear(),this.stats={hits:0,misses:0,totalQueries:0}}getStats(){const s=this.stats.totalQueries>0?(this.stats.hits/this.stats.totalQueries*100).toFixed(2):0;return{...this.stats,hitRate:`${s}%`,cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,ttlMs:this.ttl}}_normalizePath(s){return s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase()}async warmup(s,t){console.log("Warming up cache with common directories..."),await this.prefetchDirectories(s,t),console.log(`Cache warmed up. Cached ${this.cache.size} directories.`)}getCachedPaths(){return Array.from(this.cache.keys())}isCached(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?!(Date.now()-i.timestamp>=this.ttl):!1}getCacheAge(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?Date.now()-i.timestamp:null}setTTL(s){this.ttl=s}setMaxCacheSize(s){for(this.maxCacheSize=s;this.cache.size>s;){const t=this._getOldestKey();t&&(this.cache.delete(t),this.accessOrder.delete(t))}}export(){return{cache:Array.from(this.cache.entries()),accessOrder:Array.from(this.accessOrder.entries()),stats:this.stats,ttl:this.ttl,maxCacheSize:this.maxCacheSize}}import(s){this.cache=new Map(s.cache),this.accessOrder=new Map(s.accessOrder),this.stats=s.stats,this.ttl=s.ttl,this.maxCacheSize=s.maxCacheSize}}class mt{constructor(){this.allowedDirectories=this.loadAllowedDirectories(),this.blacklistedPaths=this.loadBlacklistedPaths(),this.permissionCache=new Map,this.cacheTimeout=5*60*1e3}async checkDirectoryAccess(s){if(!s)throw new Error("Directory path is required");const t=this._normalizePath(s),i=this.permissionCache.get(t);if(i&&Date.now()-i.timestamp<this.cacheTimeout){if(!i.allowed)throw new Error(`Directory access denied: ${s}`);return!0}if(!this.isDirectoryAllowed(t))throw this._cachePermission(t,!1),new Error(`Directory access denied: ${s}`);if(this.isBlacklisted(t))throw this._cachePermission(t,!1),new Error(`Directory is blacklisted: ${s}`);return this._cachePermission(t,!0),!0}async checkFileEditAccess(s){if(!s)throw new Error("File path is required");const t=this._getDirectoryPath(s);if(await this.checkDirectoryAccess(t),!this.isSafeFileExtension(s))throw new Error(`File type not allowed for editing: ${s}`);return!0}isDirectoryAllowed(s){const t=this._normalizePath(s);return this.allowedDirectories.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isBlacklisted(s){const t=this._normalizePath(s);return this.blacklistedPaths.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isSafeFileExtension(s){const t=[".exe",".bat",".cmd",".sh",".bin",".dll",".sys",".com",".scr",".vbs",".ps1",".app",".deb",".rpm"],i=this._getFileExtension(s).toLowerCase();return!t.includes(i)}loadAllowedDirectories(){return[`${this._getHomeDirectory()}`,"/"].filter(t=>t)}loadBlacklistedPaths(){const s=this._getHomeDirectory();return["C:\\Windows","C:\\Program Files","C:\\Program Files (x86)","C:\\ProgramData","/System","/etc","/root","/boot","/proc","/sys","/dev","/var/log",`${s}/.ssh`,`${s}/.aws`,`${s}/.gnupg`,`${s}/AppData/Local`,`${s}/AppData/Roaming`,`${s}/Library/Keychains`,".git",".svn",".hg","node_modules"].filter(t=>t)}addAllowedDirectory(s){const t=this._normalizePath(s);return this.allowedDirectories.includes(t)?!1:(this.allowedDirectories.push(t),this.permissionCache.clear(),!0)}removeAllowedDirectory(s){const t=this._normalizePath(s),i=this.allowedDirectories.indexOf(t);return i!==-1?(this.allowedDirectories.splice(i,1),this.permissionCache.clear(),!0):!1}addBlacklistedPath(s){const t=this._normalizePath(s);return this.blacklistedPaths.includes(t)?!1:(this.blacklistedPaths.push(t),this.permissionCache.clear(),!0)}getAllowedDirectories(){return[...this.allowedDirectories]}getBlacklistedPaths(){return[...this.blacklistedPaths]}clearCache(){this.permissionCache.clear()}_cachePermission(s,t){this.permissionCache.set(s,{allowed:t,timestamp:Date.now()})}_normalizePath(s){return s?s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase():""}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_getFileExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.substring(t):""}_getHomeDirectory(){return typeof process>"u"||!{}?"":{}.HOME||{}.USERPROFILE||{}.HOMEPATH||""}getCacheStats(){return{cacheSize:this.permissionCache.size,cacheTimeout:this.cacheTimeout}}export(){return{allowedDirectories:this.allowedDirectories,blacklistedPaths:this.blacklistedPaths}}import(s){s.allowedDirectories&&(this.allowedDirectories=s.allowedDirectories),s.blacklistedPaths&&(this.blacklistedPaths=s.blacklistedPaths),this.permissionCache.clear()}}class Nn{constructor(s,t=null){this.apiBase=s||"http://localhost:3001",this.directoryManager=t||new mt,this.maxFileSize=50*1024*1024}async readFile(s,t={}){try{const i=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(i);const l=t.maxSize||this.maxFileSize,o=await fetch(`${this.apiBase}/api/file-system/read-file?path=${encodeURIComponent(s)}&maxSize=${l}`);if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.message||`Failed to read file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to read file");return{success:!0,content:r.content,size:r.size,encoding:r.encoding||t.encoding||"utf-8",path:s}}catch(i){throw console.error("Error reading file:",i),new Error(`Failed to read file: ${i.message}`)}}async editFile(s,t,i={}){try{if(await this.directoryManager.checkFileEditAccess(s),i.validate&&typeof i.validate=="function")try{i.validate(t)}catch(d){throw new Error(`Content validation failed: ${d.message}`)}let l=null;if(i.backup)try{l=await this.createBackup(s)}catch(d){if(console.warn("Failed to create backup:",d),i.requireBackup)throw new Error(`Backup required but failed: ${d.message}`)}const o=await fetch(`${this.apiBase}/api/file-system/write-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s,content:t,encoding:i.encoding||"utf-8",backup:i.backup||!1})});if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.message||`Failed to write file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to write file");return{success:!0,path:s,backupPath:l||r.backupPath,bytesWritten:t.length}}catch(l){throw console.error("Error editing file:",l),new Error(`Failed to edit file: ${l.message}`)}}async createBackup(s){try{const t=new Date().toISOString().replace(/[:.]/g,"-"),i=`${s}.backup.${t}`,l=await fetch(`${this.apiBase}/api/file-system/backup-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:s,backupPath:i})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Backup failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Backup failed");return o.backupPath||i}catch(t){throw new Error(`Failed to create backup: ${t.message}`)}}async deleteFile(s,t={}){try{await this.directoryManager.checkFileEditAccess(s);let i=null;t.backup&&(i=await this.createBackup(s));const l=await fetch(`${this.apiBase}/api/file-system/delete-file`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Delete failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Delete failed");return{success:!0,path:s,backupPath:i}}catch(i){throw new Error(`Failed to delete file: ${i.message}`)}}async renameFile(s,t){try{await this.directoryManager.checkFileEditAccess(s);const i=this._getDirectoryPath(t);await this.directoryManager.checkDirectoryAccess(i);const l=await fetch(`${this.apiBase}/api/file-system/rename-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPath:s,newPath:t})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Rename failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Rename failed");return{success:!0,oldPath:s,newPath:t}}catch(i){throw new Error(`Failed to rename file: ${i.message}`)}}async getFileInfo(s){try{const t=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(t);const i=await fetch(`${this.apiBase}/api/file-system/file-info?path=${encodeURIComponent(s)}`);if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||"Failed to get file info")}const l=await i.json();if(!l.success)throw new Error(l.message||"Failed to get file info");return{success:!0,...l.info}}catch(t){throw new Error(`Failed to get file info: ${t.message}`)}}async fileExists(s){try{return(await this.getFileInfo(s)).success}catch{return!1}}async validateFileSize(s,t=null){const i=await this.getFileInfo(s),l=t||this.maxFileSize;if(i.size>l)throw new Error(`File too large: ${this._formatBytes(i.size)} (max: ${this._formatBytes(l)})`);return!0}setMaxFileSize(s){this.maxFileSize=s}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_formatBytes(s,t=2){if(s===0)return"0 Bytes";const i=1024,l=t<0?0:t,o=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(s)/Math.log(i));return parseFloat((s/Math.pow(i,r)).toFixed(l))+" "+o[r]}export(){return{apiBase:this.apiBase,maxFileSize:this.maxFileSize,directoryConfig:this.directoryManager.export()}}}class bn{constructor(s){this.apiBase=s||"http://localhost:3001",this.bitmaskIndex=new yn,this.fsCache=new wn(5*60*1e3),this.directoryManager=new mt,this.fileEditor=new Nn(this.apiBase,this.directoryManager),this.isIndexing=!1,this.indexProgress=0,this.lastIndexTime=null,this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0},this.queryCache=new Map,this.queryCacheSize=100,this.queryCacheTTL=2*60*1e3}async initialize(){console.log("ðŸš€ Initializing FastSearchEngine...");try{this._startBackgroundIndexing(),console.log("âœ… FastSearchEngine initialized")}catch(s){console.error("âŒ Failed to initialize FastSearchEngine:",s)}}async searchFiles(s,t={}){const i=performance.now();this.searchStats.totalSearches++;try{const l=this._getQueryCacheKey(s,t),o=this._getFromQueryCache(l);if(o)return console.log("âš¡ Cache hit for query:",s),o;t.directory&&await this.directoryManager.checkDirectoryAccess(t.directory);let r;const d=this.bitmaskIndex.getStats().totalFiles>100;d&&!t.forceAPISearch?(r=await this._indexedSearch(s,t),this.searchStats.indexedSearches++):(r=await this._apiSearch(s,t),this.searchStats.fallbackSearches++),t.checkPermissions!==!1&&(r.files=r.files.filter(C=>{const w=this._getDirectoryPath(C.path);return this.directoryManager.isDirectoryAllowed(w)}));const f=performance.now()-i;this._updateSearchStats(f);const x={...r,searchTime:f,indexed:d,cached:!1};return this._addToQueryCache(l,x),x}catch(l){throw console.error("Search error:",l),new Error(`Search failed: ${l.message}`)}}async _indexedSearch(s,t){console.log("ðŸ” Using indexed search for:",s);const i=this.bitmaskIndex.search(s,{fileTypes:t.fileTypes,minSize:t.minSize,maxSize:t.maxSize,modifiedAfter:t.modifiedAfter,modifiedBefore:t.modifiedBefore,limit:t.limit||1e3});return{success:!0,files:i.map(l=>({id:`file-${l.id}`,name:l.name,displayName:l.name,path:l.path,type:l.type==="folder"?"folder":"file",fileType:l.type,size:l.size,modified:l.modified,parentPath:this._getDirectoryPath(l.path)})),total:i.length,query:s}}async _apiSearch(s,t){console.log("ðŸŒ Using API search for:",s);const i=t.directory||"/",l=`${this.apiBase}/api/file-system/search?query=${encodeURIComponent(s)}&path=${encodeURIComponent(i)}`,o=await fetch(l);if(!o.ok)throw new Error(`API search failed: ${o.statusText}`);const r=await o.json();if(!r.success)throw new Error(r.message||"API search failed");return r.results&&r.results.length>0&&this._indexSearchResults(r.results),{success:!0,files:r.results||[],total:r.results?.length||0,query:s}}async listDirectory(s,t={}){try{return await this.directoryManager.checkDirectoryAccess(s),{success:!0,items:(await this.fsCache.listDirectory(s,async o=>{const d=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(o)}`)).json();if(!d.success)throw new Error(d.message||"Failed to list directory");return d.items&&d.items.length>0&&this._indexSearchResults(d.items),d.items||[]})).filter(o=>{const r=o.type==="folder"?o.path:this._getDirectoryPath(o.path);return this.directoryManager.isDirectoryAllowed(r)}),path:s}}catch(i){throw new Error(`Failed to list directory: ${i.message}`)}}async readFileContent(s,t={}){return await this.fileEditor.readFile(s,t)}async updateFileContent(s,t,i={}){const l=await this.fileEditor.editFile(s,t,i);return this._invalidateCachesForPath(s),l}async deleteFile(s,t={}){const i=await this.fileEditor.deleteFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),i}async renameFile(s,t){const i=await this.fileEditor.renameFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),this._invalidateCachesForPath(t),i}async _startBackgroundIndexing(){if(!this.isIndexing){this.isIndexing=!0,console.log("ðŸ“‡ Starting background indexing...");try{const t=this.directoryManager.getAllowedDirectories().slice(0,5);await this.fsCache.warmup(t,async i=>{try{const o=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(i)}`)).json();return o.success?o.items||[]:[]}catch(l){return console.warn(`Failed to prefetch ${i}:`,l.message),[]}}),this.lastIndexTime=Date.now(),console.log("âœ… Background indexing complete")}catch(s){console.error("âŒ Background indexing failed:",s)}finally{this.isIndexing=!1}}}_indexSearchResults(s){s.forEach(t=>{this.bitmaskIndex.addFile(t.path,{name:t.name||t.displayName,size:t.size||0,modified:t.modified||Date.now(),type:t.fileType||t.type||"file"})})}_removeFromIndex(s){const t=Array.from(this.bitmaskIndex.fileMetadata.values()).find(i=>i.path===s);t&&this.bitmaskIndex.removeFile(t.id)}_invalidateCachesForPath(s){const t=this._getDirectoryPath(s);this.fsCache.invalidate(t),this.queryCache.clear()}_getQueryCacheKey(s,t){return JSON.stringify({query:s.toLowerCase(),options:t})}_getFromQueryCache(s){const t=this.queryCache.get(s);return t?Date.now()-t.timestamp>this.queryCacheTTL?(this.queryCache.delete(s),null):{...t.data,cached:!0}:null}_addToQueryCache(s,t){if(this.queryCache.size>=this.queryCacheSize){const i=this.queryCache.keys().next().value;this.queryCache.delete(i)}this.queryCache.set(s,{data:t,timestamp:Date.now()})}_updateSearchStats(s){const t=this.searchStats.totalSearches,i=this.searchStats.avgSearchTime;this.searchStats.avgSearchTime=(i*(t-1)+s)/t}getStats(){return{search:this.searchStats,index:this.bitmaskIndex.getStats(),cache:this.fsCache.getStats(),security:{allowedDirectories:this.directoryManager.getAllowedDirectories().length,blacklistedPaths:this.directoryManager.getBlacklistedPaths().length},queryCache:{size:this.queryCache.size,maxSize:this.queryCacheSize}}}clearAll(){this.bitmaskIndex.clear(),this.fsCache.clear(),this.queryCache.clear(),this.directoryManager.clearCache(),this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0}}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):"/"}export(){return{index:this.bitmaskIndex.export(),cache:this.fsCache.export(),directoryConfig:this.directoryManager.export(),stats:this.searchStats,lastIndexTime:this.lastIndexTime}}import(s){s.index&&this.bitmaskIndex.import(s.index),s.cache&&this.fsCache.import(s.cache),s.directoryConfig&&this.directoryManager.import(s.directoryConfig),s.stats&&(this.searchStats=s.stats),s.lastIndexTime&&(this.lastIndexTime=s.lastIndexTime)}}const is="http://localhost:3001",kn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Le();const{isConnected:o}=$e(),[r,d]=n.useState("/"),[f,x]=n.useState([]),[C,w]=n.useState([]),[c,S]=n.useState(""),[_,L]=n.useState(!1),[p,h]=n.useState(null),[v,j]=n.useState(!1),[T,z]=n.useState(!1),[Z,H]=n.useState(null),[U]=n.useState(()=>new bn(is)),[B,M]=n.useState(null),[K,X]=n.useState(null),O=n.useRef(null),g=n.useRef(null),F=300,V=n.useRef(null);n.useEffect(()=>{U.initialize();const E=setInterval(()=>{X(U.getStats())},5e3);return()=>clearInterval(E)},[U]),n.useEffect(()=>{if(s||t){const E=setTimeout(()=>{a()},3e3);return()=>clearTimeout(E)}},[s,t,a]),n.useEffect(()=>{o&&W()},[o]),n.useEffect(()=>{o&&J()},[r,o]),n.useEffect(()=>(V.current&&clearTimeout(V.current),c.trim()===""?(w(f),L(!1),M(null)):(L(!0),V.current=setTimeout(()=>{D(c)},300)),()=>{V.current&&clearTimeout(V.current)}),[c]),n.useEffect(()=>{c.trim()===""&&w(f)},[f]),n.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]);const W=async()=>{try{const ee=await(await fetch(`${is}/api/file-system/info`)).json();H(ee),ee.accessible||i("Network projects directory is not accessible.")}catch(E){console.error("Error checking network access:",E),i("Failed to check network directory access: "+E.message),H({accessible:!1,message:"Connection failed"})}},J=async()=>{j(!0),a();try{const E=await U.listDirectory(r);if(E.success)x(E.items),w(E.items);else throw new Error("Failed to load directory")}catch(E){console.error("Error fetching file system items:",E),i(E.message||"Failed to load directory contents"),x([]),w([])}finally{j(!1)}},D=async E=>{if(!E||E.trim()===""){w(f),L(!1);return}L(!0),a();try{const ee=performance.now(),se=await U.searchFiles(E,{directory:r,recursive:!0,checkPermissions:!0,limit:500}),Q=performance.now()-ee;M({time:Q,indexed:se.indexed,cached:se.cached,resultCount:se.files.length,query:E}),w(se.files),Q<100&&se.files.length>0&&l(`âš¡ Found ${se.files.length} results in ${Q.toFixed(0)}ms ${se.cached?"(cached)":se.indexed?"(indexed)":""}`)}catch(ee){if(console.error("Search error:",ee),ee.message.includes("permission denied")||ee.message.includes("access denied"))i(`Access denied: ${ee.message}`);else{console.log("Falling back to local search");const se=f.filter(Q=>Q.displayName.toLowerCase().includes(E.toLowerCase()));w(se)}}finally{L(!1)}},N=E=>{d(E),S(""),h(null),M(null)},m=E=>{O.current&&clearTimeout(O.current),g.current===E.id?(g.current=null,b(E)):(g.current=E.id,u(E),O.current=setTimeout(()=>{g.current=null},F))},u=E=>{p===E.id?h(null):h(E.id)},b=async E=>{if(E.type==="folder")N(E.path);else{z(!0),l(`Opening ${E.displayName}...`);try{if(await new Promise(se=>setTimeout(se,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const Q=await(await fetch(`${is}/api/file-system/filepath?path=${encodeURIComponent(E.path)}`)).json();if(!Q.success)throw new Error(Q.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",Q.fullPath),console.log("ðŸ“„ File type:",Q.fileType);const de=await window.electron.openFileInApp(Q.fullPath);if(de.success)console.log("âœ… Opened with Windows default application"),l(`Opened ${E.displayName}`);else throw new Error(de.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const se=`${is}/api/file-system/file?path=${encodeURIComponent(E.path)}`,Q=window.open(se,"_blank");if(!Q)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");Q.focus(),console.log("âœ… Opened in browser tab"),l(`Opened ${E.displayName} in browser`)}}catch(ee){console.error("âŒ Error opening file:",ee),i(`Error opening file: ${ee.message||"Failed to open file"}`)}finally{z(!1)}}},P=()=>{if(r==="/")return[{name:"PROJECTS",path:"/"}];const E=r.split("/").filter(Q=>Q),ee=[{name:"PROJECTS",path:"/"}];let se="";return E.forEach(Q=>{se+=`/${Q}`,ee.push({name:Q.length>20?Q.substring(0,20)+"...":Q,path:se,fullName:Q})}),ee};return o?e.jsxs("div",{className:`file-management-section ${T?"file-opening-cursor":""}`,children:[Z&&e.jsxs("div",{className:`network-status ${Z.accessible?"accessible":"not-accessible"}`,children:[e.jsx("span",{className:"status-text",children:Z.accessible?"Network directory accessible":"Network directory not accessible"}),e.jsx("span",{className:"network-path",children:Z.path||"\\\\KMTI-NAS\\Shared\\Public\\PROJECTS"})]}),e.jsxs("div",{className:"file-nav-controls",children:[e.jsx("div",{className:"breadcrumb-container",children:e.jsx("nav",{className:"breadcrumb",children:P().map((E,ee)=>e.jsxs("span",{className:"breadcrumb-item",children:[ee>0&&e.jsx("span",{className:"breadcrumb-separator",children:"/"}),e.jsx("button",{className:`breadcrumb-link ${ee===P().length-1?"active":""}`,onClick:()=>N(E.path),disabled:ee===P().length-1,title:E.fullName||E.name,children:E.name})]},E.path))})}),e.jsx("div",{className:"file-controls-right",children:e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:c,onChange:E=>S(E.target.value),className:"search-input"}),c&&e.jsx("button",{className:"search-clear-btn",onClick:()=>S(""),title:"Clear search",children:"Ã—"})]})})]}),B&&e.jsxs("div",{className:"search-performance-bar",children:[e.jsxs("span",{className:"perf-badge",children:["âš¡ ",B.time.toFixed(0),"ms"]}),e.jsx("span",{className:"perf-badge",children:B.cached?"ðŸ’¾ Cached":B.indexed?"ðŸ“‡ Indexed":"ðŸŒ API"}),e.jsxs("span",{className:"perf-badge",children:["ðŸ“Š ",B.resultCount," results"]}),K&&e.jsxs("span",{className:"perf-badge",title:"Cache statistics",children:["ðŸ’¿ ",K.cache.cacheSize," dirs cached (",K.cache.hitRate," hit rate)"]})]}),s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsx("div",{className:"file-system-container",children:v||_?e.jsx(re,{type:"grid"}):e.jsxs(e.Fragment,{children:[T&&e.jsx("div",{className:"component-loading-overlay",children:e.jsx(re,{type:"grid"})}),e.jsx("div",{className:`files-content ${T?"loading":""}`,children:e.jsx("div",{className:"files-grid",children:C.length===0&&c?e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['No files found for "',c,'"']}),e.jsx("p",{className:"no-results-hint",children:"Try a different search term or check your spelling"})]}):C.map(E=>e.jsxs("div",{className:`file-item ${E.type} ${p===E.id?"selected":""}`,onClick:()=>m(E),title:`${E.name}
1st click: Select
2nd click: Open`,children:[e.jsx("div",{className:"file-icon",children:e.jsx(Ge,{fileType:E.fileType,isFolder:E.type==="folder",altText:E.type,className:"file-icon-img"})}),e.jsxs("div",{className:"file-info",children:[e.jsx("div",{className:"file-name",title:E.name,children:E.displayName}),E.parentPath&&c&&e.jsxs("div",{className:"file-location",title:E.parentPath,children:["ðŸ“ ",E.parentPath]})]})]},E.id))})})]})})]}):e.jsx(re,{type:"table"})},Cn=Me(kn,{componentName:"File Management"});const Sn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,users:o,user:r})=>{Le();const{isConnected:d}=$e(),[f,x]=n.useState(!1),[C,w]=n.useState([]),[c,S]=n.useState(!1),[_,L]=n.useState({name:"",leaderId:"",leaderUsername:""}),[p,h]=n.useState(null),[v,j]=n.useState({isOpen:!1,teamId:null,teamName:""}),[T,z]=n.useState({fileManagement:{rootDirectory:""},general:{timezone:"UTC",dateFormat:"ISO",language:"en-US"}}),[Z,H]=n.useState(!0),U=(m,u,b)=>{z(P=>({...P,[m]:{...P[m],[u]:b}}))},B=async()=>{H(!0);try{const u=await(await fetch("http://localhost:3001/api/settings/root_directory")).json();u.success&&u.setting&&z(b=>({...b,fileManagement:{...b.fileManagement,rootDirectory:u.setting.value||"/home/admin/files"}}))}catch(m){console.error("Failed to fetch settings:",m),i("Failed to load settings")}finally{H(!1)}},M=async()=>{a();try{if(console.log("Browse button clicked"),console.log("window.electron available:",!!window.electron),console.log("window.electron.openDirectoryDialog available:",!!(window.electron&&window.electron.openDirectoryDialog)),window.electron&&window.electron.openDirectoryDialog){console.log("Opening Electron directory dialog...");const m=await window.electron.openDirectoryDialog();if(console.log("Dialog result:",m),!m.canceled&&m.filePaths&&m.filePaths.length>0){const u=m.filePaths[0];console.log("Selected path:",u),z(b=>({...b,fileManagement:{...b.fileManagement,rootDirectory:u}})),l(`Selected directory: ${u}`)}else console.log("Dialog was canceled")}else console.warn("Electron API not available"),i("Folder browser is only available in the desktop application. Please enter the path manually or run the Electron app.")}catch(m){console.error("Error browsing directory:",m),i("Failed to open directory browser: "+m.message)}},K=async()=>{if(!T.fileManagement.rootDirectory.trim()){i("Root directory path is required");return}x(!0);try{const u=await(await fetch("http://localhost:3001/api/settings/root_directory",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:T.fileManagement.rootDirectory,updated_by:r?.username||"admin"})})).json();u.success?l("New directory settings saved successfully"):i(u.message||"Failed to save file directory settings")}catch(m){console.error("Error saving settings:",m),i("Failed to save file directory settings")}finally{x(!1)}};n.useEffect(()=>{d&&(X(),B())},[d]);const X=async()=>{S(!0);try{const u=await(await fetch("http://localhost:3001/api/teams")).json();u.success?w(u.teams||[]):i("Failed to fetch teams")}catch{i("Failed to fetch teams")}finally{S(!1)}},O=async()=>{if(!_.name.trim()){i("Team name is required");return}x(!0);try{const u=await(await fetch("http://localhost:3001/api/teams",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:_.name,leaderId:_.leaderId,leaderUsername:_.leaderUsername})})).json();u.success?(l("Team created successfully"),L({name:"",leaderId:"",leaderUsername:""}),X()):i(u.message||"Failed to create team")}catch{i("Failed to create team")}finally{x(!1)}},g=async()=>{if(!p||!p.name.trim()){i("Team name is required");return}x(!0);try{const u=await(await fetch(`http://localhost:3001/api/teams/${p.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:p.name,leaderId:p.leader_id,leaderUsername:p.leader_username,isActive:p.is_active})})).json();u.success?(l("Team updated successfully"),h(null),X()):i(u.message||"Failed to update team")}catch{i("Failed to update team")}finally{x(!1)}},F=(m,u)=>{j({isOpen:!0,teamId:m,teamName:u})},V=async()=>{const{teamId:m,teamName:u}=v;x(!0);try{const P=await(await fetch(`http://localhost:3001/api/teams/${m}`,{method:"DELETE"})).json();P.success?(l(`Team '${u}' deleted successfully`),X()):i(P.message||"Failed to delete team")}catch{i("Failed to delete team")}finally{x(!1),j({isOpen:!1,teamId:null,teamName:""})}},W=()=>{j({isOpen:!1,teamId:null,teamName:""})},J=m=>h({...m}),D=()=>h(null),N=()=>o?.filter(m=>m.role==="TEAM LEADER"||m.role==="ADMIN")||[];return d?e.jsxs("div",{className:`settings-section ${f?"loading-cursor":""}`,children:[s&&e.jsx(fe,{type:"error",message:s,onClose:a}),t&&e.jsx(fe,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"settings-grid",children:[e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"File Management"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Root Directory Path"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{type:"text",value:T.fileManagement.rootDirectory,onChange:m=>U("fileManagement","rootDirectory",m.target.value),placeholder:"/home/admin/files",className:"form-input",disabled:Z}),e.jsx("button",{className:"btn btn-secondary",onClick:M,disabled:f||Z,title:"Browse for folder (Desktop app only)",children:"Browse"}),e.jsx("button",{className:"btn btn-primary",onClick:K,disabled:f||Z,children:f?"Saving...":"Save"})]}),e.jsx("p",{className:"help-text",children:"Base directory for files"})]})})]}),e.jsxs("div",{className:"settings-card team-management-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"Team Management"})}),e.jsxs("div",{className:"settings-card-body",children:[e.jsxs("div",{className:"team-section",children:[e.jsx("h4",{children:"Create New Team"}),e.jsxs("div",{className:"team-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Name"}),e.jsx("input",{type:"text",value:_.name,onChange:m=>L(u=>({...u,name:m.target.value})),placeholder:"Enter team name",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Leader"}),e.jsxs("select",{value:_.leaderId,onChange:m=>{const u=N().find(b=>b.id==m.target.value);L(b=>({...b,leaderId:m.target.value,leaderUsername:u?u.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),N().map(m=>e.jsxs("option",{value:m.id,children:[m.fullName," (",m.username,") - ",m.role]},m.id))]})]}),e.jsx("button",{className:"btn btn-primary",id:"create-team-btn",onClick:O,disabled:f||!_.name.trim(),children:f?"Creating...":"Create Team"})]})]}),e.jsxs("div",{className:"team-section",children:[e.jsxs("h4",{children:["Existing Teams (",C.length,")"]}),c?e.jsx("div",{className:"loading-state",children:"Loading teams..."}):C.length===0?e.jsx("div",{className:"empty-state",children:"No teams found"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"teams-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Team Name"}),e.jsx("th",{children:"Leader"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map(m=>e.jsx("tr",{children:p&&p.id===m.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:p.name,onChange:u=>h(b=>({...b,name:u.target.value})),className:"form-input"})}),e.jsx("td",{children:e.jsxs("select",{value:p.leader_id||"",onChange:u=>{const b=N().find(P=>P.id==u.target.value);h(P=>({...P,leader_id:u.target.value,leader_username:b?b.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),N().map(u=>e.jsxs("option",{value:u.id,children:[u.fullName," (",u.username,")"]},u.id))]})}),e.jsx("td",{children:e.jsxs("select",{value:p.is_active,onChange:u=>h(b=>({...b,is_active:u.target.value==="true"})),className:"form-select",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:g,disabled:f,children:f?"Saving...":"Save"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:D,children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:m.name}),e.jsx("td",{children:m.leader_username||"No leader assigned"}),e.jsx("td",{children:e.jsx("span",{className:`status ${m.is_active?"active":"inactive"}`,children:m.is_active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>J(m),children:"Edit"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>F(m.id,m.name),children:"Delete"})]})})]})},m.id))})]})})]})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"System Information"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"system-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Application Version:"}),e.jsx("span",{className:"info-value",children:"v2.1.0"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Database Version:"}),e.jsx("span",{className:"info-value",children:"MySQL"})]})]})})]})]}),e.jsx(Re,{isOpen:v.isOpen,onClose:W,onConfirm:V,title:"Delete Team",message:"Are you sure you want to delete this team?",confirmText:"Delete Team",variant:"danger",isLoading:f,itemInfo:v.teamName?{name:v.teamName,details:"All team members will be unassigned"}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The team will be permanently removed from the system."})})]}):e.jsx(re,{type:"admin"})},_n=Me(Sn,{componentName:"Settings"});const Fn=({error:a,success:s,setError:t,setSuccess:i,clearMessages:l,user:o,contextAssignmentId:r})=>{Le(),$e();const[d,f]=n.useState([]),[x,C]=n.useState(!0),[w,c]=n.useState(!1),[S,_]=n.useState({}),[L,p]=n.useState(!1),[h,v]=n.useState(null),[j,T]=n.useState([]),[z,Z]=n.useState(!1),[H,U]=n.useState(""),[B,M]=n.useState(null),[K,X]=n.useState(""),[O,g]=n.useState({}),[F,V]=n.useState(!1),[W,J]=n.useState(!1),[D,N]=n.useState(null),[m,u]=n.useState(!1),[b,P]=n.useState(null),[E,ee]=n.useState({}),[se,Q]=n.useState(null),[de,ue]=n.useState(!0),xe=n.useRef(null),ye=n.useRef(null);n.useEffect(()=>{Ce()},[]),n.useEffect(()=>{if(r&&typeof r=="object"){const{assignmentId:y,commentId:$,shouldOpenComments:te}=r;if(y&&te){const ne=d.find(le=>le.id===y);ne&&(I(ne),$&&setTimeout(()=>{const le=document.querySelector(`[data-comment-id="${$}"]`);le&&(le.scrollIntoView({behavior:"smooth",block:"center"}),le.classList.add("highlight-comment"),setTimeout(()=>{le.classList.remove("highlight-comment")},2e3))},500))}}},[r,d]),n.useEffect(()=>{if(x||w||!de)return;const y={root:null,rootMargin:"100px",threshold:.1};return xe.current=new IntersectionObserver($=>{$[0].isIntersecting&&de&&!w&&(console.log("Intersection detected, loading more..."),Se())},y),ye.current&&xe.current.observe(ye.current),()=>{xe.current&&xe.current.disconnect()}},[x,w,de,se]),n.useEffect(()=>{const y=$=>{b&&!$.target.closest(".admin-card-menu")&&P(null)};return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[b]);const Ce=async()=>{try{C(!0),l(),console.log("Fetching initial assignments...");const $=await(await fetch("http://localhost:3001/api/assignments/admin/all?limit=20")).json();if(console.log("Initial assignments response:",$),!$.success){t($.message||"Failed to fetch assignments"),C(!1);return}const te=$.assignments||[];console.log(`Fetched ${te.length} initial assignments`),f(te),Q($.nextCursor),ue($.hasMore)}catch(y){console.error("Error fetching assignments:",y),t("Failed to load assignments")}finally{C(!1)}},Se=n.useCallback(async()=>{if(w||!de||!se){console.log("Skipping fetch:",{loadingMore:w,hasMore:de,nextCursor:se});return}try{c(!0),console.log("Fetching more assignments with cursor:",se);const $=await(await fetch(`http://localhost:3001/api/assignments/admin/all?cursor=${se}&limit=20`)).json();if(console.log("More assignments response:",$),!$.success){t($.message||"Failed to fetch more assignments");return}const te=$.assignments||[];console.log(`Fetched ${te.length} more assignments`),f(ne=>[...ne,...te]),Q($.nextCursor),ue($.hasMore)}catch(y){console.error("Error fetching more assignments:",y),t("Failed to load more assignments")}finally{c(!1)}},[se,de,w]),pe=n.useCallback(async y=>{try{Z(!0);const te=await(await fetch(`http://localhost:3001/api/assignments/${y}/comments`)).json();te.success?T(te.comments||[]):t(te.message||"Failed to load comments. Please try again.")}catch($){console.error("Error fetching comments:",$),t("Failed to load comments")}finally{Z(!1)}},[t]),I=n.useCallback(y=>{v(y),p(!0),pe(y.id)},[pe]),G=n.useCallback(()=>{p(!1),v(null),T([]),U(""),M(null),X("")},[]),q=n.useCallback(async y=>{if(y.preventDefault(),!!H.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const $=o,te=H,ne={id:`temp-${Date.now()}`,comment:te,user_id:$.id,username:$.username,user_fullname:$.fullName,user_role:$.role,created_at:new Date().toISOString(),replies:[]};T(be=>[...be,ne]),U("");const Ne=await(await fetch(`http://localhost:3001/api/assignments/${h.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:$.id,username:$.username,comment:te})})).json();Ne.success?(await pe(h.id),i("Comment posted successfully"),setTimeout(()=>i(""),3e3)):(T(be=>be.filter(_e=>_e.id!==ne.id)),U(te),t(Ne.message||"Failed to post comment"))}catch($){console.error("Error posting comment:",$),t("Failed to post comment")}},[H,o,h,pe,t,i]),ce=n.useCallback(async(y,$)=>{if(y.preventDefault(),!!K.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const te=o,ne=K,le={id:`temp-${Date.now()}`,reply:ne,user_id:te.id,username:te.username,user_fullname:te.fullName,user_role:te.role,created_at:new Date().toISOString()};T(_e=>_e.map(ve=>ve.id===$?{...ve,replies:[...ve.replies||[],le]}:ve)),X(""),M(null);const be=await(await fetch(`http://localhost:3001/api/assignments/${h.id}/comments/${$}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:te.id,username:te.username,reply:ne})})).json();be.success?(await pe(h.id),i("Reply posted successfully"),setTimeout(()=>i(""),3e3)):(T(_e=>_e.map(ve=>ve.id===$?{...ve,replies:(ve.replies||[]).filter(ps=>ps.id!==le.id)}:ve)),X(ne),M($),t(be.message||"Failed to post reply"))}catch(te){console.error("Error posting reply:",te),t("Failed to post reply")}},[K,o,h,pe,t,i]),k=y=>{_($=>({...$,[y]:!$[y]}))},Y=y=>{ee($=>({...$,[y]:!$[y]}))},ae=n.useCallback(y=>y?y.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2):"?",[]),ge=y=>y?new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No due date",je=y=>{if(!y)return"";const ne=new Date(y)-new Date,le=Math.ceil(ne/(1e3*60*60*24));return le<0?`${Math.abs(le)} days overdue`:le===0?"Due today":le===1?"1 day left":`${le} days left`},cs=y=>y?new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown",ds=n.useCallback(y=>{if(!y)return"Unknown";const $=new Date(y),ne=Math.floor((new Date-$)/1e3);return ne<60?"Just now":ne<3600?`${Math.floor(ne/60)}m ago`:ne<86400?`${Math.floor(ne/3600)}h ago`:ne<604800?`${Math.floor(ne/86400)}d ago`:$.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[]),hs=y=>{if(!y)return"#95a5a6";const $=new Date(y),ne=Math.ceil(($-new Date)/(1e3*60*60*24));return ne<0?"#e74c3c":ne<=2?"#f39c12":"#27ae60"},ms=n.useCallback(y=>{g($=>({...$,[y]:!$[y]}))},[]),us=async(y,$)=>{if(!y){t("File path not available");return}try{if(V(!0),l(),i("Opening file..."),await new Promise(ne=>setTimeout(ne,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const le=await(await fetch(`http://localhost:3001/api/files/${$}/path`)).json();if(!le.success)throw new Error(le.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",le.filePath),console.log("ðŸ“„ File name:",le.fileName);const Ne=await window.electron.openFileInApp(le.filePath);if(Ne.success)console.log("âœ… Opened with Windows default application"),i("File opened successfully");else throw new Error(Ne.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const ne=`http://localhost:3001${y}`,le=window.open(ne,"_blank");if(!le)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");le.focus(),console.log("âœ… Opened in browser tab"),i("File opened in browser")}}catch(te){console.error("âŒ Error opening file:",te),i(""),t(`Error opening file: File deleted/rejected or ${te.message||"Failed to open file"}`)}finally{V(!1)}},Ee=async()=>{if(D)try{u(!0),l(),i("Deleting assignment and associated files...");const $=await(await fetch(`http://localhost:3001/api/assignments/${D.id}`,{method:"DELETE"})).json();$.success?(f(te=>te.filter(ne=>ne.id!==D.id)),i("Assignment and associated files deleted successfully"),setTimeout(()=>i(""),3e3),J(!1),N(null)):t($.message||"Failed to delete assignment")}catch(y){console.error("Error deleting assignment:",y),t("Failed to delete assignment")}finally{u(!1)}},Be=()=>{J(!1),N(null)};return x?e.jsx("div",{className:"task-management-container",children:e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsx("div",{className:"task-count",children:"Loading..."}),e.jsx("div",{className:"feed-container",children:e.jsx("div",{className:"loading-skeleton",children:[1,2,3].map(y=>e.jsxs("div",{className:"skeleton-assignment-card",children:[e.jsxs("div",{className:"skeleton-card-header",children:[e.jsxs("div",{className:"skeleton-header-left",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-header-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]}),e.jsx("div",{className:"skeleton-header-right",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]}),e.jsx("div",{className:"skeleton-title-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-title"})}),e.jsxs("div",{className:"skeleton-description-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-medium"})]}),e.jsxs("div",{className:"skeleton-attachment-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-small"}),e.jsxs("div",{className:"skeleton-file-item",children:[e.jsx("div",{className:"skeleton-file-icon"}),e.jsxs("div",{className:"skeleton-file-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]})]}),e.jsx("div",{className:"skeleton-comments-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]},y))})})]})}):e.jsxs("div",{className:`task-management-container ${F?"file-opening-cursor":""}`,children:[a&&e.jsx(fe,{type:"error",message:a,onClose:l}),s&&e.jsx(fe,{type:"success",message:s,onClose:l}),e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsxs("div",{className:"task-count",children:[d.length," task",d.length!==1?"s":"",de&&" â€¢ Scroll for more"]}),e.jsx("div",{className:"feed-container",children:d.length===0?e.jsxs("div",{className:"empty-feed",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“­"}),e.jsx("h3",{children:"No Tasks Yet"}),e.jsx("p",{children:"Team leaders haven't created any assignments yet."})]}):e.jsxs(e.Fragment,{children:[d.map(y=>e.jsxs("div",{className:"admin-assignment-card",children:[e.jsxs("div",{className:"admin-card-header",children:[e.jsxs("div",{className:"admin-header-left",children:[e.jsx("div",{className:"admin-avatar",children:ae(y.team_leader_fullname||y.team_leader_username)}),e.jsxs("div",{className:"admin-header-info",children:[e.jsxs("div",{className:"admin-assignment-assigned",children:[e.jsx("span",{className:"admin-team-leader-name",children:y.team_leader_fullname||y.team_leader_username}),e.jsx("span",{className:"role-badge team-leader",children:"TEAM LEADER"}),"assigned to"," ",e.jsx("span",{className:"admin-assigned-user",children:y.assigned_member_details&&y.assigned_member_details.length>0?y.assigned_member_details.length===1?y.assigned_member_details[0].fullName||y.assigned_member_details[0].username:`${y.assigned_member_details.length} members (${y.assigned_member_details.map($=>$.fullName||$.username).join(", ")})`:y.assigned_to==="all"?"All team members":"Unknown User"})]}),e.jsx("div",{className:"admin-assignment-created",children:y.created_at?cs(y.created_at):"Unknown creation date"})]})]}),e.jsxs("div",{className:"admin-header-right",children:[e.jsxs("div",{className:"admin-card-menu",children:[e.jsx("button",{className:"admin-menu-btn",onClick:()=>P(b===y.id?null:y.id),title:"More options",children:"â‹®"}),b===y.id&&e.jsx("div",{className:"admin-menu-dropdown",children:e.jsx("button",{className:"admin-menu-item admin-delete-menu-item",onClick:()=>{N(y),J(!0),P(null)},children:"Delete"})})]}),y.due_date&&e.jsxs("div",{className:"admin-due-date",children:["Due: ",ge(y.due_date),e.jsxs("span",{className:"admin-days-left",style:{color:hs(y.due_date)},children:[" ","(",je(y.due_date),")"]})]})]})]}),e.jsx("div",{className:"admin-task-title-section",children:e.jsx("h3",{className:"admin-assignment-title",children:y.title})}),y.description&&e.jsx("div",{className:"admin-task-description-section",children:e.jsxs("p",{className:"admin-assignment-description",children:[S[y.id]?y.description:y.description.length>200?`${y.description.substring(0,200)}...`:y.description,y.description.length>200&&e.jsx("button",{className:"admin-expand-btn",onClick:()=>k(y.id),children:S[y.id]?"Show less":"Show more"})]})}),e.jsx("div",{className:"admin-attachment-section",children:y.recent_submissions&&y.recent_submissions.length>0?e.jsxs("div",{className:"admin-attached-file",children:[e.jsxs("div",{className:"admin-file-label",children:["ðŸ“Ž Attachment",y.recent_submissions.length>1?"s":""," (",y.recent_submissions.length,"):"]}),(E[y.id]?y.recent_submissions:y.recent_submissions.slice(0,5)).map(($,te)=>e.jsxs("div",{className:"admin-file-item",onClick:()=>us($.file_path,$.id),style:{cursor:"pointer",marginBottom:te<(E[y.id]?y.recent_submissions.length:Math.min(5,y.recent_submissions.length))-1?"8px":"0"},children:[e.jsx(Ge,{fileType:$.original_name.split(".").pop(),size:"small",className:"admin-file-icon"}),e.jsxs("div",{className:"admin-file-details",children:[e.jsx("div",{className:"admin-file-name",children:$.original_name}),e.jsxs("div",{className:"admin-file-meta",children:["Submitted by ",e.jsx("span",{className:"admin-file-submitter",children:$.fullName||$.username})," on ",ge($.submitted_at),$.tag&&e.jsxs("span",{style:{backgroundColor:"#dbeafe",color:"#1e40af",padding:"4px 10px",borderRadius:"12px",fontSize:"11px",fontWeight:"600",border:"1px solid #93c5fd",display:"inline-flex",alignItems:"center",gap:"4px",marginLeft:"8px"},children:["ðŸ·ï¸ ",$.tag]})]})]})]},$.id)),y.recent_submissions.length>5&&e.jsx("button",{className:"admin-attachment-toggle-btn",onClick:()=>Y(y.id),children:E[y.id]?"See less":`See more (${y.recent_submissions.length-5} more)`})]}):e.jsxs("div",{className:"admin-no-attachment",children:[e.jsx("span",{className:"admin-no-attachment-icon",children:"ðŸ“„"}),e.jsx("span",{className:"admin-no-attachment-text",children:"No attachments yet"})]})}),e.jsx("div",{className:"admin-comments-section",children:e.jsxs("div",{className:"admin-comments-text",onClick:()=>I(y),children:["Comments (",y.comment_count||0,")"]})})]},y.id)),w&&e.jsx("div",{className:"inline-skeleton-container",children:[1,2].map(y=>e.jsxs("div",{className:"skeleton-card",children:[e.jsxs("div",{className:"skeleton-header",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-text",children:[e.jsx("div",{className:"skeleton-line skeleton-line-short"}),e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})]})]}),e.jsxs("div",{className:"skeleton-body",children:[e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line skeleton-line-short"})]})]},y))}),de&&!w&&e.jsx("div",{ref:ye,style:{height:"20px",margin:"20px 0"}})]})}),e.jsx(dt,{isOpen:L,onClose:G,assignment:h,comments:j,loadingComments:z,newComment:H,setNewComment:U,onPostComment:q,replyingTo:B,setReplyingTo:M,replyText:K,setReplyText:X,onPostReply:ce,visibleReplies:O,toggleRepliesVisibility:ms,getInitials:ae,formatTimeAgo:ds,user:o}),e.jsx(Re,{isOpen:W,onClose:Be,onConfirm:Ee,title:"Delete Task",message:"Are you sure you want to delete this task?",confirmText:"Delete Task",cancelText:"Cancel",variant:"danger",isLoading:m,itemInfo:D?{name:D.title,details:`${D.comment_count||0} comment${(D.comment_count||0)!==1?"s":""} â€¢ ${D.recent_submissions?.length||0} submission${(D.recent_submissions?.length||0)!==1?"s":""}`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The task and all associated comments will be permanently removed from the system."})})]})]})},Tn=Me(Fn,{componentName:"Task Management"});const ut=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-title",children:a.title}),e.jsx("div",{className:"notification-message",children:a.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsxs("span",{className:"notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));ut.displayName="NotificationItem";const Mn=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,d]=n.useState(!1),[f,x]=n.useState(""),[C,w]=n.useState(0),[c,S]=n.useState(!1),[_,L]=n.useState(!1);st(C);const[p,h]=n.useState(1),[v,j]=n.useState(!0),[T,z]=n.useState(0),Z=20,H=n.useRef(null),U=n.useRef(null),[B,M]=n.useState(null);n.useEffect(()=>{K(1,!0);const N=setInterval(()=>{K(1,!0,!0)},3e4);return()=>clearInterval(N)},[a.id]),n.useEffect(()=>{if(l||r||!v)return;const N={root:null,rootMargin:"100px",threshold:.1};return H.current=new IntersectionObserver(m=>{m[0].isIntersecting&&v&&!r&&K(p+1,!1)},N),U.current&&H.current.observe(U.current),()=>{H.current&&H.current.disconnect()}},[l,r,v,p]);const K=async(N,m=!1,u=!1)=>{try{m&&!u?o(!0):u||d(!0);const P=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${N}&limit=${Z}`)).json();if(P.success){const E=P.notifications||[];if(m)i(E),h(1);else if(u){const ee=new Set(t.map(Q=>Q.id)),se=E.filter(Q=>!ee.has(Q.id));se.length>0&&i([...se,...t])}else i(ee=>[...ee,...E]),h(N);w(P.unreadCount||0),z(P.totalCount||0),j(P.hasMore||!1)}else x("Failed to fetch notifications")}catch(b){console.error("Error fetching notifications:",b),u||x("Failed to fetch notifications")}finally{m&&!u?o(!1):u||d(!1)}},X=async N=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${N}/read`,{method:"PUT"})).json()).success&&(i(b=>b.map(P=>P.id===N?{...P,is_read:!0}:P)),w(b=>Math.max(0,b-1)))}catch(m){console.error("Error marking notification as read:",m)}},O=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(u=>u.map(b=>({...b,is_read:!0}))),w(0))}catch(N){console.error("Error marking all as read:",N)}},g=async N=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${N}`,{method:"DELETE"})).json()).success){const b=t.find(P=>P.id===N);i(P=>P.filter(E=>E.id!==N)),z(P=>P-1),b&&!b.is_read&&w(P=>Math.max(0,P-1))}}catch(m){console.error("Error deleting notification:",m)}},F=async()=>{L(!0);try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),w(0),z(0),j(!1),S(!1))}catch(N){console.error("Error deleting all notifications:",N),x("Failed to delete all notifications")}finally{L(!1)}},V=N=>{if(N.is_read||X(N.id),console.log("ðŸ“‹ Notification clicked:",N),N.type==="password_reset_request"){s&&N.file_id&&(console.log("ðŸ”‘ Password reset request - Navigating to User Management"),s("users",{userId:N.file_id,action:"reset-password",username:N.action_by_username}));return}N.type==="comment"?N.assignment_id&&(N.comment_id&&M(N.comment_id),s&&s("tasks",{assignmentId:N.assignment_id,commentId:N.comment_id,shouldOpenComments:!0})):N.assignment_id?s&&s("tasks",N.assignment_id):N.file_id&&(N.type==="approval"||N.type==="rejection"?s&&s("file-approval",N.file_id):s&&s("file-management",N.file_id))},W=({type:N})=>e.jsx(Ge,{fileType:N,size:"medium",altText:`${N} notification icon`,className:"notification-type-icon"}),J=n.useCallback(N=>{const m=new Date,u=new Date(N),b=Math.floor((m-u)/1e3);return b<60?`${b}s ago`:b<3600?`${Math.floor(b/60)}m ago`:b<86400?`${Math.floor(b/3600)}h ago`:b<604800?`${Math.floor(b/86400)}d ago`:u.toLocaleDateString()},[]),D=()=>e.jsx("div",{className:"notification-skeleton",children:[1,2,3,4,5].map(N=>e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"}),e.jsx("div",{className:"skeleton-line skeleton-line-meta"})]})]},N))});return l?e.jsxs("div",{className:"notifications-page",children:[e.jsx("div",{className:"notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(D,{})]}):e.jsxs("div",{className:`notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"notifications-actions",children:[C>0&&e.jsx("button",{className:"btn-mark-all-read",onClick:O,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"btn-delete-all",onClick:()=>S(!0),children:"Delete All"})]})]}),f&&e.jsx("div",{className:"error-message",children:f}),e.jsxs("div",{className:"notifications-stats",children:[T," total â€¢ ",C," unread"]}),t.length===0?e.jsxs("div",{className:"no-notifications",children:[e.jsx("div",{className:"no-notifications-icon",children:"ðŸ””"}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notifications-list",children:t.map(N=>e.jsx(ut,{notification:N,onNotificationClick:V,onDeleteNotification:g,NotificationIcon:W,formatTimeAgo:J},N.id))}),r&&e.jsxs("div",{className:"notifications-loading-more",children:[e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]}),e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]})]}),v&&!r&&e.jsx("div",{ref:U,className:"load-more-trigger"}),!v&&t.length>=Z&&e.jsx("div",{className:"end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]}),c&&e.jsx(Re,{isOpen:c,onClose:()=>S(!1),onConfirm:F,title:"Delete All Notifications",message:"Are you sure you want to delete all notifications?",confirmText:"Delete All",cancelText:"Cancel",variant:"danger",isLoading:_,itemInfo:{name:`${T} notification${T!==1?"s":""}`,details:`Including ${C} unread notification${C!==1?"s":""}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})})]})},En=Me(Mn,{componentName:"Notifications"});const An=({notifications:a,onClose:s,onNavigate:t})=>{const[i,l]=n.useState([]),[o,r]=n.useState(new Set),d=tt({duration:8e3});n.useEffect(()=>{const c=a.filter(S=>!S.is_read&&!o.has(S.id)).slice(0,3);if(l(c),c.length>0){const S=c.length===1?c[0].title:`${c.length} New Notifications`;d(S)}if(c.length>0){const S=c.map(_=>setTimeout(()=>{f(_.id)},8e3));return()=>S.forEach(_=>clearTimeout(_))}},[a,o]);const f=c=>{r(S=>new Set([...S,c])),l(S=>S.filter(_=>_.id!==c))},x=c=>{console.log("ðŸ‘‰ Admin Toast clicked:",c),t&&(c.type==="password_reset_request"&&c.file_id?(console.log("ðŸ”‘ Password reset request - Navigating to User Management"),t("users",{userId:c.file_id,action:"reset-password",username:c.action_by_username})):c.assignment_id?(console.log("ðŸ“‹ Navigating to tasks:",c.assignment_id),t("tasks",c.assignment_id)):c.file_id?c.type==="approval"||c.type==="rejection"||c.type==="final_approval"||c.type==="final_rejection"?(console.log("âœ… Navigating to file-approval:",c.file_id),t("file-approval",c.file_id)):(console.log("ðŸ“ Navigating to file-management:",c.file_id),t("file-management",c.file_id)):console.log("âš ï¸ No specific target for notification")),f(c.id)},C=c=>{switch(c){case"password_reset_request":return"ðŸ”‘";case"comment":return"ðŸ’¬";case"assignment":return"ðŸ“‹";case"approval":return"âœ…";case"rejection":return"âŒ";case"final_approval":return"ðŸŽ‰";case"final_rejection":return"ðŸš«";default:return"ðŸ””"}},w=c=>{switch(c){case"password_reset_request":return"gray";case"comment":return"blue";case"assignment":return"purple";case"approval":case"final_approval":return"green";case"rejection":case"final_rejection":return"red";default:return"gray"}};return i.length===0?null:e.jsx("div",{className:"toast-container cursor-pointer",children:i.map((c,S)=>e.jsxs("div",{className:`toast-notification toast-${w(c.type)}`,style:{animationDelay:`${S*100}ms`},onClick:()=>x(c),children:[e.jsx("div",{className:"toast-icon",children:C(c.type)}),e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-title",children:c.title}),e.jsx("div",{className:"toast-message",children:c.message}),e.jsxs("div",{className:"toast-meta",children:[e.jsxs("span",{children:["ðŸ‘¤ ",c.action_by_username]}),c.assignment_title&&e.jsxs("span",{children:["ðŸ“‹ ",c.assignment_title]})]})]}),e.jsx("button",{className:"toast-close",onClick:_=>{_.stopPropagation(),f(c.id)},children:"âœ•"})]},c.id))})},Dn=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,d]=n.useState(""),[f,x]=n.useState(""),[C,w]=n.useState([]),[c,S]=n.useState(0),[_,L]=n.useState(null),[p,h]=n.useState(!1),v=n.useRef(null),j=n.useRef(null);n.useEffect(()=>{Rs({targets:v.current,opacity:[0,1],duration:300,easing:"easeOutCubic"}),Rs({targets:j.current,opacity:[0,1],duration:300,delay:100,easing:"easeOutCubic"})},[]),n.useEffect(()=>{T(),z();const O=setInterval(z,1e4);return()=>clearInterval(O)},[]);const T=async()=>{try{const g=await(await fetch("http://localhost:3001/api/users")).json();g.success&&o(g.users)}catch(O){console.error("Error fetching users:",O)}},z=async()=>{try{const g=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();g.success&&(w(g.notifications||[]),S(g.unreadCount||0))}catch(O){console.error("Error fetching notifications:",O)}},Z=()=>{s()},H=()=>{d(""),x("")},U=(O,g=null)=>{i(O),L(g),H()},B=(O,g)=>{if(console.log("ðŸ”” Admin Navigation triggered:",{tabName:O,contextData:g}),p&&h(!1),i(O),L(g),H(),g){const F=document.querySelector(".content-area");F&&(F.scrollTop=0),g.action==="reset-password"&&console.log("ðŸ”‘ Password reset context:",g)}},M=()=>{h(!p)},K=()=>{h(!1)},X=()=>{const O={clearMessages:H,error:r,success:f,setError:d,setSuccess:x};switch(t){case"dashboard":return e.jsx(Qs,{user:a,users:l});case"users":return e.jsx(dn,{...O,user:a,contextData:_});case"activity-logs":return e.jsx(fn,{...O});case"file-approval":return e.jsx(vn,{...O,contextFileId:_});case"file-management":return e.jsx(Cn,{...O,contextFileId:_});case"tasks":return e.jsx(Tn,{...O,user:a,contextAssignmentId:_});case"notifications":return e.jsx(En,{user:a,onNavigate:B});case"settings":return e.jsx(_n,{...O,users:l,user:a});default:return e.jsx(Qs,{user:a,users:l})}};return e.jsx(Xa,{initialUser:a,children:e.jsx(sn,{children:e.jsx(an,{userId:a?.id,children:e.jsx(n.Suspense,{fallback:e.jsx(re,{type:"admin"}),children:e.jsxs("div",{className:"minimal-admin-dashboard",children:[e.jsx("button",{className:`burger-menu-btn ${p?"active":""}`,onClick:M,"aria-label":"Toggle sidebar menu",children:e.jsxs("div",{className:"burger-menu-icon",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{className:`sidebar-overlay ${p?"active":""}`,onClick:K}),e.jsxs("div",{className:`admin-sidebar ${p?"open":""}`,ref:v,children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"admin-info",children:[e.jsx("div",{className:"admin-name",children:a.fullName||"Admin User"}),e.jsx("div",{className:"admin-role",children:a.role||"Administrator"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${t==="dashboard"?"active":""}`,onClick:()=>{U("dashboard"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${t==="notifications"?"active":""}`,onClick:()=>{U("notifications"),K()},children:[e.jsxs("span",{className:"nav-icon nav-icon-with-badge",children:[me("notifications"),c>0&&e.jsx("span",{className:"sidebar-notification-badge",children:c>99?"99+":c})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${t==="file-management"?"active":""}`,onClick:()=>{U("file-management"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("files")}),e.jsx("span",{className:"nav-label",children:"Files"})]}),e.jsxs("button",{className:`nav-item ${t==="users"?"active":""}`,onClick:()=>{U("users"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("users")}),e.jsx("span",{className:"nav-label",children:"Users"})]}),e.jsxs("button",{className:`nav-item ${t==="activity-logs"?"active":""}`,onClick:()=>{U("activity-logs"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("activityLogs")}),e.jsx("span",{className:"nav-label",children:"Activity Logs"})]}),e.jsxs("button",{className:`nav-item ${t==="file-approval"?"active":""}`,onClick:()=>{U("file-approval"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("fileApproval")}),e.jsx("span",{className:"nav-label",children:"File Approval"})]}),e.jsxs("button",{className:`nav-item ${t==="tasks"?"active":""}`,onClick:()=>{U("tasks"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${t==="settings"?"active":""}`,onClick:()=>{U("settings"),K()},children:[e.jsx("span",{className:"nav-icon",children:me("settings")}),e.jsx("span",{className:"nav-label",children:"Settings"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{onClick:Z,className:"logout-btn",children:[e.jsx("span",{className:"nav-icon",children:me("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]}),e.jsx("div",{className:"admin-main-content",ref:j,children:e.jsx("div",{className:"content-area",children:X()})}),e.jsx(An,{notifications:C,onNavigate:B})]})})})})})};var In={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ln=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$n=(a,s)=>{const t=n.forwardRef(({color:i="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:r,children:d,...f},x)=>n.createElement("svg",{ref:x,...In,width:l,height:l,stroke:i,strokeWidth:r?Number(o)*24/Number(l):o,className:`lucide lucide-${Ln(a)}`,...f},[...s.map(([C,w])=>n.createElement(C,w)),...(Array.isArray(d)?d:[d])||[]]));return t.displayName=`${a}`,t};var rs=$n;const Gs=rs("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Pn=rs("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Rn=rs("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Bn=rs("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),zn=({id:a,type:s,title:t,message:i,duration:l=5e3,onClose:o,action:r})=>{const[d,f]=n.useState(!0),[x,C]=n.useState(!1);n.useEffect(()=>{if(l>0){const _=setTimeout(()=>{w()},l);return()=>clearTimeout(_)}},[l]);const w=()=>{C(!0),setTimeout(()=>{f(!1),o(a)},300)},c=()=>{switch(s){case"success":return e.jsx(Pn,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(Gs,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(Gs,{className:"w-5 h-5 text-yellow-500"});case"info":default:return e.jsx(Rn,{className:"w-5 h-5 text-blue-500"})}},S=()=>{switch(s){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":default:return"bg-blue-50 border-blue-200"}};return d?e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-sm w-full animate-slide-in ${x?"animate-slide-out":""}`,style:{animation:x?"slideOut 0.3s ease-in forwards":"slideIn 0.3s ease-out"},children:e.jsx("div",{className:`${S()} border rounded-lg shadow-lg p-4`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:c()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:t}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:i}),r&&e.jsx("button",{onClick:r.onClick,className:"mt-2 px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors",children:r.label})]}),e.jsx("button",{onClick:w,className:"flex-shrink-0 p-1 hover:bg-gray-200 rounded transition-colors",children:e.jsx(Bn,{className:"w-4 h-4 text-gray-500"})})]})})}):null};const On=({version:a,onInstall:s,onClose:t})=>e.jsx("div",{className:"update-alert-overlay",children:e.jsxs("div",{className:"update-alert-modal",children:[e.jsx(Fs,{type:"success",message:`Update ${a} has been downloaded and is ready to install. The application will restart to apply the update.`,onClose:t}),e.jsxs("div",{className:"update-alert-buttons",children:[e.jsx("button",{onClick:s,className:"update-install-btn",children:"Install & Restart"}),e.jsx("button",{onClick:t,className:"update-cancel-btn",children:"Cancel"})]})]})}),Un=()=>{const[a,s]=n.useState([]),[t,i]=n.useState(null),l=n.useCallback(x=>{const C=Date.now()+Math.random(),w={id:C,...x};return s(c=>[...c,w]),C},[]),o=n.useCallback(x=>{s(C=>C.filter(w=>w.id!==x))},[]),r=n.useCallback(()=>{window.updater&&window.updater.restartAndInstall(),i(null)},[]),d=n.useCallback(()=>{i(null)},[]),f=n.useCallback((x,C)=>{switch(x){case"available":l({type:"info",title:"Update Available",message:`Version ${C.version} is available for download.`,duration:1e4});break;case"downloading":break;case"downloaded":i({version:C.version});break;case"error":l({type:"error",title:"Update Failed",message:C.message||"Failed to check for updates.",duration:8e3,action:{label:"Retry",onClick:()=>{window.updater&&window.updater.checkForUpdates()}}});break}},[l]);return Ke.useEffect(()=>{if(window.updater)return window.updater.onStatus(C=>{f(C.status,C)})},[f]),Ke.useEffect(()=>(window.toastContainer={addToast:l,showUpdateToast:f},()=>{delete window.toastContainer}),[l,f]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 z-50 pointer-events-none",children:a.map((x,C)=>e.jsx("div",{className:"pointer-events-auto mb-2",style:{transform:`translateY(${C*10}px)`,zIndex:50+C},children:e.jsx(zn,{...x,onClose:o})},x.id))}),t&&e.jsx(On,{version:t.version,onInstall:r,onClose:d})]})},Ae=Xs("App");function Vn(){const[a,s]=n.useState(()=>{const o=localStorage.getItem("user");if(o)try{const r=JSON.parse(o);return Ae.info("User session restored from localStorage"),r}catch(r){return Ae.error("Error parsing saved user",r),localStorage.removeItem("user"),null}return null}),t=o=>{Ae.logLogin(o),s(o),localStorage.setItem("user",JSON.stringify(o)),Ae.logStateUpdate("User authenticated and saved")},i=()=>{Ae.logLogout(),s(null),localStorage.removeItem("user")},l=()=>{if(!a)return null;switch(Ae.logNavigation("login",`${a.panelType}-dashboard`),a.panelType){case"user":return e.jsx(Js,{user:a,onLogout:i});case"teamleader":return e.jsx(Za,{user:a,onLogout:i});case"admin":return e.jsx(Dn,{user:a,onLogout:i});default:return Ae.warn("Unknown panel type, defaulting to user dashboard",{panelType:a.panelType}),e.jsx(Js,{user:a,onLogout:i})}};return e.jsx(Bt,{children:e.jsxs("div",{className:"app",children:[e.jsx(Un,{}),e.jsxs(zt,{children:[e.jsx(ws,{path:"/login",element:a?e.jsx(Ns,{to:"/dashboard",replace:!0}):e.jsx(Xt,{onLogin:t})}),e.jsx(ws,{path:"/dashboard",element:a?l():e.jsx(Ns,{to:"/login",replace:!0})}),e.jsx(ws,{path:"/",element:e.jsx(Ns,{to:a?"/dashboard":"/login",replace:!0})})]})]})})}class Hn extends Ke.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){console.error("ErrorBoundary caught an error:",s,t),this.setState({error:s,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{style:De.container,children:e.jsxs("div",{style:De.card,children:[e.jsx("h1",{style:De.title,children:"âš ï¸ Oops! Something went wrong"}),e.jsx("p",{style:De.message,children:"The application encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{style:De.buttonGroup,children:[e.jsx("button",{onClick:this.handleReset,style:De.primaryButton,children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),style:De.secondaryButton,children:"Reload Page"})]}),!1]})}):this.props.children}}const De={container:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#f5f5f5",padding:"20px"},card:{backgroundColor:"white",borderRadius:"8px",padding:"40px",maxWidth:"600px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center"},title:{fontSize:"24px",marginBottom:"16px",color:"#333"},message:{fontSize:"16px",color:"#666",marginBottom:"24px",lineHeight:"1.5"},buttonGroup:{display:"flex",gap:"12px",justifyContent:"center",marginBottom:"24px"},primaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s"},secondaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#fff",color:"#333",border:"2px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},details:{marginTop:"24px",textAlign:"left"},summary:{cursor:"pointer",padding:"12px",backgroundColor:"#f9f9f9",borderRadius:"4px",fontWeight:"600"},errorDetails:{marginTop:"12px",padding:"16px",backgroundColor:"#fff5f5",borderRadius:"4px",border:"1px solid #ffcccb"},errorMessage:{marginBottom:"12px",color:"#d32f2f"},errorStack:{fontSize:"12px",color:"#666",overflow:"auto",maxHeight:"200px",whiteSpace:"pre-wrap",wordWrap:"break-word"}};typeof window<"u"&&(window.React=Ke);const pt=document.getElementById("root");if(!pt)throw new Error("Failed to find the root element");const Wn=_s.createRoot(pt);Wn.render(e.jsx(Hn,{children:e.jsx(Vn,{})}));console.log("âœ… React application initialized successfully");export{Ra as A,Re as C,Ge as F,qs as L,Gn as N,Pa as S,Qn as a,za as g,e as j,st as u};
