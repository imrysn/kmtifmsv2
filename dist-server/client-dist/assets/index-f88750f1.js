import{r as n,a as $t,b as Ss}from"./react-vendor-a308f804.js";import{H as Pt,R as Rt,a as vs,N as ys}from"./router-vendor-90630356.js";import{a as $s}from"./anime-vendor-37453147.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}})();var Qs={exports:{}},as={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bt=n,zt=Symbol.for("react.element"),Ot=Symbol.for("react.fragment"),Ut=Object.prototype.hasOwnProperty,Vt=Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ht={key:!0,ref:!0,__self:!0,__source:!0};function Gs(a,s,t){var i,l={},o=null,r=null;t!==void 0&&(o=""+t),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(r=s.ref);for(i in s)Ut.call(s,i)&&!Ht.hasOwnProperty(i)&&(l[i]=s[i]);if(a&&a.defaultProps)for(i in s=a.defaultProps,s)l[i]===void 0&&(l[i]=s[i]);return{$$typeof:zt,type:a,key:o,ref:r,props:l,_owner:Vt.current}}as.Fragment=Ot;as.jsx=Gs;as.jsxs=Gs;Qs.exports=as;var e=Qs.exports,Cs={},Ps=$t;Cs.createRoot=Ps.createRoot,Cs.hydrateRoot=Ps.hydrateRoot;const Wt=!1,qt=["password","token","secret","apiKey","api_key","accessToken","refreshToken","privateKey","sessionId","sessionToken"],Kt=["email","username","phone","address","ssn","creditCard","bankAccount"];function ts(a,s=!Wt){if(!a||typeof a!="object")return a;if(Array.isArray(a))return a.map(i=>ts(i,s));const t={};for(const[i,l]of Object.entries(a)){const o=i.toLowerCase();if(qt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}if(s&&Kt.some(r=>o.includes(r))){t[i]="***REDACTED***";continue}l&&typeof l=="object"?t[i]=ts(l,s):t[i]=l}return t}function Jt(a){return a?{id:a.id,role:a.role||a.panelType,team:a.team,username:`${a.username?.[0]}***`,email:"***@***.***",timestamp:new Date().toISOString()}:null}class Qt{constructor(s="App"){this.component=s}log(s,t=null){}info(s,t=null){const i=t?ts(t):null;console.info(`â„¹ï¸ [${this.component}] ${s}`,i||"")}warn(s,t=null){const i=t?ts(t):null;console.warn(`âš ï¸ [${this.component}] ${s}`,i||"")}error(s,t=null){const i=t?{message:t.message,name:t.name,stack:void 0}:null;console.error(`âŒ [${this.component}] ${s}`,i||"")}logLogin(s){const t=Jt(s);this.info("User logged in",t)}logLogout(){this.info("User logged out")}logStateUpdate(s){this.log(`State updated: ${s}`)}logNavigation(s,t){this.log(`Navigation: ${s} â†’ ${t}`)}debug(s,t=null){}logPerformance(s,t){console.log(`âš¡ [${this.component}] ${s} took ${t}ms`)}}function Ys(a){return new Qt(a)}const Gt=""+new URL("kmti_logo-e782f075.png",import.meta.url).href,Rs=Ys("Login"),ke={EMAIL:"kmt_login_email",PASSWORD:"kmt_login_password",REMEMBER:"kmt_remember_me"},Yt=({onLogin:a})=>{const[s,t]=n.useState("user"),[i,l]=n.useState({email:"",password:""}),[o,r]=n.useState({}),[c,y]=n.useState(!1),[g,S]=n.useState(""),[N,T]=n.useState(!1),[L,m]=n.useState(!1),[M,p]=n.useState(""),[u,f]=n.useState(!1),[C,k]=n.useState(!1),[z,Y]=n.useState("");n.useEffect(()=>{if(localStorage.getItem(ke.REMEMBER)==="true"){const J=localStorage.getItem(ke.EMAIL)||"",ee=localStorage.getItem(ke.PASSWORD)||"";l({email:J,password:ee}),m(!0)}},[]);const U=()=>{t(s==="user"?"admin":"user"),l({email:"",password:""}),r({}),S("")},B=I=>{const J=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,ee=/^[a-zA-Z0-9._-]+$/;return I.includes("@")?J.test(I):ee.test(I)&&I.length>=3&&I.length<=30},P=()=>{const I={};return i.email.trim()?B(i.email)||(i.email.includes("@")?I.email="Please enter a valid email address":I.email="Username must be 3-30 characters and contain only letters, numbers, dots, underscores, or hyphens"):I.email="Username or email is required",i.password.trim()||(I.password="Password is required"),r(I),Object.keys(I).length===0},E=()=>{k(!0),Y("")},H=async()=>{if(z.trim()){f(!0),p("");try{const J=await(await fetch("http://localhost:3001/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:z.trim()})})).json();J.success?(p("Password reset instructions have been sent to Admin (Contact him for your new password)."),k(!1)):p(J.message||"Failed to send reset email.")}catch(I){Rs.error("Forgot password failed",I),p("Unable to connect to server. Please try again.")}finally{f(!1)}}},X=()=>{k(!1),Y(""),p("")},O=I=>{const{name:J,value:ee}=I.target;l(te=>({...te,[J]:ee})),o[J]&&r(te=>({...te,[J]:""})),g&&S("")},W=async I=>{if(I.preventDefault(),!!P()){y(!0),S("");try{const ee=await(await fetch("http://localhost:3001/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...i,loginType:s})})).json();ee.success?(L?(localStorage.setItem(ke.EMAIL,i.email),localStorage.setItem(ke.PASSWORD,i.password),localStorage.setItem(ke.REMEMBER,"true")):(localStorage.removeItem(ke.EMAIL),localStorage.removeItem(ke.PASSWORD),localStorage.removeItem(ke.REMEMBER)),setTimeout(()=>{a(ee.user)},200)):S(ee.message||"Login failed")}catch(J){Rs.error("Login failed",J),S("Unable to connect to server. Please try again.")}finally{y(!1)}}};return e.jsxs("div",{className:"unified-login-container",children:[e.jsxs("div",{className:"main-login-card",children:[e.jsx("div",{className:"welcome-section",children:e.jsxs("div",{className:"welcome-content",children:[e.jsx("div",{className:"logo-container",children:e.jsx("img",{src:Gt,alt:"KMTI Logo",className:"login-logo"})}),e.jsx("div",{className:"system-name",children:e.jsx("p",{children:"File Management System"})})]})}),e.jsx("div",{className:"login-section",children:e.jsxs("div",{className:"login-form-container",children:[e.jsx("div",{className:"login-header",children:e.jsx("h2",{children:"Sign in"})}),e.jsx("div",{className:"login-toggle",children:e.jsx("button",{type:"button",className:`toggle-switch ${s}`,onClick:U,"aria-label":`Switch to ${s==="user"?"Admin":"User"} login`,children:e.jsx("span",{className:"toggle-slider"})})}),e.jsxs("form",{onSubmit:W,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{type:"text",id:"email",name:"email",value:i.email,onChange:O,className:o.email?"error":"",disabled:c,placeholder:"User Name"}),o.email&&e.jsx("span",{className:"error-message",children:o.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"password-input-container",children:[e.jsx("input",{type:N?"text":"password",id:"password",name:"password",value:i.password,onChange:O,className:o.password?"error":"",disabled:c,placeholder:"Password"}),e.jsx("button",{type:"button",className:"show-password-btn",onClick:()=>T(!N),children:"SHOW"})]}),o.password&&e.jsx("span",{className:"error-message",children:o.password})]}),e.jsxs("div",{className:"form-options",children:[e.jsxs("label",{className:"remember-me",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:I=>m(I.target.checked)}),e.jsx("span",{className:"checkmark"}),"Remember me"]}),e.jsx("button",{type:"button",className:"forgot-password",onClick:E,disabled:u||c,children:u?"Sending...":"Forgot Password?"})]}),g&&e.jsx("div",{className:"api-error",children:g}),M&&e.jsx("div",{className:"api-error",style:{backgroundColor:"#DCFCE7",color:"#166534",borderColor:"#BBF7D0"},children:M}),e.jsx("button",{type:"submit",className:`login-button ${s} ${c?"loading":""}`,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),e.jsx("span",{children:"Signing In..."})]}):"Sign in"})]})]})})]}),C&&e.jsx("div",{className:"modal-overlay",onClick:X,children:e.jsxs("div",{className:"modal-content",onClick:I=>I.stopPropagation(),children:[e.jsx("h3",{children:"Reset Password"}),e.jsx("p",{children:"Enter your email address or username to receive password reset instructions."}),e.jsx("input",{type:"text",value:z,onChange:I=>Y(I.target.value),placeholder:"Email or Username",disabled:u}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:X,disabled:u,className:"cancel-button",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:!z.trim()||u,className:"submit-button",children:u?"Sending...":"Send Reset Password"})]})]})})]})},Zt="modulepreload",Xt=function(a,s){return new URL(a,s).href},Bs={},he=function(s,t,i){if(!t||t.length===0)return s();const l=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=Xt(o,i),o in Bs)return;Bs[o]=!0;const r=o.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!i)for(let S=l.length-1;S>=0;S--){const N=l[S];if(N.href===o&&(!r||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const g=document.createElement("link");if(g.rel=r?"stylesheet":Zt,r||(g.as="script",g.crossOrigin=""),g.href=o,document.head.appendChild(g),r)return new Promise((S,N)=>{g.addEventListener("load",S),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>s()).catch(o=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o})};const ce=({type:a="dashboard"})=>{switch(a){case"dashboard":return e.jsx(zs,{});case"admin":return e.jsx(ea,{});case"teamleader":return e.jsx(sa,{});case"myfiles":return e.jsx(ta,{});case"table":return e.jsx(aa,{});case"card":return e.jsx(na,{});case"grid":return e.jsx(ia,{});default:return e.jsx(zs,{})}},zs=()=>e.jsxs("div",{className:"skeleton-container",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"20px"}}),[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a))]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]},a))}),e.jsxs("div",{className:"skeleton-content-area",children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"200px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))})]})]})]}),ea=()=>e.jsxs("div",{className:"skeleton-container admin-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",children:[e.jsx("div",{className:"skeleton-box",style:{height:"80px",marginBottom:"24px"}}),[1,2,3,4,5,6].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"8px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-stats-grid",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:[1,2,3,4].map(a=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70%"}})]},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"40px",width:"250px",marginBottom:"16px"}}),e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5,6].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"15%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"10%"}})]},a))})]})]})]}),sa=()=>e.jsxs("div",{className:"skeleton-container tl-skeleton",children:[e.jsxs("div",{className:"skeleton-sidebar",style:{width:"260px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"60px",marginBottom:"32px"}}),[1,2,3,4].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"48px",marginBottom:"12px"}},a)),e.jsx("div",{style:{marginTop:"auto"},children:e.jsx("div",{className:"skeleton-box",style:{height:"48px"}})})]}),e.jsxs("div",{className:"skeleton-main",children:[e.jsx("div",{className:"skeleton-box",style:{height:"70px",marginBottom:"24px"}}),e.jsx("div",{className:"skeleton-stats-grid",children:[1,2,3].map(a=>e.jsx("div",{className:"skeleton-card",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"40%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",borderRadius:"12px"}})]})},a))}),e.jsxs("div",{style:{marginTop:"32px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"180px",marginBottom:"20px"}}),e.jsxs("div",{className:"skeleton-table",children:[e.jsx("div",{className:"skeleton-table-header",children:[1,2,3,4,5,6,7,8].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}},a))}),[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"90%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"85%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"50%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"60%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"55%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"32px",borderRadius:"6px"}})]},a))]})]})]})]}),ta=()=>e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"140px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"18px",width:"200px"}})]}),e.jsx("div",{style:{display:"flex",gap:"0"},children:[1,2,3,4].map(a=>e.jsxs("div",{style:{borderRight:a!==4?"1px solid #d5d5d9":"none",padding:"0 24px",display:"flex",alignItems:"center",gap:"16px",minWidth:"200px",height:"80px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"56px",height:"56px",borderRadius:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"40px",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"140px"}})]})]},a))})]}),e.jsxs("div",{style:{background:"white",border:"1px solid #d5d5d9",borderRadius:"12px",overflow:"hidden"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"14px 20px",background:"white",borderBottom:"1px solid #d5d5d9"},children:["FILENAME","DATE & TIME","TEAM","STATUS","ACTIONS"].map((a,s)=>e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80px"}},s))}),[1,2,3,4,5,6,7,8,9,10].map(a=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 180px 120px 220px 120px",gap:"30px",padding:"16px 20px",borderBottom:a!==10?"1px solid #e5e5ea":"none",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{className:"skeleton-box",style:{width:"44px",height:"44px",borderRadius:"8px",flexShrink:0}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"70%",marginBottom:"6px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"40%"}})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"90%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"12px",width:"70%"}})]}),e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"80%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"28px",width:"180px",borderRadius:"50px"}}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"70px",borderRadius:"6px"}})})]},a))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",background:"white",borderTop:"1px solid #e5e5ea",marginTop:"-1px",borderRadius:"0 0 12px 12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"14px",width:"200px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"32px",width:"100px",borderRadius:"6px"}})]}),e.jsx("div",{style:{display:"flex",gap:"6px"},children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"skeleton-box",style:{height:"36px",width:"36px",borderRadius:"6px"}},a))})]})]}),aa=()=>e.jsx("div",{className:"skeleton-table",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"skeleton-table-row",children:[e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"25%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"20%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"30%"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"15%"}})]},a))}),na=()=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-box",style:{height:"24px",width:"60%",marginBottom:"12px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"80%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"20px",width:"70%"}})]}),ia=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"1rem",padding:"1.5rem"},children:[1,2,3,4,5,6,7,8,9,10,11,12].map(a=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"1rem",borderRadius:"8px"},children:[e.jsx("div",{className:"skeleton-box",style:{height:"48px",width:"48px",marginBottom:"0.75rem",borderRadius:"8px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"100%",marginBottom:"4px"}}),e.jsx("div",{className:"skeleton-box",style:{height:"16px",width:"80%"}})]},a))});const Zs=n.memo(({comment:a,replyingTo:s,setReplyingTo:t,visibleReplies:i,toggleRepliesVisibility:l,getInitials:o,formatTimeAgo:r,replyText:c,setReplyText:y,onPostReply:g,user:S,highlightUsername:N})=>{const[L,m]=n.useState(!1),M=a.comment.length>150,p=N&&(a.username===N||a.user_fullname===N),u=n.useCallback(()=>{t(a.id)},[a.id,t]),f=n.useCallback(()=>{l(a.id)},[a.id,l]);return e.jsxs("div",{className:`comment-thread ${p?"highlight-comment":""}`,"data-comment-id":a.id,children:[e.jsxs("div",{className:"comment-item",children:[e.jsx("div",{className:"comment-avatar",children:o(a.user_fullname||a.fullName||a.username)}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:a.user_fullname||a.fullName||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-").replace("_","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"comment-time",children:r(a.created_at)})]}),e.jsxs("div",{className:"comment-text",children:[M&&!L?a.comment.substring(0,150)+"...":a.comment,M&&e.jsx("button",{className:"see-more-btn",onClick:()=>m(!L),children:L?"See less":"See more"})]}),e.jsxs("div",{className:"comment-actions",children:[e.jsx("button",{className:"reply-button",onClick:u,children:"Reply"}),a.replies&&a.replies.length>0&&e.jsxs("button",{className:"view-replies-button",onClick:f,children:[i[a.id]?"Hide":"View"," ",a.replies.length," ",a.replies.length===1?"reply":"replies"]})]})]})]}),a.replies&&a.replies.length>0&&i[a.id]&&e.jsx("div",{className:"replies-thread",children:a.replies.map(C=>e.jsx(Xs,{reply:C,getInitials:o,formatTimeAgo:r},C.id))}),s===a.id&&e.jsx(et,{comment:a,replyText:c,setReplyText:y,onPostReply:g,getInitials:o,user:S})]})});Zs.displayName="CommentItem";const Xs=n.memo(({reply:a,getInitials:s,formatTimeAgo:t})=>{const[l,o]=n.useState(!1),r=a.reply.length>150;return e.jsxs("div",{className:"reply-item",children:[e.jsx("div",{className:"reply-avatar",children:s(a.user_fullname||a.fullName||a.username)}),e.jsxs("div",{className:"reply-content",children:[e.jsxs("div",{className:"reply-header",children:[e.jsx("span",{className:"reply-author",children:a.user_fullname||a.fullName||a.username}),e.jsx("span",{className:`role-badge ${a.user_role?a.user_role.toLowerCase().replace(" ","-").replace("_","-"):"user"}`,children:a.user_role||"USER"}),e.jsx("span",{className:"reply-time",children:t(a.created_at)})]}),e.jsxs("div",{className:"reply-text",children:[r&&!l?a.reply.substring(0,150)+"...":a.reply,r&&e.jsx("button",{className:"see-more-btn",onClick:()=>o(!l),children:l?"See less":"See more"})]})]})]})});Xs.displayName="ReplyItem";const et=n.memo(({comment:a,replyText:s,setReplyText:t,onPostReply:i,getInitials:l,user:o})=>{const r=n.useCallback(y=>{i(y,a.id)},[i,a.id]),c=n.useCallback(y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),r(y))},[r]);return e.jsxs("div",{className:"reply-input-box",children:[e.jsx("div",{className:"comment-avatar reply-avatar",children:l(o.username||o.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a reply...",value:s,onChange:y=>t(y.target.value),onKeyPress:c,autoFocus:!0}),e.jsx("button",{className:"comment-submit-btn",onClick:r,disabled:!s.trim(),children:"âž¤"})]})]})});et.displayName="ReplyInputBox";const st=n.memo(({isOpen:a,onClose:s,assignment:t,comments:i,loadingComments:l,newComment:o,setNewComment:r,onPostComment:c,replyingTo:y,setReplyingTo:g,replyText:S,setReplyText:N,onPostReply:T,visibleReplies:L,toggleRepliesVisibility:m,getInitials:M,formatTimeAgo:p,user:u,highlightUsername:f=null})=>{if(!a||!t)return null;const C=n.useCallback(k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),c(k))},[c]);return e.jsx("div",{className:"comments-modal-overlay",onClick:s,children:e.jsxs("div",{className:"comments-modal",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"comments-modal-header",children:[e.jsxs("h3",{children:["Comments - ",t.title]}),e.jsx("button",{className:"close-modal-btn",onClick:s,children:"âœ•"})]}),e.jsx("div",{className:"comments-modal-body",children:l?e.jsxs("div",{className:"loading-comments",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading comments..."})]}):i.length===0?e.jsx("div",{className:"no-comments",children:e.jsx("p",{children:"ðŸ’¬ No comments yet. Be the first to comment!"})}):e.jsx("div",{className:"comments-list",children:i.map(k=>e.jsx(Zs,{comment:k,replyingTo:y,setReplyingTo:g,visibleReplies:L,toggleRepliesVisibility:m,getInitials:M,formatTimeAgo:p,replyText:S,setReplyText:N,onPostReply:T,user:u,highlightUsername:f},k.id))})}),e.jsx("div",{className:"comments-modal-footer",children:e.jsxs("div",{className:"add-comment",children:[e.jsx("div",{className:"comment-avatar",children:M(u.username||u.fullName)}),e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("input",{type:"text",className:"comment-input",placeholder:"Write a comment...",value:o,onChange:k=>r(k.target.value),onKeyPress:C}),e.jsx("button",{className:"comment-submit-btn",onClick:c,disabled:!o.trim(),children:"âž¤"})]})]})})]})})});st.displayName="CommentsModal";const me=({type:a="info",message:s,onClose:t,autoCloseDelay:i=3e3})=>{if(n.useEffect(()=>{if(i>0&&t){const r=setTimeout(()=>{t()},i);return()=>clearTimeout(r)}},[i,t]),!s)return null;const l=()=>{switch(a){case"success":return"alert-success";case"error":return"alert-error";case"warning":return"alert-warning";case"info":return"alert-info";default:return"alert-info"}},o=()=>{switch(a){case"success":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"error":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"warning":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 6V11M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});case"info":return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M10 9V14M10 6H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})});default:return null}};return e.jsx("div",{className:"alert-message-component",children:e.jsxs("div",{className:`alert ${l()} message-fade`,children:[e.jsxs("div",{className:"alert-content",children:[e.jsx("span",{className:"alert-icon",children:o()}),e.jsx("span",{className:"alert-message",children:s})]}),t&&e.jsx("button",{onClick:t,className:"alert-close",children:"Ã—"})]})})};let Ae=!0,_s=document.title,ns=!1,ss=null;try{window.electron&&window.electron.flashFrame&&(ns=!0,ss=window.electron,console.log("âœ… Electron environment detected - using native window flashing"))}catch{console.log("â„¹ï¸ Browser environment detected - using title flashing")}document.addEventListener("visibilitychange",()=>{Ae=!document.hidden,Ae&&Le()});ns&&(window.addEventListener("focus",()=>{Ae=!0,Le()}),window.addEventListener("blur",()=>{Ae=!1}));window.addEventListener("load",()=>{_s=document.title});const Fs=(a="New Notification",s=1e4)=>{console.log(`ðŸ”” flashTaskbar called: "${a}" (isElectron: ${ns}, isVisible: ${Ae})`),console.log("âš ï¸ Taskbar flash disabled to prevent page blinking")},Le=()=>{console.log("â¹ï¸ Stopping taskbar flash"),ns&&ss&&ss.flashFrame&&ss.flashFrame(!1),document.title=_s},Ts=a=>{_s=a,Ae&&(document.title=a)},Ms=a=>{if(a>0){const s=a===1?"New Notification":`${a} New Notifications`;Fs(s)}},tt=()=>Ae,la={flashTaskbar:Fs,stopFlashing:Le,updateOriginalTitle:Ts,flashForNotifications:Ms,isVisible:tt},oa=Object.freeze(Object.defineProperty({__proto__:null,default:la,flashForNotifications:Ms,flashTaskbar:Fs,isVisible:tt,stopFlashing:Le,updateOriginalTitle:Ts},Symbol.toStringTag,{value:"Module"})),at=(a,s={})=>{const{enabled:t=!0,duration:i=1e4,pageTitle:l=null}=s,o=n.useRef(a);return n.useEffect(()=>{l&&Ts(l)},[l]),n.useEffect(()=>{if(!t)return;const r=a-o.current;r>0&&(console.log(`ðŸ“¢ ${r} new notification(s) - Flashing taskbar`),Ms(r)),o.current=a},[a,t]),n.useEffect(()=>()=>{Le()},[]),{stopFlashing:Le}},ra=(a={})=>{const{duration:s=1e4}=a,t=(i="New Notification")=>{console.log(`ðŸ“¢ Manual flash: ${i}`),he(()=>Promise.resolve().then(()=>oa),void 0,import.meta.url).then(l=>{l.flashTaskbar(i,s)})};return n.useEffect(()=>()=>{Le()},[]),t},nt=({notifications:a,onClose:s,onNavigate:t,duration:i=5e3,role:l="user"})=>{const[o,r]=n.useState([]),[c,y]=n.useState(new Set),g=ra({duration:i});n.useEffect(()=>{const m=a.filter(M=>!M.is_read&&!c.has(M.id)).slice(0,3);if(r(m),m.length>0){const M=m.length===1?m[0].title:`${m.length} New Notifications`;g(M)}if(m.length>0){const M=m.map(p=>setTimeout(()=>{S(p.id)},i));return()=>M.forEach(p=>clearTimeout(p))}},[a,c,i]);const S=n.useCallback(m=>{y(M=>new Set([...M,m])),r(M=>M.filter(p=>p.id!==m))},[]),N=n.useCallback(m=>{console.log(`ðŸ‘‰ ${l} Toast clicked:`,m),t&&(l==="admin"?m.type==="password_reset_request"?(console.log("ðŸ”‘ Password reset request - Navigating to User Management"),t("users",{userId:m.action_by_id,action:"reset-password",username:m.action_by_username})):m.assignment_id?(console.log("ðŸ“‹ Navigating to tasks:",m.assignment_id),t("tasks",m.assignment_id)):m.file_id&&(m.type==="approval"||m.type==="rejection"||m.type==="final_approval"||m.type==="final_rejection"?(console.log("âœ… Navigating to file-approval:",m.file_id),t("file-approval",m.file_id)):(console.log("ðŸ“ Navigating to file-management:",m.file_id),t("file-management",m.file_id))):l==="user"?m.type==="comment"&&m.assignment_id?(m.action_by_username&&sessionStorage.setItem("highlightCommentBy",m.action_by_username),t("tasks",m.assignment_id)):m.type==="assignment"&&m.assignment_id?t("tasks",m.assignment_id):((m.type==="approval"||m.type==="rejection"||m.type==="final_approval"||m.type==="final_rejection")&&m.file_id||m.file_id)&&t("my-files",m.file_id):l==="teamleader"&&(m.assignment_id?t("assignments",m.assignment_id):m.file_id&&t("file-collection",m.file_id))),S(m.id)},[t,S,l]),T=n.useCallback(m=>{switch(m){case"password_reset_request":return"ðŸ”‘";case"password_reset_complete":return"âœ…";case"comment":return"ðŸ’¬";case"assignment":return"ðŸ“‹";case"approval":return"âœ…";case"rejection":return"âŒ";case"final_approval":return"ðŸŽ‰";case"final_rejection":return"ðŸš«";default:return"ðŸ””"}},[]),L=n.useCallback(m=>{switch(m){case"password_reset_request":return"gray";case"password_reset_complete":return"green";case"comment":return"blue";case"assignment":return"purple";case"approval":case"final_approval":return"green";case"rejection":case"final_rejection":return"red";default:return"gray"}},[]);return o.length===0?null:e.jsx("div",{className:"toast-container cursor-pointer",children:o.map((m,M)=>e.jsxs("div",{className:`toast-notification toast-${L(m.type)}`,style:{animationDelay:`${M*100}ms`},onClick:()=>N(m),children:[e.jsx("div",{className:"toast-icon",children:T(m.type)}),e.jsxs("div",{className:"toast-content",children:[e.jsx("div",{className:"toast-title",children:m.title}),e.jsx("div",{className:"toast-message",children:m.message}),e.jsxs("div",{className:"toast-meta",children:[e.jsxs("span",{children:["ðŸ‘¤ ",m.action_by_username]}),m.assignment_title&&e.jsxs("span",{children:["ðŸ“‹ ",m.assignment_title]})]})]}),e.jsx("button",{className:"toast-close",onClick:p=>{p.stopPropagation(),S(m.id)},children:"âœ•"})]},m.id))})},ca=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z",fill:"#FDB022"})}),da=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#E74C3C"}),e.jsx("path",{d:"M14 2v6h6",fill:"#C0392B"}),e.jsx("text",{x:"12",y:"17",fontSize:"6",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"PDF"})]}),Os=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#2980B9"}),e.jsx("path",{d:"M14 2v6h6",fill:"#3498DB"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"DOC"})]}),Us=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#27AE60"}),e.jsx("path",{d:"M14 2v6h6",fill:"#229954"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"XLS"})]}),Ve=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z",fill:"#9B59B6"})}),ws=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#95A5A6"}),e.jsx("path",{d:"M14 2v6h6M10 8h2v2h-2v-2zm0 2h2v2h-2v-2z",fill:"#7F8C8D"}),e.jsx("text",{x:"12",y:"17",fontSize:"5",textAnchor:"middle",fill:"white",fontWeight:"bold",children:"ZIP"})]}),Ze=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M18 4l2 3h-3l-2-3h-2l2 3h-3l-2-3H8l2 3H7L5 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z",fill:"#E67E22"}),e.jsx("path",{d:"M10 12l5 3-5 3v-6z",fill:"white"})]}),Ns=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z",fill:"#1ABC9C"})}),He=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#34495E"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2C3E50"}),e.jsx("rect",{x:"8",y:"12",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"14",width:"8",height:"1",fill:"white"}),e.jsx("rect",{x:"8",y:"16",width:"6",height:"1",fill:"white"})]}),Pe=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#3498DB"}),e.jsx("path",{d:"M14 2v6h6",fill:"#2980B9"}),e.jsx("circle",{cx:"12",cy:"14",r:"3",fill:"none",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17",stroke:"white",strokeWidth:"0.5"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14",stroke:"white",strokeWidth:"0.5"})]}),ha=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6z",fill:"#BDC3C7"}),e.jsx("path",{d:"M14 2v6h6",fill:"#95A5A6"})]}),ma=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})}),ua=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z",fill:"currentColor"})}),pa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z",fill:"currentColor"})}),fa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z",fill:"currentColor"})}),Vs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),xa=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z",fill:"currentColor"})}),ga=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z",fill:"currentColor"})}),ja=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z",fill:"currentColor"})}),va=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z",fill:"currentColor"})}),ya=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),wa=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"}),e.jsx("path",{d:"M14 2v6h6"}),e.jsx("path",{d:"M16 13H8"}),e.jsx("path",{d:"M16 17H8"}),e.jsx("path",{d:"M10 9H8"})]}),Na=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"file-icon-svg",children:e.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"})}),ba=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]}),ka=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"file-icon-svg",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 9l-9 9z"}),e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),e.jsx("path",{d:"M13.59 7l-1.42 1.41L16.17 12l-4.59 4.59L13.59 18l6-6z"}),e.jsx("path",{d:"M7.41 7L6 8.41l4.59 4.59L6 17.59 7.41 19l6-6z"})]}),We={folder:ca,pdf:da,doc:Os,docx:Os,xls:Us,xlsx:Us,jpg:Ve,jpeg:Ve,png:Ve,gif:Ve,bmp:Ve,zip:ws,rar:ws,"7z":ws,mp4:Ze,mov:Ze,avi:Ze,mkv:Ze,mp3:Ns,wav:Ns,flac:Ns,txt:He,json:He,html:He,css:He,js:He,default:ha,icd:Pe,sldprt:Pe,sldasm:Pe,slddrw:Pe,dwg:Pe,dxf:Pe,dashboard:ma,files:ua,users:pa,activityLogs:fa,fileApproval:Vs,settings:xa,logout:ga,tasks:ja,notifications:va,comment:ya,assignment:wa,approval:Vs,rejection:Na,final_approval:ba,final_rejection:ka},Ca=(a,s=!1)=>{if(s)return We.folder;const t=a?.toLowerCase()||"";return We[t]||We.default},pe=a=>{const s=We[a]||We.default;return e.jsx(s,{})},Sa=({fileType:a,isFolder:s=!1,altText:t="File Icon",className:i="",style:l={},size:o="default"})=>{const r=Ca(a,s),c={small:{width:"24px",height:"24px"},default:{width:"40px",height:"40px"},medium:{width:"48px",height:"48px"},large:{width:"64px",height:"64px"}},y=typeof o=="string"&&c[o]?c[o]:c.default;return e.jsx("div",{className:`file-icon-wrapper ${i}`.trim(),style:{width:y.width,height:y.height,minWidth:y.width,minHeight:y.height,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,background:"transparent",...l},role:"img","aria-label":t,children:e.jsx(r,{})})},qe=Ss.memo(Sa);const Re=({isOpen:a,onClose:s,onConfirm:t,title:i="Confirm Action",message:l="Are you sure you want to proceed?",confirmText:o="Confirm",cancelText:r="Cancel",variant:c="danger",isLoading:y=!1,itemInfo:g,children:S})=>{if(!a)return null;const N=M=>{M.target===M.currentTarget&&!y&&s()},T=M=>{M.preventDefault(),M.stopPropagation(),y||t()},L=M=>{M.preventDefault(),M.stopPropagation(),y||s()},m=()=>{switch(c){case"danger":return"btn-danger";case"warning":return"btn-warning";case"info":return"btn-primary";default:return"btn-danger"}};return e.jsx("div",{className:"modal-overlay",onClick:N,children:e.jsxs("div",{className:`modal confirmation-modal ${c}`,onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:L,className:"modal-close",disabled:y,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:l}),g&&e.jsxs("div",{className:"item-info",children:[g.name&&e.jsx("div",{className:"item-name",children:g.name}),g.details&&e.jsx("div",{className:"item-details",children:g.details})]}),S,!S&&e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"delete-actions",children:[e.jsx("button",{type:"button",onClick:L,className:"btn btn-secondary",disabled:y,children:r}),e.jsx("button",{type:"button",onClick:T,className:`btn ${m()}`,disabled:y,children:y?"Deleting...":o})]})})]})})};const _a=({activeTab:a,setActiveTab:s,filesCount:t,notificationCount:i,onLogout:l,user:o})=>e.jsxs("div",{className:"user-sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:o?.fullName||"User"}),e.jsx("div",{className:"user-role",children:o?.team||"No Team"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${a==="dashboard"?"active":""}`,onClick:()=>s("dashboard"),children:[e.jsx("span",{className:"nav-icon",children:pe("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${a==="notification"?"active":""}`,onClick:()=>s("notification"),children:[e.jsxs("span",{className:"nav-icon notification-icon-wrapper",children:[pe("notifications"),i>0&&e.jsx("span",{className:"notification-badge",children:i})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${a==="my-files"?"active":""}`,onClick:()=>s("my-files"),children:[e.jsx("span",{className:"nav-icon",children:pe("files")}),e.jsx("span",{className:"nav-label",children:"My Files"}),t>0&&e.jsx("span",{className:"file-count-badge",children:t})]}),e.jsxs("button",{className:`nav-item ${a==="tasks"?"active":""}`,onClick:()=>s("tasks"),children:[e.jsx("span",{className:"nav-icon",children:pe("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${a==="team-files"?"active":""}`,onClick:()=>s("team-files"),children:[e.jsx("span",{className:"nav-icon",children:pe("users")}),e.jsx("span",{className:"nav-label",children:"Team Tasks"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{className:"logout-btn",onClick:l,children:[e.jsx("span",{className:"nav-icon",children:pe("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]});const Fa=({columns:a=5})=>e.jsx("tr",{className:"skeleton-row",children:Array.from({length:a}).map((s,t)=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-box-inline",style:{width:t===0?"80%":"60%"}})},t))}),Wn=()=>e.jsxs("div",{className:"skeleton-card-inline",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"20px",width:"60%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"32px",width:"40%"}})]}),Ta=()=>e.jsxs("div",{className:"skeleton-stat-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"50%",marginBottom:"8px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"28px",width:"30%"}})]}),qn=({rows:a=5,columns:s=5})=>e.jsx("div",{className:"loading-table-container",children:e.jsxs("table",{style:{width:"100%"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:s}).map((t,i)=>e.jsx("th",{children:e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"70%"}})},i))})}),e.jsx("tbody",{children:Array.from({length:a}).map((t,i)=>e.jsx(Fa,{columns:s},i))})]})}),Hs=({count:a=4})=>e.jsx("div",{className:"loading-cards-grid",children:Array.from({length:a}).map((s,t)=>e.jsx(Ta,{},t))}),Ws=({user:a,files:s,setActiveTab:t,onOpenFile:i,onNavigateToTasks:l})=>{const[o,r]=n.useState([]),[c,y]=n.useState([]),[g,S]=n.useState([]),[N,T]=n.useState(!0),[L,m]=n.useState(new Date);n.useEffect(()=>{let E=!0;(async()=>{E&&await M()})();const X=setInterval(()=>{E&&M(!0)},3e4);return()=>{E=!1,clearInterval(X)}},[a.id,a.team]);const M=async(E=!1)=>{try{E||T(!0);const[H,X,O]=await Promise.all([fetch(`http://localhost:3001/api/assignments/user/${a.id}`),fetch(`http://localhost:3001/api/assignments/team/${a.team}/all-tasks?limit=5`),fetch(`http://localhost:3001/api/notifications/user/${a.id}`)]),[W,I,J]=await Promise.all([H.json(),X.json(),O.json()]);W.success&&r(W.assignments||[]),I.success&&y(I.assignments||[]),J.success&&S(J.notifications||[]),m(new Date)}catch(H){console.error("Error fetching dashboard data:",H)}finally{T(!1)}},p=async E=>{try{await fetch(`http://localhost:3001/api/notifications/${E.id}/read`,{method:"PUT"})}catch(H){console.error("Error marking notification as read:",H)}E.type==="comment"&&E.assignment_id?(sessionStorage.setItem("scrollToAssignment",E.assignment_id),sessionStorage.setItem("highlightCommentBy",E.action_by_username),l?l(E.assignment_id):t("tasks")):E.type==="assignment"?l?l():t("tasks"):E.file_id&&(i?i(E.file_id):t("my-files"))},u=n.useMemo(()=>({total:o.length,pending:o.filter(E=>E.user_status!=="submitted").length,submitted:o.filter(E=>E.user_status==="submitted").length,overdue:o.filter(E=>E.due_date?new Date(E.due_date)<new Date&&E.user_status!=="submitted":!1).length}),[o]),f=n.useMemo(()=>({total:s.length,pending:s.filter(E=>E.current_stage?.includes("pending")).length,approved:s.filter(E=>E.status==="final_approved").length,rejected:s.filter(E=>E.status?.includes("rejected")||E.current_stage?.includes("rejected")).length}),[s]),C=n.useMemo(()=>({totalTasks:c.length,totalSubmissions:c.reduce((E,H)=>E+(H.recent_submissions?H.recent_submissions.length:0),0)}),[c]),k=n.useMemo(()=>({unread:g.filter(E=>!E.is_read).length,recent:g.slice(0,3)}),[g]),z=n.useMemo(()=>u.total>0?Math.round(u.submitted/u.total*100):0,[u]),Y=n.useMemo(()=>f.total>0?Math.round(f.approved/f.total*100):0,[f]),U=n.useMemo(()=>f.total>0?Math.round(f.rejected/f.total*100):0,[f]),B=n.useMemo(()=>u.total>0?Math.round((u.total-u.overdue)/u.total*100):100,[u]),P=n.useMemo(()=>{const E=u.total>0?u.submitted/u.total*100:0,H=f.total>0?f.approved/f.total*100:0,X=f.total>0?f.rejected/f.total*20:0,O=u.total>0?(u.total-u.overdue)/u.total*100:100,W=E*.4+H*.3+O*.3;return Math.max(0,Math.round(W-X))},[u,f]);return N?e.jsx("div",{className:"modern-dashboard",children:e.jsxs("div",{className:"dashboard-skeleton",children:[e.jsx("div",{className:"top-stats-grid",children:e.jsx(Hs,{count:3})}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"180px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"16px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"40px",width:"100%",marginBottom:"20px"}}),e.jsx("div",{className:"analytics-metrics-grid",children:e.jsx(Hs,{count:4})})]}),e.jsxs("div",{className:"notifications-card-modern skeleton-card",children:[e.jsx("div",{className:"skeleton-box-inline",style:{height:"24px",width:"140px",marginBottom:"20px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%",marginBottom:"10px"}}),e.jsx("div",{className:"skeleton-box-inline",style:{height:"60px",width:"100%"}})]})]})]})}):e.jsxs("div",{className:"modern-dashboard",children:[e.jsxs("div",{className:"top-stats-grid",children:[e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("tasks"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Tasks"}),e.jsx("div",{className:"stat-card-value",children:u.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[u.pending," pending"]})," Â· ",e.jsxs("span",{className:"submitted-count",children:[u.submitted," submitted"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("my-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"My Files"}),e.jsx("div",{className:"stat-card-value",children:f.total}),e.jsxs("div",{className:"stat-card-detail",children:[e.jsxs("span",{className:"pending-count",children:[f.pending," pending"]})," Â· ",e.jsxs("span",{className:"approved-count",children:[f.approved," approved"]})," Â· ",e.jsxs("span",{className:"rejected-count",children:[f.rejected," rejected"]})]})]})]}),e.jsxs("div",{className:"stat-card-modern",onClick:()=>t("team-files"),children:[e.jsx("div",{className:"stat-card-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),e.jsxs("div",{className:"stat-card-content",children:[e.jsx("div",{className:"stat-card-label",children:"Team Activity"}),e.jsx("div",{className:"stat-card-value",children:C.totalTasks}),e.jsxs("div",{className:"stat-card-detail",children:[C.totalTasks," tasks Â· ",C.totalSubmissions," submissions"]})]})]})]}),e.jsxs("div",{className:"dashboard-main-grid",children:[e.jsxs("div",{className:"analytics-card-modern",children:[e.jsx("div",{className:"analytics-card-header",children:e.jsx("h2",{className:"analytics-card-title",children:"Performance Analytics"})}),e.jsxs("div",{className:"analytics-content",children:[e.jsx("div",{className:"overall-score-section",children:e.jsxs("div",{className:"score-content-wrapper",children:[e.jsx("div",{className:"circular-progress-container",children:e.jsxs("svg",{className:"circular-progress-svg",viewBox:"0 0 200 200",children:[e.jsx("circle",{className:"progress-ring-bg",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18"}),e.jsx("circle",{className:"progress-ring-fill",cx:"100",cy:"100",r:"85",fill:"none",strokeWidth:"18",strokeDasharray:`${P/100*534} 534`,strokeLinecap:"round",style:{stroke:P>=85?"#10b981":P>=70?"#22c55e":P>=50?"#f59e0b":"#ef4444"}}),e.jsxs("text",{className:"score-percentage-text",x:"100",y:"95",textAnchor:"middle",children:[P,"%"]}),e.jsx("text",{className:"score-label-text",x:"100",y:"118",textAnchor:"middle",children:"Performance"})]})}),e.jsxs("div",{className:"score-description",children:[e.jsx("div",{className:"score-status",children:e.jsx("div",{className:"status-badge",style:{background:P>=85||P>=70?"#d1fae5":P>=50?"#fef3c7":"#fee2e2",color:P>=85||P>=70?"#065f46":P>=50?"#92400e":"#991b1b"},children:P>=85?"ðŸŒŸ Excellent":P>=70?"âœ… Good":P>=50?"âš ï¸ Fair":"ðŸ“‰ Needs Improvement"})}),e.jsx("p",{className:"score-message",children:P>=85?"Outstanding work! You're exceeding expectations.":P>=70?"Great job! Keep up the good momentum.":P>=50?"You're on track. Focus on completing pending tasks.":"Let's work on improving your completion rate."}),e.jsxs("div",{className:"score-legend-grid",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot excellent"}),e.jsx("span",{children:"85-100% Excellent"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot good"}),e.jsx("span",{children:"70-84% Good"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot fair"}),e.jsx("span",{children:"50-69% Fair"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot poor"}),e.jsx("span",{children:"0-49% Poor"})]})]})]})]})}),e.jsxs("div",{className:"analytics-metrics-grid",children:[e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon task-completion-icon",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Task Completion"}),e.jsxs("div",{className:"metric-value",children:[z,"%"]}),e.jsxs("div",{className:"metric-detail",children:[u.submitted,"/",u.total," completed"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon ontime-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"On-Time Delivery"}),e.jsxs("div",{className:"metric-value",children:[B,"%"]}),e.jsxs("div",{className:"metric-detail",children:[u.total-u.overdue,"/",u.total," on time"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon approval-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e.jsx("polyline",{points:"13 2 13 9 20 9"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Approval Rate"}),e.jsxs("div",{className:"metric-value",children:[Y,"%"]}),e.jsxs("div",{className:"metric-detail",children:[f.approved,"/",f.total," approved"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon rejection-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"File Rejection Rate"}),e.jsxs("div",{className:"metric-value",children:[U,"%"]}),e.jsxs("div",{className:"metric-detail",children:[f.rejected,"/",f.total," rejected"]})]})]}),e.jsxs("div",{className:"analytics-metric",children:[e.jsx("div",{className:"metric-icon overdue-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Overdue Tasks"}),e.jsx("div",{className:"metric-value",children:u.overdue}),e.jsx("div",{className:"metric-detail",children:"Tasks awaiting attention"})]})]})]})]})]}),e.jsxs("div",{className:"notifications-card-modern",children:[e.jsxs("div",{className:"notifications-card-header",children:[e.jsxs("h2",{className:"notifications-card-title",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),"Notifications"]}),e.jsx("div",{className:"notifications-badge",children:k.unread})]}),e.jsx("div",{className:"notifications-content",children:k.recent.length>0?e.jsxs(e.Fragment,{children:[k.recent.map(E=>e.jsx("div",{className:`notification-item-modern ${E.is_read?"":"unread"}`,onClick:()=>p(E),style:{cursor:"pointer"},children:e.jsxs("div",{className:"notification-text",children:[e.jsx("div",{className:"notification-title-modern",children:E.title}),e.jsx("div",{className:"notification-time-modern",children:(()=>{const H=new Date,X=new Date(E.created_at),O=H-X,W=Math.floor(O/6e4),I=Math.floor(O/36e5);return W<60?`${W} minutes ago`:I<24?`${I} hour${I>1?"s":""} ago`:X.toLocaleDateString()})()})]})},E.id)),e.jsx("button",{className:"view-all-notifications-btn",onClick:()=>t("notification"),children:"View all notifications"})]}):e.jsxs("div",{className:"empty-notifications",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{children:"No notifications"})]})})]})]})]})},Ma=n.lazy(()=>he(()=>import("./TeamTasksTab-646118e1.js"),["./TeamTasksTab-646118e1.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TeamTasksTab-e9d479ad.css"],import.meta.url)),Ea=n.lazy(()=>he(()=>import("./MyFilesTab-ad0be8ed.js"),["./MyFilesTab-ad0be8ed.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./MyFilesTab-2608cae7.css"],import.meta.url)),Da=n.lazy(()=>he(()=>import("./NotificationTab-RealTime-bdaa948b.js"),["./NotificationTab-RealTime-bdaa948b.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./NotificationTab-RealTime-c831b0ad.css"],import.meta.url)),Aa=n.lazy(()=>he(()=>import("./TasksTab-Enhanced-145a1b98.js"),["./TasksTab-Enhanced-145a1b98.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./TasksTab-Enhanced-f73d19c6.css"],import.meta.url)),La=n.lazy(()=>he(()=>import("./FileModal-62021683.js"),["./FileModal-62021683.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js","./FileModal-6990c4b3.css"],import.meta.url)),qs=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,c]=n.useState([]),[y,g]=n.useState(!1),[S,N]=n.useState(""),[T,L]=n.useState(""),[m,M]=n.useState(null),[p,u]=n.useState(!1),[f,C]=n.useState([]),[k,z]=n.useState("all"),[Y,U]=n.useState(0),[B,P]=n.useState([]),E=async()=>{g(!0);try{const d=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();d.success?o(d.files||[]):N("Failed to fetch your files")}catch(w){console.error("Error fetching user files:",w),N("Failed to connect to server")}finally{g(!1)}},H=w=>{i(w)};n.useEffect(()=>{(async()=>{try{const j=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();j.success&&(U(j.unreadCount||0),P(j.notifications||[]))}catch(d){console.error("Error fetching notifications:",d)}})()},[a.id]),n.useEffect(()=>{E()},[a.id]),n.useEffect(()=>{t==="my-files"&&E()},[t,a.id]),n.useEffect(()=>{X()},[l,k]);const X=()=>{let w=l;k!=="all"&&(w=w.filter(d=>{switch(k){case"pending":return d.current_stage.includes("pending");case"approved":return d.status==="final_approved";case"rejected":return d.status.includes("rejected");default:return!0}})),c(w)},O=async w=>{M(w),u(!0);try{const j=await(await fetch(`http://localhost:3001/api/files/${w.id}/comments`)).json();j.success&&C(j.comments||[])}catch(d){console.error("Error fetching comments:",d),C([])}},W=async w=>{try{const j=await(await fetch(`http://localhost:3001/api/files/user/${a.id}`)).json();if(j.success&&j.files){const v=j.files.find(q=>q.id===parseInt(w));v?(i("my-files"),setTimeout(async()=>{await O(v)},100)):N("File not found in your files")}else N("Failed to fetch file details")}catch(d){console.error("Error fetching file:",d),N("Failed to connect to server")}},I=(w=null)=>{i("tasks"),w&&sessionStorage.setItem("scrollToAssignment",w)},J=async(w,d)=>{w==="my-files"&&d?await W(d):w==="tasks"&&d?(i("tasks"),sessionStorage.setItem("scrollToAssignment",d)):i(w)},ee=w=>{if(w===0)return"0 Bytes";const d=1024,j=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(w)/Math.log(d));return parseFloat((w/Math.pow(d,v)).toFixed(2))+" "+j[v]},te=()=>{N(""),L("")},h=()=>{s()},x=w=>{L(w)},F=()=>{switch(t){case"dashboard":return e.jsx(Ws,{user:a,files:l,setActiveTab:i});case"team-files":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"table"}),children:e.jsx(Ma,{user:a})});case"my-files":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"myfiles"}),children:e.jsx(Ea,{filteredFiles:r,isLoading:y,filterStatus:k,setFilterStatus:z,setActiveTab:i,fetchUserFiles:E,formatFileSize:ee,openFileModal:O,files:l,user:a,onUploadSuccess:x})});case"notification":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"list"}),children:e.jsx(Da,{user:a,onOpenFile:W,onNavigateToTasks:I,onUpdateUnreadCount:U})});case"tasks":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"table"}),children:e.jsx(Aa,{user:a})});default:return e.jsx(Ws,{user:a,files:l,setActiveTab:H,onOpenFile:W,onNavigateToTasks:I})}};return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"dashboard"}),children:e.jsxs("div",{className:"minimal-dashboard user-dashboard",children:[e.jsx(_a,{activeTab:t,setActiveTab:H,filesCount:l.filter(w=>w.status==="uploaded"||w.status==="team_leader_approved"||w.status==="final_approved").length,notificationCount:Y,onLogout:h,user:a}),e.jsx("div",{className:"main-content",children:e.jsxs("div",{className:"dashboard-content",children:[e.jsx(me,{type:"error",message:S,onClose:te}),e.jsx(me,{type:"success",message:T,onClose:te}),F()]})}),p&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(La,{showFileModal:p,setShowFileModal:u,selectedFile:m,fileComments:f,formatFileSize:ee})}),e.jsx(nt,{notifications:B,onNavigate:J,role:"user"})]})})};const Ia=({activeTab:a,setActiveTab:s,clearMessages:t,setSidebarOpen:i,sidebarOpen:l,onLogout:o})=>{const r=c=>{s(c),t(),i(!1)};return e.jsxs("aside",{className:`tl-sidebar ${l?"open":""}`,children:[e.jsxs("div",{className:"tl-brand",children:[e.jsx("div",{className:"tl-brand-logo",children:"TL"}),e.jsx("span",{className:"tl-brand-name",children:"Team Leader"})]}),e.jsxs("nav",{className:"tl-nav",children:[e.jsxs("button",{className:`tl-nav-item ${a==="dashboard"?"active":""}`,onClick:()=>r("dashboard"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="notifications"?"active":""}`,onClick:()=>r("notifications"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("span",{children:"Notifications"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="file-collection"?"active":""}`,onClick:()=>r("file-collection"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),e.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),e.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),e.jsx("span",{children:"File Collection"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="assignments"?"active":""}`,onClick:()=>r("assignments"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 11l3 3L22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),e.jsx("span",{children:"Tasks"})]}),e.jsxs("button",{className:`tl-nav-item ${a==="team-management"?"active":""}`,onClick:()=>r("team-management"),children:[e.jsxs("svg",{className:"tl-nav-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Team Management"})]})]}),e.jsx("div",{className:"tl-sidebar-footer",children:e.jsxs("button",{className:"tl-logout-btn",onClick:o,children:[e.jsxs("svg",{className:"tl-logout-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),e.jsx("span",{children:"Logout"})]})})]})};const it=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`tl-notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"tl-notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"tl-notification-content",children:[e.jsxs("div",{className:"tl-notification-title",children:[a.title,!a.is_read&&e.jsx("span",{className:"tl-unread-badge",children:"New"})]}),e.jsx("div",{className:"tl-notification-message",children:a.message}),e.jsxs("div",{className:"tl-notification-meta",children:[e.jsxs("span",{className:"tl-notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"tl-notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"tl-notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"tl-notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"tl-notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"tl-notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));it.displayName="NotificationItem";const Kn=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,c]=n.useState(!1),[y,g]=n.useState(""),[S,N]=n.useState(0),[T,L]=n.useState(!1),[m,M]=n.useState(!1);at(S);const[p,u]=n.useState(1),[f,C]=n.useState(!0),[k,z]=n.useState(0),Y=20,U=n.useRef(null),B=n.useRef(null);n.useEffect(()=>{P(1,!0);const h=setInterval(()=>{P(1,!0,!0)},3e4);return()=>clearInterval(h)},[a.id]),n.useEffect(()=>{if(l||r||!f)return;const h={root:null,rootMargin:"100px",threshold:.1};return U.current=new IntersectionObserver(x=>{x[0].isIntersecting&&f&&!r&&P(p+1,!1)},h),B.current&&U.current.observe(B.current),()=>{U.current&&U.current.disconnect()}},[l,r,f,p]);const P=async(h,x=!1,F=!1)=>{try{x&&!F?o(!0):F||c(!0);const d=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${h}&limit=${Y}`)).json();if(d.success){const j=d.notifications||[];if(x)i(j),u(1);else if(F){const v=new Set(t.map(K=>K.id)),q=j.filter(K=>!v.has(K.id));q.length>0&&i([...q,...t])}else i(v=>[...v,...j]),u(h);N(d.unreadCount||0),z(d.totalCount||0),C(d.hasMore||!1)}else g("Failed to fetch notifications")}catch(w){console.error("Error fetching notifications:",w),F||g("Failed to fetch notifications")}finally{x&&!F?o(!1):F||c(!1)}},E=async h=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${h}/read`,{method:"PUT"})).json()).success&&(i(w=>w.map(d=>d.id===h?{...d,is_read:!0}:d)),N(w=>Math.max(0,w-1)))}catch(x){console.error("Error marking notification as read:",x)}},H=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(F=>F.map(w=>({...w,is_read:!0}))),N(0))}catch(h){console.error("Error marking all as read:",h)}},X=async h=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${h}`,{method:"DELETE"})).json()).success){const w=t.find(d=>d.id===h);i(d=>d.filter(j=>j.id!==h)),z(d=>d-1),w&&!w.is_read&&N(d=>Math.max(0,d-1))}}catch(x){console.error("Error deleting notification:",x)}},O=()=>{L(!0)},W=async()=>{M(!0);try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),N(0),z(0),C(!1),L(!1))}catch(h){console.error("Error deleting all notifications:",h),g("Failed to delete all notifications")}finally{M(!1)}},I=h=>{console.log("ðŸ”” Notification clicked:",h),console.log("   Type:",h.type),console.log("   Title:",h.title),console.log("   Assignment ID:",h.assignment_id),h.is_read||E(h.id);const x=h.title==="New Reply on Assignment";if(console.log("   Is Reply Notification:",x),h.type==="comment"||x)if(console.log("   â†’ Navigating to assignments with comment context"),h.assignment_id){const F={assignmentId:h.assignment_id,shouldOpenComments:!0,expandAllReplies:x};console.log("   ðŸ“¤ Sending navigation data:",F),s?s("assignments",F):console.error("   âŒ onNavigate function not provided!")}else console.error("   âŒ No assignment_id found in notification!");else h.type==="submission"||h.type==="file_uploaded"||h.type==="assignment"?(console.log("   â†’ Navigating to assignments (Go to Task behavior)"),h.assignment_id?s?s("assignments",{assignmentId:h.assignment_id,fileId:h.file_id||null,shouldOpenComments:!1,fromFileSubmission:!0}):console.error("   âŒ onNavigate function not provided!"):console.error("   âŒ No assignment_id found in notification!")):h.type==="approval"||h.type==="rejection"||h.type==="final_approval"||h.type==="final_rejection"?(console.log("   â†’ Navigating to file collection"),h.file_id?s&&s("file-collection",{fileId:h.file_id}):console.error("   âŒ No file_id found in notification!")):!h.type||h.type===""?(console.log("   âš ï¸ Empty notification type, checking IDs..."),h.file_id&&h.assignment_id?(console.log("   â†’ Has both file_id and assignment_id, treating as file submission"),console.log("   â†’ Navigating to assignments (Go to Task behavior)"),s&&s("assignments",{assignmentId:h.assignment_id,fileId:h.file_id,shouldOpenComments:!1,fromFileSubmission:!0})):h.assignment_id?(console.log("   â†’ Has assignment_id only, navigating to assignments"),s&&s("assignments",{assignmentId:h.assignment_id,shouldOpenComments:!1})):h.file_id?(console.log("   â†’ Has file_id only, navigating to file collection"),s&&s("file-collection",{fileId:h.file_id})):console.error("   âŒ Empty type and no valid IDs found!")):console.warn("   âš ï¸ Unknown notification type:",h.type)},J=({type:h})=>e.jsx(qe,{fileType:h,size:"medium",altText:`${h} notification icon`,className:"tl-notification-type-icon"}),ee=n.useCallback(h=>{const x=new Date,F=new Date(h),w=Math.floor((x-F)/1e3);return w<60?`${w}s ago`:w<3600?`${Math.floor(w/60)}m ago`:w<86400?`${Math.floor(w/3600)}h ago`:w<604800?`${Math.floor(w/86400)}d ago`:F.toLocaleDateString()},[]),te=()=>e.jsx("div",{className:"tl-notification-skeleton",children:[1,2,3,4,5].map(h=>e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-meta"})]})]},h))});return l?e.jsxs("div",{className:"tl-notifications-page",children:[e.jsx("div",{className:"tl-notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(te,{})]}):e.jsxs("div",{className:`tl-notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"tl-notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"tl-notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"tl-notifications-actions",children:[S>0&&e.jsx("button",{className:"tl-btn-mark-all-read",onClick:H,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"tl-btn-delete-all",onClick:O,children:"Delete All"})]})]}),y&&e.jsx("div",{className:"tl-error-message",children:y}),e.jsxs("div",{className:"tl-notifications-stats",children:[k," total â€¢ ",S," unread"]}),t.length===0?e.jsxs("div",{className:"tl-no-notifications",children:[e.jsx("div",{className:"tl-no-notifications-icon",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tl-notifications-list",children:t.map(h=>e.jsx(it,{notification:h,onNotificationClick:I,onDeleteNotification:X,NotificationIcon:J,formatTimeAgo:ee},h.id))}),r&&e.jsxs("div",{className:"tl-notifications-loading-more",children:[e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]}),e.jsxs("div",{className:"tl-notification-skeleton-item",children:[e.jsx("div",{className:"tl-skeleton-icon"}),e.jsxs("div",{className:"tl-skeleton-content",children:[e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-title"}),e.jsx("div",{className:"tl-skeleton-line tl-skeleton-line-message"})]})]})]}),f&&!r&&e.jsx("div",{ref:B,className:"tl-load-more-trigger"}),!f&&t.length>=Y&&e.jsx("div",{className:"tl-end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]}),T&&e.jsx("div",{className:"custom-modal-overlay",onClick:()=>!m&&L(!1),children:e.jsxs("div",{className:"custom-modal",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"custom-modal-header",children:[e.jsx("h3",{children:"Delete All Notifications?"}),e.jsx("button",{onClick:()=>L(!1),className:"custom-modal-close",disabled:m,type:"button",children:"Ã—"})]}),e.jsx("div",{className:"custom-modal-body",children:e.jsxs("div",{className:"delete-warning",children:[e.jsx("span",{className:"warning-icon",children:"âš ï¸"}),e.jsxs("div",{className:"warning-content",children:[e.jsx("h4",{children:"Are you sure you want to delete all notifications?"}),e.jsxs("div",{className:"item-info",children:[e.jsxs("div",{className:"item-name",children:[k," notification",k!==1?"s":""]}),e.jsxs("div",{className:"item-details",children:["Including ",S," unread notification",S!==1?"s":""]})]}),e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})]})]})}),e.jsx("div",{className:"custom-modal-footer",children:e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>L(!1),className:"modal-cancel-btn",disabled:m,children:"Cancel"}),e.jsx("button",{type:"button",onClick:W,className:"modal-confirm-btn",disabled:m,children:m?"Deleting...":"Delete All"})]})})]})})]})};function lt(a){if(!a)return"Unknown File Type";const s=a.replace(/^\./,"").toLowerCase().trim();return["pdf document","word document","excel spreadsheet","text file","jpeg image","png image","zip archive","documents","spreadsheets","presentations","images","videos","audio","cad/3d files","engineering files","archives","code","executables"].includes(s)?a.split(" ").map(m=>m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()).join(" "):["pdf","doc","docx","txt","rtf","odt","pages"].includes(s)?"Documents":["xls","xlsx","csv","ods","numbers"].includes(s)?"Spreadsheets":["ppt","pptx","key","odp"].includes(s)?"Presentations":["jpg","jpeg","png","gif","bmp","svg","webp","tiff","tif","ico","heic","heif"].includes(s)?"Images":["mp4","avi","mov","wmv","flv","mkv","webm","mpeg","mpg","m4v"].includes(s)?"Videos":["mp3","wav","flac","aac","ogg","wma","m4a","opus"].includes(s)?"Audio":["dwg","dxf","dwf","dwt","sldprt","sldasm","slddrw","step","stp","iges","igs","stl","obj","fbx","3ds","sat","ipt","iam","idw","prt","asm","drw","catpart","catproduct","catdrawing","x_t","x_b"].includes(s)?"CAD/3D Files":["icd","bom","sch","pcb","gerber","gbr","cam","nc","gcode","plt","dxp","schdoc","pcbdoc","brd","lib","mod","kicad_pcb","kicad_sch","kicad_mod","pro"].includes(s)?"Engineering Files":["zip","rar","7z","tar","gz","bz2","xz","iso"].includes(s)?"Archives":["js","jsx","ts","tsx","py","java","cpp","c","h","cs","php","rb","go","rs","swift","kt","scala","r","m","sh","html","css","scss","sass","less","json","xml","yaml","yml","sql","md","markdown"].includes(s)?"Code":["exe","dll","so","dylib","app","dmg","pkg","deb","rpm","msi"].includes(s)?"Executables":/^[A-Z0-9]+\s+File$/i.test(a)?a:s.length<=10&&!/\s/.test(s)?`${s.toUpperCase()} File`:a}function $a(a){if(!a)return"Unknown File Type";const s=a.split(".").pop();return lt(s)}function Pa(a,s=""){return!a||a==="Unknown File Type"?s?$a(s):"Unknown File Type":lt(a)}const bs=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.OverviewTab}))),Ra=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileCollectionTab}))),Ba=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.TeamManagementTab}))),za=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.AssignmentsTab}))),Oa=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.NotificationTab}))),Ua=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.BulkActionModal}))),Va=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FilterModal}))),Ha=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.PriorityModal}))),Wa=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.MemberFilesModal}))),qa=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.CreateAssignmentModal}))),Ka=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.ReviewModal}))),Ja=n.lazy(()=>he(()=>import("./index-58cf4f38.js"),["./index-58cf4f38.js","./react-vendor-a308f804.js","./router-vendor-90630356.js","./anime-vendor-37453147.js"],import.meta.url).then(a=>({default:a.FileViewModal}))),Qa=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState(!1),[r,c]=n.useState([]),[y,g]=n.useState([]),[S,N]=n.useState([]),[T,L]=n.useState("all"),[m,M]=n.useState("date-desc"),[p,u]=n.useState(!1),[f,C]=n.useState(""),[k,z]=n.useState(""),[Y,U]=n.useState(null),[B,P]=n.useState(!1),[E,H]=n.useState(!1),[X,O]=n.useState(""),[W,I]=n.useState(""),[J,ee]=n.useState(!1),[te,h]=n.useState(""),[x,F]=n.useState([]),[w,d]=n.useState(null),[j,v]=n.useState([]),[q,K]=n.useState(!1),[Z,re]=n.useState(""),[fe,ge]=n.useState(""),[we,Ce]=n.useState(!1),[Se,xe]=n.useState({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),[A,Q]=n.useState({field:"uploaded_at",direction:"DESC"}),[V,de]=n.useState(!1),[_,G]=n.useState(null),[ae,je]=n.useState("normal"),[ve,ls]=n.useState(""),[os,rs]=n.useState([]),[cs,ds]=n.useState({overdue:0,urgent:0,pending:0});n.useState(!1);const[Me,Be]=n.useState([]),[b,$]=n.useState(null),[se,ne]=n.useState([]),[le,Ne]=n.useState(!1),[be,_e]=n.useState(!1),[ye,hs]=n.useState(null),[ut,pt]=n.useState("total"),[ms,Ke]=n.useState([]),[ft,us]=n.useState(!1),[Es,ps]=n.useState(!1),[ze,Ds]=n.useState({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),[xt,As]=n.useState(null),[gt,Je]=n.useState(null),[jt,Ls]=n.useState(null),[vt,Qe]=n.useState(null);n.useEffect(()=>{t==="overview"&&Oe("total"),t==="file-collection"&&fs(),yt(),xs(),Nt(),t==="assignments"&&Ue(),t==="dashboard"&&(console.log("ðŸ”„ DASHBOARD TAB: Loading data...",{activeTab:t,team:a.team}),fs(),Ue())},[a.team,t]),n.useEffect(()=>{const R=setInterval(xs,3e4);return()=>clearInterval(R)},[a.team]),n.useEffect(()=>{const R=()=>{w&&d(null)};return document.addEventListener("click",R),()=>document.removeEventListener("click",R)},[w]),n.useEffect(()=>{if(te.trim()==="")g(r);else{const R=r.filter(D=>D.original_name?.toLowerCase().includes(te.toLowerCase())||D.username?.toLowerCase().includes(te.toLowerCase())||D.description?.toLowerCase().includes(te.toLowerCase())||D.file_type?.toLowerCase().includes(te.toLowerCase()));g(R)}},[r,te,ut]);const fs=async()=>{u(!0);try{const D=await(await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}/all-submissions`)).json();D.success&&N(D.submissions||[])}catch(R){console.error("Error fetching all submissions:",R),N([])}finally{u(!1)}},Oe=async(R=null)=>{u(!0);try{let D=`http://localhost:3001/api/files/team-leader/${a.team}?limit=1000`;if(R==="total")D=`http://localhost:3001/api/files/team/${a.team}?limit=1000`;else if(R&&R!=="pending"){let ue=R;D=`http://localhost:3001/api/files/team/${a.team}/status/${ue}?limit=1000`}const oe=await(await fetch(D)).json();oe.success&&(c(oe.files||[]),g(oe.files||[]),pt(R||null))}catch(D){console.error("Error fetching files:",D)}finally{u(!1)}},yt=async()=>{Ne(!0);try{const D=await(await fetch(`http://localhost:3001/api/team-members/${a.team}`)).json();if(D.success&&D.members&&D.members.length>0){const ie=D.members.map(ue=>({id:ue.id,name:ue.fullName||ue.username,email:ue.email,joined:new Date(ue.created_at||Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),files:ue.totalFiles||0,status:"Active",...ue})),oe={id:a.id,name:a.fullName||a.username,email:a.email,joined:new Date(a.created_at||Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),files:0,status:"Active",fullName:a.fullName,username:a.username,role:a.role};Be([oe,...ie])}else{const ie={id:a.id,name:a.fullName||a.username,email:a.email,joined:new Date(a.created_at||Date.now()).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),files:0,status:"Active",fullName:a.fullName,username:a.username,role:a.role};Be([ie])}}catch(R){console.error("Error fetching team members:",R),C("Failed to load team members"),Be([])}finally{Ne(!1)}},wt=async(R,D)=>{$({id:R,name:D}),u(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/member/${R}`)).json();oe.success?(ne(oe.files||[]),_e(!0)):C("Failed to fetch member files")}catch(ie){console.error("Error fetching member files:",ie),C("Failed to connect to server")}finally{u(!1)}},Nt=async()=>{try{const D=await(await fetch(`http://localhost:3001/api/dashboard/team/${a.team}`)).json();D.success&&hs(D.analytics||{})}catch(R){console.error("Error fetching analytics:",R)}},Ue=async()=>{us(!0);try{const R=await fetch(`http://localhost:3001/api/assignments/team-leader/${a.team}`);if(R.status===404){Ke([]),us(!1);return}const D=await R.json();D.success?Ke(D.assignments||[]):Ke([])}catch(R){console.error("Error fetching assignments:",R),Ke([])}finally{us(!1)}},bt=async()=>{if(!ze.title.trim()){C("Please enter assignment title");return}if(ze.assignedMembers.length===0){C("Please select at least one team member");return}ee(!0);try{const D=await(await fetch("http://localhost:3001/api/assignments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...ze,assignedTo:ze.assignedMembers.length>0?"specific":"all",teamLeaderId:a.id,teamLeaderUsername:a.username,team:a.team})})).json();D.success?(z(`Assignment created! ${D.membersAssigned} members assigned.`),ps(!1),Ds({title:"",description:"",dueDate:"",fileTypeRequired:"",assignedMembers:[]}),Ue()):C(D.message||"Failed to create assignment")}catch(R){console.error("Error creating assignment:",R),C("Failed to create assignment")}finally{ee(!1)}},kt=async(R,D)=>{try{(await(await fetch(`http://localhost:3001/api/assignments/${R}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamLeaderUsername:a.username,team:a.team})})).json()).success?(z("Assignment deleted successfully"),Ue()):C("Failed to delete assignment")}catch(ie){console.error("Error deleting assignment:",ie),C("Failed to delete assignment")}},Ct=async(R,D)=>{U(R),I(D),O(""),P(!0);try{const oe=await(await fetch(`http://localhost:3001/api/files/${R.id}/comments`)).json();oe.success&&F(oe.comments||[])}catch(ie){console.error("Error fetching comments:",ie),F([])}},St=async R=>{try{(await(await fetch("http://localhost:3001/api/files/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R.file_path})})).json()).success?z("File opened successfully"):C("Failed to open file")}catch(D){console.error("Error opening file:",D),C("Failed to open file")}},_t=async(R,D=null)=>{R.preventDefault();const ie=D||W;if(!(!Y||!ie)){ee(!0),C("");try{const ue=await(await fetch(`http://localhost:3001/api/files/${Y.id}/team-leader-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:ie,comments:X.trim(),teamLeaderId:a.id,teamLeaderUsername:a.username,teamLeaderRole:a.role,team:a.team})})).json();ue.success?(z(`File ${ie}d successfully!`),P(!1),U(null),O(""),I(null),F([]),Oe()):C(ue.message||`Failed to ${ie} file`)}catch(oe){console.error(`Error ${ie}ing file:`,oe),C(`Failed to ${ie} file. Please try again.`)}finally{ee(!1)}}},Ge=R=>{if(!R||R===0||isNaN(R))return"0 Bytes";const D=1024,ie=["Bytes","KB","MB","GB"],oe=Math.floor(Math.log(R)/Math.log(D));return parseFloat((R/Math.pow(D,oe)).toFixed(2))+" "+ie[oe]},Ft=R=>{if(!R)return"No date";const D=new Date(R);return isNaN(D.getTime())?"Invalid Date":D.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Tt=async()=>{if(Z==="reject"&&!fe.trim()){C("Please provide a reason for rejection");return}ee(!0),C("");try{const D=await(await fetch("http://localhost:3001/api/files/bulk-action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:j,action:Z,comments:fe.trim(),reviewerId:a.id,reviewerUsername:a.username,reviewerRole:a.role,team:a.team})})).json();D.success?(z(`Successfully ${Z}d ${D.results.success.length} file(s)`),D.results.failed.length>0&&C(`Failed to process ${D.results.failed.length} file(s)`),K(!1),re(""),ge(""),v([]),Oe()):C(D.message||`Failed to ${Z} files`)}catch(R){console.error("Error performing bulk action:",R),C(`Failed to ${Z} files. Please try again.`)}finally{ee(!1)}},Mt=async()=>{u(!0);try{const D=await(await fetch(`http://localhost:3001/api/files/team-leader/${a.team}/filter`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filters:Se,sort:A,page:1,limit:100})})).json();D.success?(c(D.files||[]),Ce(!1)):C("Failed to apply filters")}catch(R){console.error("Error applying filters:",R),C("Failed to apply filters")}finally{u(!1)}},Et=()=>{xe({fileType:[],submittedBy:[],dateFrom:"",dateTo:"",priority:"",hasDeadline:!1,isOverdue:!1}),Oe()},Dt=async()=>{if(_){ee(!0),C("");try{const D=await(await fetch(`http://localhost:3001/api/files/${_}/priority`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:ae,dueDate:ve,reviewerId:a.id,reviewerUsername:a.username})})).json();D.success?(z("Priority and deadline updated successfully"),de(!1),G(null),Oe(),xs()):C(D.message||"Failed to update priority")}catch(R){console.error("Error updating priority:",R),C("Failed to update priority. Please try again.")}finally{ee(!1)}}},xs=async()=>{try{const D=await(await fetch(`http://localhost:3001/api/files/notifications/${a.team}`)).json();D.success&&(rs(D.notifications||[]),ds(D.counts||{overdue:0,urgent:0,pending:0}))}catch(R){console.error("Error fetching notifications:",R)}},gs=()=>{C(""),z("")},At=(R,D)=>{D.stopPropagation(),d(w===R?null:R)},Lt=async(R,D)=>{D.stopPropagation();try{(await(await fetch("http://localhost:3001/api/files/open-in-explorer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:R})})).json()).success?z("File opened in explorer"):C("Failed to open file in explorer")}catch(ie){console.error("Error opening file in explorer:",ie),C("Failed to open file in explorer")}d(null)},js=()=>94,It=()=>{switch(t){case"overview":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Me,calculateApprovalRate:js})});case"dashboard":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Me,calculateApprovalRate:js,submittedFiles:S,assignments:ms,notifications:os,notificationCounts:cs,analyticsData:ye,activeTab:t,setActiveTab:i,onNavigateToTask:(R,D)=>{i("assignments"),Je(R),D&&Qe(D)}})});case"file-collection":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"table"}),children:e.jsx(Ra,{submittedFiles:S,isLoading:p,openFileViewModal:St,formatFileSize:Ge,user:a,openMenuId:w,toggleMenu:At,handleOpenInExplorer:Lt,fileCollectionFilter:T,setFileCollectionFilter:L,fileCollectionSort:m,setFileCollectionSort:M,onNavigateToTask:(R,D)=>{i("assignments"),Je(R),D&&Qe(D)},highlightedFileId:jt,onClearFileHighlight:()=>Ls(null)})});case"team-management":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"table"}),children:e.jsx(Ba,{isLoadingTeam:le,teamMembers:Me,fetchMemberFiles:wt})});case"assignments":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"table"}),children:e.jsx(za,{isLoadingAssignments:ft,assignments:ms,formatDate:Ft,deleteAssignment:kt,setShowCreateAssignmentModal:ps,openReviewModal:Ct,user:a,notificationCommentContext:xt,onClearNotificationContext:()=>As(null),highlightedAssignmentId:gt,onClearHighlight:()=>Je(null),highlightedFileId:vt,onClearFileHighlight:()=>Qe(null)})});case"notifications":return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"list"}),children:e.jsx(Oa,{user:a,onNavigate:async(R,D)=>{if(console.log("ðŸŽ¯ Dashboard onNavigate called"),console.log("   Tab:",R),console.log("   Data:",D),R==="assignments"){i("assignments"),ms.length===0&&(console.log("   â³ Fetching assignments..."),await Ue());const ie=typeof D=="object"?D.assignmentId:D,oe=typeof D=="object"?D.shouldOpenComments:!1,ue=typeof D=="object"?D.expandAllReplies:!1,Ye=typeof D=="object"?D.fileId:null;if(console.log("   ðŸ“‹ Extracted data:"),console.log("      assignmentId:",ie),console.log("      shouldOpenComments:",oe),console.log("      expandAllReplies:",ue),console.log("      fileId:",Ye),ie)if(Je(ie),console.log("   âœ… Set highlightedAssignmentId:",ie),Ye&&(Qe(Ye),console.log("   âœ… Set highlightedSubmissionFileId:",Ye)),oe){const Is={assignmentId:ie,expandAllReplies:ue};console.log("   âœ… Setting notificationCommentContext:",Is),As(Is)}else console.log("   âš ï¸ Not opening comments - shouldOpenComments:",oe)}else if(R==="file-collection"&&(i("file-collection"),S.length===0&&await fs(),D)){const ie=typeof D=="object"?D.fileId:D;Ls(ie)}}})});default:return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"cards"}),children:e.jsx(bs,{pendingFiles:r,teamMembers:Me,calculateApprovalRate:js})})}};return e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"teamleader"}),children:e.jsxs("div",{className:"tl-dashboard",children:[e.jsx(Ia,{activeTab:t,setActiveTab:i,clearMessages:gs,setSidebarOpen:o,sidebarOpen:l,onLogout:s}),e.jsxs("main",{className:"tl-main",children:[e.jsx(me,{type:"error",message:f,onClose:gs}),e.jsx(me,{type:"success",message:k,onClose:gs}),It()]}),q&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ua,{showBulkActionModal:q,setShowBulkActionModal:K,bulkAction:Z,selectedFileIds:j,bulkComments:fe,setBulkComments:ge,isProcessing:J,submitBulkAction:Tt})}),we&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Va,{showFilterModal:we,setShowFilterModal:Ce,filters:Se,setFilters:xe,clearFilters:Et,applyFilters:Mt})}),V&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ha,{showPriorityModal:V,setShowPriorityModal:de,priorityValue:ae,setPriorityValue:je,dueDateValue:ve,setDueDateValue:ls,isProcessing:J,submitPriority:Dt})}),be&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Wa,{showMemberFilesModal:be,setShowMemberFilesModal:_e,selectedMember:b,setSelectedMember:$,memberFiles:se,setMemberFiles:ne,isLoading:p,formatFileSize:Ge})}),Es&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(qa,{showCreateAssignmentModal:Es,setShowCreateAssignmentModal:ps,assignmentForm:ze,setAssignmentForm:Ds,teamMembers:Me,isProcessing:J,createAssignment:bt,currentUserId:a.id})}),B&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ka,{showReviewModal:B,setShowReviewModal:P,selectedFile:Y,reviewAction:W,setReviewAction:I,fileComments:x,reviewComments:X,setReviewComments:O,isProcessing:J,handleReviewSubmit:_t,formatFileSize:Ge,user:a})}),E&&e.jsx(n.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ja,{showModal:E,setShowModal:H,selectedFile:Y,formatFileSize:Ge,user:a})})]})})};const ot=n.createContext(null),Ga=({children:a,initialUser:s})=>{const[t,i]=n.useState(s||null),[l,o]=n.useState(!!s);n.useEffect(()=>{s&&(i(s),o(!0))},[s]);const S={user:t,isAuthenticated:l,login:N=>{i(N),o(!0)},logout:()=>{i(null),o(!1)},updateUser:N=>{i(T=>({...T,...N}))},hasPermission:N=>{if(!t)return!1;const T={ADMIN:3,"TEAM LEADER":2,USER:1},L=T[t.role]||0,m=T[N]||0;return L>=m}};return e.jsx(ot.Provider,{value:S,children:a})},Ie=()=>{const a=n.useContext(ot);if(!a)throw new Error("useAuth must be used within an AuthProvider");return a},rt=n.createContext(null),Ya="http://localhost:3001",Za=({children:a})=>{const[s,t]=n.useState(!0),[i,l]=n.useState(!0),[o,r]=n.useState(null),[c,y]=n.useState(3e4),g=n.useCallback(async()=>{try{const T=(await fetch(`${Ya}/api/health`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok;return l(T),t(!0),r(new Date),T}catch(N){return console.warn("Network check failed:",N.message),l(!1),t(navigator.onLine),r(new Date),!1}},[]);n.useEffect(()=>{g()},[g]),n.useEffect(()=>{const N=setInterval(g,c);return()=>clearInterval(N)},[g,c]),n.useEffect(()=>{const N=()=>{t(!0),g()},T=()=>{t(!1),l(!1)};return window.addEventListener("online",N),window.addEventListener("offline",T),()=>{window.removeEventListener("online",N),window.removeEventListener("offline",T)}},[g]);const S={isOnline:s,isServerAvailable:i,isConnected:s&&i,lastChecked:o,checkNetworkStatus:g,setCheckInterval:y};return e.jsx(rt.Provider,{value:S,children:a})},$e=()=>{const a=n.useContext(rt);if(!a)throw new Error("useNetwork must be used within a NetworkProvider");return a},Xa=n.createContext(null),en=({children:a,userId:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(0),[r,c]=n.useState(!1),y=n.useRef(null),g=n.useCallback(async(p=!1)=>{if(s){p||c(!0);try{const f=await(await fetch(`http://localhost:3001/api/notifications/user/${s}?page=1&limit=20`)).json();f.success&&(i(f.notifications||[]),o(f.unreadCount||0))}catch(u){console.error("Error fetching notifications:",u)}finally{p||c(!1)}}},[s]),S=n.useCallback(async p=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${p}/read`,{method:"PUT"})).json()).success&&(i(C=>C.map(k=>k.id===p?{...k,is_read:!0}:k)),o(C=>Math.max(0,C-1)))}catch(u){console.error("Error marking notification as read:",u)}},[]),N=n.useCallback(async()=>{if(s)try{(await(await fetch(`http://localhost:3001/api/notifications/user/${s}/read-all`,{method:"PUT"})).json()).success&&(i(f=>f.map(C=>({...C,is_read:!0}))),o(0))}catch(p){console.error("Error marking all as read:",p)}},[s]),T=n.useCallback(async p=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${p}`,{method:"DELETE"})).json()).success){const C=t.find(k=>k.id===p);i(k=>k.filter(z=>z.id!==p)),C&&!C.is_read&&o(k=>Math.max(0,k-1))}}catch(u){console.error("Error deleting notification:",u)}},[t]),L=n.useCallback((p=3e4)=>{y.current&&clearInterval(y.current),y.current=setInterval(()=>{g(!0)},p)},[g]),m=n.useCallback(()=>{y.current&&(clearInterval(y.current),y.current=null)},[]);n.useEffect(()=>(s&&(g(),L()),()=>m()),[s,g,L,m]);const M={notifications:t,unreadCount:l,isLoading:r,fetchNotifications:g,markAsRead:S,markAllAsRead:N,deleteNotification:T,startPolling:L,stopPolling:m};return e.jsx(Xa.Provider,{value:M,children:a})};class sn extends n.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){const{onError:i,componentName:l}=this.props;console.error("ðŸš¨ Error Boundary Caught Error:",{component:l||"Unknown",error:s.toString(),stack:t.componentStack,timestamp:new Date().toISOString()}),this.setState(o=>({error:s,errorInfo:t,errorCount:o.errorCount+1})),i&&i(s,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};logErrorToService=(s,t)=>{};render(){const{hasError:s,error:t,errorInfo:i,errorCount:l}=this.state,{children:o,fallback:r,componentName:c="Component",showDetails:y=!1}=this.props;return s?r?typeof r=="function"?r(t,this.handleReset):r:e.jsx("div",{className:"error-boundary-container",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h2",{className:"error-title",children:"Something went wrong"}),e.jsxs("p",{className:"error-message",children:[c," encountered an unexpected error and couldn't render."]}),y&&t&&e.jsx("div",{className:"error-details",children:e.jsxs("details",{children:[e.jsx("summary",{className:"error-summary",children:"Technical Details (Click to expand)"}),e.jsxs("div",{className:"error-stack",children:[e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error:"}),e.jsx("pre",{children:t.toString()})]}),i&&e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Component Stack:"}),e.jsx("pre",{children:i.componentStack})]}),e.jsxs("div",{className:"error-info-section",children:[e.jsx("strong",{children:"Error Count:"})," ",l]})]})]})}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:this.handleReset,className:"error-btn error-btn-primary",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"error-btn error-btn-secondary",children:"Reload Page"})]}),l>2&&e.jsxs("div",{className:"error-persistent-notice",children:[e.jsxs("p",{children:["âš ï¸ This error has occurred ",l," times."]}),e.jsx("p",{children:"If the problem persists, please contact support."})]})]})}):o}}const Te=(a,s={})=>{const t=i=>e.jsx(sn,{...s,children:e.jsx(a,{...i})});return t.displayName=`withErrorBoundary(${a.displayName||a.name||"Component"})`,t},tn=({user:a,users:s})=>{Ie();const{isConnected:t}=$e(),[i,l]=n.useState(!0),[o,r]=n.useState(""),[c,y]=n.useState({totalFiles:0,approved:0,pending:0,rejected:0,fileTypes:[],recentActivity:[],approvalRate:0,approvalTrends:[],previousMonth:{totalFiles:0,approved:0,pending:0,rejected:0}});n.useEffect(()=>{let p=!0;const u=async()=>{if(t){l(!0),r("");try{const C=await(await fetch("http://localhost:3001/api/dashboard/summary")).json();if(!p)return;C.success?y(C.summary):r(C.message||"Failed to load dashboard data")}catch(f){if(console.error("Error fetching dashboard summary:",f),!p)return;r("Unable to connect to server")}finally{p&&l(!1)}}};if(t){u();const f=setInterval(u,60*1e3);return()=>{p=!1,clearInterval(f)}}},[t]);const g=c.pending,S=c.approved,N=c.rejected,T=c.totalFiles;n.useMemo(()=>c.recentActivity.filter(p=>p.activity&&p.activity.toLowerCase().includes("team leader")).length,[c.recentActivity]),n.useMemo(()=>c.recentActivity.filter(p=>p.activity&&p.activity.toLowerCase().includes("admin")).length,[c.recentActivity]);const L=n.useMemo(()=>{const p=(u,f)=>f===0?u>0?100:0:(u-f)/f*100;return c.previousMonth?{pending:p(g,c.previousMonth.pending),approved:p(S,c.previousMonth.approved),rejected:p(N,c.previousMonth.rejected),total:p(T,c.previousMonth.totalFiles)}:{pending:0,approved:0,rejected:0,total:0}},[g,S,N,T,c.previousMonth]),m=p=>{const u=Math.abs(p),f=p>0?"â†‘":p<0?"â†“":"â€”",C=p>0?"positive":p<0?"negative":"neutral",k=u.toFixed(1);return p===0?{text:"â€” No change from last month",className:"neutral"}:{text:`${f} ${p>=0?"+":"-"}${k}% from last month`,className:C}},M=n.useMemo(()=>c.recentActivity.map(p=>e.jsx("div",{className:"activity-item",children:e.jsxs("div",{className:"activity-content",children:[e.jsxs("div",{className:"activity-header",children:[e.jsx("span",{className:"activity-user",children:p.username||p.role||"System"}),e.jsx("span",{className:"activity-badge "+(p.activity&&p.activity.toLowerCase().includes("approved")?"approved":p.activity&&p.activity.toLowerCase().includes("rejected")?"rejected":"upload"),children:(p.activity||"").split(" ")[0]})]}),e.jsx("div",{className:"activity-description",children:p.activity}),e.jsx("div",{className:"activity-meta",children:new Date(p.timestamp).toLocaleString()})]})},p.id)),[c.recentActivity]);return t?e.jsxs("div",{className:`dashboard-overview ${i?"loading-cursor":""}`,children:[e.jsx("div",{className:"top-row",children:e.jsx("div",{className:"stats-section",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Pending Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":g}),!i&&e.jsx("div",{className:`stat-change ${m(L.pending).className}`,children:m(L.pending).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Approved Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":S.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${m(L.approved).className}`,children:m(L.approved).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Rejected Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":N}),!i&&e.jsx("div",{className:`stat-change ${L.rejected>0?"negative":L.rejected<0?"positive":"neutral"}`,children:m(L.rejected).text})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-header",children:e.jsx("span",{className:"stat-label",children:"Total Files"})}),e.jsx("div",{className:"stat-number",children:i?"â€”":T.toLocaleString()}),!i&&e.jsx("div",{className:`stat-change ${m(L.total).className}`,children:m(L.total).text})]})]})})}),e.jsxs("div",{className:"bottom-row",children:[e.jsxs("div",{className:"charts-section",children:[e.jsxs("div",{className:"chart-card",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{children:"File Approval Trends"})}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading trends..."}),!i&&(!c.approvalTrends||c.approvalTrends.length===0)&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No trend data available"}),!i&&c.approvalTrends&&c.approvalTrends.length>0&&e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 700 300",preserveAspectRatio:"xMidYMid meet",style:{background:"transparent"},children:(()=>{const p=c.approvalTrends.slice(-30),u=Math.max(...p.map(B=>Math.max(B.approved||0,B.rejected||0)),1),f={left:50,right:50,top:30,bottom:50},C=700-f.left-f.right,k=300-f.top-f.bottom,z=C/Math.max(p.length-1,1),Y=p.map((B,P)=>({x:f.left+P*z,y:f.top+k-(B.approved||0)/u*k})),U=p.map((B,P)=>({x:f.left+P*z,y:f.top+k-(B.rejected||0)/u*k}));return e.jsxs(e.Fragment,{children:[[0,.25,.5,.75,1].map(B=>{const P=f.top+k-B*k;return e.jsx("line",{x1:f.left,y1:P,x2:f.left+C,y2:P,stroke:"#E5E7EB",strokeWidth:"1",strokeDasharray:"4 4"},B)}),Y.map((B,P)=>{if(P===0)return null;const E=Y[P-1];return e.jsx("line",{x1:E.x,y1:E.y,x2:B.x,y2:B.y,stroke:"#10B981",strokeWidth:"3"},`approved-${P}`)}),U.map((B,P)=>{if(P===0)return null;const E=U[P-1];return e.jsx("line",{x1:E.x,y1:E.y,x2:B.x,y2:B.y,stroke:"#EF4444",strokeWidth:"3"},`rejected-${P}`)}),Y.map((B,P)=>e.jsx("circle",{cx:B.x,cy:B.y,r:"4",fill:"#10B981"},`approved-point-${P}`)),U.map((B,P)=>e.jsx("circle",{cx:B.x,cy:B.y,r:"4",fill:"#EF4444"},`rejected-point-${P}`)),p.map((B,P)=>{if(P%5!==0&&P!==p.length-1)return null;const E=f.left+P*z,H=B.day||B.date||`D${P+1}`;return e.jsx("text",{x:E,y:f.top+k+30,fontSize:"11",fill:"#6B7280",textAnchor:"middle",children:H},`label-${P}`)}),e.jsxs("g",{transform:`translate(${f.left}, 10)`,children:[e.jsx("circle",{cx:"0",cy:"0",r:"4",fill:"#10B981"}),e.jsx("text",{x:"10",y:"4",fontSize:"12",fill:"#6B7280",children:"Approved"}),e.jsx("circle",{cx:"80",cy:"0",r:"4",fill:"#EF4444"}),e.jsx("text",{x:"90",y:"4",fontSize:"12",fill:"#6B7280",children:"Rejected"})]})]})})()})]})]}),e.jsxs("div",{className:"chart-card",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{children:"File Types Distribution"}),e.jsx("span",{style:{fontSize:"12px",color:"var(--text-tertiary)"},children:"All file types tracked"})]}),e.jsxs("div",{className:"chart-content",children:[i&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"Loading file types..."}),!i&&c.fileTypes.length===0&&e.jsx("div",{style:{padding:"1rem",textAlign:"center"},children:"No file type data available"}),!i&&c.fileTypes.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"100%",height:"300",viewBox:"0 0 200 200",children:(()=>{const p=c.fileTypes.reduce((C,k)=>C+k.count,0),u=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];let f=0;return c.fileTypes.map((C,k)=>{const z=C.count/p*100,Y=`${z/100*440} 440`,U=e.jsx("circle",{cx:"100",cy:"100",r:"70",fill:"none",stroke:u[k%u.length]||"#999",strokeWidth:"30",strokeDasharray:Y,strokeDashoffset:-f},C.file_type);return f+=z/100*440,U})})()}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"8px"},children:c.fileTypes.map((p,u)=>{const f=["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#14B8A6","#A855F7","#F43F5E"];return e.jsxs("span",{style:{whiteSpace:"nowrap"},children:[e.jsx("span",{style:{color:f[u%f.length]||"#999"},children:"â– "}),"Â ",p.file_type||"Unknown"," (",p.count,")"]},p.file_type)})})})]})]})]})]}),e.jsxs("div",{className:"section-card activity-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h3",{children:"Recent Activity"})}),e.jsxs("div",{className:"activity-list",children:[i&&e.jsx("div",{style:{padding:"1rem"},children:"Loading recent activityâ€¦"}),!i&&c.recentActivity.length===0&&e.jsx("div",{style:{padding:"1rem"},children:"No recent activity"}),!i&&M]})]})]})]}):e.jsx(ce,{type:"admin"})},Ks=Te(n.memo(tn),{componentName:"Dashboard Overview"});const ks=({isOpen:a,onClose:s,onSubmit:t,title:i,submitText:l="Submit",cancelText:o="Cancel",isLoading:r=!1,size:c="medium",children:y})=>{if(!a)return null;const g=T=>{T.target===T.currentTarget&&!r&&s()},S=T=>{T.preventDefault(),t&&t(T)},N=()=>{switch(c){case"small":return"modal-small";case"large":return"modal-large";default:return"modal-medium"}};return e.jsx("div",{className:"modal-overlay",onClick:g,children:e.jsxs("div",{className:`modal form-modal ${N()}`,onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:i}),e.jsx("button",{onClick:s,className:"modal-close",type:"button",disabled:r,children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{className:"modal-body",children:y}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",onClick:s,className:"btn btn-secondary",disabled:r,children:o}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?"Processing...":l})]})]})]})})};const an=({isOpen:a,onClose:s,file:t,onApprove:i,onReject:l,onOpenFile:o,isLoading:r,isOpeningFile:c,formatFileSize:y,mapFileStatus:g,getStatusDisplayName:S})=>{if(!a||!t)return null;const N=y(t.file_size),T=new Date(t.uploaded_at).toLocaleString();return e.jsx("div",{className:"file-details-modal-component",children:e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal file-modal",onClick:L=>L.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"File Details"}),e.jsx("button",{onClick:s,className:"modal-close",children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"file-details-section",children:[e.jsx("h4",{className:"section-title",children:"File Details"}),e.jsxs("div",{className:"file-details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE NAME:"}),e.jsx("span",{className:"detail-value",children:t.original_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE TYPE:"}),e.jsx("span",{className:"detail-value",children:Pa(t.file_type,t.original_name)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"FILE SIZE:"}),e.jsx("span",{className:"detail-value",children:N})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"SUBMITTED BY:"}),e.jsx("span",{className:"detail-value",children:t.username})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"TEAM:"}),e.jsx("span",{className:"detail-value team-badge-inline",children:t.user_team})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"UPLOAD DATE:"}),e.jsx("span",{className:"detail-value",children:T})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"STATUS:"}),e.jsx("span",{className:`detail-value status-badge status-${g(t.status)}`,children:S(t.status)})]})]})]}),e.jsx("div",{className:"actions-section",children:e.jsxs("div",{className:"action-buttons-large",children:[e.jsxs("button",{type:"button",onClick:i,className:"btn btn-success-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M16.875 5L7.5 14.375L3.125 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Approve"]}),e.jsxs("button",{type:"button",onClick:l,className:"btn btn-danger-large",disabled:r||t.status==="final_approved"||t.status==="rejected_by_team_leader"||t.status==="rejected_by_admin",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Reject"]}),e.jsxs("button",{onClick:o,className:"btn btn-secondary-large",disabled:r||c,children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M15 10.8333V15.8333C15 16.2754 14.8244 16.6993 14.5118 17.0118C14.1993 17.3244 13.7754 17.5 13.3333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V6.66667C2.5 6.22464 2.67559 5.80072 2.98816 5.48816C3.30072 5.17559 3.72464 5 4.16667 5H9.16667M12.5 2.5H17.5M17.5 2.5V7.5M17.5 2.5L8.33333 11.6667",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),c?"Opening...":"Open"]})]})})]})]})})})},nn=(a=[],s=10)=>{const[t,i]=n.useState(1),l=n.useMemo(()=>Math.ceil(a.length/s),[a.length,s]),o=n.useMemo(()=>{const p=(t-1)*s,u=p+s;return a.slice(p,u)},[a,t,s]),r=n.useMemo(()=>(t-1)*s,[t,s]),c=n.useMemo(()=>Math.min(r+s,a.length),[r,s,a.length]),y=n.useCallback(p=>{const u=Math.max(1,Math.min(p,l));i(u)},[l]),g=n.useCallback(()=>{i(p=>Math.min(p+1,l))},[l]),S=n.useCallback(()=>{i(p=>Math.max(p-1,1))},[]),N=n.useCallback(()=>{i(1)},[]),T=n.useCallback(()=>{i(l)},[l]),L=n.useCallback(()=>{i(1)},[]),m=t<l,M=t>1;return{currentPage:t,totalPages:l,paginatedItems:o,startIndex:r,endIndex:c,itemsPerPage:s,goToPage:y,nextPage:g,prevPage:S,goToFirstPage:N,goToLastPage:T,resetPagination:L,canGoNext:m,canGoPrev:M}},ln=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,user:o,contextData:r})=>{const{user:c}=Ie(),{isConnected:y}=$e(),[g,S]=n.useState([]),[N,T]=n.useState([]),[L,m]=n.useState(!1),[M,p]=n.useState(""),[u,f]=n.useState(!1),[C,k]=n.useState(null),[z,Y]=n.useState(!1),[U,B]=n.useState(!1),[P,E]=n.useState(!1),[H,X]=n.useState(!1),[O,W]=n.useState(null),[I,J]=n.useState({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),ee=n.useMemo(()=>{let _=g;if(M.trim()!==""){const G=M.toLowerCase();_=g.filter(ae=>ae.fullName.toLowerCase().includes(G)||ae.username.toLowerCase().includes(G)||ae.email.toLowerCase().includes(G)||ae.role.toLowerCase().includes(G)||ae.team&&ae.team.toLowerCase().includes(G))}return _.sort((G,ae)=>{const je=new Date(G.created_at||0),ve=new Date(ae.created_at||0);return je-ve})},[M,g]),{currentPage:te,totalPages:h,paginatedItems:x,startIndex:F,endIndex:w,goToPage:d,nextPage:j,prevPage:v,resetPagination:q}=nn(ee,9),K=n.useMemo(()=>N.filter(_=>_.is_active),[N]),Z=n.useCallback(async()=>{f(!0);try{const G=await(await fetch("http://localhost:3001/api/users")).json();G.success?(S(G.users),q()):i("Failed to fetch users")}catch(_){console.error("Error fetching users:",_),i("Failed to connect to server")}finally{f(!1)}},[i,q]),re=n.useCallback(async()=>{m(!0);try{const G=await(await fetch("http://localhost:3001/api/teams")).json();G.success&&T(G.teams||[])}catch(_){console.error("Error fetching teams:",_)}finally{m(!1)}},[]);n.useEffect(()=>{Z(),re()},[Z,re]),n.useEffect(()=>{if(r&&r.action==="reset-password"&&r.userId){console.log("ðŸ”‘ Opening password reset modal for user:",r);const _=g.find(G=>G.id===r.userId);_?(xe(_),l(`Password reset request from ${r.username||_.username}`),setTimeout(()=>{const G=document.querySelector(`[data-user-id="${r.userId}"]`);G&&(G.scrollIntoView({behavior:"smooth",block:"center"}),G.classList.add("highlight-user"),setTimeout(()=>G.classList.remove("highlight-user"),2e3))},300)):i("User not found. They may have been deleted.")}},[r,g,l,i]);const fe=n.useCallback(async _=>{_.preventDefault(),f(!0),i("");try{const ae=await(await fetch("http://localhost:3001/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...I,adminId:c.id,adminUsername:c.username,adminRole:c.role,adminTeam:c.team})})).json();ae.success?(l("User created successfully"),Y(!1),J({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),Z()):i(ae.message)}catch{i("Failed to create user")}finally{f(!1)}},[I,c,i,l,Z]),ge=n.useCallback(async _=>{_.preventDefault(),f(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${C.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:I.fullName,username:I.username,email:I.email,role:I.role,team:I.team,adminId:c.id,adminUsername:c.username,adminRole:c.role,adminTeam:c.team})})).json();ae.success?(l("User updated successfully"),B(!1),k(null),Z()):i(ae.message)}catch{i("Failed to update user")}finally{f(!1)}},[I,C,c,i,l,Z]),we=n.useCallback(async _=>{_.preventDefault(),f(!0),i("");try{const ae=await(await fetch(`http://localhost:3001/api/users/${C.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:I.password,adminId:c.id,adminUsername:c.username,adminRole:c.role,adminTeam:c.team})})).json();ae.success?(l("Password reset successfully"),E(!1),k(null),J(je=>({...je,password:""}))):i(ae.message)}catch{i("Failed to reset password")}finally{f(!1)}},[I.password,C,c,i,l]),Ce=n.useCallback(async()=>{if(O){f(!0);try{const G=await(await fetch(`http://localhost:3001/api/users/${O.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:c.id,adminUsername:c.username,adminRole:c.role,adminTeam:c.team})})).json();G.success?(l(`User ${O.fullName} deleted successfully`),X(!1),W(null),Z()):i(G.message)}catch{i("Failed to delete user")}finally{f(!1)}}},[O,c,i,l,Z]),Se=n.useCallback(_=>{i(""),l(""),k(_),J({fullName:_.fullName||"",username:_.username||"",email:_.email||"",password:"",role:_.role||"USER",team:_.team||""}),B(!0)},[i,l]),xe=n.useCallback(_=>{i(""),l(""),k(_),J(G=>({...G,password:""})),E(!0)},[i,l]),A=n.useCallback(_=>{W(_),X(!0)},[]),Q=n.useCallback(()=>{i(""),l(""),k(null),J({fullName:"",username:"",email:"",password:"",role:"USER",team:""}),Y(!0)},[i,l]),V=n.useCallback((_,G)=>{J(ae=>({...ae,[_]:G}))},[]),de=n.useCallback(_=>{p(_.target.value),q()},[q]);return y?e.jsxs("div",{className:`users-management ${u?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsx("div",{className:"search-section",children:e.jsx("div",{className:"search-container",children:e.jsx("input",{type:"text",placeholder:"Search users by name, email, role, or team...",value:M,onChange:de,className:"search-input"})})}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn btn-primary",onClick:Q,children:"Add User"})})]}),s&&e.jsx(me,{type:"error",message:s,onClose:a}),t&&e.jsx(me,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[u?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading users..."})]}):e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Password"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.map(_=>{const G=_.role.toLowerCase().replace(" ","-");return e.jsxs("tr",{className:"user-row","data-user-id":_.id,children:[e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:_.fullName})})}),e.jsx("td",{children:_.username}),e.jsx("td",{className:"email-cell",children:_.email}),e.jsx("td",{children:e.jsxs("div",{className:"password-cell",children:[e.jsx("span",{className:"password-hidden",children:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),e.jsx("button",{className:"password-reset-btn",onClick:()=>xe(_),title:"Reset Password",children:"Reset"})]})}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${G}`,children:_.role})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:_.team||"â€”"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit-btn",onClick:()=>Se(_),title:"Edit User",children:"Edit"}),e.jsx("button",{className:"action-btn delete-btn",onClick:()=>A(_),title:"Delete User",children:"Delete"})]})})]},_.id)})})]})}),!u&&ee.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No users found"}),e.jsx("p",{children:"No users match your current search criteria."})]}),!u&&h>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",F+1," to ",w," of ",ee.length," users"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:v,disabled:te===1,title:"Previous Page",children:"â€¹"}),e.jsx("div",{className:"pagination-numbers",children:Array.from({length:Math.min(5,h)},(_,G)=>{let ae;return h<=5||te<=3?ae=G+1:te>=h-2?ae=h-4+G:ae=te-2+G,e.jsx("button",{className:`pagination-number ${te===ae?"active":""}`,onClick:()=>d(ae),children:ae},ae)})}),e.jsx("button",{className:"pagination-btn",onClick:j,disabled:te===h,title:"Next Page",children:"â€º"})]})]})]}),z&&e.jsx(ks,{isOpen:z,onClose:()=>Y(!1),onSubmit:fe,title:"Add New User",submitText:"Create User",isLoading:u,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:I.fullName,onChange:_=>V("fullName",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:I.username,onChange:_=>V("username",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:I.email,onChange:_=>V("email",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password *"}),e.jsx("input",{type:"password",value:I.password,onChange:_=>V("password",_.target.value),required:!0,minLength:"6",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:I.role,onChange:_=>V("role",_.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:I.team,onChange:_=>V("team",_.target.value),className:"form-select",disabled:L,children:[e.jsx("option",{value:"",children:"Select Team"}),K.map(_=>e.jsxs("option",{value:_.name,children:[_.name,_.leader_username&&` (Led by ${_.leader_username})`]},_.id))]}),L&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),U&&C&&e.jsx(ks,{isOpen:U,onClose:()=>B(!1),onSubmit:ge,title:"Edit User",submitText:"Update User",isLoading:u,size:"medium",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:I.fullName,onChange:_=>V("fullName",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username *"}),e.jsx("input",{type:"text",value:I.username,onChange:_=>V("username",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:I.email,onChange:_=>V("email",_.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role *"}),e.jsxs("select",{value:I.role,onChange:_=>V("role",_.target.value),className:"form-select",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TEAM LEADER",children:"Team Leader"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team"}),e.jsxs("select",{value:I.team,onChange:_=>V("team",_.target.value),className:"form-select",disabled:L,children:[e.jsx("option",{value:"",children:"Select Team"}),K.map(_=>e.jsxs("option",{value:_.name,children:[_.name,_.leader_username&&` (Led by ${_.leader_username})`]},_.id))]}),L&&e.jsx("p",{className:"help-text",children:"Loading teams..."})]})]})}),P&&C&&e.jsxs(ks,{isOpen:P,onClose:()=>E(!1),onSubmit:we,title:"Reset Password",submitText:"Reset Password",isLoading:u,size:"small",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:["User: ",e.jsxs("strong",{children:[C.fullName," (",C.username,")"]})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password *"}),e.jsx("input",{type:"password",value:I.password,onChange:_=>V("password",_.target.value),required:!0,minLength:"6",placeholder:"Enter new password",className:"form-input"})]})]}),H&&O&&e.jsx(Re,{isOpen:H,onClose:()=>X(!1),onConfirm:Ce,title:"Delete User",message:"Are you sure you want to delete this user?",confirmText:"Delete User",variant:"danger",isLoading:u,itemInfo:{name:O.fullName,details:`${O.email} â€¢ ${O.role}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The user account and all associated data will be permanently removed from the system."})})]}):e.jsx(ce,{type:"table"})},on=Te(ln,{componentName:"User Management"});function ct(a){const s=new Map;return function(...i){const l=JSON.stringify(i);if(s.has(l))return s.get(l);const o=a(...i);return s.set(l,o),o}}const rn=ct(a=>new Date(a).toLocaleDateString()),cn=ct(a=>new Date(a).toLocaleTimeString()),dn=n.memo(({log:a})=>e.jsxs("tr",{children:[e.jsx("td",{children:a.username}),e.jsx("td",{children:a.role}),e.jsx("td",{children:a.team}),e.jsxs("td",{children:[rn(a.timestamp)," ",cn(a.timestamp)]}),e.jsx("td",{children:a.activity})]})),hn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Ie();const{isConnected:o}=$e(),[r,c]=n.useState([]),[y,g]=n.useState(""),[S,N]=n.useState(""),[T,L]=n.useState("all"),[m,M]=n.useState(1),[p,u]=n.useState(!1),[f,C]=n.useState(!1);n.useState(null),n.useState(!1);const k=12;n.useEffect(()=>{T==="all"&&o&&H()},[T,o]),n.useEffect(()=>{const h=setTimeout(()=>N(y),300);return()=>clearTimeout(h)},[y]);const z=n.useMemo(()=>{let h=[...r];if(S.trim()!==""){const x=S.toLowerCase();h=h.filter(F=>F.username.toLowerCase().includes(x)||F.role.toLowerCase().includes(x)||F.team.toLowerCase().includes(x)||F.activity.toLowerCase().includes(x))}if(T!=="all"){const x=new Date,F=new Date(x.getFullYear(),x.getMonth(),x.getDate());h=h.filter(w=>{const d=new Date(w.timestamp);switch(T){case"today":return d>=F;case"week":const j=new Date(F);return j.setDate(F.getDate()-7),d>=j;case"month":const v=new Date(F);return v.setMonth(F.getMonth()-1),d>=v;default:return!0}})}return h},[r,S,T]),Y=n.useMemo(()=>{const h=Math.ceil(z.length/k),x=(m-1)*k,F=x+k,w=z.slice(x,F);return{totalPages:h,startIndex:x,endIndex:F,currentLogs:w}},[z,m,k]),{totalPages:U,startIndex:B,endIndex:P,currentLogs:E}=Y;n.useEffect(()=>{M(1)},[z]);const H=async(h=1e4)=>{u(!0);try{const x=`http://localhost:3001/api/activity-logs?limit=${h}`,w=await(await fetch(x)).json();w.success?c(w.logs):i("Failed to fetch activity logs")}catch(x){console.error("Error fetching activity logs:",x),i("Failed to connect to server")}finally{u(!1)}},X=()=>{const h=[["Username","Role","Team","Date & Time","Activity"],...z.map(d=>[d.username,d.role,d.team,new Date(d.timestamp).toLocaleString(),d.activity])].map(d=>d.join(",")).join(`
`),x=new Blob([h],{type:"text/csv"}),F=window.URL.createObjectURL(x),w=document.createElement("a");w.href=F,w.download=`activity-logs-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(F),l("Activity logs exported successfully")},O=()=>{g(""),L("all"),M(1),l("All filters cleared")},W=n.useCallback(()=>{g("")},[]);n.useCallback(h=>{M(h)},[]),n.useCallback(()=>{M(h=>Math.max(h-1,1))},[]),n.useCallback(()=>{M(h=>Math.min(h+1,U))},[U]);const I=n.useMemo(()=>{const h=[];if(U<=5)for(let F=1;F<=U;F++)h.push(e.jsx("button",{className:`pagination-btn ${F===m?"active":""}`,onClick:()=>M(F),children:F},F));else{h.push(e.jsx("button",{className:`pagination-btn ${m===1?"active":""}`,onClick:()=>M(1),children:"1"},1)),m>3&&h.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const F=Math.max(2,m-1),w=Math.min(U-1,m+1);for(let d=F;d<=w;d++)d!==1&&d!==U&&h.push(e.jsx("button",{className:`pagination-btn ${d===m?"active":""}`,onClick:()=>M(d),children:d},d));m<U-2&&h.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),U>1&&h.push(e.jsx("button",{className:`pagination-btn ${U===m?"active":""}`,onClick:()=>M(U),children:U},U))}return h},[U,m]),J=()=>{const h=y.trim()!=="",x=T!=="all";if(h&&x){const F={today:"today",week:"this week",month:"this month"}[T];return`search "${y}" and ${F}`}else{if(h)return`search "${y}"`;if(x)return`date filter "${{today:"today",week:"this week",month:"this month"}[T]}"`}return"current filters"},ee=async()=>{if(!(y.trim()!=="")&&!(T!=="all")){i("Please apply a search term or date filter to specify logs for deletion");return}if(z.length===0){i("No logs found matching your current filter criteria");return}C(!0)},te=async()=>{const h=z.length,x=z.map(F=>F.id);console.log("Attempting to delete logs:",{logsToDelete:h,logIdsToDelete:x});try{const F=await fetch("http://localhost:3001/api/health");console.log("API health check:",F.status,F.ok)}catch(F){console.error("API health check failed:",F),i("Cannot connect to server. Please ensure the server is running."),u(!1);return}u(!0);try{console.log("Making delete request to:","http://localhost:3001/api/activity-logs/bulk-delete");const F=await fetch("http://localhost:3001/api/activity-logs/bulk-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({logIds:x})});if(console.log("Response status:",F.status,"OK:",F.ok),!F.ok){const j=await F.text();throw console.error("Response error text:",j),new Error(`HTTP error! status: ${F.status} - ${j}`)}const w=await F.json();if(console.log("Delete response:",w),!w.success)throw new Error(w.message||"Failed to delete logs");const d=r.filter(j=>!x.includes(j.id));console.log("Updating state:",{originalCount:r.length,newCount:d.length,deletedCount:w.deletedCount}),c(d),M(1),C(!1),s&&i(""),l(`Successfully deleted ${w.deletedCount||h} log(s) matching your filter criteria`)}catch(F){console.error("Error deleting logs:",F),i(`Failed to delete logs: ${F.message}`)}finally{u(!1)}};return o?e.jsxs("div",{className:`activity-logs-section ${p?"loading-cursor":""}`,children:[e.jsxs("div",{className:"action-bar",children:[e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-container",children:[e.jsx("input",{type:"text",placeholder:"Search activity logs...",value:y,onChange:h=>g(h.target.value),className:"search-input"}),y&&e.jsx("button",{className:"search-clear-btn",onClick:W,title:"Clear search",children:"Ã—"})]}),e.jsx("div",{className:"date-filter-container",children:e.jsxs("select",{value:T,onChange:h=>L(h.target.value),className:"date-filter-select",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})}),(y||T!=="all")&&e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:O,children:"Clear Filters"})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-danger",onClick:ee,disabled:y.trim()===""&&T==="all"||z.length===0||p,title:y.trim()===""&&T==="all"?"Apply a search term or date filter to specify logs for deletion":`Delete ${z.length} filtered log(s)`,children:p?"Deleting...":`Delete Logs (${z.length})`}),e.jsx("button",{className:"btn btn-primary",onClick:X,disabled:z.length===0,children:"Export Logs"})]})]}),s&&e.jsx(me,{type:"error",message:s,onClose:a}),t&&e.jsx(me,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"table-section",children:[p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading activity logs..."})]}):e.jsx("div",{className:"logs-table-container",children:e.jsxs("table",{className:"activity-logs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Activity"})]})}),e.jsx("tbody",{children:E.map(h=>e.jsx(dn,{log:h},h.id))})]})}),!p&&z.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No activity logs found"}),e.jsx("p",{children:"No activity logs match your current search criteria."})]}),!p&&z.length>0&&U>1&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(m-1)*k+1," to ",Math.min(m*k,z.length)," of ",z.length," logs"]}),U>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>M(h=>Math.max(h-1,1)),disabled:m===1,children:"â€¹"}),I,e.jsx("button",{className:"pagination-btn",onClick:()=>M(h=>Math.min(h+1,U)),disabled:m===U,children:"â€º"})]})]})]}),e.jsxs(Re,{isOpen:f,onClose:()=>C(!1),onConfirm:te,title:"Delete Activity Logs",message:"Are you sure you want to delete these activity logs?",confirmText:`Delete ${z.length} Log(s)`,variant:"danger",isLoading:p,children:[e.jsxs("p",{className:"confirmation-description",children:["You are about to delete ",e.jsxs("strong",{children:[z.length," log(s)"]})," that match your ",J(),"."]}),e.jsx("p",{className:"confirmation-description",style:{marginTop:"0.5rem"},children:"This action cannot be undone. The selected activity logs will be permanently removed from the system and cannot be recovered."})]})]}):e.jsx(ce,{type:"table"})},mn=Te(n.memo(hn),{componentName:"Activity Logs"});const Fe="http://localhost:3001/api",Xe=n.memo(({icon:a,label:s,count:t,className:i})=>e.jsxs("div",{className:`file-status-card ${i}`,children:[e.jsx("div",{className:`status-icon ${i}-icon`,children:a}),e.jsxs("div",{className:"status-info",children:[e.jsx("div",{className:"status-number",children:t}),e.jsx("div",{className:"status-label",children:s})]})]})),un=n.memo(()=>e.jsxs("tr",{className:"file-row-skeleton",children:[e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text-lg"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-text"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton skeleton-btn"})})]})),pn=n.memo(({file:a,formatFileSize:s,mapFileStatus:t,getStatusDisplayName:i,onOpenModal:l,onDelete:o})=>{const r=n.useCallback(()=>{l(a)},[a,l]),c=n.useCallback(L=>{L.stopPropagation(),o(a)},[a,o]),g=n.useCallback((L,m)=>{if(L){const M=L.split(".");if(M.length>1)return M[M.length-1].toLowerCase()}return m?m.replace(/^\./,"").toLowerCase():""},[])(a.original_name,a.file_type),S=n.useMemo(()=>new Date(a.uploaded_at).toLocaleDateString(),[a.uploaded_at]),N=n.useMemo(()=>new Date(a.uploaded_at).toLocaleTimeString(),[a.uploaded_at]),T=n.useMemo(()=>s(a.file_size),[a.file_size,s]);return e.jsxs("tr",{className:"file-row",onClick:r,children:[e.jsx("td",{children:e.jsxs("div",{className:"file-cell",children:[e.jsx("div",{className:"file-icon",children:e.jsx(qe,{fileType:g,isFolder:!1,altText:`Icon for ${a.original_name}`,size:"medium"})}),e.jsxs("div",{className:"file-details",children:[e.jsx("span",{className:"file-name",children:a.original_name}),e.jsx("span",{className:"file-size",children:T})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"user-cell",children:e.jsx("span",{className:"user-name",children:a.username})})}),e.jsx("td",{children:e.jsxs("div",{className:"datetime-cell",children:[e.jsx("div",{className:"date",children:S}),e.jsx("div",{className:"time",children:N})]})}),e.jsx("td",{children:e.jsx("span",{className:"team-badge",children:a.user_team})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${t(a.status)}`,children:i(a.status)})}),e.jsx("td",{children:e.jsx("button",{className:"action-btn delete-btn",onClick:c,title:"Delete File",children:"Delete"})})]})}),fn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{const{user:o}=Ie(),{isConnected:r}=$e(),[c,y]=n.useState([]),[g,S]=n.useState(""),[N,T]=n.useState(""),[L,m]=n.useState("all"),[M,p]=n.useState("date-desc"),[u,f]=n.useState(1),[C]=n.useState(7),[k,z]=n.useState(null),[Y,U]=n.useState(!1),[B,P]=n.useState(!1),[E,H]=n.useState(null),[X,O]=n.useState(!0),[W,I]=n.useState(!1),J=n.useRef(null),ee=n.useRef(null),te=n.useRef(null),h=n.useRef(null);n.useEffect(()=>{if(s||t){const A=setTimeout(()=>{a()},3e3);return()=>clearTimeout(A)}},[s,t,a]);const x=n.useCallback(async()=>{h.current&&h.current.abort(),h.current=new AbortController,O(!0);try{const Q=await(await fetch(`${Fe}/files/all`,{signal:h.current.signal})).json();Q.success?y(Q.files):i("Failed to fetch files")}catch(A){A.name!=="AbortError"&&(console.error("Error fetching files:",A),i("Failed to connect to server"))}finally{O(!1)}},[i]);n.useEffect(()=>(r&&x(),()=>{h.current&&h.current.abort()}),[r,x]),n.useEffect(()=>{const A=setTimeout(()=>S(N),300);return()=>clearTimeout(A)},[N]),n.useEffect(()=>{f(1)},[g,L,M]);const F=n.useMemo(()=>({pendingTeamLeader:c.filter(A=>A.status==="uploaded").length,pendingAdmin:c.filter(A=>A.status==="team_leader_approved").length,approved:c.filter(A=>A.status==="final_approved").length,rejected:c.filter(A=>A.status==="rejected_by_team_leader"||A.status==="rejected_by_admin").length}),[c]),w=n.useMemo(()=>{let A=c;if(L!=="all"&&(A=A.filter(Q=>{switch(L){case"pending-team-leader":return Q.status==="uploaded";case"pending-admin":return Q.status==="team_leader_approved";case"approved":return Q.status==="final_approved";case"rejected":return Q.status==="rejected_by_team_leader"||Q.status==="rejected_by_admin";default:return!1}})),g&&g.trim()!==""){const Q=g.toLowerCase();A=A.filter(V=>V.original_name.toLowerCase().includes(Q)||V.username.toLowerCase().includes(Q)||V.user_team.toLowerCase().includes(Q))}return[...A].sort((Q,V)=>{switch(M){case"date-desc":return new Date(V.uploaded_at)-new Date(Q.uploaded_at);case"date-asc":return new Date(Q.uploaded_at)-new Date(V.uploaded_at);case"filename-asc":return Q.original_name.localeCompare(V.original_name);case"filename-desc":return V.original_name.localeCompare(Q.original_name);case"user-asc":return Q.username.localeCompare(V.username);case"user-desc":return V.username.localeCompare(Q.username);default:return 0}})},[c,g,L,M]),d=n.useMemo(()=>{const A=(u-1)*C,Q=A+C;return w.slice(A,Q)},[w,u,C]),j=n.useMemo(()=>Math.ceil(w.length/C),[w.length,C]),v=n.useCallback(A=>{if(A===0)return"0 Bytes";const Q=1024,V=["Bytes","KB","MB","GB"],de=Math.floor(Math.log(A)/Math.log(Q));return parseFloat((A/Math.pow(Q,de)).toFixed(2))+" "+V[de]},[]);n.useMemo(()=>k?v(k.file_size):"",[k,v]),n.useMemo(()=>k?new Date(k.uploaded_at).toLocaleString():"",[k]);const q=n.useCallback(A=>{switch(A){case"uploaded":case"team_leader_approved":return"pending";case"final_approved":return"approved";case"rejected_by_team_leader":case"rejected_by_admin":return"rejected";default:return"pending"}},[]),K=n.useCallback(A=>{switch(A){case"uploaded":return"Pending Team Leader";case"team_leader_approved":return"Pending Admin";case"final_approved":return"Approved";case"rejected_by_team_leader":return"Rejected by Team Leader";case"rejected_by_admin":return"Rejected by Admin";default:return A.charAt(0).toUpperCase()+A.slice(1)}},[]),Z=n.useCallback(A=>{H(A),P(!0)},[]),re=n.useCallback(A=>{z(A),U(!0)},[]),fe=n.useCallback(()=>{U(!1),z(null),I(!1)},[]),ge=n.useCallback(async()=>{if(E){O(!0);try{try{await fetch(`${Fe}/files/${E.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})})}catch(V){console.warn("Physical file deletion failed (file may not exist):",V)}const Q=await(await fetch(`${Fe}/files/${E.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();Q.success?(y(V=>V.filter(de=>de.id!==E.id)),P(!1),H(null),l("File metadata deleted successfully")):i(Q.message||"Failed to delete file metadata")}catch(A){console.error("Error deleting file:",A),i(A.message||"Failed to delete file metadata")}finally{O(!1)}}},[E,o,i,l]),we=n.useCallback(async A=>{if(A){I(!0);try{const V=await(await fetch(`${Fe}/files/${A.id}/path`)).json();if(!V.success)throw new Error("Failed to get file path");const de=V.filePath;if(window.electron&&typeof window.electron.openFileInApp=="function"){const _=await window.electron.openFileInApp(de);if(!_.success)throw new Error(_.error||"Failed to open file")}else i("File opening not available")}catch(Q){console.error("Error opening file:",Q),i(Q.message||"Failed to open file")}finally{I(!1)}}},[i]),Ce=n.useCallback(async()=>{if(k){O(!0);try{let A=!1;if(window.electron&&typeof window.electron.openDirectoryDialog=="function"){const Q={};try{if(typeof window.electron.getNetworkProjectsPath=="function"){const ve=await window.electron.getNetworkProjectsPath();ve&&(Q.defaultPath=ve)}}catch(ve){console.warn("Could not get default path",ve)}const V=await window.electron.openDirectoryDialog(Q);if(!V||V.canceled||!V.filePaths||V.filePaths.length===0){O(!1);return}const de=V.filePaths[0],G=await(await fetch(`${Fe}/files/${k.id}/move-to-projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinationPath:de,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team,deleteFromUploads:!0})})).json();if(!G.success)throw new Error(G.message||"Failed to move file");const je=await(await fetch(`${Fe}/files/${k.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();if(!je.success)throw new Error(je.message||"Failed to approve file");A=!0}else throw new Error("File system access not available");A&&(y(Q=>Q.map(V=>V.id===k.id?{...V,status:"final_approved"}:V)),fe(),l("File approved and moved successfully"),x())}catch(A){console.error("Approval error:",A),i(A.message||"Failed to approve file")}finally{O(!1)}}},[k,o,i,l,fe,x]),Se=n.useCallback(async()=>{if(k){O(!0);try{const Q=await(await fetch(`${Fe}/files/${k.id}/admin-review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject",comments:null,adminId:o.id,adminUsername:o.username,adminRole:o.role,team:o.team})})).json();Q.success?(await fetch(`${Fe}/files/${k.id}/delete-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:o.id,adminUsername:o.username,adminRole:o.role})}).catch(()=>{}),y(V=>V.map(de=>de.id===k.id?{...de,status:"rejected_by_admin"}:de)),fe(),l("File rejected successfully"),x()):i(Q.message||"Failed to reject file")}catch(A){console.error("Error rejecting file:",A),i("Failed to reject file")}finally{O(!1)}}},[k,o,i,l,fe,x]),xe=n.useMemo(()=>{const A=[];if(j<=5)for(let V=1;V<=j;V++)A.push(e.jsx("button",{className:`pagination-btn ${V===u?"active":""}`,onClick:()=>f(V),children:V},V));else{A.push(e.jsx("button",{className:`pagination-btn ${u===1?"active":""}`,onClick:()=>f(1),children:"1"},1)),u>3&&A.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis1"));const V=Math.max(2,u-1),de=Math.min(j-1,u+1);for(let _=V;_<=de;_++)_!==1&&_!==j&&A.push(e.jsx("button",{className:`pagination-btn ${_===u?"active":""}`,onClick:()=>f(_),children:_},_));u<j-2&&A.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},"ellipsis2")),j>1&&A.push(e.jsx("button",{className:`pagination-btn ${j===u?"active":""}`,onClick:()=>f(j),children:j},j))}return A},[j,u]);return r?e.jsxs("div",{className:`file-approval-section ${W?"file-opening-cursor":""}`,children:[s&&e.jsx(me,{type:"error",message:s,onClose:a}),t&&e.jsx(me,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"file-status-cards",ref:J,children:[e.jsx(Xe,{icon:"TL",label:"Pending Team Leader",count:F.pendingTeamLeader,className:"pending"}),e.jsx(Xe,{icon:"AD",label:"Pending Admin",count:F.pendingAdmin,className:"pending-admin"}),e.jsx(Xe,{icon:"AP",label:"Approved Files",count:F.approved,className:"approved"}),e.jsx(Xe,{icon:"RE",label:"Rejected Files",count:F.rejected,className:"rejected"})]}),e.jsxs("div",{className:"file-controls",children:[e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search files by name, user, or team...",value:N,onChange:A=>T(A.target.value),className:"search-input",ref:ee}),g&&e.jsx("button",{className:"search-clear-btn",onClick:()=>{T(""),S("")},title:"Clear search",children:"Ã—"})]}),e.jsxs("div",{className:"file-filters",children:[e.jsxs("select",{value:L,onChange:A=>m(A.target.value),className:"form-select",ref:te,children:[e.jsx("option",{value:"all",children:"All Files"}),e.jsx("option",{value:"pending-team-leader",children:"Pending Team Leader"}),e.jsx("option",{value:"pending-admin",children:"Pending Admin"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsxs("select",{value:M,onChange:A=>p(A.target.value),className:"form-select",children:[e.jsx("option",{value:"date-desc",children:"Latest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"filename-asc",children:"Filename A-Z"}),e.jsx("option",{value:"filename-desc",children:"Filename Z-A"}),e.jsx("option",{value:"user-asc",children:"User A-Z"}),e.jsx("option",{value:"user-desc",children:"User Z-A"})]})]})]}),e.jsxs("div",{className:"table-section",children:[e.jsx("div",{className:"files-table-container",children:e.jsxs("table",{className:"files-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Submitted By"}),e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Team"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:X?Array(C).fill(0).map((A,Q)=>e.jsx(un,{},Q)):d.length>0?d.map(A=>e.jsx(pn,{file:A,formatFileSize:v,mapFileStatus:q,getStatusDisplayName:K,onOpenModal:re,onDelete:Z},A.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No files found"}),e.jsx("p",{children:"No files match your current search and filter criteria."})]})})})})]})}),!X&&w.length>0&&e.jsxs("div",{className:"pagination-section",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(u-1)*C+1," to ",Math.min(u*C,w.length)," of ",w.length," files"]}),j>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>f(A=>Math.max(A-1,1)),disabled:u===1,children:"â€¹"}),xe,e.jsx("button",{className:"pagination-btn",onClick:()=>f(A=>Math.min(A+1,j)),disabled:u===j,children:"â€º"})]})]})]}),e.jsx(an,{isOpen:Y,onClose:fe,file:k,onApprove:Ce,onReject:Se,onOpenFile:()=>we(k),isLoading:X,isOpeningFile:W,formatFileSize:v,mapFileStatus:q,getStatusDisplayName:K}),e.jsx(Re,{isOpen:B&&E,onClose:()=>P(!1),onConfirm:ge,title:"Deleting File",message:"Are you sure you want to delete this file?",confirmText:"Delete File",variant:"danger",isLoading:X,itemInfo:E?{name:E.original_name||E.filename,details:`Submitted by ${E.username} from ${E.user_team} team`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The file and all its associated data will be permanently removed."})})]}):e.jsx(ce,{type:"table"})},xn=Te(fn,{componentName:"File Approval"});class gn{constructor(){this.invertedIndex=new Map,this.fileMetadata=new Map,this.keywordBitmasks=new Map,this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}addFile(s,t={}){const i=this.nextFileId++,l={id:i,path:s,name:t.name||this._getFileName(s),size:t.size||0,modified:t.modified||Date.now(),type:t.type||this._getFileType(s),content:t.content||null};return this.fileMetadata.set(i,l),this._extractKeywords(l).forEach(r=>{this.invertedIndex.has(r)||this.invertedIndex.set(r,new Set),this.invertedIndex.get(r).add(i)}),this.stats.totalFiles++,this.stats.lastIndexTime=Date.now(),i}search(s,t={}){const i=this._normalizeQuery(s);if(i.length===0)return[];let l=null;for(const r of i){const c=this._findMatchingIds(r);if(l===null?l=c:l=new Set([...l].filter(y=>c.has(y))),l.size===0)break}const o=l?Array.from(l).map(r=>this.fileMetadata.get(r)):[];return this._applyFilters(o,t)}_findMatchingIds(s){const t=new Set;this.invertedIndex.has(s)&&this.invertedIndex.get(s).forEach(i=>t.add(i));for(const[i,l]of this.invertedIndex.entries())(i.startsWith(s)||i.includes(s))&&l.forEach(o=>t.add(o));return t}_extractKeywords(s){const t=new Set;s.name.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(r=>r.length>1).forEach(r=>t.add(r));const l=s.name.split(".").pop();return l&&l!==s.name&&t.add(l.toLowerCase()),t.add(s.type),s.content&&s.content.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(c=>c.length>2).slice(0,100).forEach(c=>t.add(c)),s.path.toLowerCase().split(/[\/\\]/).filter(r=>r.length>1).forEach(r=>t.add(r)),t}_normalizeQuery(s){return s.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(t=>t.length>0)}_applyFilters(s,t){let i=[...s];if(t.fileTypes&&t.fileTypes.length>0){const l=t.fileTypes.map(o=>o.startsWith(".")?o.slice(1).toLowerCase():o.toLowerCase());i=i.filter(o=>{const r=o.name.split(".").pop().toLowerCase();return l.includes(r)})}return t.minSize!==void 0&&(i=i.filter(l=>l.size>=t.minSize)),t.maxSize!==void 0&&(i=i.filter(l=>l.size<=t.maxSize)),t.modifiedAfter&&(i=i.filter(l=>l.modified>=t.modifiedAfter)),t.modifiedBefore&&(i=i.filter(l=>l.modified<=t.modifiedBefore)),i.sort((l,o)=>o.modified-l.modified),t.limit&&(i=i.slice(0,t.limit)),i}removeFile(s){const t=this.fileMetadata.get(s);return t?(this._extractKeywords(t).forEach(l=>{const o=this.invertedIndex.get(l);o&&(o.delete(s),o.size===0&&this.invertedIndex.delete(l))}),this.fileMetadata.delete(s),this.stats.totalFiles--,!0):!1}clear(){this.invertedIndex.clear(),this.fileMetadata.clear(),this.keywordBitmasks.clear(),this.nextFileId=0,this.stats={totalFiles:0,totalKeywords:0,indexSize:0,lastIndexTime:null}}getStats(){return{...this.stats,totalKeywords:this.invertedIndex.size,indexSize:this._calculateIndexSize()}}_calculateIndexSize(){let s=0;for(const[t,i]of this.invertedIndex.entries())s+=t.length*2,s+=i.size*8;for(const[,t]of this.fileMetadata.entries())s+=JSON.stringify(t).length*2;return s}_getFileName(s){return s.split(/[\/\\]/).pop()||s}_getFileType(s){const t=s.split(".").pop()?.toLowerCase();return!t||t===s?"file":["pdf","doc","docx","txt","rtf","odt"].includes(t)?"document":["jpg","jpeg","png","gif","bmp","svg","webp"].includes(t)?"image":["mp4","avi","mov","mkv","flv","wmv"].includes(t)?"video":["mp3","wav","flac","aac","ogg","wma"].includes(t)?"audio":["js","jsx","ts","tsx","py","java","cpp","c","cs","php","rb"].includes(t)?"code":["zip","rar","7z","tar","gz"].includes(t)?"archive":"file"}export(){return{fileMetadata:Array.from(this.fileMetadata.entries()),invertedIndex:Array.from(this.invertedIndex.entries()).map(([s,t])=>[s,Array.from(t)]),nextFileId:this.nextFileId,stats:this.stats}}import(s){this.clear(),this.fileMetadata=new Map(s.fileMetadata),this.invertedIndex=new Map(s.invertedIndex.map(([t,i])=>[t,new Set(i)])),this.nextFileId=s.nextFileId,this.stats=s.stats}}class jn{constructor(s=5*60*1e3){this.cache=new Map,this.ttl=s,this.stats={hits:0,misses:0,totalQueries:0},this.maxCacheSize=500,this.accessOrder=new Map}async listDirectory(s,t){this.stats.totalQueries++;const i=this._normalizePath(s),l=this.cache.get(i);if(l&&Date.now()-l.timestamp<this.ttl)return this.stats.hits++,this._updateAccessOrder(i),l.data;this.stats.misses++;try{const o=await t(s);return this._setCache(i,o),o}catch(o){if(l)return console.warn(`Using stale cache for ${s}: ${o.message}`),l.data;throw o}}async prefetchDirectories(s,t){const i=s.map(async l=>{try{const o=this._normalizePath(l);if(!this.cache.has(o)){const r=await t(l);this._setCache(o,r)}}catch(o){console.warn(`Failed to prefetch ${l}:`,o.message)}});await Promise.allSettled(i)}_setCache(s,t){if(this.cache.size>=this.maxCacheSize){const i=this._getOldestKey();i&&(this.cache.delete(i),this.accessOrder.delete(i))}this.cache.set(s,{data:t,timestamp:Date.now()}),this._updateAccessOrder(s)}_updateAccessOrder(s){this.accessOrder.set(s,Date.now())}_getOldestKey(){let s=null,t=1/0;for(const[i,l]of this.accessOrder.entries())l<t&&(t=l,s=i);return s}invalidate(s){const t=this._normalizePath(s);this.cache.delete(t),this.accessOrder.delete(t)}invalidatePrefix(s){const t=this._normalizePath(s),i=[];for(const l of this.cache.keys())l.startsWith(t)&&i.push(l);return i.forEach(l=>{this.cache.delete(l),this.accessOrder.delete(l)}),i.length}clear(){this.cache.clear(),this.accessOrder.clear(),this.stats={hits:0,misses:0,totalQueries:0}}getStats(){const s=this.stats.totalQueries>0?(this.stats.hits/this.stats.totalQueries*100).toFixed(2):0;return{...this.stats,hitRate:`${s}%`,cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,ttlMs:this.ttl}}_normalizePath(s){return s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase()}async warmup(s,t){console.log("Warming up cache with common directories..."),await this.prefetchDirectories(s,t),console.log(`Cache warmed up. Cached ${this.cache.size} directories.`)}getCachedPaths(){return Array.from(this.cache.keys())}isCached(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?!(Date.now()-i.timestamp>=this.ttl):!1}getCacheAge(s){const t=this._normalizePath(s),i=this.cache.get(t);return i?Date.now()-i.timestamp:null}setTTL(s){this.ttl=s}setMaxCacheSize(s){for(this.maxCacheSize=s;this.cache.size>s;){const t=this._getOldestKey();t&&(this.cache.delete(t),this.accessOrder.delete(t))}}export(){return{cache:Array.from(this.cache.entries()),accessOrder:Array.from(this.accessOrder.entries()),stats:this.stats,ttl:this.ttl,maxCacheSize:this.maxCacheSize}}import(s){this.cache=new Map(s.cache),this.accessOrder=new Map(s.accessOrder),this.stats=s.stats,this.ttl=s.ttl,this.maxCacheSize=s.maxCacheSize}}class dt{constructor(){this.allowedDirectories=this.loadAllowedDirectories(),this.blacklistedPaths=this.loadBlacklistedPaths(),this.permissionCache=new Map,this.cacheTimeout=5*60*1e3}async checkDirectoryAccess(s){if(!s)throw new Error("Directory path is required");const t=this._normalizePath(s),i=this.permissionCache.get(t);if(i&&Date.now()-i.timestamp<this.cacheTimeout){if(!i.allowed)throw new Error(`Directory access denied: ${s}`);return!0}if(!this.isDirectoryAllowed(t))throw this._cachePermission(t,!1),new Error(`Directory access denied: ${s}`);if(this.isBlacklisted(t))throw this._cachePermission(t,!1),new Error(`Directory is blacklisted: ${s}`);return this._cachePermission(t,!0),!0}async checkFileEditAccess(s){if(!s)throw new Error("File path is required");const t=this._getDirectoryPath(s);if(await this.checkDirectoryAccess(t),!this.isSafeFileExtension(s))throw new Error(`File type not allowed for editing: ${s}`);return!0}isDirectoryAllowed(s){const t=this._normalizePath(s);return this.allowedDirectories.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isBlacklisted(s){const t=this._normalizePath(s);return this.blacklistedPaths.some(i=>{const l=this._normalizePath(i);return t.startsWith(l)||t===l})}isSafeFileExtension(s){const t=[".exe",".bat",".cmd",".sh",".bin",".dll",".sys",".com",".scr",".vbs",".ps1",".app",".deb",".rpm"],i=this._getFileExtension(s).toLowerCase();return!t.includes(i)}loadAllowedDirectories(){return[`${this._getHomeDirectory()}`,"/"].filter(t=>t)}loadBlacklistedPaths(){const s=this._getHomeDirectory();return["C:\\Windows","C:\\Program Files","C:\\Program Files (x86)","C:\\ProgramData","/System","/etc","/root","/boot","/proc","/sys","/dev","/var/log",`${s}/.ssh`,`${s}/.aws`,`${s}/.gnupg`,`${s}/AppData/Local`,`${s}/AppData/Roaming`,`${s}/Library/Keychains`,".git",".svn",".hg","node_modules"].filter(t=>t)}addAllowedDirectory(s){const t=this._normalizePath(s);return this.allowedDirectories.includes(t)?!1:(this.allowedDirectories.push(t),this.permissionCache.clear(),!0)}removeAllowedDirectory(s){const t=this._normalizePath(s),i=this.allowedDirectories.indexOf(t);return i!==-1?(this.allowedDirectories.splice(i,1),this.permissionCache.clear(),!0):!1}addBlacklistedPath(s){const t=this._normalizePath(s);return this.blacklistedPaths.includes(t)?!1:(this.blacklistedPaths.push(t),this.permissionCache.clear(),!0)}getAllowedDirectories(){return[...this.allowedDirectories]}getBlacklistedPaths(){return[...this.blacklistedPaths]}clearCache(){this.permissionCache.clear()}_cachePermission(s,t){this.permissionCache.set(s,{allowed:t,timestamp:Date.now()})}_normalizePath(s){return s?s.replace(/\\/g,"/").replace(/\/+/g,"/").replace(/\/$/,"").toLowerCase():""}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_getFileExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.substring(t):""}_getHomeDirectory(){return typeof process>"u"||!{}?"":{}.HOME||{}.USERPROFILE||{}.HOMEPATH||""}getCacheStats(){return{cacheSize:this.permissionCache.size,cacheTimeout:this.cacheTimeout}}export(){return{allowedDirectories:this.allowedDirectories,blacklistedPaths:this.blacklistedPaths}}import(s){s.allowedDirectories&&(this.allowedDirectories=s.allowedDirectories),s.blacklistedPaths&&(this.blacklistedPaths=s.blacklistedPaths),this.permissionCache.clear()}}class vn{constructor(s,t=null){this.apiBase=s||"http://localhost:3001",this.directoryManager=t||new dt,this.maxFileSize=50*1024*1024}async readFile(s,t={}){try{const i=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(i);const l=t.maxSize||this.maxFileSize,o=await fetch(`${this.apiBase}/api/file-system/read-file?path=${encodeURIComponent(s)}&maxSize=${l}`);if(!o.ok){const c=await o.json().catch(()=>({}));throw new Error(c.message||`Failed to read file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to read file");return{success:!0,content:r.content,size:r.size,encoding:r.encoding||t.encoding||"utf-8",path:s}}catch(i){throw console.error("Error reading file:",i),new Error(`Failed to read file: ${i.message}`)}}async editFile(s,t,i={}){try{if(await this.directoryManager.checkFileEditAccess(s),i.validate&&typeof i.validate=="function")try{i.validate(t)}catch(c){throw new Error(`Content validation failed: ${c.message}`)}let l=null;if(i.backup)try{l=await this.createBackup(s)}catch(c){if(console.warn("Failed to create backup:",c),i.requireBackup)throw new Error(`Backup required but failed: ${c.message}`)}const o=await fetch(`${this.apiBase}/api/file-system/write-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s,content:t,encoding:i.encoding||"utf-8",backup:i.backup||!1})});if(!o.ok){const c=await o.json().catch(()=>({}));throw new Error(c.message||`Failed to write file: ${o.statusText}`)}const r=await o.json();if(!r.success)throw new Error(r.message||"Failed to write file");return{success:!0,path:s,backupPath:l||r.backupPath,bytesWritten:t.length}}catch(l){throw console.error("Error editing file:",l),new Error(`Failed to edit file: ${l.message}`)}}async createBackup(s){try{const t=new Date().toISOString().replace(/[:.]/g,"-"),i=`${s}.backup.${t}`,l=await fetch(`${this.apiBase}/api/file-system/backup-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:s,backupPath:i})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Backup failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Backup failed");return o.backupPath||i}catch(t){throw new Error(`Failed to create backup: ${t.message}`)}}async deleteFile(s,t={}){try{await this.directoryManager.checkFileEditAccess(s);let i=null;t.backup&&(i=await this.createBackup(s));const l=await fetch(`${this.apiBase}/api/file-system/delete-file`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Delete failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Delete failed");return{success:!0,path:s,backupPath:i}}catch(i){throw new Error(`Failed to delete file: ${i.message}`)}}async renameFile(s,t){try{await this.directoryManager.checkFileEditAccess(s);const i=this._getDirectoryPath(t);await this.directoryManager.checkDirectoryAccess(i);const l=await fetch(`${this.apiBase}/api/file-system/rename-file`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPath:s,newPath:t})});if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.message||"Rename failed")}const o=await l.json();if(!o.success)throw new Error(o.message||"Rename failed");return{success:!0,oldPath:s,newPath:t}}catch(i){throw new Error(`Failed to rename file: ${i.message}`)}}async getFileInfo(s){try{const t=this._getDirectoryPath(s);await this.directoryManager.checkDirectoryAccess(t);const i=await fetch(`${this.apiBase}/api/file-system/file-info?path=${encodeURIComponent(s)}`);if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||"Failed to get file info")}const l=await i.json();if(!l.success)throw new Error(l.message||"Failed to get file info");return{success:!0,...l.info}}catch(t){throw new Error(`Failed to get file info: ${t.message}`)}}async fileExists(s){try{return(await this.getFileInfo(s)).success}catch{return!1}}async validateFileSize(s,t=null){const i=await this.getFileInfo(s),l=t||this.maxFileSize;if(i.size>l)throw new Error(`File too large: ${this._formatBytes(i.size)} (max: ${this._formatBytes(l)})`);return!0}setMaxFileSize(s){this.maxFileSize=s}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):t}_formatBytes(s,t=2){if(s===0)return"0 Bytes";const i=1024,l=t<0?0:t,o=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(s)/Math.log(i));return parseFloat((s/Math.pow(i,r)).toFixed(l))+" "+o[r]}export(){return{apiBase:this.apiBase,maxFileSize:this.maxFileSize,directoryConfig:this.directoryManager.export()}}}class yn{constructor(s){this.apiBase=s||"http://localhost:3001",this.bitmaskIndex=new gn,this.fsCache=new jn(5*60*1e3),this.directoryManager=new dt,this.fileEditor=new vn(this.apiBase,this.directoryManager),this.isIndexing=!1,this.indexProgress=0,this.lastIndexTime=null,this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0},this.queryCache=new Map,this.queryCacheSize=100,this.queryCacheTTL=2*60*1e3}async initialize(){console.log("ðŸš€ Initializing FastSearchEngine...");try{this._startBackgroundIndexing(),console.log("âœ… FastSearchEngine initialized")}catch(s){console.error("âŒ Failed to initialize FastSearchEngine:",s)}}async searchFiles(s,t={}){const i=performance.now();this.searchStats.totalSearches++;try{const l=this._getQueryCacheKey(s,t),o=this._getFromQueryCache(l);if(o)return console.log("âš¡ Cache hit for query:",s),o;t.directory&&await this.directoryManager.checkDirectoryAccess(t.directory);let r;const c=this.bitmaskIndex.getStats().totalFiles>100;c&&!t.forceAPISearch?(r=await this._indexedSearch(s,t),this.searchStats.indexedSearches++):(r=await this._apiSearch(s,t),this.searchStats.fallbackSearches++),t.checkPermissions!==!1&&(r.files=r.files.filter(S=>{const N=this._getDirectoryPath(S.path);return this.directoryManager.isDirectoryAllowed(N)}));const y=performance.now()-i;this._updateSearchStats(y);const g={...r,searchTime:y,indexed:c,cached:!1};return this._addToQueryCache(l,g),g}catch(l){throw console.error("Search error:",l),new Error(`Search failed: ${l.message}`)}}async _indexedSearch(s,t){console.log("ðŸ” Using indexed search for:",s);const i=this.bitmaskIndex.search(s,{fileTypes:t.fileTypes,minSize:t.minSize,maxSize:t.maxSize,modifiedAfter:t.modifiedAfter,modifiedBefore:t.modifiedBefore,limit:t.limit||1e3});return{success:!0,files:i.map(l=>({id:`file-${l.id}`,name:l.name,displayName:l.name,path:l.path,type:l.type==="folder"?"folder":"file",fileType:l.type,size:l.size,modified:l.modified,parentPath:this._getDirectoryPath(l.path)})),total:i.length,query:s}}async _apiSearch(s,t){console.log("ðŸŒ Using API search for:",s);const i=t.directory||"/",l=`${this.apiBase}/api/file-system/search?query=${encodeURIComponent(s)}&path=${encodeURIComponent(i)}`,o=await fetch(l);if(!o.ok)throw new Error(`API search failed: ${o.statusText}`);const r=await o.json();if(!r.success)throw new Error(r.message||"API search failed");return r.results&&r.results.length>0&&this._indexSearchResults(r.results),{success:!0,files:r.results||[],total:r.results?.length||0,query:s}}async listDirectory(s,t={}){try{return await this.directoryManager.checkDirectoryAccess(s),{success:!0,items:(await this.fsCache.listDirectory(s,async o=>{const c=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(o)}`)).json();if(!c.success)throw new Error(c.message||"Failed to list directory");return c.items&&c.items.length>0&&this._indexSearchResults(c.items),c.items||[]})).filter(o=>{const r=o.type==="folder"?o.path:this._getDirectoryPath(o.path);return this.directoryManager.isDirectoryAllowed(r)}),path:s}}catch(i){throw new Error(`Failed to list directory: ${i.message}`)}}async readFileContent(s,t={}){return await this.fileEditor.readFile(s,t)}async updateFileContent(s,t,i={}){const l=await this.fileEditor.editFile(s,t,i);return this._invalidateCachesForPath(s),l}async deleteFile(s,t={}){const i=await this.fileEditor.deleteFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),i}async renameFile(s,t){const i=await this.fileEditor.renameFile(s,t);return this._removeFromIndex(s),this._invalidateCachesForPath(s),this._invalidateCachesForPath(t),i}async _startBackgroundIndexing(){if(!this.isIndexing){this.isIndexing=!0,console.log("ðŸ“‡ Starting background indexing...");try{const t=this.directoryManager.getAllowedDirectories().slice(0,5);await this.fsCache.warmup(t,async i=>{try{const o=await(await fetch(`${this.apiBase}/api/file-system/browse?path=${encodeURIComponent(i)}`)).json();return o.success?o.items||[]:[]}catch(l){return console.warn(`Failed to prefetch ${i}:`,l.message),[]}}),this.lastIndexTime=Date.now(),console.log("âœ… Background indexing complete")}catch(s){console.error("âŒ Background indexing failed:",s)}finally{this.isIndexing=!1}}}_indexSearchResults(s){s.forEach(t=>{this.bitmaskIndex.addFile(t.path,{name:t.name||t.displayName,size:t.size||0,modified:t.modified||Date.now(),type:t.fileType||t.type||"file"})})}_removeFromIndex(s){const t=Array.from(this.bitmaskIndex.fileMetadata.values()).find(i=>i.path===s);t&&this.bitmaskIndex.removeFile(t.id)}_invalidateCachesForPath(s){const t=this._getDirectoryPath(s);this.fsCache.invalidate(t),this.queryCache.clear()}_getQueryCacheKey(s,t){return JSON.stringify({query:s.toLowerCase(),options:t})}_getFromQueryCache(s){const t=this.queryCache.get(s);return t?Date.now()-t.timestamp>this.queryCacheTTL?(this.queryCache.delete(s),null):{...t.data,cached:!0}:null}_addToQueryCache(s,t){if(this.queryCache.size>=this.queryCacheSize){const i=this.queryCache.keys().next().value;this.queryCache.delete(i)}this.queryCache.set(s,{data:t,timestamp:Date.now()})}_updateSearchStats(s){const t=this.searchStats.totalSearches,i=this.searchStats.avgSearchTime;this.searchStats.avgSearchTime=(i*(t-1)+s)/t}getStats(){return{search:this.searchStats,index:this.bitmaskIndex.getStats(),cache:this.fsCache.getStats(),security:{allowedDirectories:this.directoryManager.getAllowedDirectories().length,blacklistedPaths:this.directoryManager.getBlacklistedPaths().length},queryCache:{size:this.queryCache.size,maxSize:this.queryCacheSize}}}clearAll(){this.bitmaskIndex.clear(),this.fsCache.clear(),this.queryCache.clear(),this.directoryManager.clearCache(),this.searchStats={totalSearches:0,avgSearchTime:0,indexedSearches:0,fallbackSearches:0}}_getDirectoryPath(s){const t=s.replace(/\\/g,"/"),i=t.lastIndexOf("/");return i!==-1?t.substring(0,i):"/"}export(){return{index:this.bitmaskIndex.export(),cache:this.fsCache.export(),directoryConfig:this.directoryManager.export(),stats:this.searchStats,lastIndexTime:this.lastIndexTime}}import(s){s.index&&this.bitmaskIndex.import(s.index),s.cache&&this.fsCache.import(s.cache),s.directoryConfig&&this.directoryManager.import(s.directoryConfig),s.stats&&(this.searchStats=s.stats),s.lastIndexTime&&(this.lastIndexTime=s.lastIndexTime)}}const es="http://localhost:3001",wn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l})=>{Ie();const{isConnected:o}=$e(),[r,c]=n.useState("/"),[y,g]=n.useState([]),[S,N]=n.useState([]),[T,L]=n.useState(""),[m,M]=n.useState(!1),[p,u]=n.useState(null),[f,C]=n.useState(!1),[k,z]=n.useState(!1),[Y,U]=n.useState(null),[B]=n.useState(()=>new yn(es)),[P,E]=n.useState(null),[H,X]=n.useState(null),O=n.useRef(null),W=n.useRef(null),I=300,J=n.useRef(null);n.useEffect(()=>{B.initialize();const v=setInterval(()=>{X(B.getStats())},5e3);return()=>clearInterval(v)},[B]),n.useEffect(()=>{if(s||t){const v=setTimeout(()=>{a()},3e3);return()=>clearTimeout(v)}},[s,t,a]),n.useEffect(()=>{o&&ee()},[o]),n.useEffect(()=>{o&&te()},[r,o]),n.useEffect(()=>(J.current&&clearTimeout(J.current),T.trim()===""?(N(y),M(!1),E(null)):(M(!0),J.current=setTimeout(()=>{h(T)},300)),()=>{J.current&&clearTimeout(J.current)}),[T]),n.useEffect(()=>{T.trim()===""&&N(y)},[y]),n.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]);const ee=async()=>{try{const q=await(await fetch(`${es}/api/file-system/info`)).json();U(q),q.accessible||i("Network projects directory is not accessible.")}catch(v){console.error("Error checking network access:",v),i("Failed to check network directory access: "+v.message),U({accessible:!1,message:"Connection failed"})}},te=async()=>{C(!0),a();try{const v=await B.listDirectory(r);if(v.success)g(v.items),N(v.items);else throw new Error("Failed to load directory")}catch(v){console.error("Error fetching file system items:",v),i(v.message||"Failed to load directory contents"),g([]),N([])}finally{C(!1)}},h=async v=>{if(!v||v.trim()===""){N(y),M(!1);return}M(!0),a();try{const q=performance.now(),K=await B.searchFiles(v,{directory:r,recursive:!0,checkPermissions:!0,limit:500}),Z=performance.now()-q;E({time:Z,indexed:K.indexed,cached:K.cached,resultCount:K.files.length,query:v}),N(K.files),Z<100&&K.files.length>0&&l(`âš¡ Found ${K.files.length} results in ${Z.toFixed(0)}ms ${K.cached?"(cached)":K.indexed?"(indexed)":""}`)}catch(q){if(console.error("Search error:",q),q.message.includes("permission denied")||q.message.includes("access denied"))i(`Access denied: ${q.message}`);else{console.log("Falling back to local search");const K=y.filter(Z=>Z.displayName.toLowerCase().includes(v.toLowerCase()));N(K)}}finally{M(!1)}},x=v=>{c(v),L(""),u(null),E(null)},F=v=>{O.current&&clearTimeout(O.current),W.current===v.id?(W.current=null,d(v)):(W.current=v.id,w(v),O.current=setTimeout(()=>{W.current=null},I))},w=v=>{p===v.id?u(null):u(v.id)},d=async v=>{if(v.type==="folder")x(v.path);else{z(!0),l(`Opening ${v.displayName}...`);try{if(await new Promise(K=>setTimeout(K,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const Z=await(await fetch(`${es}/api/file-system/filepath?path=${encodeURIComponent(v.path)}`)).json();if(!Z.success)throw new Error(Z.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",Z.fullPath),console.log("ðŸ“„ File type:",Z.fileType);const re=await window.electron.openFileInApp(Z.fullPath);if(re.success)console.log("âœ… Opened with Windows default application"),l(`Opened ${v.displayName}`);else throw new Error(re.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const K=`${es}/api/file-system/file?path=${encodeURIComponent(v.path)}`,Z=window.open(K,"_blank");if(!Z)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");Z.focus(),console.log("âœ… Opened in browser tab"),l(`Opened ${v.displayName} in browser`)}}catch(q){console.error("âŒ Error opening file:",q),i(`Error opening file: ${q.message||"Failed to open file"}`)}finally{z(!1)}}},j=()=>{if(r==="/")return[{name:"PROJECTS",path:"/"}];const v=r.split("/").filter(Z=>Z),q=[{name:"PROJECTS",path:"/"}];let K="";return v.forEach(Z=>{K+=`/${Z}`,q.push({name:Z.length>20?Z.substring(0,20)+"...":Z,path:K,fullName:Z})}),q};return o?e.jsxs("div",{className:`file-management-section ${k?"file-opening-cursor":""}`,children:[Y&&e.jsxs("div",{className:`network-status ${Y.accessible?"accessible":"not-accessible"}`,children:[e.jsx("span",{className:"status-text",children:Y.accessible?"Network directory accessible":"Network directory not accessible"}),e.jsx("span",{className:"network-path",children:Y.path||"\\\\KMTI-NAS\\Shared\\Public\\PROJECTS"})]}),e.jsxs("div",{className:"file-nav-controls",children:[e.jsx("div",{className:"breadcrumb-container",children:e.jsx("nav",{className:"breadcrumb",children:j().map((v,q)=>e.jsxs("span",{className:"breadcrumb-item",children:[q>0&&e.jsx("span",{className:"breadcrumb-separator",children:"/"}),e.jsx("button",{className:`breadcrumb-link ${q===j().length-1?"active":""}`,onClick:()=>x(v.path),disabled:q===j().length-1,title:v.fullName||v.name,children:v.name})]},v.path))})}),e.jsx("div",{className:"file-controls-right",children:e.jsxs("div",{className:"file-search",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:T,onChange:v=>L(v.target.value),className:"search-input"}),T&&e.jsx("button",{className:"search-clear-btn",onClick:()=>L(""),title:"Clear search",children:"Ã—"})]})})]}),P&&e.jsxs("div",{className:"search-performance-bar",children:[e.jsxs("span",{className:"perf-badge",children:["âš¡ ",P.time.toFixed(0),"ms"]}),e.jsx("span",{className:"perf-badge",children:P.cached?"ðŸ’¾ Cached":P.indexed?"ðŸ“‡ Indexed":"ðŸŒ API"}),e.jsxs("span",{className:"perf-badge",children:["ðŸ“Š ",P.resultCount," results"]}),H&&e.jsxs("span",{className:"perf-badge",title:"Cache statistics",children:["ðŸ’¿ ",H.cache.cacheSize," dirs cached (",H.cache.hitRate," hit rate)"]})]}),s&&e.jsx(me,{type:"error",message:s,onClose:a}),t&&e.jsx(me,{type:"success",message:t,onClose:a}),e.jsx("div",{className:"file-system-container",children:f||m?e.jsx(ce,{type:"grid"}):e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"component-loading-overlay",children:e.jsx(ce,{type:"grid"})}),e.jsx("div",{className:`files-content ${k?"loading":""}`,children:e.jsx("div",{className:"files-grid",children:S.length===0&&T?e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['No files found for "',T,'"']}),e.jsx("p",{className:"no-results-hint",children:"Try a different search term or check your spelling"})]}):S.map(v=>e.jsxs("div",{className:`file-item ${v.type} ${p===v.id?"selected":""}`,onClick:()=>F(v),title:`${v.name}
1st click: Select
2nd click: Open`,children:[e.jsx("div",{className:"file-icon",children:e.jsx(qe,{fileType:v.fileType,isFolder:v.type==="folder",altText:v.type,className:"file-icon-img"})}),e.jsxs("div",{className:"file-info",children:[e.jsx("div",{className:"file-name",title:v.name,children:v.displayName}),v.parentPath&&T&&e.jsxs("div",{className:"file-location",title:v.parentPath,children:["ðŸ“ ",v.parentPath]})]})]},v.id))})})]})})]}):e.jsx(ce,{type:"table"})},Nn=Te(wn,{componentName:"File Management"});const bn=({clearMessages:a,error:s,success:t,setError:i,setSuccess:l,users:o,user:r})=>{Ie();const{isConnected:c}=$e(),[y,g]=n.useState(!1),[S,N]=n.useState([]),[T,L]=n.useState(!1),[m,M]=n.useState("Loading..."),[p,u]=n.useState({name:"",leaderId:"",leaderUsername:""}),[f,C]=n.useState(null),[k,z]=n.useState({isOpen:!1,teamId:null,teamName:""}),[Y,U]=n.useState({fileManagement:{rootDirectory:""},general:{timezone:"UTC",dateFormat:"ISO",language:"en-US"}}),[B,P]=n.useState(!0);n.useEffect(()=>{(async()=>{try{if(window.updater&&window.updater.getVersion){const j=await window.updater.getVersion();M(`v${j}`)}else{const v=await(await fetch("http://localhost:3001/api/version")).json();v.success&&v.version?M(`v${v.version}`):M("Unknown")}}catch(j){console.error("Failed to fetch app version:",j),M("Unknown")}})()},[]);const E=(d,j,v)=>{U(q=>({...q,[d]:{...q[d],[j]:v}}))},H=async()=>{P(!0);try{const j=await(await fetch("http://localhost:3001/api/settings/root_directory")).json();j.success&&j.setting&&U(v=>({...v,fileManagement:{...v.fileManagement,rootDirectory:j.setting.value||"/home/admin/files"}}))}catch(d){console.error("Failed to fetch settings:",d),i("Failed to load settings")}finally{P(!1)}},X=async()=>{a();try{if(console.log("Browse button clicked"),console.log("window.electron available:",!!window.electron),console.log("window.electron.openDirectoryDialog available:",!!(window.electron&&window.electron.openDirectoryDialog)),window.electron&&window.electron.openDirectoryDialog){console.log("Opening Electron directory dialog...");const d=await window.electron.openDirectoryDialog();if(console.log("Dialog result:",d),!d.canceled&&d.filePaths&&d.filePaths.length>0){const j=d.filePaths[0];console.log("Selected path:",j),U(v=>({...v,fileManagement:{...v.fileManagement,rootDirectory:j}})),l(`Selected directory: ${j}`)}else console.log("Dialog was canceled")}else console.warn("Electron API not available"),i("Folder browser is only available in the desktop application. Please enter the path manually or run the Electron app.")}catch(d){console.error("Error browsing directory:",d),i("Failed to open directory browser: "+d.message)}},O=async()=>{if(!Y.fileManagement.rootDirectory.trim()){i("Root directory path is required");return}g(!0);try{const j=await(await fetch("http://localhost:3001/api/settings/root_directory",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:Y.fileManagement.rootDirectory,updated_by:r?.username||"admin"})})).json();j.success?l("New directory settings saved successfully"):i(j.message||"Failed to save file directory settings")}catch(d){console.error("Error saving settings:",d),i("Failed to save file directory settings")}finally{g(!1)}};n.useEffect(()=>{c&&(W(),H())},[c]);const W=async()=>{L(!0);try{const j=await(await fetch("http://localhost:3001/api/teams")).json();j.success?N(j.teams||[]):i("Failed to fetch teams")}catch{i("Failed to fetch teams")}finally{L(!1)}},I=async()=>{if(!p.name.trim()){i("Team name is required");return}g(!0);try{const j=await(await fetch("http://localhost:3001/api/teams",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:p.name,leaderId:p.leaderId,leaderUsername:p.leaderUsername})})).json();j.success?(l("Team created successfully"),u({name:"",leaderId:"",leaderUsername:""}),W()):i(j.message||"Failed to create team")}catch{i("Failed to create team")}finally{g(!1)}},J=async()=>{if(!f||!f.name.trim()){i("Team name is required");return}g(!0);try{const j=await(await fetch(`http://localhost:3001/api/teams/${f.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f.name,leaderId:f.leader_id,leaderUsername:f.leader_username,isActive:f.is_active})})).json();j.success?(l("Team updated successfully"),C(null),W()):i(j.message||"Failed to update team")}catch{i("Failed to update team")}finally{g(!1)}},ee=(d,j)=>{z({isOpen:!0,teamId:d,teamName:j})},te=async()=>{const{teamId:d,teamName:j}=k;g(!0);try{const q=await(await fetch(`http://localhost:3001/api/teams/${d}`,{method:"DELETE"})).json();q.success?(l(`Team '${j}' deleted successfully`),W()):i(q.message||"Failed to delete team")}catch{i("Failed to delete team")}finally{g(!1),z({isOpen:!1,teamId:null,teamName:""})}},h=()=>{z({isOpen:!1,teamId:null,teamName:""})},x=d=>C({...d}),F=()=>C(null),w=()=>o?.filter(d=>d.role==="TEAM LEADER"||d.role==="ADMIN")||[];return c?e.jsxs("div",{className:`settings-section ${y?"loading-cursor":""}`,children:[s&&e.jsx(me,{type:"error",message:s,onClose:a}),t&&e.jsx(me,{type:"success",message:t,onClose:a}),e.jsxs("div",{className:"settings-grid",children:[e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"File Management"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Root Directory Path"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{type:"text",value:Y.fileManagement.rootDirectory,onChange:d=>E("fileManagement","rootDirectory",d.target.value),placeholder:"/home/admin/files",className:"form-input",disabled:B}),e.jsx("button",{className:"btn btn-secondary",onClick:X,disabled:y||B,title:"Browse for folder (Desktop app only)",children:"Browse"}),e.jsx("button",{className:"btn btn-primary",onClick:O,disabled:y||B,children:y?"Saving...":"Save"})]}),e.jsx("p",{className:"help-text",children:"Base directory for files"})]})})]}),e.jsxs("div",{className:"settings-card team-management-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"Team Management"})}),e.jsxs("div",{className:"settings-card-body",children:[e.jsxs("div",{className:"team-section",children:[e.jsx("h4",{children:"Create New Team"}),e.jsxs("div",{className:"team-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Name"}),e.jsx("input",{type:"text",value:p.name,onChange:d=>u(j=>({...j,name:d.target.value})),placeholder:"Enter team name",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Team Leader"}),e.jsxs("select",{value:p.leaderId,onChange:d=>{const j=w().find(v=>v.id==d.target.value);u(v=>({...v,leaderId:d.target.value,leaderUsername:j?j.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),w().map(d=>e.jsxs("option",{value:d.id,children:[d.fullName," (",d.username,") - ",d.role]},d.id))]})]}),e.jsx("button",{className:"btn btn-primary",id:"create-team-btn",onClick:I,disabled:y||!p.name.trim(),children:y?"Creating...":"Create Team"})]})]}),e.jsxs("div",{className:"team-section",children:[e.jsxs("h4",{children:["Existing Teams (",S.length,")"]}),T?e.jsx("div",{className:"loading-state",children:"Loading teams..."}):S.length===0?e.jsx("div",{className:"empty-state",children:"No teams found"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"teams-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Team Name"}),e.jsx("th",{children:"Leader"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:S.map(d=>e.jsx("tr",{children:f&&f.id===d.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:f.name,onChange:j=>C(v=>({...v,name:j.target.value})),className:"form-input"})}),e.jsx("td",{children:e.jsxs("select",{value:f.leader_id||"",onChange:j=>{const v=w().find(q=>q.id==j.target.value);C(q=>({...q,leader_id:j.target.value,leader_username:v?v.username:""}))},className:"form-select",children:[e.jsx("option",{value:"",children:"No Team Leader"}),w().map(j=>e.jsxs("option",{value:j.id,children:[j.fullName," (",j.username,")"]},j.id))]})}),e.jsx("td",{children:e.jsxs("select",{value:f.is_active,onChange:j=>C(v=>({...v,is_active:j.target.value==="true"})),className:"form-select",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:J,disabled:y,children:y?"Saving...":"Save"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:F,children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:d.name}),e.jsx("td",{children:d.leader_username||"No leader assigned"}),e.jsx("td",{children:e.jsx("span",{className:`status ${d.is_active?"active":"inactive"}`,children:d.is_active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsxs("div",{className:"team-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>x(d),children:"Edit"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>ee(d.id,d.name),children:"Delete"})]})})]})},d.id))})]})})]})]})]}),e.jsxs("div",{className:"settings-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h3",{children:"System Information"})}),e.jsx("div",{className:"settings-card-body",children:e.jsxs("div",{className:"system-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Application Version:"}),e.jsx("span",{className:"info-value",children:m})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Database Version:"}),e.jsx("span",{className:"info-value",children:"MySQL"})]})]})})]})]}),e.jsx(Re,{isOpen:k.isOpen,onClose:h,onConfirm:te,title:"Delete Team",message:"Are you sure you want to delete this team?",confirmText:"Delete Team",variant:"danger",isLoading:y,itemInfo:k.teamName?{name:k.teamName,details:"All team members will be unassigned"}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The team will be permanently removed from the system."})})]}):e.jsx(ce,{type:"admin"})},kn=Te(bn,{componentName:"Settings"});const Cn=({error:a,success:s,setError:t,setSuccess:i,clearMessages:l,user:o,contextAssignmentId:r})=>{Ie(),$e();const[c,y]=n.useState([]),[g,S]=n.useState(!0),[N,T]=n.useState(!1),[L,m]=n.useState({}),[M,p]=n.useState(!1),[u,f]=n.useState(null),[C,k]=n.useState([]),[z,Y]=n.useState(!1),[U,B]=n.useState(""),[P,E]=n.useState(null),[H,X]=n.useState(""),[O,W]=n.useState({}),[I,J]=n.useState(!1),[ee,te]=n.useState(!1),[h,x]=n.useState(null),[F,w]=n.useState(!1),[d,j]=n.useState(null),[v,q]=n.useState({}),[K,Z]=n.useState(null),[re,fe]=n.useState(!0),ge=n.useRef(null),we=n.useRef(null);n.useEffect(()=>{Ce()},[]),n.useEffect(()=>{if(r&&typeof r=="object"){const{assignmentId:b,commentId:$,shouldOpenComments:se}=r;if(b&&se){const ne=c.find(le=>le.id===b);ne&&(A(ne),$&&setTimeout(()=>{const le=document.querySelector(`[data-comment-id="${$}"]`);le&&(le.scrollIntoView({behavior:"smooth",block:"center"}),le.classList.add("highlight-comment"),setTimeout(()=>{le.classList.remove("highlight-comment")},2e3))},500))}}},[r,c]),n.useEffect(()=>{if(g||N||!re)return;const b={root:null,rootMargin:"100px",threshold:.1};return ge.current=new IntersectionObserver($=>{$[0].isIntersecting&&re&&!N&&(console.log("Intersection detected, loading more..."),Se())},b),we.current&&ge.current.observe(we.current),()=>{ge.current&&ge.current.disconnect()}},[g,N,re,K]),n.useEffect(()=>{const b=$=>{d&&!$.target.closest(".admin-card-menu")&&j(null)};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[d]);const Ce=async()=>{try{S(!0),l(),console.log("Fetching initial assignments...");const $=await(await fetch("http://localhost:3001/api/assignments/admin/all?limit=20")).json();if(console.log("Initial assignments response:",$),!$.success){t($.message||"Failed to fetch assignments"),S(!1);return}const se=$.assignments||[];console.log(`Fetched ${se.length} initial assignments`),y(se),Z($.nextCursor),fe($.hasMore)}catch(b){console.error("Error fetching assignments:",b),t("Failed to load assignments")}finally{S(!1)}},Se=n.useCallback(async()=>{if(N||!re||!K){console.log("Skipping fetch:",{loadingMore:N,hasMore:re,nextCursor:K});return}try{T(!0),console.log("Fetching more assignments with cursor:",K);const $=await(await fetch(`http://localhost:3001/api/assignments/admin/all?cursor=${K}&limit=20`)).json();if(console.log("More assignments response:",$),!$.success){t($.message||"Failed to fetch more assignments");return}const se=$.assignments||[];console.log(`Fetched ${se.length} more assignments`),y(ne=>[...ne,...se]),Z($.nextCursor),fe($.hasMore)}catch(b){console.error("Error fetching more assignments:",b),t("Failed to load more assignments")}finally{T(!1)}},[K,re,N]),xe=n.useCallback(async b=>{try{Y(!0);const se=await(await fetch(`http://localhost:3001/api/assignments/${b}/comments`)).json();se.success?k(se.comments||[]):t(se.message||"Failed to load comments. Please try again.")}catch($){console.error("Error fetching comments:",$),t("Failed to load comments")}finally{Y(!1)}},[t]),A=n.useCallback(b=>{f(b),p(!0),xe(b.id)},[xe]),Q=n.useCallback(()=>{p(!1),f(null),k([]),B(""),E(null),X("")},[]),V=n.useCallback(async b=>{if(b.preventDefault(),!!U.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const $=o,se=U,ne={id:`temp-${Date.now()}`,comment:se,user_id:$.id,username:$.username,user_fullname:$.fullName,user_role:$.role,created_at:new Date().toISOString(),replies:[]};k(be=>[...be,ne]),B("");const Ne=await(await fetch(`http://localhost:3001/api/assignments/${u.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:$.id,username:$.username,comment:se})})).json();Ne.success?(await xe(u.id),i("Comment posted successfully"),setTimeout(()=>i(""),3e3)):(k(be=>be.filter(_e=>_e.id!==ne.id)),B(se),t(Ne.message||"Failed to post comment"))}catch($){console.error("Error posting comment:",$),t("Failed to post comment")}},[U,o,u,xe,t,i]),de=n.useCallback(async(b,$)=>{if(b.preventDefault(),!!H.trim())try{if(!o||!o.id){t("User session not found. Please log in again.");return}const se=o,ne=H,le={id:`temp-${Date.now()}`,reply:ne,user_id:se.id,username:se.username,user_fullname:se.fullName,user_role:se.role,created_at:new Date().toISOString()};k(_e=>_e.map(ye=>ye.id===$?{...ye,replies:[...ye.replies||[],le]}:ye)),X(""),E(null);const be=await(await fetch(`http://localhost:3001/api/assignments/${u.id}/comments/${$}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:se.id,username:se.username,reply:ne})})).json();be.success?(await xe(u.id),i("Reply posted successfully"),setTimeout(()=>i(""),3e3)):(k(_e=>_e.map(ye=>ye.id===$?{...ye,replies:(ye.replies||[]).filter(hs=>hs.id!==le.id)}:ye)),X(ne),E($),t(be.message||"Failed to post reply"))}catch(se){console.error("Error posting reply:",se),t("Failed to post reply")}},[H,o,u,xe,t,i]),_=b=>{m($=>({...$,[b]:!$[b]}))},G=b=>{q($=>({...$,[b]:!$[b]}))},ae=n.useCallback(b=>b?b.split(" ").map($=>$[0]).join("").toUpperCase().slice(0,2):"?",[]),je=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No due date",ve=b=>{if(!b)return"";const ne=new Date(b)-new Date,le=Math.ceil(ne/(1e3*60*60*24));return le<0?`${Math.abs(le)} days overdue`:le===0?"Due today":le===1?"1 day left":`${le} days left`},ls=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown",os=n.useCallback(b=>{if(!b)return"Unknown";const $=new Date(b),ne=Math.floor((new Date-$)/1e3);return ne<60?"Just now":ne<3600?`${Math.floor(ne/60)}m ago`:ne<86400?`${Math.floor(ne/3600)}h ago`:ne<604800?`${Math.floor(ne/86400)}d ago`:$.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[]),rs=b=>{if(!b)return"#95a5a6";const $=new Date(b),ne=Math.ceil(($-new Date)/(1e3*60*60*24));return ne<0?"#e74c3c":ne<=2?"#f39c12":"#27ae60"},cs=n.useCallback(b=>{W($=>({...$,[b]:!$[b]}))},[]),ds=async(b,$)=>{if(!b){t("File path not available");return}try{if(J(!0),l(),i("Opening file..."),await new Promise(ne=>setTimeout(ne,300)),window.electron&&window.electron.openFileInApp){console.log("ðŸ’» Running in Electron - using Windows default application");const le=await(await fetch(`http://localhost:3001/api/files/${$}/path`)).json();if(!le.success)throw new Error(le.message||"Failed to get file path");console.log("ðŸ“‚ Full path:",le.filePath),console.log("ðŸ“„ File name:",le.fileName);const Ne=await window.electron.openFileInApp(le.filePath);if(Ne.success)console.log("âœ… Opened with Windows default application"),i("File opened successfully");else throw new Error(Ne.error||"Failed to open file")}else{console.log("ðŸŒ Running in browser - opening in new tab");const ne=`http://localhost:3001${b}`,le=window.open(ne,"_blank");if(!le)throw new Error("Pop-up blocked. Please allow pop-ups for this site.");le.focus(),console.log("âœ… Opened in browser tab"),i("File opened in browser")}}catch(se){console.error("âŒ Error opening file:",se),i(""),t(`Error opening file: File deleted/rejected or ${se.message||"Failed to open file"}`)}finally{J(!1)}},Me=async()=>{if(h)try{w(!0),l(),i("Deleting assignment and associated files...");const $=await(await fetch(`http://localhost:3001/api/assignments/${h.id}`,{method:"DELETE"})).json();$.success?(y(se=>se.filter(ne=>ne.id!==h.id)),i("Assignment and associated files deleted successfully"),setTimeout(()=>i(""),3e3),te(!1),x(null)):t($.message||"Failed to delete assignment")}catch(b){console.error("Error deleting assignment:",b),t("Failed to delete assignment")}finally{w(!1)}},Be=()=>{te(!1),x(null)};return g?e.jsx("div",{className:"task-management-container",children:e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsx("div",{className:"task-count",children:"Loading..."}),e.jsx("div",{className:"feed-container",children:e.jsx("div",{className:"loading-skeleton",children:[1,2,3].map(b=>e.jsxs("div",{className:"skeleton-assignment-card",children:[e.jsxs("div",{className:"skeleton-card-header",children:[e.jsxs("div",{className:"skeleton-header-left",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-header-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]}),e.jsx("div",{className:"skeleton-header-right",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]}),e.jsx("div",{className:"skeleton-title-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-title"})}),e.jsxs("div",{className:"skeleton-description-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-full"}),e.jsx("div",{className:"skeleton-line skeleton-line-medium"})]}),e.jsxs("div",{className:"skeleton-attachment-section",children:[e.jsx("div",{className:"skeleton-line skeleton-line-small"}),e.jsxs("div",{className:"skeleton-file-item",children:[e.jsx("div",{className:"skeleton-file-icon"}),e.jsxs("div",{className:"skeleton-file-info",children:[e.jsx("div",{className:"skeleton-line skeleton-line-medium"}),e.jsx("div",{className:"skeleton-line skeleton-line-small"})]})]})]}),e.jsx("div",{className:"skeleton-comments-section",children:e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})})]},b))})})]})}):e.jsxs("div",{className:`task-management-container ${I?"file-opening-cursor":""}`,children:[a&&e.jsx(me,{type:"error",message:a,onClose:l}),s&&e.jsx(me,{type:"success",message:s,onClose:l}),e.jsxs("div",{className:"task-feed",children:[e.jsx("div",{className:"feed-header-simple",children:e.jsx("h2",{children:"All Tasks"})}),e.jsxs("div",{className:"task-count",children:[c.length," task",c.length!==1?"s":"",re&&" â€¢ Scroll for more"]}),e.jsx("div",{className:"feed-container",children:c.length===0?e.jsxs("div",{className:"empty-feed",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“­"}),e.jsx("h3",{children:"No Tasks Yet"}),e.jsx("p",{children:"Team leaders haven't created any assignments yet."})]}):e.jsxs(e.Fragment,{children:[c.map(b=>e.jsxs("div",{className:"admin-assignment-card",children:[e.jsxs("div",{className:"admin-card-header",children:[e.jsxs("div",{className:"admin-header-left",children:[e.jsx("div",{className:"admin-avatar",children:ae(b.team_leader_fullname||b.team_leader_username)}),e.jsxs("div",{className:"admin-header-info",children:[e.jsxs("div",{className:"admin-assignment-assigned",children:[e.jsx("span",{className:"admin-team-leader-name",children:b.team_leader_fullname||b.team_leader_username}),e.jsx("span",{className:"role-badge team-leader",children:"TEAM LEADER"}),"assigned to"," ",e.jsx("span",{className:"admin-assigned-user",children:b.assigned_member_details&&b.assigned_member_details.length>0?b.assigned_member_details.length===1?b.assigned_member_details[0].fullName||b.assigned_member_details[0].username:`${b.assigned_member_details.length} members (${b.assigned_member_details.map($=>$.fullName||$.username).join(", ")})`:b.assigned_to==="all"?"All team members":"Unknown User"})]}),e.jsx("div",{className:"admin-assignment-created",children:b.created_at?ls(b.created_at):"Unknown creation date"})]})]}),e.jsxs("div",{className:"admin-header-right",children:[e.jsxs("div",{className:"admin-card-menu",children:[e.jsx("button",{className:"admin-menu-btn",onClick:()=>j(d===b.id?null:b.id),title:"More options",children:"â‹®"}),d===b.id&&e.jsx("div",{className:"admin-menu-dropdown",children:e.jsx("button",{className:"admin-menu-item admin-delete-menu-item",onClick:()=>{x(b),te(!0),j(null)},children:"Delete"})})]}),b.due_date&&e.jsxs("div",{className:"admin-due-date",children:["Due: ",je(b.due_date),e.jsxs("span",{className:"admin-days-left",style:{color:rs(b.due_date)},children:[" ","(",ve(b.due_date),")"]})]})]})]}),e.jsx("div",{className:"admin-task-title-section",children:e.jsx("h3",{className:"admin-assignment-title",children:b.title})}),b.description&&e.jsx("div",{className:"admin-task-description-section",children:e.jsxs("p",{className:"admin-assignment-description",children:[L[b.id]?b.description:b.description.length>200?`${b.description.substring(0,200)}...`:b.description,b.description.length>200&&e.jsx("button",{className:"admin-expand-btn",onClick:()=>_(b.id),children:L[b.id]?"Show less":"Show more"})]})}),e.jsx("div",{className:"admin-attachment-section",children:b.recent_submissions&&b.recent_submissions.length>0?e.jsxs("div",{className:"admin-attached-file",children:[e.jsxs("div",{className:"admin-file-label",children:["ðŸ“Ž Attachment",b.recent_submissions.length>1?"s":""," (",b.recent_submissions.length,"):"]}),(v[b.id]?b.recent_submissions:b.recent_submissions.slice(0,5)).map(($,se)=>e.jsxs("div",{className:"admin-file-item",onClick:()=>ds($.file_path,$.id),style:{cursor:"pointer",marginBottom:se<(v[b.id]?b.recent_submissions.length:Math.min(5,b.recent_submissions.length))-1?"8px":"0"},children:[e.jsx(qe,{fileType:$.original_name.split(".").pop(),size:"small",className:"admin-file-icon"}),e.jsxs("div",{className:"admin-file-details",children:[e.jsx("div",{className:"admin-file-name",children:$.original_name}),e.jsxs("div",{className:"admin-file-meta",children:["Submitted by ",e.jsx("span",{className:"admin-file-submitter",children:$.fullName||$.username})," on ",je($.submitted_at),$.tag&&e.jsxs("span",{style:{backgroundColor:"#dbeafe",color:"#1e40af",padding:"4px 10px",borderRadius:"12px",fontSize:"11px",fontWeight:"600",border:"1px solid #93c5fd",display:"inline-flex",alignItems:"center",gap:"4px",marginLeft:"8px"},children:["ðŸ·ï¸ ",$.tag]})]})]})]},$.id)),b.recent_submissions.length>5&&e.jsx("button",{className:"admin-attachment-toggle-btn",onClick:()=>G(b.id),children:v[b.id]?"See less":`See more (${b.recent_submissions.length-5} more)`})]}):e.jsxs("div",{className:"admin-no-attachment",children:[e.jsx("span",{className:"admin-no-attachment-icon",children:"ðŸ“„"}),e.jsx("span",{className:"admin-no-attachment-text",children:"No attachments yet"})]})}),e.jsx("div",{className:"admin-comments-section",children:e.jsxs("div",{className:"admin-comments-text",onClick:()=>A(b),children:["Comments (",b.comment_count||0,")"]})})]},b.id)),N&&e.jsx("div",{className:"inline-skeleton-container",children:[1,2].map(b=>e.jsxs("div",{className:"skeleton-card",children:[e.jsxs("div",{className:"skeleton-header",children:[e.jsx("div",{className:"skeleton-avatar"}),e.jsxs("div",{className:"skeleton-text",children:[e.jsx("div",{className:"skeleton-line skeleton-line-short"}),e.jsx("div",{className:"skeleton-line skeleton-line-tiny"})]})]}),e.jsxs("div",{className:"skeleton-body",children:[e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line skeleton-line-short"})]})]},b))}),re&&!N&&e.jsx("div",{ref:we,style:{height:"20px",margin:"20px 0"}})]})}),e.jsx(st,{isOpen:M,onClose:Q,assignment:u,comments:C,loadingComments:z,newComment:U,setNewComment:B,onPostComment:V,replyingTo:P,setReplyingTo:E,replyText:H,setReplyText:X,onPostReply:de,visibleReplies:O,toggleRepliesVisibility:cs,getInitials:ae,formatTimeAgo:os,user:o}),e.jsx(Re,{isOpen:ee,onClose:Be,onConfirm:Me,title:"Delete Task",message:"Are you sure you want to delete this task?",confirmText:"Delete Task",cancelText:"Cancel",variant:"danger",isLoading:F,itemInfo:h?{name:h.title,details:`${h.comment_count||0} comment${(h.comment_count||0)!==1?"s":""} â€¢ ${h.recent_submissions?.length||0} submission${(h.recent_submissions?.length||0)!==1?"s":""}`}:null,children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. The task and all associated comments will be permanently removed from the system."})})]})]})},Sn=Te(Cn,{componentName:"Task Management"});const ht=n.memo(({notification:a,onNotificationClick:s,onDeleteNotification:t,NotificationIcon:i,formatTimeAgo:l})=>e.jsxs("div",{className:`notification-item ${a.is_read?"":"unread"}`,onClick:()=>s(a),children:[e.jsx("div",{className:"notification-icon",children:e.jsx(i,{type:a.type})}),e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-title",children:a.title}),e.jsx("div",{className:"notification-message",children:a.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsxs("span",{className:"notification-author",children:["ðŸ‘¤ ",a.action_by_username," (",a.action_by_role,")"]}),a.assignment_title&&e.jsxs("span",{className:"notification-assignment",children:["Assignment: ",a.assignment_title]}),a.file_name&&e.jsx("span",{className:"notification-file",children:a.file_name}),a.assignment_due_date&&e.jsxs("span",{className:"notification-due-date",children:["Due: ",new Date(a.assignment_due_date).toLocaleDateString()]})]}),e.jsx("div",{className:"notification-time",children:l(a.created_at)})]}),e.jsx("button",{className:"notification-delete",onClick:o=>{o.stopPropagation(),t(a.id)},children:"âœ•"})]}));ht.displayName="NotificationItem";const _n=({user:a,onNavigate:s})=>{const[t,i]=n.useState([]),[l,o]=n.useState(!0),[r,c]=n.useState(!1),[y,g]=n.useState(""),[S,N]=n.useState(0),[T,L]=n.useState(!1),[m,M]=n.useState(!1);at(S);const[p,u]=n.useState(1),[f,C]=n.useState(!0),[k,z]=n.useState(0),Y=20,U=n.useRef(null),B=n.useRef(null),[P,E]=n.useState(null);n.useEffect(()=>{H(1,!0);const x=setInterval(()=>{H(1,!0,!0)},3e4);return()=>clearInterval(x)},[a.id]),n.useEffect(()=>{if(l||r||!f)return;const x={root:null,rootMargin:"100px",threshold:.1};return U.current=new IntersectionObserver(F=>{F[0].isIntersecting&&f&&!r&&H(p+1,!1)},x),B.current&&U.current.observe(B.current),()=>{U.current&&U.current.disconnect()}},[l,r,f,p]);const H=async(x,F=!1,w=!1)=>{try{F&&!w?o(!0):w||c(!0);const j=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}?page=${x}&limit=${Y}`)).json();if(j.success){const v=j.notifications||[],q=v.filter(K=>K.type==="password_reset_request");if(q.length>0&&(console.log("ðŸ” Password reset notifications found:",q.length),q.forEach(K=>{console.log("  - Notification:",{id:K.id,type:K.type,action_by_id:K.action_by_id,action_by_username:K.action_by_username,file_id:K.file_id,message:K.message})})),F)i(v),u(1);else if(w){const K=new Set(t.map(re=>re.id)),Z=v.filter(re=>!K.has(re.id));Z.length>0&&i([...Z,...t])}else i(K=>[...K,...v]),u(x);N(j.unreadCount||0),z(j.totalCount||0),C(j.hasMore||!1)}else g("Failed to fetch notifications")}catch(d){console.error("Error fetching notifications:",d),w||g("Failed to fetch notifications")}finally{F&&!w?o(!1):w||c(!1)}},X=async x=>{try{(await(await fetch(`http://localhost:3001/api/notifications/${x}/read`,{method:"PUT"})).json()).success&&(i(d=>d.map(j=>j.id===x?{...j,is_read:!0}:j)),N(d=>Math.max(0,d-1)))}catch(F){console.error("Error marking notification as read:",F)}},O=async()=>{try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/read-all`,{method:"PUT"})).json()).success&&(i(w=>w.map(d=>({...d,is_read:!0}))),N(0))}catch(x){console.error("Error marking all as read:",x)}},W=async x=>{try{if((await(await fetch(`http://localhost:3001/api/notifications/${x}`,{method:"DELETE"})).json()).success){const d=t.find(j=>j.id===x);i(j=>j.filter(v=>v.id!==x)),z(j=>j-1),d&&!d.is_read&&N(j=>Math.max(0,j-1))}}catch(F){console.error("Error deleting notification:",F)}},I=async()=>{M(!0);try{(await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}/delete-all`,{method:"DELETE"})).json()).success&&(i([]),N(0),z(0),C(!1),L(!1))}catch(x){console.error("Error deleting all notifications:",x),g("Failed to delete all notifications")}finally{M(!1)}},J=x=>{if(x.is_read||X(x.id),console.log("ðŸ“‹ Notification clicked:",x),console.log("   - Full notification object:",JSON.stringify(x,null,2)),console.log("   - Type:",x.type),console.log("   - Type (string):",String(x.type)),console.log("   - Type comparison:",x.type==="password_reset_request"),console.log("   - Type includes:",String(x.type).includes("password_reset_request")),String(x.type).includes("password_reset_request")){if(console.log("ðŸ”‘ Password reset request detected"),console.log("   - action_by_id:",x.action_by_id),console.log("   - action_by_username:",x.action_by_username),console.log("   - file_id:",x.file_id),console.log("   - onNavigate exists:",!!s),s){console.log("ðŸ”‘ Password reset request - Navigating to User Management");const F={userId:x.action_by_id,action:"reset-password",username:x.action_by_username};console.log("   - Context data:",F),s("users",F)}else console.error("âŒ onNavigate is not defined!");return}String(x.type).includes("comment")?x.assignment_id&&(x.comment_id&&E(x.comment_id),s&&s("tasks",{assignmentId:x.assignment_id,commentId:x.comment_id,shouldOpenComments:!0})):x.assignment_id?s&&s("tasks",x.assignment_id):x.file_id&&(x.type==="approval"||x.type==="rejection"?s&&s("file-approval",x.file_id):s&&s("file-management",x.file_id))},ee=({type:x})=>e.jsx(qe,{fileType:x,size:"medium",altText:`${x} notification icon`,className:"notification-type-icon"}),te=n.useCallback(x=>{const F=new Date,w=new Date(x),d=Math.floor((F-w)/1e3);return d<60?`${d}s ago`:d<3600?`${Math.floor(d/60)}m ago`:d<86400?`${Math.floor(d/3600)}h ago`:d<604800?`${Math.floor(d/86400)}d ago`:w.toLocaleDateString()},[]),h=()=>e.jsx("div",{className:"notification-skeleton",children:[1,2,3,4,5].map(x=>e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"}),e.jsx("div",{className:"skeleton-line skeleton-line-meta"})]})]},x))});return l?e.jsxs("div",{className:"notifications-page",children:[e.jsx("div",{className:"notifications-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]})}),e.jsx(h,{})]}):e.jsxs("div",{className:`notifications-page ${l?"loading-cursor":""}`,children:[e.jsxs("div",{className:"notifications-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Notifications"}),e.jsx("p",{className:"notifications-subtitle",children:"Stay updated with your file approvals and system messages"})]}),e.jsxs("div",{className:"notifications-actions",children:[S>0&&e.jsx("button",{className:"btn-mark-all-read",onClick:O,children:"Mark All as Read"}),t.length>0&&e.jsx("button",{className:"btn-delete-all",onClick:()=>L(!0),children:"Delete All"})]})]}),y&&e.jsx("div",{className:"error-message",children:y}),e.jsxs("div",{className:"notifications-stats",children:[k," total â€¢ ",S," unread"]}),t.length===0?e.jsxs("div",{className:"no-notifications",children:[e.jsx("div",{className:"no-notifications-icon",children:"ðŸ””"}),e.jsx("h3",{children:"No notifications"}),e.jsx("p",{children:"You're all caught up! Check back later for updates."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"notifications-list",children:t.map(x=>e.jsx(ht,{notification:x,onNotificationClick:J,onDeleteNotification:W,NotificationIcon:ee,formatTimeAgo:te},x.id))}),r&&e.jsxs("div",{className:"notifications-loading-more",children:[e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]}),e.jsxs("div",{className:"notification-skeleton-item",children:[e.jsx("div",{className:"skeleton-icon"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line skeleton-line-title"}),e.jsx("div",{className:"skeleton-line skeleton-line-message"})]})]})]}),f&&!r&&e.jsx("div",{ref:B,className:"load-more-trigger"}),!f&&t.length>=Y&&e.jsx("div",{className:"end-of-list",children:e.jsx("p",{children:"You've reached the end of your notifications"})})]}),T&&e.jsx(Re,{isOpen:T,onClose:()=>L(!1),onConfirm:I,title:"Delete All Notifications",message:"Are you sure you want to delete all notifications?",confirmText:"Delete All",cancelText:"Cancel",variant:"danger",isLoading:m,itemInfo:{name:`${k} notification${k!==1?"s":""}`,details:`Including ${S} unread notification${S!==1?"s":""}`},children:e.jsx("p",{className:"warning-text",children:"This action cannot be undone. All notifications will be permanently removed from your account."})})]})},Fn=Te(_n,{componentName:"Notifications"}),Tn=({user:a,onLogout:s})=>{const[t,i]=n.useState("dashboard"),[l,o]=n.useState([]),[r,c]=n.useState(""),[y,g]=n.useState(""),[S,N]=n.useState([]),[T,L]=n.useState(0),[m,M]=n.useState(null),[p,u]=n.useState(!1),f=n.useRef(null),C=n.useRef(null);n.useEffect(()=>{$s({targets:f.current,opacity:[0,1],duration:300,easing:"easeOutCubic"}),$s({targets:C.current,opacity:[0,1],duration:300,delay:100,easing:"easeOutCubic"})},[]),n.useEffect(()=>{k(),z();const O=setInterval(z,1e4);return()=>clearInterval(O)},[]);const k=async()=>{try{const W=await(await fetch("http://localhost:3001/api/users")).json();W.success&&o(W.users)}catch(O){console.error("Error fetching users:",O)}},z=async()=>{try{const W=await(await fetch(`http://localhost:3001/api/notifications/user/${a.id}`)).json();W.success&&(N(W.notifications||[]),L(W.unreadCount||0))}catch(O){console.error("Error fetching notifications:",O)}},Y=()=>{s()},U=()=>{c(""),g("")},B=(O,W=null)=>{i(O),M(W),U()},P=(O,W)=>{if(console.log("ðŸ”” Admin Navigation triggered:",{tabName:O,contextData:W}),p&&u(!1),i(O),M(W),U(),W){const I=document.querySelector(".content-area");I&&(I.scrollTop=0),W.action==="reset-password"&&console.log("ðŸ”‘ Password reset context:",W)}},E=()=>{u(!p)},H=()=>{u(!1)},X=()=>{const O={clearMessages:U,error:r,success:y,setError:c,setSuccess:g};switch(t){case"dashboard":return e.jsx(Ks,{user:a,users:l});case"users":return e.jsx(on,{...O,user:a,contextData:m});case"activity-logs":return e.jsx(mn,{...O});case"file-approval":return e.jsx(xn,{...O,contextFileId:m});case"file-management":return e.jsx(Nn,{...O,contextFileId:m});case"tasks":return e.jsx(Sn,{...O,user:a,contextAssignmentId:m});case"notifications":return e.jsx(Fn,{user:a,onNavigate:P});case"settings":return e.jsx(kn,{...O,users:l,user:a});default:return e.jsx(Ks,{user:a,users:l})}};return e.jsx(Ga,{initialUser:a,children:e.jsx(Za,{children:e.jsx(en,{userId:a?.id,children:e.jsx(n.Suspense,{fallback:e.jsx(ce,{type:"admin"}),children:e.jsxs("div",{className:"minimal-admin-dashboard",children:[e.jsx("button",{className:`burger-menu-btn ${p?"active":""}`,onClick:E,"aria-label":"Toggle sidebar menu",children:e.jsxs("div",{className:"burger-menu-icon",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),e.jsx("div",{className:`sidebar-overlay ${p?"active":""}`,onClick:H}),e.jsxs("div",{className:`admin-sidebar ${p?"open":""}`,ref:f,children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"admin-info",children:[e.jsx("div",{className:"admin-name",children:a.fullName||"Admin User"}),e.jsx("div",{className:"admin-role",children:a.role||"Administrator"})]})}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs("button",{className:`nav-item ${t==="dashboard"?"active":""}`,onClick:()=>{B("dashboard"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("dashboard")}),e.jsx("span",{className:"nav-label",children:"Dashboard"})]}),e.jsxs("button",{className:`nav-item ${t==="notifications"?"active":""}`,onClick:()=>{B("notifications"),H()},children:[e.jsxs("span",{className:"nav-icon nav-icon-with-badge",children:[pe("notifications"),T>0&&e.jsx("span",{className:"sidebar-notification-badge",children:T>99?"99+":T})]}),e.jsx("span",{className:"nav-label",children:"Notifications"})]}),e.jsxs("button",{className:`nav-item ${t==="file-management"?"active":""}`,onClick:()=>{B("file-management"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("files")}),e.jsx("span",{className:"nav-label",children:"Files"})]}),e.jsxs("button",{className:`nav-item ${t==="users"?"active":""}`,onClick:()=>{B("users"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("users")}),e.jsx("span",{className:"nav-label",children:"Users"})]}),e.jsxs("button",{className:`nav-item ${t==="activity-logs"?"active":""}`,onClick:()=>{B("activity-logs"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("activityLogs")}),e.jsx("span",{className:"nav-label",children:"Activity Logs"})]}),e.jsxs("button",{className:`nav-item ${t==="file-approval"?"active":""}`,onClick:()=>{B("file-approval"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("fileApproval")}),e.jsx("span",{className:"nav-label",children:"File Approval"})]}),e.jsxs("button",{className:`nav-item ${t==="tasks"?"active":""}`,onClick:()=>{B("tasks"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("tasks")}),e.jsx("span",{className:"nav-label",children:"Tasks"})]}),e.jsxs("button",{className:`nav-item ${t==="settings"?"active":""}`,onClick:()=>{B("settings"),H()},children:[e.jsx("span",{className:"nav-icon",children:pe("settings")}),e.jsx("span",{className:"nav-label",children:"Settings"})]})]}),e.jsx("div",{className:"sidebar-footer",children:e.jsxs("button",{onClick:Y,className:"logout-btn",children:[e.jsx("span",{className:"nav-icon",children:pe("logout")}),e.jsx("span",{className:"logout-btn-text",children:"Logout"})]})})]}),e.jsx("div",{className:"admin-main-content",ref:C,children:e.jsx("div",{className:"content-area",children:X()})}),e.jsx(nt,{notifications:S,onNavigate:P,role:"admin"})]})})})})})};var Mn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const En=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Dn=(a,s)=>{const t=n.forwardRef(({color:i="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:r,children:c,...y},g)=>n.createElement("svg",{ref:g,...Mn,width:l,height:l,stroke:i,strokeWidth:r?Number(o)*24/Number(l):o,className:`lucide lucide-${En(a)}`,...y},[...s.map(([S,N])=>n.createElement(S,N)),...(Array.isArray(c)?c:[c])||[]]));return t.displayName=`${a}`,t};var is=Dn;const Js=is("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),An=is("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Ln=is("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),In=is("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const $n=({id:a,type:s,title:t,message:i,duration:l=5e3,onClose:o,action:r})=>{const[c,y]=n.useState(!0),[g,S]=n.useState(!1);n.useEffect(()=>{if(l>0){const m=setTimeout(()=>{N()},l);return()=>clearTimeout(m)}},[l]);const N=()=>{S(!0),setTimeout(()=>{y(!1),o(a)},300)},T=()=>{switch(s){case"success":return e.jsx(An,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(Js,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(Js,{className:"w-5 h-5 text-yellow-500"});case"info":default:return e.jsx(Ln,{className:"w-5 h-5 text-blue-500"})}},L=()=>{switch(s){case"success":return"bg-green-50 border-green-200";case"error":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":default:return"bg-blue-50 border-blue-200"}};return c?e.jsx("div",{className:`max-w-sm w-full animate-slide-in ${g?"animate-slide-out":""}`,style:{animation:g?"slideOut 0.3s ease-in forwards":"slideIn 0.3s ease-out"},children:e.jsx("div",{className:`${L()} border rounded-lg shadow-lg p-4`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:T()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:t}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:i}),r&&e.jsx("button",{onClick:r.onClick,className:"mt-2 px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors",children:r.label})]}),e.jsx("button",{onClick:N,className:"flex-shrink-0 p-1 hover:bg-gray-200 rounded transition-colors",children:e.jsx(In,{className:"w-4 h-4 text-gray-500"})})]})})}):null},Pn=({version:a,onInstall:s,onClose:t})=>e.jsx("div",{className:"update-alert-overlay",children:e.jsxs("div",{className:"update-alert-modal",children:[e.jsx(me,{type:"success",message:`Update ${a} has been downloaded and is ready to install. The application will restart to apply the update.`,onClose:t}),e.jsxs("div",{className:"update-alert-buttons",children:[e.jsx("button",{onClick:s,className:"update-install-btn",children:"Install & Restart"}),e.jsx("button",{onClick:t,className:"update-cancel-btn",children:"Cancel"})]})]})}),Rn=()=>{const[a,s]=n.useState([]),[t,i]=n.useState(null),l=n.useCallback(g=>{const S=Date.now()+Math.random(),N={id:S,...g};return s(T=>[...T,N]),S},[]),o=n.useCallback(g=>{s(S=>S.filter(N=>N.id!==g))},[]),r=n.useCallback(()=>{window.updater&&window.updater.restartAndInstall(),i(null)},[]),c=n.useCallback(()=>{i(null)},[]),y=n.useCallback((g,S)=>{switch(g){case"available":l({type:"info",title:"Update Available",message:`Version ${S.version} is available for download.`,duration:1e4});break;case"downloading":break;case"downloaded":i({version:S.version});break;case"error":l({type:"error",title:"Update Failed",message:S.message||"Failed to check for updates.",duration:8e3,action:{label:"Retry",onClick:()=>{window.updater&&window.updater.checkForUpdates()}}});break}},[l]);return n.useEffect(()=>{if(window.updater)return window.updater.onStatus(S=>{y(S.status,S)})},[y]),n.useEffect(()=>(window.toastContainer={addToast:l,showUpdateToast:y},()=>{delete window.toastContainer}),[l,y]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 z-50 pointer-events-none",children:a.map((g,S)=>e.jsx("div",{className:"pointer-events-auto mb-2",style:{transform:`translateY(${S*10}px)`,zIndex:50+S},children:e.jsx($n,{...g,onClose:o})},g.id))}),t&&e.jsx(Pn,{version:t.version,onInstall:r,onClose:c})]})},Ee=Ys("App");function Bn(){const[a,s]=n.useState(()=>{const o=localStorage.getItem("user");if(o)try{const r=JSON.parse(o);return Ee.info("User session restored from localStorage"),r}catch(r){return Ee.error("Error parsing saved user",r),localStorage.removeItem("user"),null}return null}),t=o=>{Ee.logLogin(o),s(o),localStorage.setItem("user",JSON.stringify(o)),Ee.logStateUpdate("User authenticated and saved")},i=()=>{Ee.logLogout(),s(null),localStorage.removeItem("user")},l=()=>{if(!a)return null;switch(Ee.logNavigation("login",`${a.panelType}-dashboard`),a.panelType){case"user":return e.jsx(qs,{user:a,onLogout:i});case"teamleader":return e.jsx(Qa,{user:a,onLogout:i});case"admin":return e.jsx(Tn,{user:a,onLogout:i});default:return Ee.warn("Unknown panel type, defaulting to user dashboard",{panelType:a.panelType}),e.jsx(qs,{user:a,onLogout:i})}};return e.jsx(Pt,{children:e.jsxs("div",{className:"app",children:[e.jsx(Rn,{}),e.jsxs(Rt,{children:[e.jsx(vs,{path:"/login",element:a?e.jsx(ys,{to:"/dashboard",replace:!0}):e.jsx(Yt,{onLogin:t})}),e.jsx(vs,{path:"/dashboard",element:a?l():e.jsx(ys,{to:"/login",replace:!0})}),e.jsx(vs,{path:"/",element:e.jsx(ys,{to:a?"/dashboard":"/login",replace:!0})})]})]})})}class zn extends Ss.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0}}componentDidCatch(s,t){console.error("ErrorBoundary caught an error:",s,t),this.setState({error:s,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{style:De.container,children:e.jsxs("div",{style:De.card,children:[e.jsx("h1",{style:De.title,children:"âš ï¸ Oops! Something went wrong"}),e.jsx("p",{style:De.message,children:"The application encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{style:De.buttonGroup,children:[e.jsx("button",{onClick:this.handleReset,style:De.primaryButton,children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),style:De.secondaryButton,children:"Reload Page"})]}),!1]})}):this.props.children}}const De={container:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#f5f5f5",padding:"20px"},card:{backgroundColor:"white",borderRadius:"8px",padding:"40px",maxWidth:"600px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center"},title:{fontSize:"24px",marginBottom:"16px",color:"#333"},message:{fontSize:"16px",color:"#666",marginBottom:"24px",lineHeight:"1.5"},buttonGroup:{display:"flex",gap:"12px",justifyContent:"center",marginBottom:"24px"},primaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s"},secondaryButton:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#fff",color:"#333",border:"2px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"},details:{marginTop:"24px",textAlign:"left"},summary:{cursor:"pointer",padding:"12px",backgroundColor:"#f9f9f9",borderRadius:"4px",fontWeight:"600"},errorDetails:{marginTop:"12px",padding:"16px",backgroundColor:"#fff5f5",borderRadius:"4px",border:"1px solid #ffcccb"},errorMessage:{marginBottom:"12px",color:"#d32f2f"},errorStack:{fontSize:"12px",color:"#666",overflow:"auto",maxHeight:"200px",whiteSpace:"pre-wrap",wordWrap:"break-word"}};typeof window<"u"&&(window.React=Ss);const mt=document.getElementById("root");if(!mt)throw new Error("Failed to find the root element");const On=Cs.createRoot(mt);On.render(e.jsx(zn,{children:e.jsx(Bn,{})}));console.log("âœ… React application initialized successfully");export{Wn as C,qe as F,Hs as L,Kn as N,Ia as S,at as a,qn as b,st as c,Re as d,Pa as g,e as j,nn as u};
